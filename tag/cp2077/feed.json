{
    "version": "https://jsonfeed.org/version/1",
    "title": "Sycamore's Blog • All posts by \"cp2077\" tag",
    "description": "",
    "home_page_url": "https://www.sycamore.top",
    "items": [
        {
            "id": "https://www.sycamore.top/Mod%20Develop/Cyberpunk%202077/Ciri%20Main%20Menu%20Background/",
            "url": "https://www.sycamore.top/Mod%20Develop/Cyberpunk%202077/Ciri%20Main%20Menu%20Background/",
            "title": "希里的 CP2077 主菜单背景",
            "date_published": "2024-11-05T14:56:23.000Z",
            "content_html": "<p>我试图在 2.0+ 版本中修复 mod: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmV4dXNtb2RzLmNvbS9jeWJlcnB1bmsyMDc3L21vZHMvMjU0MQ==\">Ciri in Night City - Main Menu Background Replacer</span>，添加对往日之影 Logo 的支持。</p>\n<hr />\n<p>原 Mod 启动效果图，可以看到没有往日之影的 logo：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730815548/Typera/2024/11/c42fe5caab097e56ca6115aa25028bde.png\" alt=\"image-20241106010540801\" /></p>\n<hr />\n<h1 id=\"修改方法\"><a class=\"anchor\" href=\"#修改方法\">#</a> 修改方法</h1>\n<p>修改工具：WolvenKit</p>\n<p>打开 Mod Browser，找到安装好的原 Mod</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730821582/Typera/2024/11/9c57c99a1327bca7356920876bd1a430.png\" alt=\"image-20241106024620104\" /></p>\n<p>全选，然后鼠标右键 Add selected items to project</p>\n<p>左侧 Project Explorer 中找到 menu_background.xbm 和  menu_background_1080p.xbm，这是出问题的文件（要替换），如下：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730821953/Typera/2024/11/b37f85839b86492728ac7dab74071424.png\" alt=\"image-20241106025230378\" /></p>\n<p>然后关闭 Mod Browser，根据 Project Explorer 中的路径（base\\gameplay\\gui\\fullscreen\\main_menu\\）找到游戏原文件中的 menu_background.xbm，如下：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730822090/Typera/2024/11/b58931a7d22c4213d44d924bd9586303.png\" alt=\"image-20241106025448022\" /></p>\n<p>选中，右键 Add selected items to project。弹窗问是否 Override，选择 Yes。替换成功。</p>\n<hr />\n<p>Buid -&gt; Pack Project，会在项目文件夹下打包为 zip 压缩包，这就是修复好的 Mod，安装到 CP2077，并卸载掉原 Mod。</p>\n<p>效果如下，成功补上往日之影的 Logo：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730822474/Typera/2024/11/fbc6ffdfb07adb1f77abc0edd380520e.png\" alt=\"image-20241106030106133\" /></p>\n<h1 id=\"分析原-mod\"><a class=\"anchor\" href=\"#分析原-mod\">#</a> 分析原 Mod</h1>\n<p>先阅读：关于 archive 中的文件介绍</p>\n<p>我的分析过程其实绕了很大的弯子，有兴趣可以看一下，其实蛮有意思的。</p>\n<p>或者你可以直接跳到：真正的修复点分析</p>\n<h2 id=\"定位背景图片的位置\"><a class=\"anchor\" href=\"#定位背景图片的位置\">#</a> 定位背景图片的位置</h2>\n<p>原 Mod 修改的文件还是有很多的，为了找到正确的思路，我选择先定位被修改的背景图片。</p>\n<hr />\n<p>根据游戏主线进度不同，赛博朋克的主菜单背景会更换图片。</p>\n<p>寻找后，我发现对应的目录： <code>base\\gameplay\\gui\\world\\loading_screens\\</code></p>\n<p>该目录下所谓 loading_screen_5_after_q101、loading_screen_10_after_q112，应该对应了主线中某些事件的发生，比如图片 loading_screen_10_after_q112\\loading_screen_10_shot_01.xbm：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730812872/Typera/2024/11/3609b16ee976bb030b37db1649a51d31.png\" alt=\"image-20241106002108908\" /></p>\n<p>这显然是在潜入山车安装病毒之后会出现的那个背景图。</p>\n<p>再比如图片 loading_screen_5_after_q101\\loading_screen_5_shot_01.xbm：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809719/Typera/2024/11/ffbe63923183b7d8602c1046d1bc2b84.png\" alt=\"image-20241105232833312\" /></p>\n<p>这对应目前我的主菜单图片：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809840/Typera/2024/11/a4e7e61df94dc872b29a72dd4b9fe6ba.png\" alt=\"image-20241105233029146\" /></p>\n<h2 id=\"进一步分析-inkwidget\"><a class=\"anchor\" href=\"#进一步分析-inkwidget\">#</a> 进一步分析 inkwidget</h2>\n<p>如果我要更换这个主菜单的背景图片，应该需要更改对应的 inkwidget 中的内容。</p>\n<p>原 mod 虽然不能显示往日之影的 logo，但是背景替换功能还是正常的，因此可以做一定的参考。</p>\n<p>着重分析：loading_screen_5_after_q101.inkwidget，因为这对应目前我主菜单的背景图片，方便我进行分析。这里面应该包括构成当前主菜单界面的资源。</p>\n<p>左：原文件；右：原 Mod 中修改后的文件</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730813070/Typera/2024/11/a23b9f1dc9b8ff26b6639b55bb702376.png\" alt=\"image-20241106002427225\" /></p>\n<p>先看右侧的原 Mod 文件，主要是文件 cp_bq_alphafaded.bk2，这就是被替换的希里背景动画。</p>\n<p>然后看左侧的游戏原文件，因为目前我的主菜单背景是 short01 的图片，所以不看 short02、short03 的内容：</p>\n<p><strong>smoke_loop.bk2</strong>：一个冒烟的动画视频</p>\n<p><strong>shot_01_assets.inkatlas</strong>：对文件 short_01_assets.xbm 进行了分割，提取出图片后面的三个光柱（ad）以及闪烁的灯光（antenna_lights）</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730814251/Typera/2024/11/28b987b84f447477c8c464cf7621f2cc.png\" alt=\"image-20241106004409120\" /></p>\n<p>short_01_assets.xbm 如下，应该能理解我的意思：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730814533/Typera/2024/11/01b0e79632d94fc3339833106b191ccf.png\" alt=\"image-20241106004850267\" /></p>\n<p><strong>loading_screen_5_shot_01.inkatlas</strong>：对应为主体背景，因为分割的那 4 个参数 Bottom、Left...，分别设置为了 0 和 1，也就是顶格分割，取了图片整体。</p>\n<p>如下是对主页面要素的标注，①对应 smoke_loop.bk2，②对应 shot_01_assets.inkatlas：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730814934/Typera/2024/11/48590ddd97bd03ba9d708ed367fa1ef8.png\" alt=\"image-20241106005529451\" /></p>\n<p>因此，如果只是要更换当前的背景图片，把 loading_screen_5_shot_01.xbm 换掉就行。</p>\n<h2 id=\"原-mod-思路分析\"><a class=\"anchor\" href=\"#原-mod-思路分析\">#</a> 原 Mod 思路分析</h2>\n<p>上一节说换 loading_screen_5_shot_01.xbm，其实是不够的。因为背景图片是会跟着主线剧情切换的。</p>\n<p>仔细对比可以发现，Mod 中更改的 loading_screen_5_after_q101.inkwidget，其内容和游戏原文件： base\\gameplay\\gui\\world\\loading_screens\\initial_loading_screen\\initial_loading_screen.inkwidget 完全一致。</p>\n<p>左：Mod 中的文件；右：initial_loading_screen.inkwidget</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730820048/Typera/2024/11/99b267900fa56628ce107626801cda75.png\" alt=\"image-20241106022045941\" /></p>\n<p>而我们知道，initial_loading_screen.inkwidget 中的 cp_bq_alphafaded.bk2，已经被替换为希里的背景动画了。</p>\n<p>因此 loading_screen_5_after_q101 对应的背景就会被替换为希里。</p>\n<p>再看原 Mod，每一个对应文件夹下的 inkwidget，其内容都被改成了 initial_loading_screen.inkwidget</p>\n<p>所以说原 Mod 的思路很绝：既然背景图片会换，那就把它们都改了！</p>\n<h2 id=\"真正的修复点分析\"><a class=\"anchor\" href=\"#真正的修复点分析\">#</a> 真正的修复点分析</h2>\n<p>上面分析了这么多其实对修复往日之影的 Logo 完全没用，因为在游戏原文件 loading_screen_5_after_q101.inkwidget 中，我并没有找到 Logo 的部分，上述内容都是原 Mod 更改背景图片的思路。</p>\n<p>但是把已经分析出作用的文件去掉，原 Mod 的结构就简单多了。</p>\n<hr />\n<p>我马上就发现了：base\\gameplay\\gui\\fullscreen\\main_menu\\menu_background.xbm，以及 menu_background_1080p.xbm</p>\n<p>左：原 Mod 中的 menu_background.xbm；右：游戏原目录中的 menu_background.xbm</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730821292/Typera/2024/11/e99ca6d089324954b2dfb1f94b502241.png\" alt=\"image-20241106024128469\" /></p>\n<p>少了什么一目了然，就是往日之影的 Logo。</p>\n<p>因此只要把正确的文件替换掉就行了。</p>\n",
            "tags": [
                "Develop",
                "Mod",
                "CP2077",
                "archive"
            ]
        },
        {
            "id": "https://www.sycamore.top/Mod%20Develop/Cyberpunk%202077/archive%E5%86%85%E5%AE%B9%E8%A7%A3%E6%9E%90/",
            "url": "https://www.sycamore.top/Mod%20Develop/Cyberpunk%202077/archive%E5%86%85%E5%AE%B9%E8%A7%A3%E6%9E%90/",
            "title": "archive 内容解析",
            "date_published": "2024-11-05T14:56:23.000Z",
            "content_html": "<p>本文内容会有些许凌乱，因为是 Mod 开发过程中，我对 archive 的一些文件代表的内容的想法。</p>\n<p>而且本人没有接触过 3D 动画、游戏制作这方面的内容，描述会存在很多不专业的地方。</p>\n<hr />\n<h1 id=\"文件类型和作用\"><a class=\"anchor\" href=\"#文件类型和作用\">#</a> 文件类型和作用</h1>\n<h2 id=\"xbm\"><a class=\"anchor\" href=\"#xbm\">#</a> xbm</h2>\n<p>这是一种图片类型的文件，对应游戏中出现的一些贴图的资源。</p>\n<p>通过 WolvenKit 可以查看图片的内容，比如 expansion_logo.xbm，如下所示：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730808788/Typera/2024/11/2c0934a8e3cdb50eaedad5bc5a2c17f0.png\" alt=\"image-20241105231302174\" /></p>\n<h2 id=\"inkatlas\"><a class=\"anchor\" href=\"#inkatlas\">#</a> inkatlas</h2>\n<p>这是某种代表了对 xbm 图片进行具体 ” 分割 “ 利用的文件。</p>\n<p>比如 expansion_logo.xbm 对应的 expansion_logo.inkatlas，内容如下：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730808890/Typera/2024/11/90a3c1b209806070d39ecdf04f3cd021.png\" alt=\"image-20241105231444965\" /></p>\n<p>再次展开这个 3：logo，并和 4：logo_EN 的数据进行对比，如下：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730808968/Typera/2024/11/4c4d7b17e1126d72bd67023217ae420f.png\" alt=\"image-20241105231603201\" /></p>\n<p>可以看到，其中包括的 Bottom、Left、Right、Top，对应的应该是 xbm 图片中 ” 被分割 “ 出来的具体图片的位置数据，这些数据被框定在 0~1 中。</p>\n<p>以下是我根据这些数据判断他们所对应图片的思路：</p>\n<p>3：logo 的 Bottom 和 4：logo_EN 的 Top 数值接近，几乎可以认为其就是上下相邻的两个图形。<br />\n他们的 Bottom 和 Top 数值接近于 1，因此应当位于 xbm 图片的下侧。<br />\n他们的 Left 数值相等且接近于 0，因此应当位于 xbm 图片的最左侧。</p>\n<p>所以，3：logo 和 4：logo_EN 应当分别对应 xbm 图片左下方的两个英文 logo: PHANTOM LIBERTY</p>\n<h2 id=\"inkwidget\"><a class=\"anchor\" href=\"#inkwidget\">#</a> inkwidget</h2>\n<p>这应该是说明了，组成某个界面需要用到的资源。</p>\n<hr />\n<h1 id=\"目录对应的功能\"><a class=\"anchor\" href=\"#目录对应的功能\">#</a> 目录对应的功能</h1>\n<h2 id=\"basegameplayguiworldloading_screens\"><a class=\"anchor\" href=\"#basegameplayguiworldloading_screens\">#</a>  <code>base\\gameplay\\gui\\world\\loading_screens\\</code></h2>\n<p>根据游戏主线进度不同，赛博朋克的主菜单背景会更换图片；加载存档时，会出现多张图片轮换播放。</p>\n<p>比如图片：loading_screen_5_after_q101\\loading_screen_5_shot_01.xbm</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809719/Typera/2024/11/ffbe63923183b7d8602c1046d1bc2b84.png\" alt=\"image-20241105232833312\" /></p>\n<p>可以在主菜单看到同样的图片：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809840/Typera/2024/11/a4e7e61df94dc872b29a72dd4b9fe6ba.png\" alt=\"image-20241105233029146\" /></p>\n<p>因此，如果我要更换这个主菜单的背景图片，需要更改对应的 inkwidget 中的内容。</p>\n<p>（后续分析：）</p>\n",
            "tags": [
                "Develop",
                "Mod",
                "CP2077",
                "archive"
            ]
        },
        {
            "id": "https://www.sycamore.top/Mod%20Develop/Cyberpunk%202077/Weapon%20Inspection/",
            "url": "https://www.sycamore.top/Mod%20Develop/Cyberpunk%202077/Weapon%20Inspection/",
            "title": "武器验视 Mod",
            "date_published": "2024-11-05T06:05:53.000Z",
            "content_html": "<p>开发中：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25vbmVTeWNhbW9yZS9XZWFwb24tSW5zcGVjdGlvbi1DUDIwNzc=\">noneSycamore/Weapon-Inspection-CP2077</span></p>\n",
            "tags": [
                "Develop",
                "Mod",
                "CP2077"
            ]
        }
    ]
}